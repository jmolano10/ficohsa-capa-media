sequenceDiagram
    autonumber
    participant Consumidor as Consumidore/Aplicación
    participant API as Currency Exchange Retrieves-Product <br> Epica 2576: ConsultaDisponibleVentaMonedaExtranjera <br> HU 10451:  GET - /consumer-services/currency-exchange-retrieves/v1/{currencyCode}/foreign-currency-availability
    participant LibraryPipeline as Library Pipeline <br> Currency Exchange Retrieves-Product
    participant Wrapper T24 as Wrapper T24 <br> BS: svcMercadoLibre/services <br/>Operation: consultamontodisponiblevtadolar
    participant Errors as Control de Errores <br/> <<Librería de mapeo de errores>>

    Note over Consumidor, Errors: Flujo Honduras (HN01) - ConsultaDisponibleVentaMonedaExtranjera

    alt T24 Response Exitoso
        Consumidor->>API: REST Request
        Note right of Consumidor: Header: SourceBank=HN01<br/>Path: currencyCode = USD
        
        API->>API: Validar request
        Note over API: Validar campos según contrato OpenAPI

        API->>API: Validación exitosa

        API->>API: Validar Servicio Regional
        Note right of API: key de config: CURRENCY_EXCHANGE_RETRIEVES
        
        API->>API: Validación Regional Exitosa

        API->>API: Patron Strategy Enrutamiento Regional
        Note right of API: Branch: SourceBank = ('HN01')

        API->>API: Estrategia Regional Seleccionada: HN01

        API->>LibraryPipeline: Consulta Constantes de Pipeline

        LibraryPipeline-->>API: Retorna Constantes de Pipeline

        Note right of API: Constantes que retorna <br> columnName = CURRENCY<br/>operand = EQ

        API->>API: Construir Request Wrapper T24
        Note right of API: Request: <br> columnName = CURRENCY <br> CURRENCY = USD <br> operand = EQ

        API->>Wrapper T24: CALL Wrapper T24

        Wrapper T24-->>API: successIndicator = Success
        Note left of Wrapper T24: Response: <br> successIndicator: Success<br/>AMOUNT_AVAILABLE:2500000.00

        API->>Consumidor: REST Response Exitoso
        Note right of Consumidor: Response: <br> Body: availableCurrencyAmount
    end

    activate API
    alt Exception occurs
        note over Errors: Error Library Handler
        activate Errors
            API->> Errors: Mapear código de error
            Errors -->> API: Retorna código mapeado
        deactivate Errors
        activate Consumidor
            API-->> Consumidor: Retorna error
        deactivate Consumidor
        Note over Consumidor,Errors: Diagrama guía de manejo de errores <br> http://bit.ly/4rpKVIU
    end
    deactivate API

    Note over Consumidor, Errors: Reglas de Negocio Aplicadas: <br> 1. Mapeo directo CURRENCY → criteriaValue