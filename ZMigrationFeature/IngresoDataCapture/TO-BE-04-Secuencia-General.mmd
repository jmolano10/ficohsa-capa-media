sequenceDiagram
    autonumber
    participant Consumidor as Consumidor/Aplicación
    participant API as API ConsultaDGI <br> Epica 2523: IngresoDataCapture <br> HU 7251:  POST - /regulations-and-compliance/financial-accounting-admin/v1/initiate-general-ledger-process
    participant CL as Caché Local
    participant Lambda as Lambda de parámetros
    participant UUID as Libería UUID
    participant WT24 as T24 Web Service<br/> Op: IngresodeDataCapture
    participant Errors as Control de Errores <br/> <<Librería de mapeo de errores>>

    Note over Consumidor, Errors: Flujo General - IngresoDataCapture

    Consumidor->>API: REST Request
    Note right of Consumidor: Header: SourceBank=HN01 <br/> Body: transactionBatchReference <br> organizationalUnitReference <br> accountNumber <br> currencyCode <br> transactionAmount <br> debitCreditIndicator <br> transactionDescription <br> valueDate <br> profitCenterReference <br> profitLossClassification <br> productCategory 
    API->>API: Validar Request
    Note over API: Valida campos obligatorios según contrato OpenAPI <br> transactionBatchReference (obligatorio) <br> currencyCode (obligatorio) <br> currencyCode (obligatorio) <br> transactionAmount (obligatorio) <br> debitCreditIndicator (obligatorio) <br> transactionDescription (obligatorio)

    API->>API: Validación exitosa

    API->>API: Validar Servicio Regional
    Note over API: domain: FINANCIAL_ACCOUNTING_ADMIN <br> name: CONFIG
    
    API->>API: Validación Regional Exitosa
    Note over API: Servicio habilitado para HN01

    alt Consulta parametros en caché local

        API->>CL: Consultar parámetros caché local
        Note right of API: Domain: FINANCIAL_ACCOUNTING_ADMIN <br> name: PARAM

        CL->>API: Obtiene parámetros 
        Note left of CL: ObtenerParametrizacion 2 Parámetros: <br> transactionCodeDeb <br> transactionCodeCred  

    else Consulta  parametros en Lambda Parámetros

        API->>Lambda: Consultar parámetros lambda parámetros
        Note right of API: Domain: FINANCIAL_ACCOUNTING_ADMIN <br> name: PARAM

        Lambda->>API: Obtiene parámetros 
        Note left of Lambda: ObtenerParametrizacion 2 Parámetros: <br> transactionCodeDeb <br> transactionCodeCred  

        API->>CL: Guarda parámetros en caché local
        Note right of API: transactionCodeDeb <br> transactionCodeCred  

    end

    API->>API: Transforma datos para campos SIGN y TRANSACTIONCODE
    Note over API: If (request.debitCreditIndicator = DEBIT) then <br> SIGN = D and TRANSACTIONCODE = param.transactionCodeDeb else <br> SIGN = C and TRANSACTIONCODE = param.transactionCodeCred

    API->>API: Transforma datos para campo gNARRATIVE/NARRATIVE[]
    Note over API: splitString(34) request.transactionDescription (Multiples)

    API->>API: Transforma datos para campos de moneda
    Note over API: If (request.currencyCode = HNL) then <br> AMOUNTLCY = request.transactionAmount else <br> CURRENCY = request.currencyCode and AMOUNTFCY = request.transactionAmount

    alt si header.Correlation-Id = vacío
        API->>UUID: Generar UUID 

        UUID->>API: Obtiene
    end

    API->>API: Construir Request Wrapper Cobis
    Note over API: OfsFunction/messageId = header.Correlation-Id <br> DATACAPTUREINPUTWSType/@id = concat(organizationalUnitReference||transactionBatchReference) <br> ACCOUNTNUMBER = accountNumber <br> PLCATEGORY = request.profitLossClassification <br> ACCOUNTOFFICER = request.profitCenterReference <br> PRODUCTCATEGORY = request.productCategory <br> VALUEDATE = request.valueDate

    API->>WT24: Invocar Wrapper T24 Op: IngresodeDataCapture
    Note right of API: Campos: <br> messageId <br> DATACAPTUREINPUTWSType/@id <br> ACCOUNTNUMBER <br> SIGN <br> TRANSACTIONCODE <br> gNARRATIVE/NARRATIVE <br> PLCATEGORY <br> ACCOUNTOFFICER <br> PRODUCTCATEGORY <br> VALUEDATE <br> AMOUNTLCY <br> CURRENCY <br> AMOUNTFCY

    WT24->>API: Response Wrapper T24 
    Note left of WT24: Campos: <br> transactionId <br> successIndicator <br> messages <br> VALUEDATE

    API->>API: Transformar Response
    Note over API: response.recordProcessingStatus = successIndicator

    API->>Consumidor: REST Response Success
    Note left of API: recordProcessingStatus

    activate API
    alt Exception occurs
        note over Errors: Error Library Handler
        activate Errors
            API->> Errors: Mapear código de error
            Errors -->> API: Retorna código mapeado
        deactivate Errors
        activate Consumidor
            API-->> Consumidor: Retorna error
        deactivate Consumidor
        Note over Consumidor,Errors: Diagrama guía de manejo de errores <br> http://bit.ly/4rpKVIU
    end
    deactivate API

    Note over Consumidor, Errors: Fin del flujo IngresoDataCapture