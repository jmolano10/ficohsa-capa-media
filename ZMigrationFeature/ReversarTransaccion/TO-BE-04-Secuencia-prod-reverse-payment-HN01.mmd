sequenceDiagram
    autonumber
    participant Consumidor as Consumidore/Aplicación
    participant API as API EliminarPagoRecaudo <br> Epica 2490: ReversarTransaccion <br> HU 6653: <br> POST: POST: /payments/payment-execution-admin/v1/reverse-transaction-payment
    participant CL as Caché Local
    participant Lambda as Lambda de Parámetros
    participant WT24 as Wrapper T24 <br> svcPagoRecaudos/services
    participant Errors as Control de Errores <br/> <<Librería de mapeo de errores>>

    Note over Consumidor, Errors: Flujo Honduras (HN01) - Reversar Pago Cheque

    alt Reverso Exitoso
        Consumidor->>API: Rest Request
        Note right of Consumidor: Header: SourceBank=HN01<br/>Body: transactionReference, transactionType, tellerType

        API->>API: Validar Rquest
        Note over  API: Validar obligatoriedad campos según contrato OpenAPI <br/> transactionReference != vacío, tellerType = true | false

        API->>API: Validación exitosa

        API->>API: Validar Servicio Regional
        Note over API: key de config: PAYMENT_EXECUTION_ADMIN
        
        API->>API: Validación Regional Exitosa
        Note over API: Servicio habilitado para HN01

        alt Consulta información de operación a consumir en caché local

            API->>CL: Consultar información de operación a consumir
            Note right of API: country = Header. SourceBank <br> value.operations = tellerType <br> 

            CL->>API: Retorna información de operación a consumir
            Note left of CL: value.operations.operation

        else Consulta información de operación a consumir con Lambda Parámetros

            API->>Lambda: Consultar información de operación a consumir
            Note right of API: country = Header. SourceBank <br> value.operations = tellerType

            Lambda->>API: Retorna información de operación a consumir
            Note left of Lambda: value.operations.operation

            API->>CL: Guarda información de las operaciones en caché local
            Note right of API: country = Header. SourceBank <br> value.operations = tellerType

        end

        API->>API: Construir Request a WT24
        Note over API: Trasnsactionid = transactionReference

        API->>WT24: CALL Operación T24
        Note right of API: Trasnsactionid

        WT24->>API: Response Reversión Trasnacción
        Note left of WT24: successIndicator

        API->>API: Transformar Response

        API->>Consumidor: REST Response exitoso
        Note right of Consumidor: body.data <br> transactionReference <br> transactionType <br> transactionDate

    end 

    activate API
    alt Exception occurs
        note over Errors: Error Library Handler
        activate Errors
            API->> Errors: Mapear código de error
            Errors -->> API: Retorna código mapeado
        deactivate Errors
        activate Consumidor
            API-->> Consumidor: Retorna error
        deactivate Consumidor
        Note over Consumidor,Errors: Diagrama guía de manejo de errores <br> http://bit.ly/4rpKVIU
    end
    deactivate API
