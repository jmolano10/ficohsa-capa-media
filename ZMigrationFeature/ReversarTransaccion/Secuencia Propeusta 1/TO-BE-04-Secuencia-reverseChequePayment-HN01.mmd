sequenceDiagram
    autonumber
    participant Consumidor as Consumidore/Aplicación
    participant API as API Reverso Pago Cheque <br> Epica 2490: ReversarTransaccion <br> HU 6653:  POST: /payments/cheque-processing-admin/v1/reverse-transaction
    participant WT24 as Wrapper T24 <br> svcResversaTransaccion/services <br> Operation: ReversiondePagodeCheques
    participant Errors as Control de Errores <br/> <<Librería de mapeo de errores>>

    Note over Consumidor, Errors: Flujo Honduras (HN01) - Reversar Pago Cheque

    alt Reverso Exitoso
        Consumidor->>API: Rest Request
        Note right of Consumidor: Header: SourceBank=HN01<br/>Body: transactionReference, transactionType

        API->>API: Validar Rquest
        Note over  API: Validar campos según contrato OpenAPI <br/> transactionReference != vacío

        API->>API: Validación exitosa

        API->>API: Validar Servicio Regional
        Note over API: key de config: CHEQUE_PROCESSING_ADMIN
        
        API->>API: Validación Regional Exitosa
        Note over API: Servicio habilitado para HN01

        API->>API: Validación Exitosa

        API->>API: Construir Request a WT24
        Note over API: Trasnsactionid = transactionReference

        API->>WT24: CALL ReversiondePagodeCheques
        Note right of API: Trasnsactionid

        WT24->>API: Response Reversión Cheque
        Note left of WT24: successIndicator
        API->>API: Transformar Response

        API->>Consumidor: REST Response exitoso
        Note right of Consumidor: body.data <br> transactionReference <br> transactionType <br> transactionDate
    end 

    activate API
    alt Exception occurs
        note over Errors: Error Library Handler
        activate Errors
            API->> Errors: Mapear código de error
            Errors -->> API: Retorna código mapeado
        deactivate Errors
        activate Consumidor
            API-->> Consumidor: Retorna error
        deactivate Consumidor
        Note over Consumidor,Errors: Diagrama guía de manejo de errores <br> http://bit.ly/4rpKVIU
    end
    deactivate API


        
