sequenceDiagram
    participant Cliente as Cliente/Aplicación
    participant ProxyGT as EliminarFactorCanjeGT<br/>(Proxy Service)
    participant XQueryGT as eliminarFactorCanjeGTIn.xq<br/>(Transformación)
    participant BizGT as eliminarFactorCanje_db<br/>(Business Service ABKGT)
    participant DBGT as Oracle Database GT<br/>ConnectionProxyAbanksGT

    Note over Cliente,DBGT: Región: Guatemala (GT01)
    Note over Cliente,DBGT: Esquema: PROXYABANKSGT

    Cliente->>ProxyGT: SOAP Request
    Note right of Cliente: Header: UserName=ADMIN_GT<br/>Body: PROMO_ID=PROMO_GT_2024_001<br/>Selector: SOAP body

    activate ProxyGT
    Note over ProxyGT: Pipeline: GT01_EliminarFactorCanje_request<br/>Stage: FlujoEntrada

    ProxyGT->>XQueryGT: Transformar Request
    Note right of ProxyGT: Parámetros:<br/>$eliminarFactorCanje1<br/>$userName

    activate XQueryGT
    Note over XQueryGT: Mapeo de Campos:<br/>PROMO_ID → PV_IDPROMOCION<br/>upper-case(UserName) → PV_USUARIO

    XQueryGT-->>ProxyGT: InputParameters XML
    Note left of XQueryGT: PV_IDPROMOCION=PROMO_GT_2024_001<br/>PV_USUARIO=ADMIN_GT
    deactivate XQueryGT

    ProxyGT->>BizGT: wsCallout (eliminarFactorCanje)
    Note right of ProxyGT: Request: $REQeliminarFactorCanje

    activate BizGT
    Note over BizGT: JCA Adapter<br/>Connection: ConnectionProxyAbanksGT<br/>Schema: PROXYABANKSGT<br/>Operation: eliminarFactorCanje

    BizGT->>DBGT: CALL PROXYABANKSGT.PL_P_ELIMINAR_FACTOR_CANJE
    Note right of BizGT: IN: PV_IDPROMOCION='PROMO_GT_2024_001'<br/>IN: PV_USUARIO='ADMIN_GT'

    activate DBGT
    Note over DBGT: Stored Procedure Execution<br/>Schema: PROXYABANKSGT<br/>Procedure: PL_P_ELIMINAR_FACTOR_CANJE

    alt Promoción Eliminada Exitosamente
        DBGT-->>BizGT: OutputParameters
        Note left of DBGT: OUT: PV_CODIGOMENSAJE='SUCCESS'<br/>OUT: PV_DESCRIPCIONMENSAJE='Factor de canje eliminado correctamente'

        BizGT-->>ProxyGT: Response XML

        Note over ProxyGT: Extracción: $errorCode='SUCCESS'<br/>$validationMessage='Factor de canje eliminado correctamente'

        Note over ProxyGT: Pipeline: GT01_EliminarFactorCanje_response<br/>Stage: FlujoSalida<br/>Evaluación: $errorCode = 'SUCCESS'

        ProxyGT-->>Cliente: SOAP Response (Success)
        Note left of ProxyGT: Header: successIndicator=Success<br/>Body: <eliminarFactorCanjeResponse/>

    else Error de Negocio
        DBGT-->>BizGT: OutputParameters
        Note left of DBGT: OUT: PV_CODIGOMENSAJE='ERROR'<br/>OUT: PV_DESCRIPCIONMENSAJE='Promoción no encontrada en Guatemala'

        BizGT-->>ProxyGT: Response XML

        Note over ProxyGT: Evaluación: $errorCode != 'SUCCESS'

        ProxyGT-->>Cliente: SOAP Response (Error)
        Note left of ProxyGT: Header: successIndicator=ERROR<br/>messages='Promoción no encontrada en Guatemala'

    else Error Técnico
        DBGT-->>BizGT: Exception
        BizGT-->>ProxyGT: Fault

        Note over ProxyGT: Error Handler: _onErrorHandler<br/>Stage: ManejoError

        ProxyGT-->>Cliente: SOAP Response (Exception)
        Note left of ProxyGT: Header: messageId=-1<br/>successIndicator=ERROR<br/>messages='[Technical Error]'
    end

    deactivate DBGT
    deactivate BizGT
    deactivate ProxyGT

    Note over Cliente,DBGT: Diferencias con HN01:<br/>- Esquema explícito: PROXYABANKSGT<br/>- Variable XQuery: $eliminarFactorCanje1<br/>- Business Service: ABKGT