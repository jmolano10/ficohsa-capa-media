sequenceDiagram
    autonumber
    participant Consumidor as Consumidore/Aplicación
    participant API as ActualizaDisponibleVentaMonedaExtranjera - Product <br> Epica 2550: ActualizaDisponibleVentaMonedaExtranjera <br> HU 7285:  PUT /consumer-services/currency-exchange-admin/v1/available-amount/update
    participant Wrapper T24 as Wrapper T24 <br> BS: svcMercadoLibre/services <br/>Operation: ActualizaDisponibleMonedaFCY
    participant Errors as Control de Errores <br/> <<Librería de mapeo de errores>>

    Note over Consumidor, Errors: Flujo Honduras (HN01) - ActualizaDisponibleVentaMonedaExtranjera

    alt T24 Response Exitoso
        Consumidor->>API: REST Request
        Note right of Consumidor: Header: SourceBank=HN01<br/>Body: 8 campos obligatorios <br/> customerProfile: "CLIENTE001" <br/> currencyCode: "USD" <br/> transactionAmount: "50000.00" <br/> dealReference: "DEAL20241201001" <br/> transactionStatus: "ACTIVE" <br/> operationType: "SELL" <br/> endDate: "2025-08-14" <br/> availabilityAction: "UPDATE"

        API->>API: Validar Request
        Note over API: Valida campos obligatorios según contrato OpenAPI <br/> customerProfile, currencyCode, transactionAmount, dealReference, transactionStatus, operationType, endDate, availabilityAction

        API->>API: Validación Exitosa

        API->>API: Validar Servicio Regional
        Note right of API: key de config: available-amount 

        API->>API: Validación Regional Exitosa

        API->>API: Construir Request Wrapper T24
        Note right of API: Mapeo de Campos <br/> customerProfile → Cliente <br/> currencyCode → Moneda <br/> transactionAmount → Monto <br/> dealReference → id <br/> transactionStatus → Estado <br/> operationType → TipodeOperacion <br/> endDate → FechaVencimiento <br/> availabilityAction → TipodeAccion <br> {date-to-string(current-date())} → Fecha (Enviar la fecha del sistema en formato YYYYMMDD)

        API->>Wrapper T24: CALL Wrapper T24
        Note right of API: Operation: ActualizaDisponibleVentaMonedaFCY <br/> Endpoint: svcMercadoLibre/services

        Wrapper T24-->>API: Response con Status Success
        Note right of API: Status/successIndicator: Success<br/>Status/messages: vacío<br/>FICOFXDEALSTXNOUTPUTType con datos actualizados

        API->>API: Transformar Response Body

        API->>Consumidor: REST Response Exitoso
        Note right of Consumidor: Body: statusIndicator.description = SUCCESS_FLAG <br> transactionDate.description = fecha actual YYYYMMDD <br/> availableAmountDetails = datos actualizados
    end

    activate API
    alt Exception occurs
        note over Errors: Error Library Handler
        activate Errors
            API->> Errors: Mapear código de error
            Errors -->> API: Retorna código mapeado
        deactivate Errors
        activate Consumidor
            API-->> Consumidor: Retorna error
        deactivate Consumidor
        Note over Consumidor,Errors: Diagrama guía de manejo de errores <br> http://bit.ly/4rpKVIU
    end
    deactivate API
    Note over Consumidor, Errors: Reglas de Negocio Aplicadas: <br/> 1. Conversión automática fecha actual → YYYYMMDD <br/> 2. Deal ID como identificador único en Wrapper T24 <br/>3. Mapeo directo de 8 campos API → Wrapper T24
