<bpel:process name="GetCustomerAssetsGT_SJ" targetNamespace="http://xmlns.oracle.com/DynamoMigrate/CoreBankingGT/" bea:name="GetCustomerAssetsGT_SJ" rescon:snippetVersion="1.0" xmlns:tns="http://xmlns.oracle.com/DynamoMigrate/CoreBankingGT/" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaActivosCliente/consultaActivosCliente" xmlns:ns0="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaListaCuentas/consultaListaCuentas" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaListaDepositosCliente/consultaListaDepositosCliente" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/MigrationDynamo/CommonResources/SetLogInfoService_BS" xmlns:con="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaActivosCliente">
    <bpel:partnerLinks>
        <bpel:partnerLink name="GetCustomerAssetsGT_SJ" partnerLinkType="tns:GetCustomerAssetsGT_SJ" myRole="GetCustomerAssetsGT_SJ">
	       </bpel:partnerLink>
        <bpel:partnerLink name="GetAccountsList_BS" partnerLinkType="tns:GetAccountsList_BS" partnerRole="GetAccountsList_BS"/>
        <bpel:partnerLink name="GetTermDepositsList" partnerLinkType="tns:GetTermDepositsList" partnerRole="GetTermDepositsList"/>
        <bpel:partnerLink name="SetLogInfoService_BS" partnerLinkType="tns:SetLogInfoService_BS" partnerRole="SetLogInfoService_BS"/>
    </bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="bind:args_in_msg">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="bind:args_out_msg">
	       </bpel:variable>
        <bpel:variable name="getAccountsListREQ" messageType="ns1:args_in_msg"/>
        <bpel:variable name="getAccountsListRSP" messageType="ns1:args_out_msg"/>
        <bpel:variable name="getTermDepositsListREQ" messageType="ns2:args_in_msg"/>
        <bpel:variable name="getTermDepositsListRSP" messageType="ns2:args_out_msg"/>
        <bpel:variable name="setLogInfoServiceREQ" messageType="ns3:args_in_msg"/>
        <bpel:variable name="setLogInfoServiceRSP" messageType="ns3:args_out_msg"/>
    </bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="GetCustomerAssetsGT_SJ" operation="consultaActivosCliente" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="CoreBankingPA/RequestorServices/v1.0/GetCustomerAssets/WSDL/GetCustomerAssetsPA_SJ_db" binding="bind:consultaActivosCliente_ptt-binding"/>
            </rescon:receiveInfo>
        </bpel:receive>
        <bpel:flow>
            <bpel:scope bea:name="GetAccountsList">
                <bpel:sequence>
                    <bpel:assign>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="getAccountsListREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CoreBankingPA/RequestorServices/v1.0/GetCustomerAssets/XQ/sjGetAccountsListIn"/>
                                        <expr:param name="sjGetCustomerAssetsGTREQ">
                                            <expr:path>$request.InputParameters</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="setLogInfoServiceREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CommonResources/MiddlewareDB/ProviderServices/XQ/Tx_Msg_To_SetLogInfo"/>
                                        <expr:param name="codigoAplicacion">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoServicio">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="contenido">
                                            <expr:path>fn-bea:serialize($getAccountsListREQ.InputParameters)</expr:path>
                                        </expr:param>
                                        <expr:param name="estado">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoSistema">
                                            <expr:path>13</expr:path>
                                        </expr:param>
                                        <expr:param name="nombreFlujoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaHora">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="parametros">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="uuid">
                                            <expr:path>fn:data($request.InputParameters/con:UUID)</expr:path>
                                        </expr:param>
                                        <expr:param name="version">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="operacionServicio">
                                            <expr:path>'ConsultaListaCuentas'</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoDestino">
                                            <expr:path>fn:data($request.InputParameters/con:DESTINATION_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="endpoint">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoOrigen">
                                            <expr:path>fn:data($request.InputParameters/con:SOURCE_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaTX">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="usuario">
                                            <expr:path>fn:data($request.InputParameters/con:USER)</expr:path>
                                        </expr:param>
                                        <expr:param name="descripcionError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="tipoMensaje">
                                            <expr:path>'Request'</expr:path>
                                        </expr:param>
                                        <expr:param name="metodo">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                    </bpel:assign>
                    <bpel:invoke partnerLink="SetLogInfoService_BS" operation="SetLogInfoService_BS" inputVariable="setLogInfoServiceREQ" outputVariable="setLogInfoServiceRSP">
                        <rescon:invokeInfo>
                            <rescon:service ref="CommonResources/MiddlewareDB/ProviderServices/BusinessServices/SetLogInfoService/v1.0/SetLogInfoService_BS" xsi:type="ns0:BusinessServiceRef"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                    <bpel:invoke partnerLink="GetAccountsList_BS" operation="consultaListaCuentas" inputVariable="getAccountsListREQ" outputVariable="getAccountsListRSP">
                        <rescon:invokeInfo>
                            <rescon:service ref="CoreBankingPA/ProviderServices/BusinessServices/GetAccountsList/v1.0/GetAccountsList_BS" xsi:type="ns0:BusinessServiceRef"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                    <bpel:assign>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="setLogInfoServiceREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CommonResources/MiddlewareDB/ProviderServices/XQ/Tx_Msg_To_SetLogInfo"/>
                                        <expr:param name="codigoAplicacion">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoServicio">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="contenido">
                                            <expr:path>fn-bea:serialize($getAccountsListRSP.OutputParameters)</expr:path>
                                        </expr:param>
                                        <expr:param name="estado">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoSistema">
                                            <expr:path>13</expr:path>
                                        </expr:param>
                                        <expr:param name="nombreFlujoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaHora">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="parametros">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="uuid">
                                            <expr:path>fn:data($request.InputParameters/con:UUID)</expr:path>
                                        </expr:param>
                                        <expr:param name="version">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="operacionServicio">
                                            <expr:path>'ConsultaListaCuentas'</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoDestino">
                                            <expr:path>fn:data($request.InputParameters/con:DESTINATION_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="endpoint">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoOrigen">
                                            <expr:path>fn:data($request.InputParameters/con:SOURCE_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaTX">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="usuario">
                                            <expr:path>fn:data($request.InputParameters/con:USER)</expr:path>
                                        </expr:param>
                                        <expr:param name="descripcionError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="tipoMensaje">
                                            <expr:path>'Response'</expr:path>
                                        </expr:param>
                                        <expr:param name="metodo">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                    </bpel:assign>
                    <bpel:invoke partnerLink="SetLogInfoService_BS" inputVariable="setLogInfoServiceREQ" operation="SetLogInfoService_BS" outputVariable="setLogInfoServiceRSP">
                        <rescon:invokeInfo>
                            <rescon:service xsi:type="ns0:BusinessServiceRef" ref="CommonResources/MiddlewareDB/ProviderServices/BusinessServices/SetLogInfoService/v1.0/SetLogInfoService_BS"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                </bpel:sequence>
            </bpel:scope>
            <bpel:scope bea:name="GetTermDepositsList">
                <bpel:sequence>
                    <bpel:assign>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="getTermDepositsListREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CoreBankingPA/RequestorServices/v1.0/GetCustomerAssets/XQ/sjGetTermDepositsListIn"/>
                                        <expr:param name="sjGetTermDepositsListREQ">
                                            <expr:path>$request.InputParameters</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="setLogInfoServiceREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CommonResources/MiddlewareDB/ProviderServices/XQ/Tx_Msg_To_SetLogInfo"/>
                                        <expr:param name="codigoAplicacion">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoServicio">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="contenido">
                                            <expr:path>fn-bea:serialize($getTermDepositsListREQ.InputParameters)</expr:path>
                                        </expr:param>
                                        <expr:param name="estado">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoSistema">
                                            <expr:path>13</expr:path>
                                        </expr:param>
                                        <expr:param name="nombreFlujoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaHora">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="parametros">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="uuid">
                                            <expr:path>fn:data($request.InputParameters/con:UUID)</expr:path>
                                        </expr:param>
                                        <expr:param name="version">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="operacionServicio">
                                            <expr:path>'ConsultaListaDepositos'</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoDestino">
                                            <expr:path>fn:data($request.InputParameters/con:DESTINATION_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="endpoint">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoOrigen">
                                            <expr:path>fn:data($request.InputParameters/con:SOURCE_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaTX">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="usuario">
                                            <expr:path>fn:data($request.InputParameters/con:USER)</expr:path>
                                        </expr:param>
                                        <expr:param name="descripcionError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="tipoMensaje">
                                            <expr:path>'Request'</expr:path>
                                        </expr:param>
                                        <expr:param name="metodo">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                    </bpel:assign>
                    <bpel:invoke partnerLink="SetLogInfoService_BS" inputVariable="setLogInfoServiceREQ" operation="SetLogInfoService_BS" outputVariable="setLogInfoServiceRSP">
                        <rescon:invokeInfo>
                            <rescon:service xsi:type="ns0:BusinessServiceRef" ref="CommonResources/MiddlewareDB/ProviderServices/BusinessServices/SetLogInfoService/v1.0/SetLogInfoService_BS"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                    <bpel:invoke partnerLink="GetTermDepositsList" operation="consultaListaDepositosCliente" inputVariable="getTermDepositsListREQ" outputVariable="getTermDepositsListRSP">
                        <rescon:invokeInfo>
                            <rescon:service ref="CoreBankingPA/ProviderServices/BusinessServices/GetTermDepositsList/v1.0/GetTermDepositsList" xsi:type="ns0:BusinessServiceRef"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                    <bpel:assign>
                        <bpel:extensionAssignOperation>
                            <trf:assign varName="setLogInfoServiceREQ.InputParameters">
                                <trf:expr>
                                    <expr:xqueryTransform>
                                        <expr:resource ref="CommonResources/MiddlewareDB/ProviderServices/XQ/Tx_Msg_To_SetLogInfo"/>
                                        <expr:param name="codigoAplicacion">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoServicio">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="contenido">
                                            <expr:path>fn-bea:serialize($getTermDepositsListRSP.OutputParameters)</expr:path>
                                        </expr:param>
                                        <expr:param name="estado">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="codigoSistema">
                                            <expr:path>13</expr:path>
                                        </expr:param>
                                        <expr:param name="nombreFlujoError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaHora">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="parametros">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="uuid">
                                            <expr:path>fn:data($request.InputParameters/con:UUID)</expr:path>
                                        </expr:param>
                                        <expr:param name="version">
                                            <expr:path>1</expr:path>
                                        </expr:param>
                                        <expr:param name="operacionServicio">
                                            <expr:path>'ConsultaListaDepositos'</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoDestino">
                                            <expr:path>fn:data($request.InputParameters/con:DESTINATION_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="endpoint">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="bancoOrigen">
                                            <expr:path>fn:data($request.InputParameters/con:SOURCE_BANK)</expr:path>
                                        </expr:param>
                                        <expr:param name="fechaTX">
                                            <expr:path>fn:current-dateTime()</expr:path>
                                        </expr:param>
                                        <expr:param name="usuario">
                                            <expr:path>fn:data($request.InputParameters/con:USER)</expr:path>
                                        </expr:param>
                                        <expr:param name="descripcionError">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                        <expr:param name="tipoMensaje">
                                            <expr:path>'Response'</expr:path>
                                        </expr:param>
                                        <expr:param name="metodo">
                                            <expr:path>''</expr:path>
                                        </expr:param>
                                    </expr:xqueryTransform>
                                </trf:expr>
                            </trf:assign>
                        </bpel:extensionAssignOperation>
                    </bpel:assign>
                    <bpel:invoke partnerLink="SetLogInfoService_BS" inputVariable="setLogInfoServiceREQ" operation="SetLogInfoService_BS" outputVariable="setLogInfoServiceRSP">
                        <rescon:invokeInfo>
                            <rescon:service xsi:type="ns0:BusinessServiceRef" ref="CommonResources/MiddlewareDB/ProviderServices/BusinessServices/SetLogInfoService/v1.0/SetLogInfoService_BS"/>
                        </rescon:invokeInfo>
                    </bpel:invoke>
                </bpel:sequence>
            </bpel:scope>
        </bpel:flow>
        <bpel:assign>
            <bpel:extensionAssignOperation>
                <trf:assign varName="response.OutputParameters">
                    <trf:expr>
                        <expr:xqueryTransform>
                            <expr:resource ref="CoreBankingPA/RequestorServices/v1.0/GetCustomerAssets/XQ/sjGetCustomerAssetsOut"/>
                            <expr:param name="getTermDepositsListRSP">
                                <expr:path>$getTermDepositsListRSP.OutputParameters</expr:path>
                            </expr:param>
                            <expr:param name="getAccountsListRSP">
                                <expr:path>$getAccountsListRSP.OutputParameters</expr:path>
                            </expr:param>
                        </expr:xqueryTransform>
                    </trf:expr>
                </trf:assign>
            </bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:reply partnerLink="GetCustomerAssetsGT_SJ" operation="consultaActivosCliente" variable="response"/>
    </bpel:sequence>
</bpel:process>