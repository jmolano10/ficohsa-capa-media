<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con3:SoapBindingType" xmlns:con3="http://www.bea.com/wli/sb/services/bindings/config">
      <con3:wsdl ref="MiddlewareCaja/Resources/wsdls/LiquidacionFondosExt"/>
      <con3:port>
        <con3:name>liquidacionFondosExtPSSOAP</con3:name>
        <con3:namespace>http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExt/</con3:namespace>
      </con3:port>
      <con3:selector type="SOAP body"/>
      <con3:WSI-compliant>false</con3:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/MiddlewareCaja/LiquidacionFondosExt</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-6553446582513901389-24967a96.1505e7e49a9.-7f64">
    <con:pipeline type="request" name="LIQUIDACION_request">
      <con:stage name="liquidacion_proxyRequest">
        <con:context>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb"/>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultarLiqFondosExt" prefix="con"/>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultarTipoClienteExt" prefix="con2"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExtTypes" prefix="liq"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con2:assign varName="parameterName">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7d6a</con1:id>
            <con2:expr>
              <con1:xqueryText>"T24T045.HNLACCOUNT.CONTINENTAL"</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="parameterNameMaxAmount">
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-723a</con1:id>
            <con2:expr>
              <con1:xqueryText>"T24T045.MAXAMOUNT.CONTINENTAL"</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="paymentType">
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7897</con1:id>
            <con2:expr>
              <con1:xqueryText>data($body/liq:liquidacionFondosExt/ASSET_PAYMENT_TYPE)</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="uuid">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7d0c</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUUID"/>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:wsCallout>
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7ad2</con1:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultarTipoClienteExt_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>consultarTipoClienteExt</con2:operation>
            <con2:request>
              <con2:body>$REQConsTipoCliente</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPConsTipoCliente</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQConsTipoCliente">
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7ab4</con1:id>
                <con2:expr>
                  <con1:xqueryTransform>
                    <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/consultaTipoClienteIn"/>
                    <con1:param name="assetId">
                      <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                    </con1:param>
                    <con1:param name="paymentType">
                      <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_PAYMENT_TYPE/text())</con1:path>
                    </con1:param>
                  </con1:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:assign varName="successIndConsTipCli">
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7a9a</con1:id>
                <con2:expr>
                  <con1:xqueryText>if (fn:string($RSPConsTipoCliente/con2:PN_ERROR/text()) = "0") then (
	"SUCCESS"
) else (
	"ERROR"
)</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:ifThenElse>
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7a8c</con1:id>
                <con2:case>
                  <con2:condition>
                    <con1:xqueryText>$successIndConsTipCli = "SUCCESS"</con1:xqueryText>
                  </con2:condition>
                  <con2:actions/>
                </con2:case>
                <con2:default>
                  <con2:replace varName="header" contents-only="true">
                    <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7a6c</con1:id>
                    <con2:expr>
                      <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ $successIndConsTipCli }</successIndicator>
	<messages>{ fn:string($RSPConsTipoCliente/con2:PV_ERROR/text()) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                    </con2:expr>
                  </con2:replace>
                  <con2:replace varName="body" contents-only="true">
                    <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7a54</con1:id>
                    <con2:expr>
                      <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                    </con2:expr>
                  </con2:replace>
                  <con1:reply>
                    <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7a3d</con1:id>
                  </con1:reply>
                </con2:default>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
          <con2:wsCallout>
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7850</con1:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>obtenerParametrizacion</con2:operation>
            <con2:request>
              <con2:body>$REQObtenerParam</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPObtenerParam</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQObtenerParam">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7852</con1:id>
                <con2:expr>
                  <con1:xqueryTransform>
                    <con1:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                    <con1:param name="nombreParametros">
                      <con1:path>fn:concat($parameterName,'||',$parameterNameMaxAmount)</con1:path>
                    </con1:param>
                  </con1:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:assign varName="debitAccount">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7851</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPObtenerParam/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$parameterName]/osb:VALUE/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="maxAmount">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7201</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPObtenerParam/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$parameterNameMaxAmount]/osb:VALUE/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:responseTransform>
          </con2:wsCallout>
          <con2:wsCallout>
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-779e</con1:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultarLiqFondosExt_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>consultarLiqFondosExt</con2:operation>
            <con2:request>
              <con2:body>$REQConsultarLiq</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPConsultarLiq</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQConsultarLiq">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-77a1</con1:id>
                <con2:expr>
                  <con1:xqueryTransform>
                    <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/consultaLiqFondosExtIn"/>
                    <con1:param name="assetId">
                      <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                    </con1:param>
                  </con1:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:assign varName="debitAmount">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-77a0</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPConsultarLiq/con:PN_MONTOTOTAL/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="assetName">
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-79ba</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPConsultarLiq/con:PV_NOMBRECONT/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="successIndConsLiq">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-779f</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPConsultarLiq/con:PN_ERROR/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="balances">
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7963</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPConsultarLiq/con:PV_CUENTASCONT/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="narrative">
                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-71c9</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:substring(fn:replace(fn:replace(data($RSPConsultarLiq/con:PV_CUENTASCONT),'@80@',' '),'@105',' '),1,35)</con1:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:responseTransform>
          </con2:wsCallout>
          <con2:ifThenElse>
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-785c</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$paymentType = 'CASH'</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7840</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$successIndConsLiq = "0"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-730a</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>xs:double($debitAmount) &lt; xs:double($maxAmount)</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7304</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/RetirosYPagos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Retiroenmonedalocal</con2:operation>
                              <con2:request>
                                <con2:body>$REQRetiro</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RSPRetiro</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQRetiro">
                                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7306</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/retiroFondoIn"/>
                                      <con1:param name="balances">
                                        <con1:path>$balances</con1:path>
                                      </con1:param>
                                      <con1:param name="autenticacionRequestHeader1">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="uuid">
                                        <con1:path>$uuid</con1:path>
                                      </con1:param>
                                      <con1:param name="debitAccount">
                                        <con1:path>$debitAccount</con1:path>
                                      </con1:param>
                                      <con1:param name="debitAmount">
                                        <con1:path>$debitAmount</con1:path>
                                      </con1:param>
                                      <con1:param name="txnReference">
                                        <con1:path>fn:concat(data($body/liq:liquidacionFondosExt/ASSET_ID),'!',$assetName)</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform>
                                <con2:assign varName="txnReference">
                                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7305</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RSPRetiro/Status/transactionId/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:responseTransform>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con2:wsCallout>
                            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-728e</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/RetirosYPagos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Retiroenmonedalocal</con2:operation>
                            <con2:request>
                              <con2:body>$REQRetiro</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RSPRetiro</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQRetiro">
                                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7290</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/retiroFondoInauIn"/>
                                    <con1:param name="balances">
                                      <con1:path>$balances</con1:path>
                                    </con1:param>
                                    <con1:param name="autenticacionRequestHeader1">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>$uuid</con1:path>
                                    </con1:param>
                                    <con1:param name="debitAmount">
                                      <con1:path>$debitAmount</con1:path>
                                    </con1:param>
                                    <con1:param name="debitAccount">
                                      <con1:path>$debitAccount</con1:path>
                                    </con1:param>
                                    <con1:param name="txnReference">
                                      <con1:path>fn:concat(data($body/liq:liquidacionFondosExt/ASSET_ID),'!',$assetName)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform>
                              <con2:assign varName="txnReference">
                                <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-728f</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>fn:string($RSPRetiro/Status/transactionId/text())</con1:xqueryText>
                                </con2:expr>
                              </con2:assign>
                            </con2:responseTransform>
                          </con2:wsCallout>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-783c</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>ERROR</successIndicator>
	<messages>{ $RSPConsultarLiq/con:PV_ERROR/text() }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-783b</con1:id>
                      <con2:expr>
                        <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con1:reply>
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-783a</con1:id>
                    </con1:reply>
                  </con2:default>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7833</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>fn:string($RSPRetiro/Status/successIndicator/text()) = "Success"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7831</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/RegistrarLiqFondosExt_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>registrarLiqFondosExt</con2:operation>
                        <con2:request>
                          <con2:body>$REQRegistrarLiq</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RSPRegistrarLiq</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQRegistrarLiq">
                            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7832</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/registrarLiqFondosExtIn"/>
                                <con1:param name="agency">
                                  <con1:path>data($RSPRetiro/TELLERType/LRAGENCYCODE)</con1:path>
                                </con1:param>
                                <con1:param name="user">
                                  <con1:path>fn:substring(fn:tokenize(data($RSPRetiro/TELLERType/gINPUTTER/INPUTTER),"_")[2],1,25)</con1:path>
                                </con1:param>
                                <con1:param name="chequeNumber">
                                  <con1:path>''</con1:path>
                                </con1:param>
                                <con1:param name="assetId">
                                  <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                                </con1:param>
                                <con1:param name="txnReference">
                                  <con1:path>$txnReference</con1:path>
                                </con1:param>
                                <con1:param name="paymentType">
                                  <con1:path>$paymentType</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7830</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ fn:string($RSPRetiro/Status/successIndicator/text()) }</successIndicator>
	<messages>{ fn:string-join(data($RSPRetiro/Status/messages),";") }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-782f</con1:id>
                      <con2:expr>
                        <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con1:reply>
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-782e</con1:id>
                    </con1:reply>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$paymentType = 'CASHIER_CHECK'</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-76df</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$successIndConsLiq = "0"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-76a0</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ChequeGerencia" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>EmisiondechqdegerenciaTT</con2:operation>
                        <con2:request>
                          <con2:body>$REQEmisionCheque</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RSPEmisionCheque</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQEmisionCheque">
                            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7630</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/emisionChequeIn"/>
                                <con1:param name="balances">
                                  <con1:path>$balances</con1:path>
                                </con1:param>
                                <con1:param name="autenticacionRequestHeader1">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="uuid">
                                  <con1:path>$uuid</con1:path>
                                </con1:param>
                                <con1:param name="debitAccount">
                                  <con1:path>$debitAccount</con1:path>
                                </con1:param>
                                <con1:param name="liquidacionFondosExt1">
                                  <con1:path>$body/liq:liquidacionFondosExt</con1:path>
                                </con1:param>
                                <con1:param name="amount">
                                  <con1:path>$debitAmount</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="txnReference">
                            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7668</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RSPEmisionCheque/Status/transactionId/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-76db</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>ERROR</successIndicator>
	<messages>{ $RSPConsultarLiq/con:PV_ERROR/text() }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-76da</con1:id>
                      <con2:expr>
                        <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con1:reply>
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-76d9</con1:id>
                    </con1:reply>
                  </con2:default>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753f</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>fn:string($RSPEmisionCheque/Status/successIndicator/text()) = "Success"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753d</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/RegistrarLiqFondosExt_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>registrarLiqFondosExt</con2:operation>
                        <con2:request>
                          <con2:body>$REQRegistrarLiq</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RSPRegistrarLiq</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQRegistrarLiq">
                            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753e</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/registrarLiqFondosExtIn"/>
                                <con1:param name="agency">
                                  <con1:path>data($RSPEmisionCheque/FUNDSTRANSFERType/LROTHEROFFCER)</con1:path>
                                </con1:param>
                                <con1:param name="user">
                                  <con1:path>fn:substring(fn:tokenize(data($RSPEmisionCheque/FUNDSTRANSFERType/gINPUTTER/INPUTTER),"_")[2],1,25)</con1:path>
                                </con1:param>
                                <con1:param name="chequeNumber">
                                  <con1:path>xs:string($body/liq:liquidacionFondosExt/CASHIER_CHECK/CHEQUE_NUMBER)</con1:path>
                                </con1:param>
                                <con1:param name="assetId">
                                  <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                                </con1:param>
                                <con1:param name="txnReference">
                                  <con1:path>$txnReference</con1:path>
                                </con1:param>
                                <con1:param name="paymentType">
                                  <con1:path>$paymentType</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753c</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ fn:string($RSPEmisionCheque/Status/successIndicator/text()) }</successIndicator>
	<messages>{ fn:string-join(data($RSPEmisionCheque/Status/messages),";") }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753b</con1:id>
                      <con2:expr>
                        <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con1:reply>
                      <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-753a</con1:id>
                    </con1:reply>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="LIQUIDACION_response">
      <con:stage name="liquidacion_proxyResponse">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExtTypes" prefix="liq"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7494</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$paymentType = 'CASH'</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-9063370280693122579--57428a5.15065ef3027.-7fca</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>xs:double($debitAmount) &lt; xs:double($maxAmount)</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-9063370280693122579--57428a5.15065ef3027.-7fc8</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/liquidacionFondosExtHeaderOut"/>
                            <con1:param name="outputParameters1">
                              <con1:path>$RSPRegistrarLiq</con1:path>
                            </con1:param>
                            <con1:param name="retiroenmonedalocalResponse1">
                              <con1:path>$RSPRetiro</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                      <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-9063370280693122579--57428a5.15065ef3027.-7fc6</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/liquidacionFondosExtOut"/>
                            <con1:param name="balances">
                              <con1:path>$balances</con1:path>
                            </con1:param>
                            <con1:param name="assetId">
                              <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                            </con1:param>
                            <con1:param name="outputParameters1">
                              <con1:path>$RSPRegistrarLiq</con1:path>
                            </con1:param>
                            <con1:param name="retiroenmonedalocalResponse1">
                              <con1:path>$RSPRetiro</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-9063370280693122579--57428a5.15065ef3027.-7fa8</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{fn:concat("ATENCION - ",fn:string($RSPRetiro/Status/transactionId/text())) }</successIndicator>
	<messages>REQUIERE AUTORIZACION DE SUPERVISOR</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-9063370280693122579--57428a5.15065ef3027.-7f95</con1:id>
                      <con2:expr>
                        <con1:xqueryText>&lt;liq:liquidacionFondosExtResponse/></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$paymentType = 'CASHIER_CHECK'</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-73ea</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/emisionChequeHeaderOut"/>
                      <con1:param name="emisiondechqdegerenciaTTResponse1">
                        <con1:path>$RSPEmisionCheque</con1:path>
                      </con1:param>
                      <con1:param name="outputParameters1">
                        <con1:path>$RSPRegistrarLiq</con1:path>
                      </con1:param>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:replace>
                <con2:replace varName="body" contents-only="true">
                  <con1:id>_ActionId-7955787460454461628--4befd672.1503f0fcd0b.-7378</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/emisionChequeOut"/>
                      <con1:param name="emisiondechqdegerenciaTTResponse1">
                        <con1:path>$RSPEmisionCheque</con1:path>
                      </con1:param>
                      <con1:param name="assetId">
                        <con1:path>fn:string($body/liq:liquidacionFondosExt/ASSET_ID/text())</con1:path>
                      </con1:param>
                      <con1:param name="outputParameters1">
                        <con1:path>$RSPRegistrarLiq</con1:path>
                      </con1:param>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="request" name="CONSULTA_request">
      <con:stage name="consulta_proxyRequest">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExtTypes" prefix="liq"/>
        </con:context>
        <con:actions>
          <con2:wsCallout>
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7cb7</con1:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultarLiqFondosExt_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>consultarLiqFondosExt</con2:operation>
            <con2:request>
              <con2:body>$REQConsultarLiq</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPConsultarLiq</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQConsultarLiq">
                <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7c9a</con1:id>
                <con2:expr>
                  <con1:xqueryTransform>
                    <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/consultaLiqFondosExtIn"/>
                    <con1:param name="assetId">
                      <con1:path>fn:string($body/liq:consultaFondosExt/ASSET_ID/text())</con1:path>
                    </con1:param>
                  </con1:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform/>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="CONSULTA_response">
      <con:stage name="consulta_proxyResponse">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExtTypes" prefix="liq"/>
        </con:context>
        <con:actions>
          <con2:replace varName="header" contents-only="true">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7c97</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/consultaLiqFondosExtHeaderOut"/>
                <con1:param name="outputParameters1">
                  <con1:path>$RSPConsultarLiq</con1:path>
                </con1:param>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:replace>
          <con2:replace varName="body" contents-only="true">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7c95</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="MiddlewareCaja/Resources/xqueries/LiquidacionFondosExt/consultaLiqFondosExtOut"/>
                <con1:param name="assetId">
                  <con1:path>fn:string($body/liq:consultaFondosExt/ASSET_ID/text())</con1:path>
                </con1:param>
                <con1:param name="outputParameters1">
                  <con1:path>$RSPConsultarLiq</con1:path>
                </con1:param>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6553446582513901389-24967a96.1505e7e49a9.-7f64">
      <con:stage name="proxyFault">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/liquidacionFondosExtTypes" prefix="liq"/>
        </con:context>
        <con:actions>
          <con2:replace varName="header" contents-only="true">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7f4e</con1:id>
            <con2:expr>
              <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ concat(fn:string($fault/ctx:errorCode/text()), ": ", fn:string($fault/ctx:reason/text())) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:replace varName="body" contents-only="true">
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7f39</con1:id>
            <con2:expr>
              <con1:xqueryText>&lt;liq:consultaFondosExtResponse>
	&lt;ASSET_ID>{ $operation }&lt;/ASSET_ID>
&lt;/liq:consultaFondosExtResponse></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con1:reply>
            <con1:id>_ActionId-6553446582513901389-24967a96.1505e7e49a9.-7f20</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:flow>
      <con:branch-node type="operation" name="Operations">
        <con:context/>
        <con:branch-table>
          <con:branch name="consultaFondosExt">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="CONSULTA">
                <con:request>CONSULTA_request</con:request>
                <con:response>CONSULTA_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="liquidacionFondosExt">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="LIQUIDACION">
                <con:request>LIQUIDACION_request</con:request>
                <con:response>LIQUIDACION_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow/>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
</xml-fragment>