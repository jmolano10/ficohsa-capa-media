<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con4:SoapBindingType" xmlns:con4="http://www.bea.com/wli/sb/services/bindings/config">
      <con4:wsdl ref="MiddlewareCaja/Resources/wsdls/ReversarTransaccion"/>
      <con4:port>
        <con4:name>reversarTransaccionPSSOAP</con4:name>
        <con4:namespace>http://www.ficohsa.com.hn/middleware.services/reversarTransaccionPS/</con4:namespace>
      </con4:port>
      <con4:selector type="SOAP body"/>
      <con4:WSI-compliant>false</con4:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/MiddlewareCaja/ReversarTransaccion</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-8848777042473091319--23eafd38.13c2a05c9f3.-6ddb">
    <con:pipeline type="request" name="PipelinePairNode1_request">
      <con:stage name="stage1">
        <con:context>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/reversionRecaudoAbanks_v2" prefix="rev2"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversarTransaccionTypes" prefix="rev"/>
          <con1:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
        </con:context>
        <con:actions>
          <con2:assign varName="trxId">
            <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-73f3</con1:id>
            <con2:expr>
              <con1:xqueryText>$body/rev:reversarTransaccion/TRANSACTION_ID/text()</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="tipoTrx">
            <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-73d6</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:substring(fn:string($trxId), 1, 2)</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="transactionType">
            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fc6</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:string($body/rev:reversarTransaccion/TRANSACTION_TYPE/text())</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="uuid">
            <con1:id>_ActionId-6946079507431715069--78978780.1403135af78.-781c</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUUID"/>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-739e</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "CHEQUE_PAYMENT" and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7f45</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>ReversiondePagodeCheques</con2:operation>
                  <con2:request>
                    <con2:body>$REQUEST</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RESPONSE</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQUEST">
                      <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7f0d</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoChequeIn"/>
                          <con1:param name="autenticacionRequestHeader">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="reversarTransaccion">
                            <con1:path>$body/rev:reversarTransaccion</con1:path>
                          </con1:param>
                          <con1:param name="uuid">
                            <con1:path>fn:string($uuid)</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform/>
                </con2:wsCallout>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "CREDIT_CARD_PAYMENT" and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-73ef</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>ReversionpagoTC</con2:operation>
                  <con2:request>
                    <con2:body>$reqReversarTransaccion</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>respReversarTransaccion</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="reqReversarTransaccion">
                      <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-73b7</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagooRetiroTCIn"/>
                          <con1:param name="autenticacionRequestHeader">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="reversarTransaccion">
                            <con1:path>$body/rev:reversarTransaccion</con1:path>
                          </con1:param>
                          <con1:param name="uuid">
                            <con1:path>fn:string($uuid)</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="statusReversion">
                      <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-737f</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($respReversarTransaccion/Status/successIndicator/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:responseTransform>
                </con2:wsCallout>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-7311</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-72d9</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>AutorizareversapagooretiroTC</con2:operation>
                        <con2:request>
                          <con2:body>$reqAutorizacionReversion</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>respAutorizacionReversion</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="reqAutorizacionReversion">
                            <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-72a1</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/AutorizarReversionPagooRetiroTCIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:assign varName="messageReversion">
                      <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-7233</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($respReversarTransaccion/Status/messages/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = ("REF_COLLECTION","PROPTAX_COLLECTION","ONLINE_COLLECTION", "LOCAL_COLLECTION", "ABANKS_COLLECTION") 
and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7f7f</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>fn:string($tipoTrx) = "FT"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7f47</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultasTransacciones" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>ConsultadetransaccionFT</con2:operation>
                        <con2:request>
                          <con2:body>$REQUESTConsultadetransaccionFT</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSEConsultadetransaccionFT</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUESTConsultadetransaccionFT">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7d55</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ConsultaTransaccionFT"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="payMethod">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7dfd</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionFT/WSFTTRANSACTIONType/gWSFTTRANSACTIONDetailType/mWSFTTRANSACTIONDetailType/AGRPAYMETHOD/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="valueDate">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7da1</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionFT/WSFTTRANSACTIONType/gWSFTTRANSACTIONDetailType/mWSFTTRANSACTIONDetailType/VALUEDATE/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="inputter">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7da0</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionFT/WSFTTRANSACTIONType/gWSFTTRANSACTIONDetailType/mWSFTTRANSACTIONDetailType/INPUTTER/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="branchCode">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7d9f</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionFT/WSFTTRANSACTIONType/gWSFTTRANSACTIONDetailType/mWSFTTRANSACTIONDetailType/BRANCHCODE/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="validationMessage">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7013</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn-bea:trim(concat(fn:string-join($RESPONSEConsultadetransaccionFT/Status/messages/text(), " ")," ", $RESPONSEConsultadetransaccionFT/WSFTTRANSACTIONType/ZERORECORDS/text()))</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>fn:string($tipoTrx) = "TT"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7ed9</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultasTransacciones" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>ConsultadetransaccionTT</con2:operation>
                        <con2:request>
                          <con2:body>$REQUESTConsultadetransaccionTT</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSEConsultadetransaccionTT</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUESTConsultadetransaccionTT">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7d1d</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ConsultaTransaccionTT"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="payMethod">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-7dc5</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionTT/WSTTTRANSACTIONType/gWSTTTRANSACTIONDetailType/mWSTTTRANSACTIONDetailType/AGRPAYMETHOD/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="valueDate">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7dc9</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionTT/WSTTTRANSACTIONType/gWSTTTRANSACTIONDetailType/mWSTTTRANSACTIONDetailType/VALUEDATE/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="inputter">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7dcb</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionTT/WSTTTRANSACTIONType/gWSTTTRANSACTIONDetailType/mWSTTTRANSACTIONDetailType/INPUTTER/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="branchCode">
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7dc3</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetransaccionTT/WSTTTRANSACTIONType/gWSTTTRANSACTIONDetailType/mWSTTTRANSACTIONDetailType/BRANCHCODE/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="validationMessage">
                            <con1:id>_ActionId-18868516478514786-7de475c1.13e3d9460e7.-706b</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn-bea:trim(concat(fn:string-join($RESPONSEConsultadetransaccionTT/Status/messages/text(), " ")," ", $RESPONSEConsultadetransaccionTT/WSTTTRANSACTIONType/ZERORECORDS/text()))</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-77be</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>fn:string($validationMessage) != ""</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con1:skip>
                        <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e3e</con1:id>
                      </con1:skip>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$transactionType = ("REF_COLLECTION","ABANKS_COLLECTION")</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e81</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "CASH"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7f</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudorefefec</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e80</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefEfectIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "DEB.TO.ACCT"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7d</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudorefdbcta</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7e</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefDebCtaIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "FICO.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7b</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudorefficochq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7c</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefFicoChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "OB.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e79</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudorefobchq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e7a</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefOBChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "INTL.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e77</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudorefchqtintl</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e78</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefIntChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con1:skip>
                            <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e76</con1:id>
                          </con1:skip>
                        </con2:default>
                      </con2:ifThenElse>
                      <con2:ifThenElse>
                        <con1:comment>Condicion para realizar reversión de cobranza en abanks, validando que haya sido exitosa la reversión en T24</con1:comment>
                        <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7cf3</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$transactionType = "ABANKS_COLLECTION" and
$RESPONSE/Status/successIndicator = "Success"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7cc5</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/reversionRecaudoAbanks_v2_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>reversionRecaudoAbanks_v2</con2:operation>
                              <con2:request>
                                <con2:body>$REQReversionRecAbanks</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RSPReversionRecAbanks</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQReversionRecAbanks">
                                  <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c9d</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/v2/ReversarTransaccionAbanksIn"/>
                                      <con1:param name="branchCode">
                                        <con1:path>$branchCode</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion1">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                      <con1:param name="userId">
                                        <con1:path>$inputter</con1:path>
                                      </con1:param>
                                      <con1:param name="date">
                                        <con1:path>$valueDate</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform>
                                <con2:assign varName="successIndicatorAbanks">
                                  <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7b43</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>$RSPReversionRecAbanks/rev2:PV_CODIGO_ERROR/text()</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:responseTransform>
                            </con2:wsCallout>
                            <con2:ifThenElse>
                              <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7b1e</con1:id>
                              <con2:case>
                                <con2:condition>
                                  <con1:xqueryText>$successIndicatorAbanks != "0"</con1:xqueryText>
                                </con2:condition>
                                <con2:actions>
                                  <con2:ifThenElse>
                                    <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7af4</con1:id>
                                    <con2:case>
                                      <con2:condition>
                                        <con1:xqueryText>count($RESPONSE/TELLERType) > 0</con1:xqueryText>
                                      </con2:condition>
                                      <con2:actions>
                                        <con2:wsCallout>
                                          <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7acf</con1:id>
                                          <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                          <con2:operation>EliminacionpagorecaudorefTT</con2:operation>
                                          <con2:request>
                                            <con2:body>$REQEliminacion</con2:body>
                                          </con2:request>
                                          <con2:response>
                                            <con2:body>RSPEliminacion</con2:body>
                                          </con2:response>
                                          <con2:requestTransform>
                                            <con2:assign varName="REQEliminacion">
                                              <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-795f</con1:id>
                                              <con2:expr>
                                                <con1:xqueryTransform>
                                                  <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/v2/EliminacionRevRecRefTTIn"/>
                                                  <con1:param name="autenticacionRequestHeader">
                                                    <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                                  </con1:param>
                                                  <con1:param name="status">
                                                    <con1:path>$RESPONSE/Status</con1:path>
                                                  </con1:param>
                                                </con1:xqueryTransform>
                                              </con2:expr>
                                            </con2:assign>
                                          </con2:requestTransform>
                                          <con2:responseTransform/>
                                        </con2:wsCallout>
                                      </con2:actions>
                                    </con2:case>
                                    <con2:default>
                                      <con2:wsCallout>
                                        <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7aa8</con1:id>
                                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con2:operation>EliminacionpagorecaudorefFT</con2:operation>
                                        <con2:request>
                                          <con2:body>$REQEliminacion</con2:body>
                                        </con2:request>
                                        <con2:response>
                                          <con2:body>REQEliminacion</con2:body>
                                        </con2:response>
                                        <con2:requestTransform>
                                          <con2:assign varName="REQEliminacion">
                                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-793b</con1:id>
                                            <con2:expr>
                                              <con1:xqueryTransform>
                                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/v2/EliminacionRevRecRefFTIn"/>
                                                <con1:param name="autenticacionRequestHeader">
                                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                                </con1:param>
                                                <con1:param name="status">
                                                  <con1:path>$RESPONSE/Status</con1:path>
                                                </con1:param>
                                              </con1:xqueryTransform>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:requestTransform>
                                        <con2:responseTransform/>
                                      </con2:wsCallout>
                                    </con2:default>
                                  </con2:ifThenElse>
                                  <con2:assign varName="validationMessage">
                                    <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-791e</con1:id>
                                    <con2:expr>
                                      <con1:xqueryText>if (fn:upper-case($RSPEliminacion/Status/successIndicator) = "SUCCESS") then (
	$validationMessage
) else (
	fn:concat($validationMessage, ". ERROR ELIMINANDO TRX: ", fn:string-join($RSPEliminacion/Status/messages, "."))
)</con1:xqueryText>
                                    </con2:expr>
                                  </con2:assign>
                                </con2:actions>
                              </con2:case>
                              <con2:default/>
                            </con2:ifThenElse>
                          </con2:actions>
                        </con2:case>
                        <con2:default/>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$transactionType = "PROPTAX_COLLECTION"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-76d3</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "CASH"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-76d1</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudoamdcefec</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-76d2</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoAMDCEfectIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "DEB.TO.ACCT"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-7776</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudoamdcdbcta</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-7777</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoAMDCDebCtaIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "FICO.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-7738</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudoamdcficochq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-7739</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoAMDCFicoChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "OB.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-76fa</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudoamdcobchq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-76fb</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoAMDCOBChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "INTL.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-76bc</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudoamdcchqintl</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-1940211678518433615--107a2c98.1409dade368.-76bd</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoAMDCIntChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con1:skip>
                            <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-76c8</con1:id>
                          </con1:skip>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$transactionType = ("ONLINE_COLLECTION", "LOCAL_COLLECTION")</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-766d</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "CASH"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-766b</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudolineaefec</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-766c</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoLocalEfectIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "DEB.TO.ACCT"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-7577</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudolineadbcta</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-7578</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoLocalDebCtaIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "FICO.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-7539</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudolineaficochq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-753a</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoLocalFicoChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "OB.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-74fb</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudolineaobchq</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-74fc</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoLocalOBChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>$payMethod = "INTL.CHEQUE"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-74bd</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTxnRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>Reversionpagorecaudolineachqintl</con2:operation>
                              <con2:request>
                                <con2:body>$REQUEST</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RESPONSE</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQUEST">
                                  <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-74be</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoLocalIntChqIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con1:skip>
                            <con1:id>_ActionId-6742292451474137277--7412f141.1409cb52122.-7662</con1:id>
                          </con1:skip>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "LOAN_PAYMENT" and 
fn:string($trxId) != "" and 
fn:substring(fn:string($trxId), 1, 3) = "TFS"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con1:id>_ActionId-6410446563752785607-4a68f230.141576ebebd.-7fc9</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion2" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>Reversiondepositocombinado</con2:operation>
                  <con2:request>
                    <con2:body>$REQUESTReversiondepositocombinado</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RESPONSEReversiondepositocombinado</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQUESTReversiondepositocombinado">
                      <con1:id>_ActionId-6410446563752785607-4a68f230.141576ebebd.-7f91</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagooPrestamoIn"/>
                          <con1:param name="autenticacionRequestHeader">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="reversarTransaccion">
                            <con1:path>$body/rev:reversarTransaccion</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="statusReversion">
                      <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7f4b</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($RESPONSEReversiondepositocombinado/Status/successIndicator/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:responseTransform>
                </con2:wsCallout>
                <con2:ifThenElse>
                  <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7f13</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7f0f</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion2" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>AuthReversionDepositosCombinados</con2:operation>
                        <con2:request>
                          <con2:body>$reqAuthReversionDepositosCombinados</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>respAuthReversionDepositosCombinados</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="reqAuthReversionDepositosCombinados">
                            <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7f10</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/AutorizarReversionDepositoCombinadoIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:assign varName="messageReversion">
                      <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7ed7</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($RESPONSEReversiondepositocombinado/Status/messages[1]/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryConditionExpr>
                  <con1:boolExpr operator="and">
                    <con1:boolExpr operator="or">
                      <con1:compExpr operator="=">
                        <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                        <con1:rightPath>"FT"</con1:rightPath>
                      </con1:compExpr>
                      <con1:compExpr operator="=">
                        <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                        <con1:rightPath>"TT"</con1:rightPath>
                      </con1:compExpr>
                    </con1:boolExpr>
                    <con1:compExpr operator="!=">
                      <con1:leftPath>fn:string($trxId)</con1:leftPath>
                      <con1:rightPath>""</con1:rightPath>
                    </con1:compExpr>
                    <con1:compExpr operator="=">
                      <con1:leftPath>$transactionType</con1:leftPath>
                      <con1:rightPath>("", "LOAN_PAYMENT")</con1:rightPath>
                    </con1:compExpr>
                  </con1:boolExpr>
                </con1:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7ff1</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryConditionExpr>
                        <con1:compExpr operator="=">
                          <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                          <con1:rightPath>"FT"</con1:rightPath>
                        </con1:compExpr>
                      </con1:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fee</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>ReversiondetransaccionFT</con2:operation>
                        <con2:request>
                          <con2:body>$reqReversarTransaccion</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>respReversarTransaccion</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="reqReversarTransaccion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7ff0</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionFTIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="statusReversion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fef</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($respReversarTransaccion/Status/successIndicator/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:responseTransform>
                      </con2:wsCallout>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fed</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7feb</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>AutorizacionreversionFT</con2:operation>
                              <con2:request>
                                <con2:body>$reqAutorizacionReversion</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>respAutorizacionReversion</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="reqAutorizacionReversion">
                                  <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fec</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/AutorizarReversionFTIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con2:assign varName="messageReversion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fea</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($respReversarTransaccion/Status/messages[1]/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryConditionExpr>
                        <con1:compExpr operator="=">
                          <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                          <con1:rightPath>"TT"</con1:rightPath>
                        </con1:compExpr>
                      </con1:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe7</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>ReversiondetransaccionTT</con2:operation>
                        <con2:request>
                          <con2:body>$reqReversarTransaccion</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>respReversarTransaccion</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="reqReversarTransaccion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe9</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionTTIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="reversarTransaccion">
                                  <con1:path>$body/rev:reversarTransaccion</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="statusReversion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe8</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($respReversarTransaccion/Status/successIndicator/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:responseTransform>
                      </con2:wsCallout>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe6</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe4</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>AutorizacionreversionTT</con2:operation>
                              <con2:request>
                                <con2:body>$reqAutorizacionReversion</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>respAutorizacionReversion</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="reqAutorizacionReversion">
                                  <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe5</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/AutorizarReversionTTIn"/>
                                      <con1:param name="autenticacionRequestHeader">
                                        <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                      </con1:param>
                                      <con1:param name="reversarTransaccion">
                                        <con1:path>$body/rev:reversarTransaccion</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform/>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con2:assign varName="messageReversion">
                            <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fe3</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($respReversarTransaccion/Status/messages[1]/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PipelinePairNode1_response">
      <con:stage name="stage1">
        <con:context>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/reversionRecaudoAbanks_v2" prefix="rev2"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversarTransaccionTypes" prefix="rev"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-71aa</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>fn:string($validationMessage) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e04</con1:id>
                  <con2:expr>
                    <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ fn:string($validationMessage) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "CHEQUE_PAYMENT" and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-6221138966623861018--5ab1239a.1410d30b973.-7e3c</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoChequeHeaderOut"/>
                      <con1:param name="reversiondePagodeChequesResponse">
                        <con1:path>$RESPONSE</con1:path>
                      </con1:param>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "CREDIT_CARD_PAYMENT" and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-7146</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="header">
                        <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-710a</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagooRetiroTCHeaderOut"/>
                            <con1:param name="autorizareversapagooretiroTCResponse">
                              <con1:path>$respAutorizacionReversion</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace contents-only="true" varName="header">
                      <con1:id>_ActionId-8084735389425772460--7babf183.13c62c0b668.-7142</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>{$statusReversion}</successIndicator>
      <messages>{$messageReversion}</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = ("REF_COLLECTION","ABANKS_COLLECTION") and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c73</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$transactionType = "ABANKS_COLLECTION" and $RSPReversionRecAbanks/rev2:PV_CODIGO_ERROR/text() != "0"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c11</con1:id>
                        <con2:expr>
                          <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ $RSPReversionRecAbanks/rev2:PV_MENSAJE_ERROR/text() }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:ifThenElse>
                      <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c6b</con1:id>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$payMethod = "CASH"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace contents-only="true" varName="header">
                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c6a</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefEfectHeaderOut"/>
                                <con1:param name="reversionpagorecaudorefefecResponse">
                                  <con1:path>$RESPONSE</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$payMethod = "DEB.TO.ACCT"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace contents-only="true" varName="header">
                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c69</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefDebCtaHeaderOut"/>
                                <con1:param name="reversionpagorecaudorefdbctaResponse">
                                  <con1:path>$RESPONSE</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$payMethod = "FICO.CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace contents-only="true" varName="header">
                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c68</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefFicoChqHeaderOut"/>
                                <con1:param name="reversionpagorecaudorefficochqResponse">
                                  <con1:path>$RESPONSE</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$payMethod = "OB.CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace contents-only="true" varName="header">
                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c67</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefOBChqHeaderOut"/>
                                <con1:param name="reversionpagorecaudorefobchqResponse">
                                  <con1:path>$RESPONSE</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$payMethod = "INTL.CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace contents-only="true" varName="header">
                            <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c66</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoRefIntChqHeaderOut"/>
                                <con1:param name="reversionpagorecaudorefchqtintlResponse">
                                  <con1:path>$RESPONSE</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:actions>
                      </con2:case>
                      <con2:default>
                        <con2:replace contents-only="true" varName="header">
                          <con1:id>_ActionId-240690267935523144--29ba20ab.1471d3c593e.-7c65</con1:id>
                          <con2:expr>
                            <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ fn:string($validationMessage) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                          </con2:expr>
                        </con2:replace>
                      </con2:default>
                    </con2:ifThenElse>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = ("PROPTAX_COLLECTION","ONLINE_COLLECTION", "LOCAL_COLLECTION") 
and fn:string($trxId) != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-6703146841962068000--4c8f7d39.1409dd1c788.-6f8a</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>count($RESPONSE/TELLERType) > 0</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-6703146841962068000--4c8f7d39.1409dd1c788.-6f52</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoTellerHeaderOut"/>
                            <con1:param name="status">
                              <con1:path>$RESPONSE/Status</con1:path>
                            </con1:param>
                            <con1:param name="tELLERType">
                              <con1:path>$RESPONSE/TELLERType</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-6703146841962068000--4c8f7d39.1409dd1c788.-6ee4</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagoRecaudoTransferHeaderOut"/>
                          <con1:param name="fUNDSTRANSFERType">
                            <con1:path>$RESPONSE/FUNDSTRANSFERType</con1:path>
                          </con1:param>
                          <con1:param name="status">
                            <con1:path>$RESPONSE/Status</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "ABANKS_COLLECTION_OLD"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-1826793034152010609--685bdfed.1410a36781d.-7f4b</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionAbanksHeaderOut"/>
                      <con1:param name="outputParameters">
                        <con1:path>$RESPONSE</con1:path>
                      </con1:param>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$transactionType = "LOAN_PAYMENT" and 
fn:string($trxId) != "" and 
fn:substring(fn:string($trxId), 1, 3) = "TFS"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7e9e</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="header">
                        <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7e48</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionPagooPrestamoHeaderOut"/>
                            <con1:param name="authReversionDepositosCombinadosResponse">
                              <con1:path>$respAuthReversionDepositosCombinados</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace contents-only="true" varName="header">
                      <con1:id>_ActionId-2937067717799538687--274ff000.141c1c1e353.-7e4a</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>{$statusReversion}</successIndicator>
      <messages>{$messageReversion}</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryConditionExpr>
                  <con1:boolExpr operator="and">
                    <con1:boolExpr operator="or">
                      <con1:compExpr operator="=">
                        <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                        <con1:rightPath>"FT"</con1:rightPath>
                      </con1:compExpr>
                      <con1:compExpr operator="=">
                        <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                        <con1:rightPath>"TT"</con1:rightPath>
                      </con1:compExpr>
                    </con1:boolExpr>
                    <con1:compExpr operator="!=">
                      <con1:leftPath>fn:string($trxId)</con1:leftPath>
                      <con1:rightPath>""</con1:rightPath>
                    </con1:compExpr>
                    <con1:compExpr operator="=">
                      <con1:leftPath>$transactionType</con1:leftPath>
                      <con1:rightPath>("","LOAN_PAYMENT")</con1:rightPath>
                    </con1:compExpr>
                  </con1:boolExpr>
                </con1:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fc0</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>upper-case($statusReversion) = "SUCCESS"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fbf</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryConditionExpr>
                              <con1:compExpr operator="=">
                                <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                                <con1:rightPath>"FT"</con1:rightPath>
                              </con1:compExpr>
                            </con1:xqueryConditionExpr>
                          </con2:condition>
                          <con2:actions>
                            <con2:replace contents-only="true" varName="header">
                              <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fbe</con1:id>
                              <con2:expr>
                                <con1:xqueryTransform>
                                  <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionFTHeaderOut"/>
                                  <con1:param name="autorizacionreversionFTResponse">
                                    <con1:path>$respAutorizacionReversion</con1:path>
                                  </con1:param>
                                </con1:xqueryTransform>
                              </con2:expr>
                            </con2:replace>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryConditionExpr>
                              <con1:compExpr operator="=">
                                <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                                <con1:rightPath>"TT"</con1:rightPath>
                              </con1:compExpr>
                            </con1:xqueryConditionExpr>
                          </con2:condition>
                          <con2:actions>
                            <con2:replace contents-only="true" varName="header">
                              <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fbd</con1:id>
                              <con2:expr>
                                <con1:xqueryTransform>
                                  <con1:resource ref="MiddlewareCaja/Resources/xqueries/ReversarTransaccion/ReversarTransaccionTTHeaderOut"/>
                                  <con1:param name="autorizacionreversionTTResponse">
                                    <con1:path>$respAutorizacionReversion</con1:path>
                                  </con1:param>
                                </con1:xqueryTransform>
                              </con2:expr>
                            </con2:replace>
                          </con2:actions>
                        </con2:case>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace contents-only="true" varName="header">
                      <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fbc</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>{$statusReversion}</successIndicator>
      <messages>{$messageReversion}</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:ifThenElse>
                <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-7172</con1:id>
                <con2:case>
                  <con2:condition>
                    <con1:xqueryText>$transactionType != "CHEQUE_PAYMENT" and 
$transactionType != "CREDIT_CARD_PAYMENT"</con1:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:replace contents-only="true" varName="header">
                      <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7f82</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>UNSUPPORTED TRANSACTION_TYPE</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:actions>
                </con2:case>
                <con2:case>
                  <con2:condition>
                    <con1:xqueryConditionExpr>
                      <con1:boolExpr operator="or">
                        <con1:compExpr operator="!=">
                          <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                          <con1:rightPath>"FT"</con1:rightPath>
                        </con1:compExpr>
                        <con1:compExpr operator="!=">
                          <con1:leftPath>fn:string($tipoTrx)</con1:leftPath>
                          <con1:rightPath>"TT"</con1:rightPath>
                        </con1:compExpr>
                      </con1:boolExpr>
                    </con1:xqueryConditionExpr>
                  </con2:condition>
                  <con2:actions>
                    <con2:replace contents-only="true" varName="header">
                      <con1:id>_ActionId-8399140991327229486-fa245a8.13c3e5f2cb6.-7fba</con1:id>
                      <con2:expr>
                        <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>TRANSACTION_ID MUST TO BEGIN WITH "FT" OR "FT"</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                      </con2:expr>
                    </con2:replace>
                  </con2:actions>
                </con2:case>
                <con2:default>
                  <con2:replace contents-only="true" varName="header">
                    <con1:id>_ActionId-3185089423348795353--751b0424.13611bf3d36.-6fd5</con1:id>
                    <con2:expr>
                      <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>REQUIRED FIELDS NOT SUPPLIED</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                    </con2:expr>
                  </con2:replace>
                </con2:default>
              </con2:ifThenElse>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace contents-only="true" varName="body">
            <con1:id>_ActionId-5389526616290378473-42edd4bf.13ab1efef84.-7c17</con1:id>
            <con2:expr>
              <con1:xqueryText>&lt;rev:reversarTransaccionResponse/></con1:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8848777042473091319--23eafd38.13c2a05c9f3.-6ddb">
      <con:stage name="Etapa de Error">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaFICOPENTypes" prefix="con"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversarTransaccionTypes" prefix="rev"/>
        </con:context>
        <con:actions>
          <con2:replace contents-only="true" varName="header">
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-6da1</con1:id>
            <con2:expr>
              <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ concat(fn:string($fault/ctx:errorCode/text()), ": ", fn:string($fault/ctx:reason/text())) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:replace contents-only="true" varName="body">
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-6da0</con1:id>
            <con2:expr>
              <con1:xqueryText>&lt;rev:reversarTransaccionResponse/></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con1:reply>
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-6d9f</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:flow>
      <con:pipeline-node name="PipelinePairNode1">
        <con:request>PipelinePairNode1_request</con:request>
        <con:response>PipelinePairNode1_response</con:response>
      </con:pipeline-node>
    </con:flow>
  </ser:router>
</xml-fragment>