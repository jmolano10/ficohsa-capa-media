<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con3:SoapBindingType" xmlns:con3="http://www.bea.com/wli/sb/services/bindings/config">
      <con3:wsdl ref="MiddlewareCaja/Resources/wsdls/PagoPrestamoCaja"/>
      <con3:port>
        <con3:name>pagoPrestamoPSSOAP</con3:name>
        <con3:namespace>http://www.ficohsa.com.hn/middleware.services/pagoPrestamoPS/</con3:namespace>
      </con3:port>
      <con3:selector type="SOAP body"/>
      <con3:WSI-compliant>false</con3:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/MiddlewareCaja/PagoPrestamoCaja</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-2384409316698514622--736b363.13cb5f6f6ac.-7ff8">
    <con1:pipeline type="error" name="_onErrorHandler-2384409316698514622--736b363.13cb5f6f6ac.-7ff8">
      <con1:stage name="proxyFault">
        <con1:context>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag"/>
        </con1:context>
        <con1:actions>
          <con2:replace contents-only="true" varName="header">
            <con:id>_ActionId-2384409316698514622--736b363.13cb5f6f6ac.-7f3d</con:id>
            <con2:expr>
              <con:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ concat(fn:string($fault/ctx:errorCode/text()), ": ", fn:string($fault/ctx:reason/text())) }</messages>
</aut:ResponseHeader>]]></con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:replace contents-only="true" varName="body">
            <con:id>_ActionId-2384409316698514622--736b363.13cb5f6f6ac.-7f2a</con:id>
            <con2:expr>
              <con:xqueryText>&lt;pag:pagoPrestamoResponse/></con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con:reply>
            <con:id>_ActionId-2384409316698514622--736b363.13cb5f6f6ac.-7f04</con:id>
          </con:reply>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="request" name="VALIDATION_request">
      <con1:stage name="valid_proxyRequest" errorHandler="_onErrorHandler-1975934683809069028--6f26b86d.14ff68fe485.-7c6a">
        <con1:context>
          <con:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultarPtmoMigrado" prefix="con2"/>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag"/>
        </con1:context>
        <con1:actions>
          <con2:wsCallout>
            <con:id>_ActionId-1975934683809069028--6f26b86d.14ff68fe485.-7c6b</con:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/consultarPtmoMigrado_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>consultarPtmoMigrado</con2:operation>
            <con2:request>
              <con2:body>$REQConsPtmoMig</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPConsPtmoMig</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQConsPtmoMig">
                <con:id>_ActionId-1975934683809069028--6f26b86d.14ff68fe485.-7c50</con:id>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="MiddlewareCaja/Resources/xqueries/ConsultaGeneralPrestamo/ConsultarPtmoMigradoIn"/>
                    <con:param name="loanNumber">
                      <con:path>fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:replace contents-only="true" varName="body">
                <con:id>_ActionId-1975934683809069028--6f26b86d.14ff68fe485.-7c03</con:id>
                <con2:location>
                  <con:xpathText>./pag:pagoPrestamo/LOAN_NUMBER</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryText>fn:string($RSPConsPtmoMig/con2:PV_NUMERO_PRESTAMO_VALIDO/text())</con:xqueryText>
                </con2:expr>
              </con2:replace>
              <con2:assign varName="responseLoanNumber">
                <con:id>_ActionId-2955661912422161236-14bac7d5.15416d182bf.-7f6b</con:id>
                <con2:expr>
                  <con:xqueryText>fn:string($RSPConsPtmoMig/con2:PV_VALOR_RECIBO/text())</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:responseTransform>
          </con2:wsCallout>
          <con2:assign varName="loanType">
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-79e7</con:id>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="MiddlewareCaja/Resources/xqueries/ConsultaGeneralPrestamo/validarTipoPrestamo"/>
                <con:param name="NumeroPrestamo">
                  <con:path>fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="uuid">
            <con:id>_ActionId-7993753185305313405-de4985b.14d217b9b5f.-7f36</con:id>
            <con2:expr>
              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUUID"/>
              </con3:xqueryTransform>
            </con2:expr>
          </con2:assign>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="VALIDATION_response"/>
    <con1:pipeline type="request" name="ABANKS_request">
      <con1:stage name="ABANKS_proxyRequest">
        <con1:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaGeneralPrestamoTypes" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="T24WebServicesImpl" prefix="t24" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_K_PAGO_PRESTAMO/TOPLEVEL-24OSB_PAG_PRESTAMO_CAJ/" prefix="top" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
        </con1:context>
        <con1:actions>
          <con1:assign varName="error" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se validan los valores soportados y los campos requeridos</con2:comment>
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a9e</con:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoCajaValidacionIn"/>
                <con2:param name="pagoPrestamo">
                  <con2:path>$body/pag:pagoPrestamo</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a9d</con:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$error = ""</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="loanNumber">
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a9c</con:id>
                  <con1:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con3:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:wsCallout>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se consulta el servicio proxy de Consulta General del Préstamo con el fin de obtener la moneda del préstamo</con2:comment>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a97</con:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/ConsultaGeneralPrestamo" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>consultaGeneralPrestamo</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTconsultaGeneralPrestamo</con1:body>
                    <con1:header>$REQUESTHconsultaGeneralPrestamo</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEconsultaGeneralPrestamo</con1:body>
                    <con1:header>RESPONSEHconsultaGeneralPrestamo</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTHconsultaGeneralPrestamo">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a9b</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQUESTconsultaGeneralPrestamo">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a9a</con:id>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/ConsultaGeneralPrestamoIn"/>
                          <con2:param name="pagoPrestamo">
                            <con2:path>$body/pag:pagoPrestamo</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="monedaPrestamo">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a99</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEconsultaGeneralPrestamo/con:consultaGeneralPrestamoResponseType/con:consultaGeneralPrestamoResponseRecordType/CURRENCY/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a98</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if ($monedaPrestamo = "") then (
	"ERROR TRYING TO GET LOAN CURRENCY"
) else ("")</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a96</con2:id>
              </con2:skip>
            </con1:default>
          </con1:ifThenElse>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se determina que camino tomar. Error o el flujo asociado a cada tipo de pago</con2:comment>
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a94</con:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$error != ""</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a93</con2:id>
                </con2:skip>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/pag:pagoPrestamo/PAYMENT_TYPE/text() = "ACCOUNT_DEBIT"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="codCorr">
                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7783</con:id>
                  <con1:expr>
                    <con:xqueryText>fn:string($body/pag:pagoPrestamo/DESCRIPTION/text())</con:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:wsCallout>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se consulta el servicio de negocio de Consulta de Cuenta para obtener la moneda de la cuenta</con2:comment>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8f</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultasCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>Consultadedetallesdelacuenta</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTConsultadedetallesdelacuenta</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEConsultadedetallesdelacuenta</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTConsultadedetallesdelacuenta">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a92</con:id>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/ConsultaDetalleCuentaIn"/>
                          <con2:param name="autenticacionRequestHeader">
                            <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                          </con2:param>
                          <con2:param name="pagoPrestamo">
                            <con2:path>$body/pag:pagoPrestamo</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="monedaCuenta">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a91</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEConsultadedetallesdelacuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a90</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if ($monedaCuenta = "") then (
	concat("ERROR TRYING TO GET ACCOUNT CURRENCY. ", $RESPONSEConsultadedetallesdelacuenta/Status/messages)

) else if ($monedaCuenta != $monedaPrestamo) then (
	"CURRENCY ACCOUNTS DIFFERENTS"
) else ("")</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8c</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>obtenerParametrizacion</con1:operation>
                  <con1:request>
                    <con1:body>$REQobtenerParametrizacion</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESobtenerParametrizacion</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQobtenerParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8e</con:id>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                          <con3:param name="nombreParametros">
                            <con3:path>"T24T134.HNLCREDITACCTNO||T24T134.USDCREDITACCTNO||T24T133.TXNTYPELOANPYMT"</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="statusParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8d</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:ERROR_CODE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8b</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$statusParametrizacion = "SUCCESS"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:ifThenElse>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a8a</con:id>
                        <con1:case>
                          <con1:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "HNL"</con3:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con1:assign varName="creditAccount">
                              <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a89</con:id>
                              <con1:expr>
                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T134.HNLCREDITACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                              </con1:expr>
                            </con1:assign>
                          </con1:actions>
                        </con1:case>
                        <con1:case>
                          <con1:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "USD"</con3:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con1:assign varName="creditAccount">
                              <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a88</con:id>
                              <con1:expr>
                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T134.USDCREDITACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                              </con1:expr>
                            </con1:assign>
                          </con1:actions>
                        </con1:case>
                      </con1:ifThenElse>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a87</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a86</con3:id>
                    </con3:skip>
                  </con1:default>
                </con1:ifThenElse>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a85</con:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$error != ""</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a84</con2:id>
                      </con2:skip>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$monedaPrestamo = "HNL" or $monedaPrestamo = "USD"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:ifThenElse>
                        <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7764</con:id>
                        <con1:case>
                          <con1:condition>
                            <con:xqueryText>$codCorr = 'CODIGO_CORRESPONSAL'</con:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con1:wsCallout>
                              <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7734</con:id>
                              <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/T24/svcRegistraTransaccionTengo/biz/svcRegistraTransaccionTengo" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con1:operation>RetiroEfectivoTengo</con1:operation>
                              <con1:request>
                                <con1:body>$REQPagoPrestamoCB</con1:body>
                              </con1:request>
                              <con1:response>
                                <con1:body>RSPPagoPrestamoCB</con1:body>
                              </con1:response>
                              <con1:requestTransform>
                                <con1:assign varName="trxType">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-76a0</con:id>
                                  <con1:expr>
                                    <con:xqueryText>fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T133.TXNTYPELOANPYMT"]/osb:VALUE/text())</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                                <con1:assign varName="REQPagoPrestamoCB">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7689</con:id>
                                  <con1:expr>
                                    <con:xqueryTransform>
                                      <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/registraTransaccionT24Tengo"/>
                                      <con:param name="transactionType">
                                        <con:path>fn:string($trxType)</con:path>
                                      </con:param>
                                      <con:param name="autenticacionRequestHeader">
                                        <con:path>$header/aut:AutenticacionRequestHeader</con:path>
                                      </con:param>
                                      <con:param name="accountCurrency">
                                        <con:path>fn:string($monedaCuenta)</con:path>
                                      </con:param>
                                      <con:param name="creditAccount">
                                        <con:path>fn:string($creditAccount)</con:path>
                                      </con:param>
                                      <con:param name="uuid">
                                        <con:path>fn:string($uuid)</con:path>
                                      </con:param>
                                      <con:param name="pagoPrestamo">
                                        <con:path>$body/pag:pagoPrestamo</con:path>
                                      </con:param>
                                    </con:xqueryTransform>
                                  </con1:expr>
                                </con1:assign>
                              </con1:requestTransform>
                              <con1:responseTransform>
                                <con1:assign varName="error">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-771b</con:id>
                                  <con1:expr>
                                    <con:xqueryText>fn:string($RSPPagoPrestamoCB/Status/successIndicator/text())</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                                <con1:assign varName="message">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7703</con:id>
                                  <con1:expr>
                                    <con:xqueryText>fn:string-join($RSPPagoPrestamoCB/Status/messages/text()," ")</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                                <con1:assign varName="transactionId">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-76f1</con:id>
                                  <con1:expr>
                                    <con:xqueryText>fn:string($RSPPagoPrestamoCB/Status/transactionId/text())</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                                <con1:assign varName="valueDate">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-76d1</con:id>
                                  <con1:expr>
                                    <con:xqueryText>fn:string($RSPPagoPrestamoCB/FUNDSTRANSFERType/DEBITVALUEDATE/text())</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                                <con1:assign varName="rteform">
                                  <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-76b7</con:id>
                                  <con1:expr>
                                    <con:xqueryText>(:: No aplica para este servicio, se indica dejar en duro "NO":)
"NO"</con:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                              </con1:responseTransform>
                            </con1:wsCallout>
                          </con1:actions>
                        </con1:case>
                        <con1:default>
                          <con1:wsCallout>
                            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se realiza la transferencia en moneda local (HNL)</con2:comment>
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7754</con:id>
                            <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Transferencias" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con1:operation>Transfmodelbankentrecuentas</con1:operation>
                            <con1:request>
                              <con1:body>$REQUESTTransfmodelbankentrecuentas</con1:body>
                            </con1:request>
                            <con1:response>
                              <con1:body>RESPONSETransfmodelbankentrecuentas</con1:body>
                            </con1:response>
                            <con1:requestTransform>
                              <con1:assign varName="trxType">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-775b</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T133.TXNTYPELOANPYMT"]/osb:VALUE/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="REQUESTTransfmodelbankentrecuentas">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-775a</con:id>
                                <con1:expr>
                                  <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                    <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/TransfmodelbankentrecuentasIn"/>
                                    <con3:param name="transactionType">
                                      <con3:path>fn:string($trxType)</con3:path>
                                    </con3:param>
                                    <con3:param name="autenticacionRequestHeader">
                                      <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                    </con3:param>
                                    <con3:param name="accountCurrency">
                                      <con3:path>fn:string($monedaCuenta)</con3:path>
                                    </con3:param>
                                    <con3:param name="creditAccount">
                                      <con3:path>fn:string($creditAccount)</con3:path>
                                    </con3:param>
                                    <con3:param name="uuid">
                                      <con3:path>fn:string($uuid)</con3:path>
                                    </con3:param>
                                    <con3:param name="pagoPrestamo">
                                      <con3:path>$body/pag:pagoPrestamo</con3:path>
                                    </con3:param>
                                  </con3:xqueryTransform>
                                </con1:expr>
                              </con1:assign>
                            </con1:requestTransform>
                            <con1:responseTransform>
                              <con1:assign varName="error">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7759</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSETransfmodelbankentrecuentas/Status/successIndicator/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="message">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7758</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSETransfmodelbankentrecuentas/Status/messages/text()," ")</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="transactionId">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7757</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSETransfmodelbankentrecuentas/Status/transactionId/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="valueDate">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7756</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSETransfmodelbankentrecuentas/FUNDSTRANSFERType/DEBITVALUEDATE/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="rteform">
                                <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7755</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">(:: No aplica para este servicio, se indica dejar en duro "NO":)
"NO"</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                            </con1:responseTransform>
                          </con1:wsCallout>
                        </con1:default>
                      </con1:ifThenElse>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a7b</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">"CURRENCY LOAN NOT SUPPORTED"</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a7a</con2:id>
                    </con2:skip>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/pag:pagoPrestamo/PAYMENT_TYPE/text() = "CASH"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a77</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>obtenerParametrizacion</con1:operation>
                  <con1:request>
                    <con1:body>$REQobtenerParametrizacion</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESobtenerParametrizacion</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQobtenerParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a79</con:id>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                          <con3:param name="nombreParametros">
                            <con3:path>"T24T044.USDCREDITAACCTNO||T24T043.HNLCREDITAACCTNO"</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="statusParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a78</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:ERROR_CODE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a76</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$statusParametrizacion != "SUCCESS"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:assign varName="error">
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a75</con:id>
                        <con1:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con3:xqueryText>
                        </con1:expr>
                      </con1:assign>
                      <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                        <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a74</con3:id>
                      </con3:skip>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$monedaPrestamo = "HNL"</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:assign varName="depositAccount">
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a73</con:id>
                        <con1:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T043.HNLCREDITAACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                        </con1:expr>
                      </con1:assign>
                      <con1:wsCallout>
                        <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f1</con:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Depositos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>Depositoefecenmonedalocal</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTDepositoefecenmonedalocal</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEDepositoefecenmonedalocal</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="REQUESTDepositoefecenmonedalocal">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f7</con:id>
                            <con1:expr>
                              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/DepositoEfectivoMonedaLocalIn"/>
                                <con3:param name="autenticacionRequestHeader">
                                  <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                </con3:param>
                                <con3:param name="depositAccount">
                                  <con3:path>fn:string($depositAccount)</con3:path>
                                </con3:param>
                                <con3:param name="uuid">
                                  <con3:path>fn:string($uuid)</con3:path>
                                </con3:param>
                                <con3:param name="pagoPrestamo">
                                  <con3:path>$body/pag:pagoPrestamo</con3:path>
                                </con3:param>
                              </con3:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:assign varName="error">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f6</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedalocal/Status/successIndicator/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="message">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f5</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSEDepositoefecenmonedalocal/Status/messages/text()," ")</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="transactionId">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f4</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedalocal/Status/transactionId/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="valueDate">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f3</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedalocal/TELLERType/VALUEDATE2/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="rteform">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77f2</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedalocal/TELLERType/RTEFORM/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:responseTransform>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$monedaPrestamo = "USD"</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:assign varName="depositAccount">
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a6b</con:id>
                        <con1:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T044.USDCREDITAACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                        </con1:expr>
                      </con1:assign>
                      <con1:wsCallout>
                        <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-77ff</con:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Depositos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>Depositoefecenmonedaextranjera</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTDepositoefecenmonedaextranjera</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEDepositoefecenmonedaextranjera</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="REQUESTDepositoefecenmonedaextranjera">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7805</con:id>
                            <con1:expr>
                              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/DepositoEfectivoMonedaExtranjeraIn"/>
                                <con3:param name="autenticacionRequestHeader">
                                  <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                </con3:param>
                                <con3:param name="depositAccount">
                                  <con3:path>fn:string($depositAccount)</con3:path>
                                </con3:param>
                                <con3:param name="uuid">
                                  <con3:path>fn:string($uuid)</con3:path>
                                </con3:param>
                                <con3:param name="pagoPrestamo">
                                  <con3:path>$body/pag:pagoPrestamo</con3:path>
                                </con3:param>
                              </con3:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:assign varName="error">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7804</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedaextranjera/Status/successIndicator/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="message">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7803</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSEDepositoefecenmonedaextranjera/Status/messages/text(), " ")</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="transactionId">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7802</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedaextranjera/Status/transactionId/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="valueDate">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7801</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedaextranjera/TELLERType/VALUEDATE2/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="rteform">
                            <con:id>_ActionId-4931609677002278306-3cb450bb.1847dded19f.-7800</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositoefecenmonedaextranjera/TELLERType/RTEFORM/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:responseTransform>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a63</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">"CURRENCY LOAN NOT SUPPORTED"</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a62</con2:id>
                    </con2:skip>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/pag:pagoPrestamo/PAYMENT_TYPE/text() = "OWN_CHEQUE"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se consulta el servicio de negocio de Consulta de Cuenta para obtener la moneda de la cuenta</con2:comment>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5e</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ConsultasCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>Consultadedetallesdelacuenta</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTConsultadedetallesdelacuenta</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEConsultadedetallesdelacuenta</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTConsultadedetallesdelacuenta">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a61</con:id>
                      <con1:expr>
                        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                          <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/ConsultaDetalleCuentaIn"/>
                          <con2:param name="autenticacionRequestHeader">
                            <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                          </con2:param>
                          <con2:param name="pagoPrestamo">
                            <con2:path>$body/pag:pagoPrestamo</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="monedaCuenta">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a60</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEConsultadedetallesdelacuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5f</con:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if ($monedaCuenta = "") then (
	concat("ERROR TRYING TO GET ACCOUNT CURRENCY. ", $RESPONSEConsultadedetallesdelacuenta/Status/messages)

) else if ($monedaCuenta != $monedaPrestamo) then (
	"CURRENCY ACCOUNTS DIFFERENTS"
) else ("")</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5b</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>obtenerParametrizacion</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTobtenerParametrizacion</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEobtenerParametrizacion</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTobtenerParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5d</con:id>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                          <con3:param name="nombreParametros">
                            <con3:path>"T24T032.HNLFICOCHQACCTNO||T24T032.USDFICOCHQACCTNO"</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="statusParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5c</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_CODE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a5a</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$statusParametrizacion = "SUCCESS"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:ifThenElse>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a59</con:id>
                        <con1:case>
                          <con1:condition>
                            <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$error != ""</con3:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                              <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a58</con3:id>
                            </con3:skip>
                          </con1:actions>
                        </con1:case>
                        <con1:default>
                          <con1:wsCallout>
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4e</con:id>
                            <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Depositos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con1:operation>Depositocombinado</con1:operation>
                            <con1:request>
                              <con1:body>$REQUESTDepositocombinado</con1:body>
                            </con1:request>
                            <con1:response>
                              <con1:body>RESPONSEDepositocombinado</con1:body>
                            </con1:response>
                            <con1:requestTransform>
                              <con1:ifThenElse>
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a57</con:id>
                                <con1:case>
                                  <con1:condition>
                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "HNL"</con3:xqueryText>
                                  </con1:condition>
                                  <con1:actions>
                                    <con1:assign varName="depositAccount">
                                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a56</con:id>
                                      <con1:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T032.HNLFICOCHQACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                                      </con1:expr>
                                    </con1:assign>
                                  </con1:actions>
                                </con1:case>
                                <con1:case>
                                  <con1:condition>
                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "USD"</con3:xqueryText>
                                  </con1:condition>
                                  <con1:actions>
                                    <con1:assign varName="depositAccount">
                                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a55</con:id>
                                      <con1:expr>
                                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T032.USDFICOCHQACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                                      </con1:expr>
                                    </con1:assign>
                                  </con1:actions>
                                </con1:case>
                              </con1:ifThenElse>
                              <con1:assign varName="REQUESTDepositocombinado">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a54</con:id>
                                <con1:expr>
                                  <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                    <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/DepositoCombinadoChequePropioIn"/>
                                    <con3:param name="autenticacionRequestHeader">
                                      <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                    </con3:param>
                                    <con3:param name="depositAccount">
                                      <con3:path>fn:string($depositAccount)</con3:path>
                                    </con3:param>
                                    <con3:param name="accountCurrency">
                                      <con3:path>fn:string($monedaPrestamo)</con3:path>
                                    </con3:param>
                                    <con3:param name="pagoPrestamo">
                                      <con3:path>$body/pag:pagoPrestamo</con3:path>
                                    </con3:param>
                                    <con3:param name="uuid">
                                      <con3:path>fn:string($uuid)</con3:path>
                                    </con3:param>
                                  </con3:xqueryTransform>
                                </con1:expr>
                              </con1:assign>
                            </con1:requestTransform>
                            <con1:responseTransform>
                              <con1:assign varName="error">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a53</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/successIndicator/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="message">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a52</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSEDepositocombinado/Status/messages/text(), " ")</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="transactionId">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a51</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/transactionId/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="valueDate">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a50</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:concat("20",$RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/gDATETIME/DATETIME)</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                              <con1:assign varName="rteform">
                                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4f</con:id>
                                <con1:expr>
                                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/RTEFORM/text())</con3:xqueryText>
                                </con1:expr>
                              </con1:assign>
                            </con1:responseTransform>
                          </con1:wsCallout>
                        </con1:default>
                      </con1:ifThenElse>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4d</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4c</con3:id>
                    </con3:skip>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body/pag:pagoPrestamo/PAYMENT_TYPE/text() = "OTHER_BANK_CHEQUE"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a49</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>obtenerParametrizacion</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTobtenerParametrizacion</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEobtenerParametrizacion</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTobtenerParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4b</con:id>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                          <con3:param name="nombreParametros">
                            <con3:path>"T24T032.HNLOBCHQACCTNO||T24T032.USDOBCHQACCTNO"</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="statusParametrizacion">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a4a</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_CODE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a48</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$statusParametrizacion = "SUCCESS"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3e</con:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Depositos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>Depositocombinado</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTDepositocombinado</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEDepositocombinado</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:ifThenElse>
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a47</con:id>
                            <con1:case>
                              <con1:condition>
                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "HNL"</con3:xqueryText>
                              </con1:condition>
                              <con1:actions>
                                <con1:assign varName="depositAccount">
                                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a46</con:id>
                                  <con1:expr>
                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T032.HNLOBCHQACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                              </con1:actions>
                            </con1:case>
                            <con1:case>
                              <con1:condition>
                                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($monedaPrestamo)) = "USD"</con3:xqueryText>
                              </con1:condition>
                              <con1:actions>
                                <con1:assign varName="depositAccount">
                                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a45</con:id>
                                  <con1:expr>
                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T032.USDOBCHQACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                                  </con1:expr>
                                </con1:assign>
                              </con1:actions>
                            </con1:case>
                          </con1:ifThenElse>
                          <con1:assign varName="REQUESTDepositocombinado">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a44</con:id>
                            <con1:expr>
                              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/DepositoCombinadoChequeOtroBancoIn"/>
                                <con3:param name="autenticacionRequestHeader">
                                  <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                </con3:param>
                                <con3:param name="depositAccount">
                                  <con3:path>fn:string($depositAccount)</con3:path>
                                </con3:param>
                                <con3:param name="accountCurrency">
                                  <con3:path>fn:string($monedaPrestamo)</con3:path>
                                </con3:param>
                                <con3:param name="pagoPrestamo">
                                  <con3:path>$body/pag:pagoPrestamo</con3:path>
                                </con3:param>
                                <con3:param name="uuid">
                                  <con3:path>fn:string($uuid)</con3:path>
                                </con3:param>
                              </con3:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:assign varName="error">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a43</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/successIndicator/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="message">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a42</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSEDepositocombinado/Status/messages/text(), " ")</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="transactionId">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a41</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/transactionId/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="valueDate">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a40</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/gTRANSACTION/mTRANSACTION/DRVALUEDATE/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="rteform">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3f</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/RTEFORM/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:responseTransform>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3d</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3c</con3:id>
                    </con3:skip>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:case>
              <con1:condition>
                <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/pag:pagoPrestamo/PAYMENT_TYPE/text() = "INTL_CHQ_US"</con3:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3b</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$monedaPrestamo = "USD"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a38</con:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ObtenerParametrizacion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>obtenerParametrizacion</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTobtenerParametrizacion</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEobtenerParametrizacion</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="REQUESTobtenerParametrizacion">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a3a</con:id>
                            <con1:expr>
                              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerParametrizacionIn"/>
                                <con3:param name="nombreParametros">
                                  <con3:path>"T24T032.USDINTLCHQACCTNO"</con3:path>
                                </con3:param>
                              </con3:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:assign varName="statusParametrizacion">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a39</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_CODE/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:responseTransform>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a37</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">"FOR PAYMENT WITH  INTERNATIONAL CHEQUE ONLY ALLOWED LOAN IN USD CURRENCY"</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a36</con3:id>
                    </con3:skip>
                  </con1:default>
                </con1:ifThenElse>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a35</con:id>
                  <con1:case>
                    <con1:condition>
                      <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$statusParametrizacion = "SUCCESS"</con3:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2d</con:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/Depositos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>Depositocombinado</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTDepositocombinado</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEDepositocombinado</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="depositAccount">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a34</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME="T24T032.USDINTLCHQACCTNO"]/osb:VALUE/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="REQUESTDepositocombinado">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a33</con:id>
                            <con1:expr>
                              <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/DepositoCombinadoChequeInternacionalIn"/>
                                <con3:param name="autenticacionRequestHeader">
                                  <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                                </con3:param>
                                <con3:param name="depositAccount">
                                  <con3:path>fn:string($depositAccount)</con3:path>
                                </con3:param>
                                <con3:param name="accountCurrency">
                                  <con3:path>"USD"</con3:path>
                                </con3:param>
                                <con3:param name="pagoPrestamo">
                                  <con3:path>$body/pag:pagoPrestamo</con3:path>
                                </con3:param>
                                <con3:param name="uuid">
                                  <con3:path>fn:string($uuid)</con3:path>
                                </con3:param>
                              </con3:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:assign varName="error">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a32</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/successIndicator/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="message">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a31</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string-join($RESPONSEDepositocombinado/Status/messages/text(), " ")</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="transactionId">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a30</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/Status/transactionId/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="valueDate">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2f</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/gTRANSACTION/mTRANSACTION/DRVALUEDATE/text())</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="rteform">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2e</con:id>
                            <con1:expr>
                              <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEDepositocombinado/TELLERFINANCIALSERVICESType/RTEFORM/text())</con3:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:responseTransform>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2c</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:string($RESPONSEobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                      <con3:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2b</con3:id>
                    </con3:skip>
                  </con1:default>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
          </con1:ifThenElse>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a2a</con:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$error = "Success"</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a27</con:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/PagoPrestamo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>pagoPrestamo</con1:operation>
                  <con1:request>
                    <con1:body>$REQUESTpagoPrestamo</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RESPONSEpagoPrestamo</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQUESTpagoPrestamo">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a29</con:id>
                      <con1:expr>
                        <con3:xqueryTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                          <con3:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoIn"/>
                          <con3:param name="autenticacionRequestHeader">
                            <con3:path>$header/aut:AutenticacionRequestHeader</con3:path>
                          </con3:param>
                          <con3:param name="transactionID">
                            <con3:path>fn:string($transactionId)</con3:path>
                          </con3:param>
                          <con3:param name="pagoPrestamo">
                            <con3:path>$body/pag:pagoPrestamo</con3:path>
                          </con3:param>
                        </con3:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="error">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a28</con:id>
                      <con1:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">if(fn:string($RESPONSEpagoPrestamo/top:ERROR_CODE/text()) != "SUCCESS") then (
	fn:string($RESPONSEpagoPrestamo/top:ERROR_MESSAGE)
) else ("")</con3:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a26</con:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$error != ""</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a23</con:id>
                        <con1:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/ReversarTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>reversarTransaccion</con1:operation>
                        <con1:request>
                          <con1:body>$REQUESTreversarTransaccion</con1:body>
                          <con1:header>$REQUESTHreversarTransaccion</con1:header>
                        </con1:request>
                        <con1:response>
                          <con1:body>RESPONSEreversarTransaccion</con1:body>
                          <con1:header>RESPONSEHreversarTransaccion</con1:header>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="REQUESTHreversarTransaccion">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a25</con:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$header</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                          <con1:assign varName="REQUESTreversarTransaccion">
                            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a24</con:id>
                            <con1:expr>
                              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/ReversarTransaccionIn"/>
                                <con2:param name="transactionId">
                                  <con2:path>$transactionId</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                      </con1:wsCallout>
                    </con1:actions>
                  </con1:case>
                  <con1:default/>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:assign varName="error">
                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a22</con:id>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">concat("ERROR IN T24 OPERATION ", $message)</con2:xqueryText>
                </con1:expr>
              </con1:assign>
            </con1:default>
          </con1:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="ABANKS_response">
      <con1:stage name="ABANKS_proxyResponse">
        <con1:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con1:context>
        <con1:actions>
          <con1:replace contents-only="true" varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a21</con:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoCajaHeaderOut"/>
                <con2:param name="valueDate">
                  <con2:path>fn:string($valueDate)</con2:path>
                </con2:param>
                <con2:param name="message">
                  <con2:path>fn:string($error)</con2:path>
                </con2:param>
                <con2:param name="transactionId">
                  <con2:path>fn:string($transactionId)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:replace contents-only="true" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a20</con:id>
            <con1:expr>
              <con:xqueryTransform>
                <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoCajaOut"/>
                <con:param name="outputParameters">
                  <con:path>$RESPONSEpagoPrestamo</con:path>
                </con:param>
                <con:param name="rteform">
                  <con:path>fn:string($rteform)</con:path>
                </con:param>
                <con:param name="error">
                  <con:path>fn:string($error)</con:path>
                </con:param>
                <con:param name="responseLoanNumber">
                  <con:path>$responseLoanNumber</con:path>
                </con:param>
                <con:param name="monedaPrestamo">
                  <con:path>fn:string($monedaPrestamo)</con:path>
                </con:param>
              </con:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="request" name="T24_request">
      <con1:stage name="T24_proxyRequest">
        <con1:context>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag"/>
        </con1:context>
        <con1:actions>
          <con2:wsCallout>
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-798b</con:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/PrestamosT24" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>PagoaprestamoAA</con2:operation>
            <con2:request>
              <con2:body>$REQPagoPtmo</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPPagoPtmo</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQPagoPtmo">
                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-796b</con:id>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoT24In"/>
                    <con:param name="uuid">
                      <con:path>$uuid</con:path>
                    </con:param>
                    <con:param name="autenticacionRequestHeader1">
                      <con:path>$header/aut:AutenticacionRequestHeader</con:path>
                    </con:param>
                    <con:param name="pagoPrestamo1">
                      <con:path>$body/pag:pagoPrestamo</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:assign varName="successIndicatorTxn">
                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7943</con:id>
                <con2:expr>
                  <con:xqueryText>fn:string($RSPPagoPtmo/Status/successIndicator/text())</con:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:assign varName="transactionId">
                <con:id>_ActionId-7993753185305313405-de4985b.14d217b9b5f.-7d18</con:id>
                <con2:expr>
                  <con:xqueryText>fn:string($RSPPagoPtmo/Status/transactionId/text())</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:responseTransform>
          </con2:wsCallout>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="T24_response">
      <con1:stage name="T24_proxyResponse">
        <con1:context>
          <con:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/sjConsultaPrestamoTypes" prefix="cons"/>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag"/>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con1:context>
        <con1:actions>
          <con2:ifThenElse>
            <con:comment>Condición para determinar si se busca detalles del pago de préstamo. Si el pago fue exitoso, se buscan detalles, de lo contrario se devuelve error.</con:comment>
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7926</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>$successIndicatorTxn = "Success"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-78f6</con:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/SjConsultaPrestamo" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>sjConsultaPrestamo</con2:operation>
                  <con2:request>
                    <con2:body>$REQConsPrestamo</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RSPConsPrestamo</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQConsPrestamo">
                      <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7878</con:id>
                      <con2:expr>
                        <con:xqueryTransform>
                          <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/ConsultaPrestamoT24SjIn"/>
                          <con:param name="password">
                            <con:path>fn:string($header/aut:AutenticacionRequestHeader/Password/text())</con:path>
                          </con:param>
                          <con:param name="username">
                            <con:path>fn:string($header/aut:AutenticacionRequestHeader/UserName/text())</con:path>
                          </con:param>
                          <con:param name="loanNumber">
                            <con:path>fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con:path>
                          </con:param>
                          <con:param name="transactionId">
                            <con:path>$transactionId</con:path>
                          </con:param>
                        </con:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="successIndicatorQry1">
                      <con:id>_ActionId-7993753185305313405-de4985b.14d217b9b5f.-7e45</con:id>
                      <con2:expr>
                        <con:xqueryText>fn:string($RSPConsPrestamo/cons:sjConsultaPrestamoResponseType/cons:consultaPagoPrestamo/TRANSACTION_INDICATOR/text())</con:xqueryText>
                      </con2:expr>
                    </con2:assign>
                    <con2:assign varName="successIndicatorQry2">
                      <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7e69</con:id>
                      <con2:expr>
                        <con:xqueryText>fn:string($RSPConsPrestamo/cons:sjConsultaPrestamoResponseType/cons:consultaAplicaPagoPrestamo/SUCCESS_INDICATOR/text())</con:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:responseTransform>
                </con2:wsCallout>
                <con2:ifThenElse>
                  <con:comment>Condición para determinar si el pago del préstamo se aplicó correctamente. Las opciones son:

* SUCCESS: El pago fue aplicado exitosamente.
* FAILURE: Se procede con la reversión de la transacción TFS original.</con:comment>
                  <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7e62</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$successIndicatorQry1 != "SUCCESS" or $successIndicatorQry2 != "SUCCESS"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7e5f</con:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/registrarErrorPagoPtmo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>registrarErrorPagoPtmo</con2:operation>
                        <con2:request>
                          <con2:body>$REQRegErrorPagoPtmo</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RSPRegErrorPagoPtmo</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQRegErrorPagoPtmo">
                            <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7d89</con:id>
                            <con2:expr>
                              <con:xqueryTransform>
                                <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/RegistrarErrorPagoPtmoIn"/>
                                <con:param name="userName">
                                  <con:path>fn:string($header/aut:AutenticacionRequestHeader/UserName/text())</con:path>
                                </con:param>
                                <con:param name="uuid">
                                  <con:path>$uuid</con:path>
                                </con:param>
                                <con:param name="sjConsultaPrestamoResponse1">
                                  <con:path>$RSPConsPrestamo</con:path>
                                </con:param>
                                <con:param name="transactionId">
                                  <con:path>$transactionId</con:path>
                                </con:param>
                                <con:param name="pagoPrestamo1">
                                  <con:path>$body/pag:pagoPrestamo</con:path>
                                </con:param>
                              </con:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                      <con2:replace varName="body" contents-only="true">
                        <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7e5e</con:id>
                        <con2:expr>
                          <con:xqueryText>&lt;pag:pagoPrestamoResponse/></con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:replace varName="body" contents-only="true">
                      <con:id>_ActionId-3669932689554374836--268044f.14d5373caba.-7e5d</con:id>
                      <con2:expr>
                        <con:xqueryTransform>
                          <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoT24Out"/>
                          <con:param name="sjConsultaPrestamoResponse1">
                            <con:path>$RSPConsPrestamo</con:path>
                          </con:param>
                          <con:param name="pagoaprestamoAAResponse1">
                            <con:path>$RSPPagoPtmo</con:path>
                          </con:param>
                        </con:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con2:default>
                </con2:ifThenElse>
                <con2:replace varName="header" contents-only="true">
                  <con:id>_ActionId-8216036010899518388-34153973.14d4f591684.-7fdc</con:id>
                  <con2:expr>
                    <con:xqueryTransform>
                      <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoT24HeaderOut"/>
                      <con:param name="successIndicatorQry2">
                        <con:path>$successIndicatorQry2</con:path>
                      </con:param>
                      <con:param name="successIndicatorQry1">
                        <con:path>$successIndicatorQry1</con:path>
                      </con:param>
                      <con:param name="pagoaprestamoAAResponse1">
                        <con:path>$RSPPagoPtmo</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:replace contents-only="true" varName="body">
                <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-78d2</con:id>
                <con2:expr>
                  <con:xqueryText>&lt;pag:pagoPrestamoResponse/></con:xqueryText>
                </con2:expr>
              </con2:replace>
              <con2:replace varName="header" contents-only="true">
                <con:id>_ActionId-4731110751785338129--25cce304.14e268cd3f2.-7f5a</con:id>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="MiddlewareCaja/Resources/xqueries/PagoPrestamoCaja/PagoPrestamoT24HeaderOut2"/>
                    <con:param name="pagoaprestamoAAResponse1">
                      <con:path>$RSPPagoPtmo</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:replace>
            </con2:default>
          </con2:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="request" name="ERROR_request">
      <con1:stage name="stage1">
        <con1:context/>
        <con1:actions>
          <con2:Error>
            <con:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7a07</con:id>
            <con2:errCode>MW-0002</con2:errCode>
            <con2:message>INVALID REQUEST</con2:message>
          </con2:Error>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="ERROR_response"/>
    <con1:pipeline type="error" name="_onErrorHandler-1975934683809069028--6f26b86d.14ff68fe485.-7c6a">
      <con1:stage name="valid_proxyFault">
        <con1:context>
          <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoPrestamoTypes" prefix="pag"/>
        </con1:context>
        <con1:actions>
          <con2:assign varName="loanType">
            <con:id>_ActionId-1975934683809069028--6f26b86d.14ff68fe485.-7c42</con:id>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="MiddlewareCaja/Resources/xqueries/ConsultaGeneralPrestamo/validarTipoPrestamo"/>
                <con:param name="NumeroPrestamo">
                  <con:path>fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="uuid">
            <con:id>_ActionId-1975934683809069028--6f26b86d.14ff68fe485.-7c29</con:id>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUUID"/>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="responseLoanNumber">
            <con:id>_ActionId-2955661912422161236-14bac7d5.15416d182bf.-7f58</con:id>
            <con2:expr>
              <con:xqueryText>fn:string($body/pag:pagoPrestamo/LOAN_NUMBER/text())</con:xqueryText>
            </con2:expr>
          </con2:assign>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:pipeline-node name="VALIDATION">
        <con:request>VALIDATION_request</con:request>
        <con:response>VALIDATION_response</con:response>
      </con:pipeline-node>
      <con:branch-node type="condition" name="LOAN_PAYMENT">
        <con:context/>
        <con:branch-table variable="loanType">
          <con:branch name="Abanks">
            <con:operator>equals</con:operator>
            <con:value>"ABANKS"</con:value>
            <con:flow>
              <con:pipeline-node name="ABANKS">
                <con:request>ABANKS_request</con:request>
                <con:response>ABANKS_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:branch name="T24">
            <con:operator>equals</con:operator>
            <con:value>"T24"</con:value>
            <con:flow>
              <con:pipeline-node name="T24">
                <con:request>T24_request</con:request>
                <con:response>T24_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow>
              <con:pipeline-node name="ERROR">
                <con:request>ERROR_request</con:request>
                <con:response>ERROR_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
</xml-fragment>