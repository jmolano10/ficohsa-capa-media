<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:security>
      <con:custom-token-authentication>
        <con:username-password>
          <con:username-selector>
            <con:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:RequestHeader/Authentication/UserName/text()</con:xpath>
            <con:variable>header</con:variable>
          </con:username-selector>
          <con:password-selector>
            <con:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:RequestHeader/Authentication/Password/text()</con:xpath>
            <con:variable>header</con:variable>
          </con:password-selector>
        </con:username-password>
      </con:custom-token-authentication>
    </ser:security>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config">
      <con:wsdl ref="MiddlewareCaja/Resources/wsdls/ReversionCompletaTransaccion"/>
      <con:port>
        <con:name>reversionCompletaTransaccionPSSOAP</con:name>
        <con:namespace>http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionPS/</con:namespace>
      </con:port>
      <con:selector type="SOAP body"/>
    </ser:binding>
    <ser:monitoring isEnabled="true">
      <ser:aggregationInterval>1440</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
    <ser:throttling enabled="false">
      <ser:capacity>0</ser:capacity>
      <ser:maxQueueLength>0</ser:maxQueueLength>
      <ser:timeToLive>0</ser:timeToLive>
    </ser:throttling>
    <ser:messageTracing enabled="false">
      <ser:detailsLevel>Terse</ser:detailsLevel>
      <ser:maxSize>8192</ser:maxSize>
    </ser:messageTracing>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/MiddlewareCaja/ProxyServices/ReversionCompletaTransaccion</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties>
        <http:use-https>true</http:use-https>
      </http:inbound-properties>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-4540080047191287187-474b7204.1503f2563a4.-7ebc">
    <con1:pipeline type="request" name="FlujoPrincipal_request">
      <con1:stage name="Validaciones">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:validate>
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-7827</con2:id>
            <con3:schema ref="MiddlewareCaja/Resources/xsds/ReversionCompletaTransaccion/reversionCompletaTransaccionTypes"/>
            <con3:schemaElement xmlns:rev="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes">rev:reversionCompletaTransaccion</con3:schemaElement>
            <con3:varName>body</con3:varName>
            <con3:location>
              <con2:xpathText>./rev:reversionCompletaTransaccion</con2:xpathText>
            </con3:location>
          </con3:validate>
          <con3:assign varName="errorMessage">
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-785f</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionCompletaTransaccionValidate"/>
                <con2:param name="reversionCompletaTransaccion">
                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
        </con1:actions>
      </con1:stage>
      <con1:stage name="ConsultaUsuariosCaja">
        <con1:context>
          <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/obtenerUsuarioCaja" prefix="obt"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77ef</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$errorMessage = ""</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con2:wsCallout xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                  <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77dd</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/obtenerUsuarioCaja_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>obtenerUsuarioCaja</con2:operation>
                  <con2:request>
                    <con2:body>$REQObtenerUsuarioTeller</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RSPObtenerUsuarioTeller</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQObtenerUsuarioTeller">
                      <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77e5</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUsuarioCaja"/>
                          <con1:param name="tellerCode">
                            <con1:path>fn:string($header/aut:RequestHeader/TellerInfo/TellerId/text())</con1:path>
                          </con1:param>
                          <con1:param name="branchCode">
                            <con1:path>fn:string($header/aut:RequestHeader/TellerInfo/BranchCode/text())</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="successIndicator">
                      <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77e4</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($RSPObtenerUsuarioTeller/obt:PV_CODIGOERROR/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                    <con2:ifThenElse>
                      <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77e3</con1:id>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$successIndicator = "SUCCESS"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="tellerUsername">
                            <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77e2</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RSPObtenerUsuarioTeller/obt:PV_USUARIO/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="tellerPassword">
                            <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-77e1</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RSPObtenerUsuarioTeller/obt:PV_PASSWORD/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:actions>
                      </con2:case>
                      <con2:default>
                        <con2:assign varName="errorMessage">
                          <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-7776</con1:id>
                          <con2:expr>
                            <con1:xqueryText>fn:string($RSPObtenerUsuarioTeller/obt:PV_MENSAJEERROR/text())</con1:xqueryText>
                          </con2:expr>
                        </con2:assign>
                        <con2:wsCallout>
                          <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7834</con1:id>
                          <con2:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                          <con2:operation>mapeoErrores</con2:operation>
                          <con2:request>
                            <con2:body>$rqMapeoErrores</con2:body>
                          </con2:request>
                          <con2:response>
                            <con2:body>rpMapeoErrores</con2:body>
                          </con2:response>
                          <con2:requestTransform>
                            <con2:assign varName="rqMapeoErrores">
                              <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-77fc</con1:id>
                              <con2:expr>
                                <con1:xqueryTransform>
                                  <con1:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageIn"/>
                                  <con1:param name="CODIGO_ERROR">
                                    <con1:path>$successIndicator</con1:path>
                                  </con1:param>
                                  <con1:param name="MENSAJE_ERROR">
                                    <con1:path>fn:string($errorMessage)</con1:path>
                                  </con1:param>
                                </con1:xqueryTransform>
                              </con2:expr>
                            </con2:assign>
                          </con2:requestTransform>
                          <con2:responseTransform>
                            <con2:replace contents-only="true" varName="header">
                              <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-77c4</con1:id>
                              <con2:expr>
                                <con1:xqueryTransform>
                                  <con1:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageOut"/>
                                  <con1:param name="mapeoErroresResponse1">
                                    <con1:path>$rpMapeoErrores</con1:path>
                                  </con1:param>
                                  <con1:param name="successIndicator">
                                    <con1:path>$successIndicator</con1:path>
                                  </con1:param>
                                </con1:xqueryTransform>
                              </con2:expr>
                            </con2:replace>
                          </con2:responseTransform>
                        </con2:wsCallout>
                        <con2:replace contents-only="true" varName="body">
                          <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-778c</con1:id>
                          <con2:expr>
                            <con1:xqueryText>&lt;rev:reversionCompletaTransaccionResponse/></con1:xqueryText>
                          </con2:expr>
                        </con2:replace>
                        <con1:reply>
                          <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-776f</con1:id>
                        </con1:reply>
                      </con2:default>
                    </con2:ifThenElse>
                  </con2:responseTransform>
                </con2:wsCallout>
                <con3:ifThenElse>
                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76ec</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$successIndicator = "SUCCESS"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con2:wsCallout xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                        <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76da</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/obtenerUsuarioCaja_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>obtenerUsuarioCaja</con2:operation>
                        <con2:request>
                          <con2:body>$REQObtenerUsuarioAuthorizer</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RSPObtenerUsuarioAuthorizer</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQObtenerUsuarioAuthorizer">
                            <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76e2</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUsuarioCaja"/>
                                <con1:param name="tellerCode">
                                  <con1:path>fn:string($body/rev:reversionCompletaTransaccion/AUTHORIZER/TELLERID/text())</con1:path>
                                </con1:param>
                                <con1:param name="branchCode">
                                  <con1:path>fn:string($body/rev:reversionCompletaTransaccion/AUTHORIZER/BRANCHCODE/text())</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="successIndicator">
                            <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76e1</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RSPObtenerUsuarioAuthorizer/obt:PV_CODIGOERROR/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76e0</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>$successIndicator = "SUCCESS"</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:assign varName="authorizerUsername">
                                  <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76df</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RSPObtenerUsuarioAuthorizer/obt:PV_USUARIO/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                                <con2:assign varName="authorizerPassword">
                                  <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-76de</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RSPObtenerUsuarioAuthorizer/obt:PV_PASSWORD/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:actions>
                            </con2:case>
                            <con2:default>
                              <con2:assign varName="errorMessage">
                                <con1:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-762c</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>fn:string($RSPObtenerUsuarioAuthorizer/obt:PV_MENSAJEERROR/text())</con1:xqueryText>
                                </con2:expr>
                              </con2:assign>
                              <con2:wsCallout>
                                <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7752</con1:id>
                                <con2:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con2:operation>mapeoErrores</con2:operation>
                                <con2:request>
                                  <con2:body>$rqMapeoErrores</con2:body>
                                </con2:request>
                                <con2:response>
                                  <con2:body>rpMapeoErrores</con2:body>
                                </con2:response>
                                <con2:requestTransform>
                                  <con2:assign varName="rqMapeoErrores">
                                    <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-76e4</con1:id>
                                    <con2:expr>
                                      <con1:xqueryTransform>
                                        <con1:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageIn"/>
                                        <con1:param name="CODIGO_ERROR">
                                          <con1:path>$successIndicator</con1:path>
                                        </con1:param>
                                        <con1:param name="MENSAJE_ERROR">
                                          <con1:path>fn:string($errorMessage)</con1:path>
                                        </con1:param>
                                      </con1:xqueryTransform>
                                    </con2:expr>
                                  </con2:assign>
                                </con2:requestTransform>
                                <con2:responseTransform>
                                  <con2:replace contents-only="true" varName="header">
                                    <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-76ac</con1:id>
                                    <con2:expr>
                                      <con1:xqueryTransform>
                                        <con1:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageOut"/>
                                        <con1:param name="mapeoErroresResponse1">
                                          <con1:path>$rpMapeoErrores</con1:path>
                                        </con1:param>
                                        <con1:param name="successIndicator">
                                          <con1:path>$successIndicator</con1:path>
                                        </con1:param>
                                      </con1:xqueryTransform>
                                    </con2:expr>
                                  </con2:replace>
                                </con2:responseTransform>
                              </con2:wsCallout>
                              <con2:replace contents-only="true" varName="body">
                                <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7674</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>&lt;rev:reversionCompletaTransaccionResponse/></con1:xqueryText>
                                </con2:expr>
                              </con2:replace>
                              <con1:reply>
                                <con1:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7657</con1:id>
                              </con1:reply>
                            </con2:default>
                          </con2:ifThenElse>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con3:actions>
                  </con3:case>
                  <con3:default/>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default>
              <con3:assign varName="successIndicator">
                <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6d30</con2:id>
                <con3:expr>
                  <con2:xqueryText>"ERROR"</con2:xqueryText>
                </con3:expr>
              </con3:assign>
            </con3:default>
          </con3:ifThenElse>
        </con1:actions>
      </con1:stage>
      <con1:stage name="Reversi贸nTransacci贸n">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-75be</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$successIndicator = "SUCCESS"</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con4:assign varName="trxId" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-2656666390752145581--21e5d556.15039ebb750.-7464</con5:id>
                  <con4:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($body/rev:reversionCompletaTransaccion/TRANSACTION_ID/text())</con5:xqueryText>
                  </con4:expr>
                </con4:assign>
                <con4:assign varName="transactionType" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-2656666390752145581--21e5d556.15039ebb750.-74bc</con5:id>
                  <con4:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($body/rev:reversionCompletaTransaccion/TRANSACTION_TYPE/text())</con5:xqueryText>
                  </con4:expr>
                </con4:assign>
                <con4:assign varName="tipoTrx" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-2656666390752145581--21e5d556.15039ebb750.-74ba</con5:id>
                  <con4:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:substring(fn:string($trxId), 1, 2)</con5:xqueryText>
                  </con4:expr>
                </con4:assign>
                <con4:assign varName="uuid" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-2656666390752145581--21e5d556.15039ebb750.-7462</con5:id>
                  <con4:expr>
                    <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                      <con5:resource ref="MiddlewareCaja/Resources/xqueries/General/obtenerUUID"/>
                    </con5:xqueryTransform>
                  </con4:expr>
                </con4:assign>
                <con3:ifThenElse>
                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-73d7</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "ACCOUNT_DEPOSIT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:wsCallout>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-732e</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion2" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>Reversiondepositocombinado</con3:operation>
                        <con3:request>
                          <con3:body>$requestReversiondepositocombinado</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>responseReversiondepositocombinado</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="requestReversiondepositocombinado">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-72f6</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionDepositoCombinadoIn"/>
                                <con2:param name="reversionCompletaTransaccion">
                                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                </con2:param>
                                <con2:param name="uuid">
                                  <con2:path>fn:string($uuid)</con2:path>
                                </con2:param>
                                <con2:param name="usuarioCaja">
                                  <con2:path>$RSPObtenerUsuarioTeller</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="successIndicator">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-72be</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string($responseReversiondepositocombinado/Status/successIndicator/text())</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorMessage">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6c66</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string-join($responseReversiondepositocombinado/Status/messages/text(),
     "||")</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                    </con3:actions>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "ACCOUNT_WITHDRAWAL"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-7286</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>fn:string($tipoTrx) = "FT"</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:wsCallout>
                              <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-724e</con2:id>
                              <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con3:operation>ReversiondetransaccionFT</con3:operation>
                              <con3:request>
                                <con3:body>$requestReversiondetransaccionFT</con3:body>
                              </con3:request>
                              <con3:response>
                                <con3:body>responseReversiondetransaccionFT</con3:body>
                              </con3:response>
                              <con3:requestTransform>
                                <con3:assign varName="requestReversiondetransaccionFT">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-71de</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionTransaccionFTIn"/>
                                      <con2:param name="reversionCompletaTransaccion">
                                        <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                      </con2:param>
                                      <con2:param name="usuarioCaja">
                                        <con2:path>$RSPObtenerUsuarioTeller</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                              </con3:requestTransform>
                              <con3:responseTransform>
                                <con3:assign varName="successIndicator">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b9f</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string($responseReversiondetransaccionFT/Status/successIndicator/text())</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorMessage">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b9e</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string-join($responseReversiondetransaccionFT/Status/messages/text(),
     "||")</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                              </con3:responseTransform>
                            </con3:wsCallout>
                          </con3:actions>
                        </con3:case>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>fn:string($tipoTrx) = "TT"</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:wsCallout>
                              <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-706d</con2:id>
                              <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con3:operation>ReversiondetransaccionTT</con3:operation>
                              <con3:request>
                                <con3:body>$requestReversiondetransaccionTT</con3:body>
                              </con3:request>
                              <con3:response>
                                <con3:body>responseReversiondetransaccionTT</con3:body>
                              </con3:response>
                              <con3:requestTransform>
                                <con3:assign varName="requestReversiondetransaccionTT">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-706f</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionTransaccionTTIn"/>
                                      <con2:param name="reversionCompletaTransaccion">
                                        <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                      </con2:param>
                                      <con2:param name="usuarioCaja">
                                        <con2:path>$RSPObtenerUsuarioTeller</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                              </con3:requestTransform>
                              <con3:responseTransform>
                                <con3:assign varName="successIndicator">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b63</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string($responseReversiondetransaccionTT/Status/successIndicator/text())</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorMessage">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b62</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string-join($responseReversiondetransaccionTT/Status/messages/text(),
     "||")</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                              </con3:responseTransform>
                            </con3:wsCallout>
                          </con3:actions>
                        </con3:case>
                      </con3:ifThenElse>
                    </con3:actions>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "CHEQUE_PAYMENT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:wsCallout>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6f9f</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>ReversiondePagodeCheques</con3:operation>
                        <con3:request>
                          <con3:body>$requestReversiondePagodeCheques</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>responseReversiondePagodeCheques</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="requestReversiondePagodeCheques">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6fa1</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionPagoChequesIn"/>
                                <con2:param name="reversionCompletaTransaccion">
                                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                </con2:param>
                                <con2:param name="uuid">
                                  <con2:path>fn:string($uuid)</con2:path>
                                </con2:param>
                                <con2:param name="usuarioCaja">
                                  <con2:path>$RSPObtenerUsuarioTeller</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="successIndicator">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b29</con2:id>
                            <con3:expr>
                              <con2:xqueryText>if (fn:upper-case($responseReversiondePagodeCheques/FICOHCHQTRANREVERSEType/TXNSTATUS/text()) = "REVERSED") then (
	"SUCCESS"
) else (
	"ERROR"
)</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorMessage">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6b28</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string-join($responseReversiondePagodeCheques/FICOHCHQTRANREVERSEType/gDESCRIPTION/DESCRIPTION/text(),
     "||")</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                    </con3:actions>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "CREDIT_CARD_PAYMENT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:wsCallout>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6f24</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>ReversionpagoTC</con3:operation>
                        <con3:request>
                          <con3:body>$requestReversionpagoTC</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>responseReversionpagoTC</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="requestReversionpagoTC">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6f26</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/ReversionRetiroTCIn"/>
                                <con2:param name="reversionCompletaTransaccion">
                                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                </con2:param>
                                <con2:param name="uuid">
                                  <con2:path>fn:string($uuid)</con2:path>
                                </con2:param>
                                <con2:param name="usuarioCaja">
                                  <con2:path>$RSPObtenerUsuarioTeller</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="successIndicator">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6aef</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string($responseReversionpagoTC/Status/successIndicator/text())</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorMessage">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6aee</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string-join($responseReversionpagoTC/Status/messages/text(),
     "||")</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                    </con3:actions>
                  </con3:case>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con1:actions>
      </con1:stage>
      <con1:stage name="Autorizaci贸nReversi贸n">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-73f4</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>upper-case($successIndicator) = "SUCCESS"</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:ifThenElse>
                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6dae</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "ACCOUNT_DEPOSIT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:wsCallout>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6dab</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion2" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>AuthReversionDepositosCombinados</con3:operation>
                        <con3:request>
                          <con3:body>$requestAuthReversionDepositosCombinados</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>responseAuthReversionDepositosCombinados</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="requestAuthReversionDepositosCombinados">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6dad</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/AuthReversionDepositosCombinadosIn"/>
                                <con2:param name="reversionCompletaTransaccion">
                                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                </con2:param>
                                <con2:param name="usuarioCaja">
                                  <con2:path>$RSPObtenerUsuarioAuthorizer</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="successIndicator">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6ab3</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string($responseAuthReversionDepositosCombinados/Status/successIndicator/text())</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorMessage">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6ab2</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string-join($responseAuthReversionDepositosCombinados/Status/messages/text(),
     "||")</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                    </con3:actions>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "ACCOUNT_WITHDRAWAL"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6daa</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>fn:string($tipoTrx) = "FT"</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:wsCallout>
                              <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6da7</con2:id>
                              <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con3:operation>AutorizacionreversionFT</con3:operation>
                              <con3:request>
                                <con3:body>$requestAutorizacionreversionFT</con3:body>
                              </con3:request>
                              <con3:response>
                                <con3:body>responseAutorizacionreversionFT</con3:body>
                              </con3:response>
                              <con3:requestTransform>
                                <con3:assign varName="requestAutorizacionreversionFT">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6da9</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/AutorizacionReversionFTIn"/>
                                      <con2:param name="reversionCompletaTransaccion">
                                        <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                      </con2:param>
                                      <con2:param name="usuarioCaja">
                                        <con2:path>$RSPObtenerUsuarioAuthorizer</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                              </con3:requestTransform>
                              <con3:responseTransform>
                                <con3:assign varName="successIndicator">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a77</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string($responseAutorizacionreversionFT/Status/successIndicator/text())</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorMessage">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a76</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string-join($responseAutorizacionreversionFT/Status/messages/text(),
     "||")</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                              </con3:responseTransform>
                            </con3:wsCallout>
                          </con3:actions>
                        </con3:case>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>fn:string($tipoTrx) = "TT"</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:wsCallout>
                              <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6da4</con2:id>
                              <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con3:operation>AutorizacionreversionTT</con3:operation>
                              <con3:request>
                                <con3:body>$requestAutorizacionreversionTT</con3:body>
                              </con3:request>
                              <con3:response>
                                <con3:body>responseAutorizacionreversionTT</con3:body>
                              </con3:response>
                              <con3:requestTransform>
                                <con3:assign varName="requestAutorizacionreversionTT">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6da6</con2:id>
                                  <con3:expr>
                                    <con2:xqueryTransform>
                                      <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/AutorizacionReversionTTIn"/>
                                      <con2:param name="reversionCompletaTransaccion">
                                        <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                      </con2:param>
                                      <con2:param name="usuarioCaja">
                                        <con2:path>$RSPObtenerUsuarioAuthorizer</con2:path>
                                      </con2:param>
                                    </con2:xqueryTransform>
                                  </con3:expr>
                                </con3:assign>
                              </con3:requestTransform>
                              <con3:responseTransform>
                                <con3:assign varName="successIndicator">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a3d</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string($responseAutorizacionreversionTT/Status/successIndicator/text())</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="errorMessage">
                                  <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a3c</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>fn:string-join($responseAutorizacionreversionTT/Status/messages/text(),
     "||")</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                              </con3:responseTransform>
                            </con3:wsCallout>
                          </con3:actions>
                        </con3:case>
                      </con3:ifThenElse>
                    </con3:actions>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "CHEQUE_PAYMENT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions/>
                  </con3:case>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$transactionType = "CREDIT_CARD_PAYMENT"</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:wsCallout>
                        <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6d9e</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="MiddlewareCaja/BussinessServices/ReversaTransaccion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>AutorizareversapagooretiroTC</con3:operation>
                        <con3:request>
                          <con3:body>$requestAutorizareversapagooretiroTC</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>responseAutorizareversapagooretiroTC</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="requestAutorizareversapagooretiroTC">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6da0</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="MiddlewareCaja/Resources/xqueries/ReversionCompletaTransaccion/AutorizaReversaPagoORetiroTCIn"/>
                                <con2:param name="reversionCompletaTransaccion">
                                  <con2:path>$body/rev:reversionCompletaTransaccion</con2:path>
                                </con2:param>
                                <con2:param name="usuarioCaja">
                                  <con2:path>$RSPObtenerUsuarioAuthorizer</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="successIndicator">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a03</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string($responseAutorizareversapagooretiroTC/Status/successIndicator/text())</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                          <con3:assign varName="errorMessage">
                            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-6a02</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string-join($responseAutorizareversapagooretiroTC/Status/messages/text(),
     "||")</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                    </con3:actions>
                  </con3:case>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="FlujoPrincipal_response">
      <con1:stage name="FlujoSalida">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-761f</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>fn:string($successIndicator) = "SUCCESS" or fn:string($successIndicator) = "Success"</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:replace contents-only="true" varName="header">
                  <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-761d</con2:id>
                  <con3:expr>
                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<transactionId>{ fn:string($trxId) }</transactionId>
	<successIndicator>{ fn:string($successIndicator) }</successIndicator>
	<messages>{ fn:string($errorMessage) }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                  </con3:expr>
                </con3:replace>
              </con3:actions>
            </con3:case>
            <con3:default>
              <con3:wsCallout>
                <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-75e5</con2:id>
                <con3:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                <con3:operation>mapeoErrores</con3:operation>
                <con3:request>
                  <con3:body>$rqMapeoErrores</con3:body>
                </con3:request>
                <con3:response>
                  <con3:body>rpMapeoErrores</con3:body>
                </con3:response>
                <con3:requestTransform>
                  <con3:assign varName="rqMapeoErrores">
                    <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-75ad</con2:id>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageIn"/>
                        <con2:param name="CODIGO_ERROR">
                          <con2:path>fn:string($successIndicator)</con2:path>
                        </con2:param>
                        <con2:param name="MENSAJE_ERROR">
                          <con2:path>fn:string($errorMessage)</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:assign>
                </con3:requestTransform>
                <con3:responseTransform>
                  <con3:replace contents-only="true" varName="header">
                    <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7575</con2:id>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageOut"/>
                        <con2:param name="mapeoErroresResponse1">
                          <con2:path>$rpMapeoErrores</con2:path>
                        </con2:param>
                        <con2:param name="successIndicator">
                          <con2:path>fn:string($successIndicator)</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:replace>
                </con3:responseTransform>
              </con3:wsCallout>
            </con3:default>
          </con3:ifThenElse>
          <con3:replace contents-only="true" varName="body">
            <con2:id>_ActionId-2656666390752145581--21e5d556.15039ebb750.-69df</con2:id>
            <con3:expr>
              <con2:xqueryText>&lt;rev:reversionCompletaTransaccionResponse /></con2:xqueryText>
            </con3:expr>
          </con3:replace>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="error" name="_onErrorHandler-4540080047191287187-474b7204.1503f2563a4.-7ebc">
      <con1:stage name="Etapa de Error">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/reversionCompletaTransaccionTypes" prefix="rev"/>
        </con1:context>
        <con1:actions>
          <con3:assign varName="errorCode">
            <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-753d</con2:id>
            <con3:expr>
              <con2:xqueryText>fn:string($fault/ctx:errorCode/text())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="errorMessage">
            <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7520</con2:id>
            <con3:expr>
              <con2:xqueryText>fn:string($fault/ctx:reason/text())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:wsCallout>
            <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-74e8</con2:id>
            <con3:service xsi:type="ref:ProxyRef" ref="MiddlewareCaja/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con3:operation>mapeoErrores</con3:operation>
            <con3:request>
              <con3:body>$rqMapeoErrores</con3:body>
            </con3:request>
            <con3:response>
              <con3:body>rpMapeoErrores</con3:body>
            </con3:response>
            <con3:requestTransform>
              <con3:assign varName="rqMapeoErrores">
                <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-74b0</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageIn"/>
                    <con2:param name="CODIGO_ERROR">
                      <con2:path>$errorCode</con2:path>
                    </con2:param>
                    <con2:param name="MENSAJE_ERROR">
                      <con2:path>$errorMessage</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:assign>
            </con3:requestTransform>
            <con3:responseTransform>
              <con3:replace contents-only="true" varName="header">
                <con2:id>_ActionId-668586091644912525-6ede78e0.1504dfab658.-7478</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="MiddlewareCaja/Resources/xqueries/MapeoErrores/mapeoErroresUsageOut"/>
                    <con2:param name="mapeoErroresResponse1">
                      <con2:path>$rpMapeoErrores</con2:path>
                    </con2:param>
                    <con2:param name="successIndicator">
                      <con2:path>$errorCode</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:replace>
            </con3:responseTransform>
          </con3:wsCallout>
          <con3:replace contents-only="true" varName="body">
            <con2:id>_ActionId-4540080047191287187-474b7204.1503f2563a4.-7dfa</con2:id>
            <con3:expr>
              <con2:xqueryText>&lt;rev:reversionCompletaTransaccionResponse/></con2:xqueryText>
            </con3:expr>
          </con3:replace>
          <con2:reply>
            <con2:id>_ActionId-4540080047191287187-474b7204.1503f2563a4.-7dc2</con2:id>
          </con2:reply>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:flow>
      <con1:pipeline-node name="FlujoPrincipal">
        <con1:request>FlujoPrincipal_request</con1:request>
        <con1:response>FlujoPrincipal_response</con1:response>
      </con1:pipeline-node>
    </con1:flow>
  </ser:router>
</xml-fragment>