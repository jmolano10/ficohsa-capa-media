<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:security>
      <con3:custom-token-authentication>
        <con3:username-password>
          <con3:username-selector>
            <con3:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:AutenticacionRequestHeader/UserName/text()</con3:xpath>
            <con3:variable>header</con3:variable>
          </con3:username-selector>
          <con3:password-selector>
            <con3:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:AutenticacionRequestHeader/Password/text()</con3:xpath>
            <con3:variable>header</con3:variable>
          </con3:password-selector>
        </con3:username-password>
      </con3:custom-token-authentication>
    </ser:security>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con4:SoapBindingType" xmlns:con4="http://www.bea.com/wli/sb/services/bindings/config">
      <con4:wsdl ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoPS"/>
      <con4:port>
        <con4:name>pagoRecaudoPSSOAP</con4:name>
        <con4:namespace>http://www.ficohsa.com.hn/middleware.services/pagoRecaudo/</con4:namespace>
      </con4:port>
      <con4:selector type="SOAP body"/>
      <con4:WSI-compliant>false</con4:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="true">
      <ser:aggregationInterval>180</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
    <ser:throttling enabled="false">
      <ser:capacity>0</ser:capacity>
      <ser:maxQueueLength>0</ser:maxQueueLength>
      <ser:timeToLive>0</ser:timeToLive>
    </ser:throttling>
    <ser:messageTracing enabled="false">
      <ser:detailsLevel>Full</ser:detailsLevel>
      <ser:maxSize>10240</ser:maxSize>
    </ser:messageTracing>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/Middleware/OperationsAndExecution/Payments/PagoRecaudo</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-8848777042473091319--23eafd38.13c2a05c9f3.-6605">
    <con:pipeline type="request" name="PipelinePairNode1_request">
      <con:stage name="proxyRequest">
        <con:context>
          <con1:userNsDecl namespace="http://alcance.local/wsinfotarjetas/" prefix="tns"/>
          <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/obtenerSecuencia" prefix="ns0"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoRecaudoTypes" prefix="pag"/>
          <con1:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
          <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/FLINK/OSB_CONSULTAR_OPER_RECAUDO/" prefix="osb"/>
          <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/FLINK/INT_K_CONVENIOS_NO_ESTANDAR/INT_CV_REGISTRAR_INFO_OPER/" prefix="int"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaTasaCambioTypes" prefix="con"/>
          <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb1"/>
        </con:context>
        <con:actions>
          <con2:assign varName="validationMessage">
            <con1:id>_ActionId-1763724706617571497--5b3f9580.13d5a582e20.-7f45</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoValidate"/>
                <con1:param name="pagoRecaudo">
                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                </con1:param>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="paymentMethod">
            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6dbc</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:string($body/pag:pagoRecaudo/PAYMENT_INFORMATION/PAYMENT_METHOD/text())</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="reqParams">
            <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7fe4</con1:id>
            <con2:expr>
              <con1:xqueryText>concat(
fn:string($header/aut:AutenticacionRequestHeader/UserName/text()),"|",
fn:string($body/pag:pagoRecaudo/CONTRACT_ID/text()),"|",
fn:string($body/pag:pagoRecaudo/DEBTOR_CODE/text())
)</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="proxyTrace">
            <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7d55</con1:id>
            <con2:expr>
              <con1:xqueryText>"preObtieneParametrizacion"</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:wsCallout>
            <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7fcd</con1:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>obtenerParametrizacion</con2:operation>
            <con2:request>
              <con2:body>$REQObtenerParam</con2:body>
            </con2:request>
            <con2:response>
              <con2:body>RSPObtenerParam</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con2:assign varName="REQObtenerParam">
                <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7fae</con1:id>
                <con2:expr>
                  <con1:xqueryTransform>
                    <con1:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                    <con1:param name="nombreParametros">
                      <con1:path>"T24C001.LOGENABLED"</con1:path>
                    </con1:param>
                  </con1:xqueryTransform>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con2:assign varName="statusParametrizacion">
                <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7f70</con1:id>
                <con2:expr>
                  <con1:xqueryText>fn:string($RSPObtenerParam/osb1:ERROR_CODE/text())</con1:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:responseTransform>
          </con2:wsCallout>
          <con2:assign varName="logEnabled">
            <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7f4d</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:string($RSPObtenerParam/osb1:CONFIGURACIONES/osb1:CONFIGURACIONES_ITEM[osb1:NAME="T24C001.LOGENABLED"]/osb1:VALUE/text())</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con1:comment>Esta condición es para determinar si se debe grabar en bitácora o no. Esto depende del parametro T24C001.LOGENABLED de la tabla parametrizacion_middleware.</con1:comment>
            <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7f37</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$statusParametrizacion = "SUCCESS" and
$logEnabled = "TRUE"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="reqUuidBitacora">
                  <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7f15</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/UUID/obtenerUUID"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="reqTimeStamp">
                  <con1:id>_ActionId-8260807813913073177-76e45d5e.14505cf0cc8.-7ed2</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/TimeStamp/obtenerTimestamp"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="proxyTrace">
                  <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7d33</con1:id>
                  <con2:expr>
                    <con1:xqueryText>"preRegistrarReqBitacora"</con1:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con4:route>
                  <con1:id>_ActionId-4577606443375125713-4946857e.151a7391d3d.-7f3a</con1:id>
                  <con4:service ref="Middleware/Business_Resources/recaudos/Resources/registrarReqConsultaRecaudo_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con4:operation>registrarReqConsultaRecaudo</con4:operation>
                  <con4:outboundTransform>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-4577606443375125713-4946857e.151a7391d3d.-7f1a</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistrarReq"/>
                          <con1:param name="autenticacionRequestHeader1">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="string1">
                            <con1:path>$reqUuidBitacora</con1:path>
                          </con1:param>
                          <con1:param name="string2">
                            <con1:path>$reqTimeStamp</con1:path>
                          </con1:param>
                          <con1:param name="pagoRecaudo1">
                            <con1:path>$body/pag:pagoRecaudo</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con4:outboundTransform>
                </con4:route>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con1:id>_ActionId-1763724706617571497--5b3f9580.13d5a582e20.-7f28</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$validationMessage = ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="proxyTrace">
                  <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7d18</con1:id>
                  <con2:expr>
                    <con1:xqueryText>"preConsultaDetContrato"</con1:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:wsCallout>
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-7060</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/contratosConvenios/Resources/ContratosConvenios" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>Consultadetallecontratorecaudo</con2:operation>
                  <con2:request>
                    <con2:body>$REQUESTConsultadetallecontratorecaudo</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RESPONSEConsultadetallecontratorecaudo</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQUESTConsultadetallecontratorecaudo">
                      <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6f9b</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaContratoIn"/>
                          <con1:param name="autenticacionRequestHeader">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="pagoRecaudo">
                            <con1:path>$body/pag:pagoRecaudo</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="type">
                      <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6f63</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($RESPONSEConsultadetallecontratorecaudo/WSCOLLECTIONCONDSType/gWSCOLLECTIONCONDSDetailType/mWSCOLLECTIONCONDSDetailType/INFOEXCHANGETYPE/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                    <con2:assign varName="contractName">
                      <con1:id>_ActionId-831901157828439466-25ca8791.14b6f054456.-7741</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($RESPONSEConsultadetallecontratorecaudo/WSCOLLECTIONCONDSType[1]/gWSCOLLECTIONCONDSDetailType/mWSCOLLECTIONCONDSDetailType[1]/DESCRIPTION/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:responseTransform>
                </con2:wsCallout>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con1:skip>
                <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-7191</con1:id>
              </con1:skip>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="uuid">
            <con1:id>_ActionId-7743566641794520533--1519e6f2.1417fae7e65.-7fc9</con1:id>
            <con2:expr>
              <con1:xqueryTransform>
                <con1:resource ref="Middleware/Business_Resources/general/UUID/obtenerUUID"/>
              </con1:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6fd3</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$type = ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="validationMessage">
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6e4a</con1:id>
                  <con2:expr>
                    <con1:xqueryText>"ERROR LOOKING COLLECTION TYPE"</con1:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con1:skip>
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6e82</con1:id>
                </con1:skip>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$type = "LOCAL"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff9</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$validationMessage = ""</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="proxyTrace">
                        <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7d01</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"preObtieneDatosConsultaLocal"</con1:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con2:wsCallout>
                        <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff4</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/recaudos/Resources/ConsultarRelacionOperacionRecaudo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>consultarRelacionOperacionRecaudo</con2:operation>
                        <con2:request>
                          <con2:body>$REQUESTconsultarRelacionOperacionRecaudo</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSEconsultarRelacionOperacionRecaudo</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUESTconsultarRelacionOperacionRecaudo">
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff8</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaRelacionOperIn"/>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff7</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>fn:string($RESPONSEconsultarRelacionOperacionRecaudo/osb:CODIGO_ERROR/text()) != "SUCCESS"</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:assign varName="validationMessage">
                                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff6</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RESPONSEconsultarRelacionOperacionRecaudo/osb:MENSAJE_ERROR/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                                <con1:skip>
                                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff5</con1:id>
                                </con1:skip>
                              </con2:actions>
                            </con2:case>
                            <con2:default/>
                          </con2:ifThenElse>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con1:skip>
                      <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff3</con1:id>
                    </con1:skip>
                  </con2:default>
                </con2:ifThenElse>
                <con2:assign varName="cantidadFacturas">
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7ff1</con1:id>
                  <con2:expr>
                    <con1:xqueryText>count($RESPONSEconsultarRelacionOperacionRecaudo/osb:CODIGO_FACTURA/osb:ITEM)</con1:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7f5e</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>number($cantidadFacturas) > 1</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="validationMessage">
                        <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7eb4</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"MULTI BILL PAYMENTS FOR LOCAL COLLECTIONS ARE NOT AVAILABLE"</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con1:skip>
                        <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7eb2</con1:id>
                      </con1:skip>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:ifThenElse>
                      <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e11</con1:id>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$validationMessage != ""</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con1:skip>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e10</con1:id>
                          </con1:skip>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "CASH"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0e</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineaefec</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0f</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalEfectivoIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "ACCT_DEBIT"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace varName="proxyTrace">
                            <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7cbb</con1:id>
                            <con2:expr>
                              <con1:xqueryText>"prePagoRecaudoLocalDbCta"</con1:xqueryText>
                            </con2:expr>
                          </con2:replace>
                          <con2:wsCallout>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0c</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineadbcta</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0d</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalDebitoCuentaIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "OWN_CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0a</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqpr</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e0b</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalChequePropioIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "OTHER_BANK_CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e08</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqob</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e09</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalChequeOtroBancoIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "CREDIT_CARD"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="contractPaymentMethods">
                            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-79da</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetallecontratorecaudo/WSCOLLECTIONCONDSType/gWSCOLLECTIONCONDSDetailType/mWSCOLLECTIONCONDSDetailType/PAYMENTMETHOD/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b0b</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>fn:contains($contractPaymentMethods,'CREDIT.CARD')</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:wsCallout>
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b07</con1:id>
                                  <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/obtenerSecuencia/biz/obtenerSecuencia_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                  <con2:operation>obtenerSecuencia</con2:operation>
                                  <con2:request>
                                    <con2:body>$REQRefNumber</con2:body>
                                  </con2:request>
                                  <con2:response>
                                    <con2:body>RSPRefNumber</con2:body>
                                  </con2:response>
                                  <con2:requestTransform>
                                    <con2:assign varName="REQRefNumber">
                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b0a</con1:id>
                                      <con2:expr>
                                        <con1:xqueryTransform>
                                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoObtenerSecuencia"/>
                                          <con1:param name="semilla">
                                            <con1:path>fn:substring(fn-bea:date-to-string-with-format("yyyyMMdd",fn:current-date()),4)</con1:path>
                                          </con1:param>
                                          <con1:param name="tipoSecuencia">
                                            <con1:path>"CC_PURCHASE"</con1:path>
                                          </con1:param>
                                        </con1:xqueryTransform>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:requestTransform>
                                  <con2:responseTransform>
                                    <con2:assign varName="purchaseRefNumber">
                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b09</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>data($RSPRefNumber/ns0:PV_SECUENCIA)</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="secuenciaCodigoError">
                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b08</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>data($RSPRefNumber/ns0:PV_CODIGO_ERROR)</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:responseTransform>
                                </con2:wsCallout>
                                <con2:ifThenElse>
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b06</con1:id>
                                  <con2:case>
                                    <con2:condition>
                                      <con1:xqueryText>$secuenciaCodigoError = 'SUCCESS'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                      <con2:wsCallout>
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b03</con1:id>
                                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con2:operation>registrarConsumo</con2:operation>
                                        <con2:request>
                                          <con2:body>$REQRegistraConsumo</con2:body>
                                        </con2:request>
                                        <con2:response>
                                          <con2:body>RSPRegistraConsumo</con2:body>
                                        </con2:response>
                                        <con2:requestTransform>
                                          <con2:assign varName="REQRegistraConsumo">
                                            <con1:id>_ActionId-6675339917960387799-2b9952c5.14c95f87a0c.-7ee8</con1:id>
                                            <con2:expr>
                                              <con1:xqueryTransform>
                                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistroConsumoTC"/>
                                                <con1:param name="pagoRecaudo1">
                                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                </con1:param>
                                                <con1:param name="purchaseDescription">
                                                  <con1:path>$contractName</con1:path>
                                                </con1:param>
                                                <con1:param name="purchaseRefNumber">
                                                  <con1:path>$purchaseRefNumber</con1:path>
                                                </con1:param>
                                              </con1:xqueryTransform>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:requestTransform>
                                        <con2:responseTransform>
                                          <con2:assign varName="confAlcance">
                                            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b04</con1:id>
                                            <con2:expr>
                                              <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:responseTransform>
                                      </con2:wsCallout>
                                      <con2:replace varName="proxyTrace">
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b02</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>"prePagoRecaudoLineaTC"</con1:xqueryText>
                                        </con2:expr>
                                      </con2:replace>
                                      <con2:ifThenElse>
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b01</con1:id>
                                        <con2:case>
                                          <con2:condition>
                                            <con1:xqueryText>$confAlcance = '00'</con1:xqueryText>
                                          </con2:condition>
                                          <con2:actions>
                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7afd</con5:id>
                                              <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                              <con1:operation>obtenerParametrizacion</con1:operation>
                                              <con1:request>
                                                <con1:body>$REQobtenerParametrizacion</con1:body>
                                              </con1:request>
                                              <con1:response>
                                                <con1:body>RESobtenerParametrizacion</con1:body>
                                              </con1:response>
                                              <con1:requestTransform>
                                                <con1:assign varName="REQobtenerParametrizacion">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7b00</con5:id>
                                                  <con1:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                      <con4:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                                      <con4:param name="nombreParametros">
                                                        <con4:path>"T24T113.HNLDEBITAACCTNO"</con4:path>
                                                      </con4:param>
                                                    </con4:xqueryTransform>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con1:requestTransform>
                                              <con1:responseTransform>
                                                <con1:assign varName="statusParametrizacion">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7aff</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_CODE/text())</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                                <con1:assign varName="debitAccount">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7afe</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:CONFIGURACIONES/osb1:CONFIGURACIONES_ITEM[osb1:NAME="T24T113.HNLDEBITAACCTNO"]/osb1:VALUE/text())</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con1:responseTransform>
                                            </con1:wsCallout>
                                            <con2:ifThenElse>
                                              <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7afc</con1:id>
                                              <con2:case>
                                                <con2:condition>
                                                  <con1:xqueryText>$statusParametrizacion = "SUCCESS"</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                  <con2:wsCallout>
                                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7afa</con1:id>
                                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                    <con2:operation>Pagoderecaudolocalylineadbcta</con2:operation>
                                                    <con2:request>
                                                      <con2:body>$REQUEST</con2:body>
                                                    </con2:request>
                                                    <con2:response>
                                                      <con2:body>RESPONSE</con2:body>
                                                    </con2:response>
                                                    <con2:requestTransform>
                                                      <con2:assign varName="REQUEST">
                                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7afb</con1:id>
                                                        <con2:expr>
                                                          <con1:xqueryTransform>
                                                            <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalTCIn"/>
                                                            <con1:param name="pagoRecaudo1">
                                                              <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                            </con1:param>
                                                            <con1:param name="uuid">
                                                              <con1:path>fn:string($uuid)</con1:path>
                                                            </con1:param>
                                                            <con1:param name="autenticacionRequestHeader1">
                                                              <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                                            </con1:param>
                                                            <con1:param name="outputParameters1">
                                                              <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                                            </con1:param>
                                                            <con1:param name="debitAccount">
                                                              <con1:path>$debitAccount</con1:path>
                                                            </con1:param>
                                                          </con1:xqueryTransform>
                                                        </con2:expr>
                                                      </con2:assign>
                                                    </con2:requestTransform>
                                                    <con2:responseTransform/>
                                                  </con2:wsCallout>
                                                  <con2:ifThenElse>
                                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af9</con1:id>
                                                    <con2:case>
                                                      <con2:condition>
                                                        <con1:xqueryText>fn:upper-case(data($RESPONSE/Status/successIndicator)) != 'SUCCESS'</con1:xqueryText>
                                                      </con2:condition>
                                                      <con2:actions>
                                                        <con2:wsCallout>
                                                          <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af6</con1:id>
                                                          <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                          <con2:operation>reversarConsumo</con2:operation>
                                                          <con2:request>
                                                            <con2:body>$REQReversarConsumo</con2:body>
                                                          </con2:request>
                                                          <con2:response>
                                                            <con2:body>RSPReversarConsumo</con2:body>
                                                          </con2:response>
                                                          <con2:requestTransform>
                                                            <con2:assign varName="REQReversarConsumo">
                                                              <con1:id>_ActionId-6675339917960387799-2b9952c5.14c95f87a0c.-7e5a</con1:id>
                                                              <con2:expr>
                                                                <con1:xqueryTransform>
                                                                  <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReversarConsumoTC"/>
                                                                  <con1:param name="pagoRecaudo1">
                                                                    <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="consumoNORResponse1">
                                                                    <con1:path>$RSPRegistraConsumo</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="purchaseDescription">
                                                                    <con1:path>$contractName</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="purchaseRefNumber">
                                                                    <con1:path>$purchaseRefNumber</con1:path>
                                                                  </con1:param>
                                                                </con1:xqueryTransform>
                                                              </con2:expr>
                                                            </con2:assign>
                                                          </con2:requestTransform>
                                                          <con2:responseTransform>
                                                            <con2:assign varName="statusReversionConsumo">
                                                              <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af7</con1:id>
                                                              <con2:expr>
                                                                <con1:xqueryText>fn:string($RSPReversarConsumo/tns:ReservarNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                                              </con2:expr>
                                                            </con2:assign>
                                                          </con2:responseTransform>
                                                        </con2:wsCallout>
                                                        <con2:ifThenElse>
                                                          <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af5</con1:id>
                                                          <con2:case>
                                                            <con2:condition>
                                                              <con1:xqueryText>$statusReversionConsumo != '00'</con1:xqueryText>
                                                            </con2:condition>
                                                            <con2:actions>
                                                              <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af4</con5:id>
                                                                <con1:expr>
                                                                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"UNHANDLED PAYMENT FAILURE"</con5:xqueryText>
                                                                </con1:expr>
                                                              </con1:assign>
                                                            </con2:actions>
                                                          </con2:case>
                                                          <con2:default/>
                                                        </con2:ifThenElse>
                                                      </con2:actions>
                                                    </con2:case>
                                                    <con2:default/>
                                                  </con2:ifThenElse>
                                                </con2:actions>
                                              </con2:case>
                                              <con2:default>
                                                <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af3</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_MESSAGE/text())</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con2:default>
                                            </con2:ifThenElse>
                                          </con2:actions>
                                        </con2:case>
                                        <con2:default>
                                          <con2:assign varName="validationMessage">
                                            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af2</con1:id>
                                            <con2:expr>
                                              <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:mensajeConfirmacion/text())</con1:xqueryText>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:default>
                                      </con2:ifThenElse>
                                      <con2:replace varName="proxyTrace">
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af1</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>"postPagoRecaudoLineaTC"</con1:xqueryText>
                                        </con2:expr>
                                      </con2:replace>
                                    </con2:actions>
                                  </con2:case>
                                  <con2:default>
                                    <con2:assign varName="validationMessage">
                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7af0</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>"FAILED TO GET SEQUENCE"</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:default>
                                </con2:ifThenElse>
                              </con2:actions>
                            </con2:case>
                            <con2:default>
                              <con2:assign varName="validationMessage">
                                <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7aef</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>"PAYMENT  METHOD NOT VALID FOR THIS CONTRACT"</con1:xqueryText>
                                </con2:expr>
                              </con2:assign>
                            </con2:default>
                          </con2:ifThenElse>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "INTL_CHQ_US"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e05</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqin</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-980345589747037196-2ea789d1.13ef1caf3d5.-7f76</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoLocalChequeInternacionalUSIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "INTL_CHQ_NON_US"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="validationMessage">
                            <con1:id>_ActionId-3698187567794039811--7b0bb3d8.13ef11cc473.-7e04</con1:id>
                            <con2:expr>
                              <con1:xqueryText>"NOT YET IMPLEMENTED"</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:actions>
                      </con2:case>
                    </con2:ifThenElse>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$type = "ONLINE"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="isExtended">
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fef</con1:id>
                  <con2:expr>
                    <con1:xqueryText>fn:string($body/pag:pagoRecaudo/EXTENDED_COLLECTION_YES_NO/text())</con1:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe6</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$isExtended = "YES"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="proxyTrace">
                        <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7c6a</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"preRegOperNoEstandar"</con1:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con2:wsCallout>
                        <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe0</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/recaudos/Resources/RegistrarOperacionConvenioNoEstandar_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>registrarOperacionConvenioNoEstandar</con2:operation>
                        <con2:request>
                          <con2:body>$REQUESTregistrarOperacionConvenioNoEstandar</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSEregistrarOperacionConvenioNoEstandar</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUESTregistrarOperacionConvenioNoEstandar">
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe5</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistrarOperConvenioNoEstandarIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="tipoOperacion">
                                  <con1:path>"2"</con1:path>
                                </con1:param>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:assign varName="successIndicatorRegistrarOperacionConvenioNoEstandar">
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe4</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEregistrarOperacionConvenioNoEstandar/int:ERROR_CODE/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe3</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>upper-case($successIndicatorRegistrarOperacionConvenioNoEstandar) != "SUCCESS"</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:assign varName="validationMessage">
                                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe2</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RESPONSEregistrarOperacionConvenioNoEstandar/int:ERROR_MESSAGE/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:actions>
                            </con2:case>
                            <con2:default>
                              <con2:assign varName="idSolicitud">
                                <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fe1</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>fn:string($RESPONSEregistrarOperacionConvenioNoEstandar/int:ID_SOLICITUD/text())</con1:xqueryText>
                                </con2:expr>
                              </con2:assign>
                            </con2:default>
                          </con2:ifThenElse>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:assign varName="idSolicitud">
                      <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fdf</con1:id>
                      <con2:expr>
                        <con1:xqueryText>fn:string($body/pag:pagoRecaudo/DEBTOR_CODE/text())</con1:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:default>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc6</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$validationMessage = ""</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="proxyTrace">
                        <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7c43</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"preObtieneDatosConsultaLinea"</con1:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con2:wsCallout>
                        <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc0</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/recaudos/Resources/ConsultarRelacionOperacionRecaudo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>consultarRelacionOperacionRecaudo</con2:operation>
                        <con2:request>
                          <con2:body>$REQUESTconsultarRelacionOperacionRecaudo</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSEconsultarRelacionOperacionRecaudo</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUESTconsultarRelacionOperacionRecaudo">
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc5</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaRelacionOperIn"/>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc4</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>fn:string($RESPONSEconsultarRelacionOperacionRecaudo/osb:CODIGO_ERROR/text()) != "SUCCESS"</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:assign varName="validationMessage">
                                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc3</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>fn:string($RESPONSEconsultarRelacionOperacionRecaudo/osb:MENSAJE_ERROR/text())</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                                <con1:skip>
                                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc2</con1:id>
                                </con1:skip>
                              </con2:actions>
                            </con2:case>
                            <con2:default>
                              <con2:replace varName="body" contents-only="true">
                                <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fc1</con1:id>
                                <con2:location>
                                  <con1:xpathText>./pag:pagoRecaudo/DEBTOR_CODE</con1:xpathText>
                                </con2:location>
                                <con2:expr>
                                  <con1:xqueryText>$idSolicitud</con1:xqueryText>
                                </con2:expr>
                              </con2:replace>
                            </con2:default>
                          </con2:ifThenElse>
                        </con2:responseTransform>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con1:skip>
                      <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fbf</con1:id>
                    </con1:skip>
                  </con2:default>
                </con2:ifThenElse>
                <con2:assign varName="cantidadFacturas">
                  <con1:id>_ActionId-6811749523141939784-70e32f54.14016cef78e.-7fbd</con1:id>
                  <con2:expr>
                    <con1:xqueryText>count($RESPONSEconsultarRelacionOperacionRecaudo/osb:CODIGO_FACTURA/osb:ITEM)</con1:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7f22</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>number($cantidadFacturas) > 1</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="validationMessage">
                        <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7ee4</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"MULTI BILL PAYMENTS FOR ONLINE COLLECTIONS ARE NOT AVAILABLE"</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con1:skip>
                        <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7ee2</con1:id>
                      </con1:skip>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:ifThenElse>
                      <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e7d</con1:id>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$validationMessage != ""</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con1:skip>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e7c</con1:id>
                          </con1:skip>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "CASH"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e7a</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineaefec</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e7b</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaEfectivoIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "ACCT_DEBIT"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:replace varName="proxyTrace">
                            <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7c24</con1:id>
                            <con2:expr>
                              <con1:xqueryText>"prePagoRecaudoLineaDbCta"</con1:xqueryText>
                            </con2:expr>
                          </con2:replace>
                          <con2:wsCallout>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e78</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineadbcta</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e79</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaDebitoCuentaIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "OWN_CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e76</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqpr</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e77</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaChequePropioIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "OTHER_BANK_CHEQUE"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e74</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqob</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e75</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaChequeOtroBancoIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "CREDIT_CARD"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="contractPaymentMethods">
                            <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7640</con1:id>
                            <con2:expr>
                              <con1:xqueryText>fn:string($RESPONSEConsultadetallecontratorecaudo/WSCOLLECTIONCONDSType/gWSCOLLECTIONCONDSDetailType/mWSCOLLECTIONCONDSDetailType/PAYMENTMETHOD/text())</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:ifThenElse>
                            <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7623</con1:id>
                            <con2:case>
                              <con2:condition>
                                <con1:xqueryText>fn:contains($contractPaymentMethods,'CREDIT.CARD')</con1:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con2:wsCallout>
                                  <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-761b</con1:id>
                                  <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/obtenerSecuencia/biz/obtenerSecuencia_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                  <con2:operation>obtenerSecuencia</con2:operation>
                                  <con2:request>
                                    <con2:body>$REQRefNumber</con2:body>
                                  </con2:request>
                                  <con2:response>
                                    <con2:body>RSPRefNumber</con2:body>
                                  </con2:response>
                                  <con2:requestTransform>
                                    <con2:assign varName="REQRefNumber">
                                      <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-761e</con1:id>
                                      <con2:expr>
                                        <con1:xqueryTransform>
                                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoObtenerSecuencia"/>
                                          <con1:param name="semilla">
                                            <con1:path>fn:substring(fn-bea:date-to-string-with-format("yyyyMMdd",fn:current-date()),4)</con1:path>
                                          </con1:param>
                                          <con1:param name="tipoSecuencia">
                                            <con1:path>"CC_PURCHASE"</con1:path>
                                          </con1:param>
                                        </con1:xqueryTransform>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:requestTransform>
                                  <con2:responseTransform>
                                    <con2:assign varName="purchaseRefNumber">
                                      <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-761d</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>data($RSPRefNumber/ns0:PV_SECUENCIA)</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                    <con2:assign varName="secuenciaCodigoError">
                                      <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-761c</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>data($RSPRefNumber/ns0:PV_CODIGO_ERROR)</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:responseTransform>
                                </con2:wsCallout>
                                <con2:ifThenElse>
                                  <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7607</con1:id>
                                  <con2:case>
                                    <con2:condition>
                                      <con1:xqueryText>$secuenciaCodigoError = 'SUCCESS'</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                      <con2:wsCallout>
                                        <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7604</con1:id>
                                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                        <con2:operation>registrarConsumo</con2:operation>
                                        <con2:request>
                                          <con2:body>$REQRegistraConsumo</con2:body>
                                        </con2:request>
                                        <con2:response>
                                          <con2:body>RSPRegistraConsumo</con2:body>
                                        </con2:response>
                                        <con2:requestTransform>
                                          <con2:assign varName="REQRegistraConsumo">
                                            <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7606</con1:id>
                                            <con2:expr>
                                              <con1:xqueryTransform>
                                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistroConsumoTC"/>
                                                <con1:param name="pagoRecaudo1">
                                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                </con1:param>
                                                <con1:param name="purchaseDescription">
                                                  <con1:path>$contractName</con1:path>
                                                </con1:param>
                                                <con1:param name="purchaseRefNumber">
                                                  <con1:path>$purchaseRefNumber</con1:path>
                                                </con1:param>
                                              </con1:xqueryTransform>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:requestTransform>
                                        <con2:responseTransform>
                                          <con2:assign varName="confAlcance">
                                            <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7605</con1:id>
                                            <con2:expr>
                                              <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:responseTransform>
                                      </con2:wsCallout>
                                      <con2:replace varName="proxyTrace">
                                        <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7603</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>"prePagoRecaudoLineaTC"</con1:xqueryText>
                                        </con2:expr>
                                      </con2:replace>
                                      <con2:ifThenElse>
                                        <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7602</con1:id>
                                        <con2:case>
                                          <con2:condition>
                                            <con1:xqueryText>$confAlcance = '00'</con1:xqueryText>
                                          </con2:condition>
                                          <con2:actions>
                                            <con2:assign varName="debitAcctParamHNL">
                                              <con1:id>_ActionId-6733809439120765363-2c43948f.150b991131c.-7fec</con1:id>
                                              <con2:expr>
                                                <con1:xqueryText>"T24T113.HNLDEBITAACCTNO"</con1:xqueryText>
                                              </con2:expr>
                                            </con2:assign>
                                            <con2:assign varName="debitAcctParamUSD">
                                              <con1:id>_ActionId-6733809439120765363-2c43948f.150b991131c.-7fcc</con1:id>
                                              <con2:expr>
                                                <con1:xqueryText>"T24T113.USDDEBITACCTNO"</con1:xqueryText>
                                              </con2:expr>
                                            </con2:assign>
                                            <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75fe</con5:id>
                                              <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                              <con1:operation>obtenerParametrizacion</con1:operation>
                                              <con1:request>
                                                <con1:body>$REQobtenerParametrizacion</con1:body>
                                              </con1:request>
                                              <con1:response>
                                                <con1:body>RESobtenerParametrizacion</con1:body>
                                              </con1:response>
                                              <con1:requestTransform>
                                                <con1:assign varName="REQobtenerParametrizacion">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7601</con5:id>
                                                  <con1:expr>
                                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                      <con4:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                                      <con4:param name="nombreParametros">
                                                        <con4:path>fn:concat($debitAcctParamHNL,"||",$debitAcctParamUSD)</con4:path>
                                                      </con4:param>
                                                    </con4:xqueryTransform>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con1:requestTransform>
                                              <con1:responseTransform>
                                                <con1:assign varName="statusParametrizacion">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7600</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_CODE/text())</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                                <con1:assign varName="debitAccount">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75ff</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">if ( fn:string($body/pag:pagoRecaudo/PAYMENT_INFORMATION/PAYMENT_CURRENCY/text()) = "HNL") then (
	fn:string($RESobtenerParametrizacion/osb1:CONFIGURACIONES/osb1:CONFIGURACIONES_ITEM[osb1:NAME=$debitAcctParamHNL]/osb1:VALUE/text())
) else (
	fn:string($RESobtenerParametrizacion/osb1:CONFIGURACIONES/osb1:CONFIGURACIONES_ITEM[osb1:NAME=$debitAcctParamUSD]/osb1:VALUE/text())
)</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con1:responseTransform>
                                            </con1:wsCallout>
                                            <con2:ifThenElse>
                                              <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75fd</con1:id>
                                              <con2:case>
                                                <con2:condition>
                                                  <con1:xqueryText>$statusParametrizacion = "SUCCESS"</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                  <con2:wsCallout>
                                                    <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75fb</con1:id>
                                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                    <con2:operation>Pagoderecaudolocalylineatc</con2:operation>
                                                    <con2:request>
                                                      <con2:body>$REQUEST</con2:body>
                                                    </con2:request>
                                                    <con2:response>
                                                      <con2:body>RESPONSE</con2:body>
                                                    </con2:response>
                                                    <con2:requestTransform>
                                                      <con2:assign varName="REQUEST">
                                                        <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75fc</con1:id>
                                                        <con2:expr>
                                                          <con1:xqueryTransform>
                                                            <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaTCIn"/>
                                                            <con1:param name="pagoRecaudo1">
                                                              <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                            </con1:param>
                                                            <con1:param name="uuid">
                                                              <con1:path>fn:string($uuid)</con1:path>
                                                            </con1:param>
                                                            <con1:param name="autenticacionRequestHeader1">
                                                              <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                                            </con1:param>
                                                            <con1:param name="debitAccount">
                                                              <con1:path>$debitAccount</con1:path>
                                                            </con1:param>
                                                            <con1:param name="outputParameters1">
                                                              <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                                            </con1:param>
                                                          </con1:xqueryTransform>
                                                        </con2:expr>
                                                      </con2:assign>
                                                    </con2:requestTransform>
                                                    <con2:responseTransform/>
                                                  </con2:wsCallout>
                                                  <con2:ifThenElse>
                                                    <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75fa</con1:id>
                                                    <con2:case>
                                                      <con2:condition>
                                                        <con1:xqueryText>fn:upper-case(data($RESPONSE/Status/successIndicator)) != 'SUCCESS'</con1:xqueryText>
                                                      </con2:condition>
                                                      <con2:actions>
                                                        <con2:wsCallout>
                                                          <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75f9</con1:id>
                                                          <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                          <con2:operation>reversarConsumo</con2:operation>
                                                          <con2:request>
                                                            <con2:body>$REQReversarConsumo</con2:body>
                                                          </con2:request>
                                                          <con2:response>
                                                            <con2:body>RSPReversarConsumo</con2:body>
                                                          </con2:response>
                                                          <con2:requestTransform>
                                                            <con2:assign varName="REQReversarConsumo">
                                                              <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-7569</con1:id>
                                                              <con2:expr>
                                                                <con1:xqueryTransform>
                                                                  <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReversarConsumoTC"/>
                                                                  <con1:param name="pagoRecaudo1">
                                                                    <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="consumoNORResponse1">
                                                                    <con1:path>$RSPRegistraConsumo</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="purchaseDescription">
                                                                    <con1:path>$contractName</con1:path>
                                                                  </con1:param>
                                                                  <con1:param name="purchaseRefNumber">
                                                                    <con1:path>$purchaseRefNumber</con1:path>
                                                                  </con1:param>
                                                                </con1:xqueryTransform>
                                                              </con2:expr>
                                                            </con2:assign>
                                                          </con2:requestTransform>
                                                          <con2:responseTransform>
                                                            <con2:assign varName="statusReversionConsumo">
                                                              <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7f20</con1:id>
                                                              <con2:expr>
                                                                <con1:xqueryText>fn:string($RSPReversarConsumo/tns:ReservarNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                                              </con2:expr>
                                                            </con2:assign>
                                                          </con2:responseTransform>
                                                        </con2:wsCallout>
                                                        <con2:ifThenElse>
                                                          <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7f91</con1:id>
                                                          <con2:case>
                                                            <con2:condition>
                                                              <con1:xqueryText>$statusReversionConsumo != '00'</con1:xqueryText>
                                                            </con2:condition>
                                                            <con2:actions>
                                                              <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7e42</con5:id>
                                                                <con1:expr>
                                                                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"UNHANDLED PAYMENT FAILURE"</con5:xqueryText>
                                                                </con1:expr>
                                                              </con1:assign>
                                                            </con2:actions>
                                                          </con2:case>
                                                          <con2:default/>
                                                        </con2:ifThenElse>
                                                      </con2:actions>
                                                    </con2:case>
                                                    <con2:default/>
                                                  </con2:ifThenElse>
                                                </con2:actions>
                                              </con2:case>
                                              <con2:default>
                                                <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75f8</con5:id>
                                                  <con1:expr>
                                                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_MESSAGE/text())</con5:xqueryText>
                                                  </con1:expr>
                                                </con1:assign>
                                              </con2:default>
                                            </con2:ifThenElse>
                                          </con2:actions>
                                        </con2:case>
                                        <con2:default>
                                          <con2:assign varName="validationMessage">
                                            <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75f7</con1:id>
                                            <con2:expr>
                                              <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:mensajeConfirmacion/text())</con1:xqueryText>
                                            </con2:expr>
                                          </con2:assign>
                                        </con2:default>
                                      </con2:ifThenElse>
                                      <con2:replace varName="proxyTrace">
                                        <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75f6</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>"postPagoRecaudoLineaTC"</con1:xqueryText>
                                        </con2:expr>
                                      </con2:replace>
                                    </con2:actions>
                                  </con2:case>
                                  <con2:default>
                                    <con2:assign varName="validationMessage">
                                      <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75f5</con1:id>
                                      <con2:expr>
                                        <con1:xqueryText>"FAILED TO GET SEQUENCE"</con1:xqueryText>
                                      </con2:expr>
                                    </con2:assign>
                                  </con2:default>
                                </con2:ifThenElse>
                              </con2:actions>
                            </con2:case>
                            <con2:default>
                              <con2:assign varName="validationMessage">
                                <con1:id>_ActionId-6233195231258431895--4bfcc139.14b9e58448a.-75a1</con1:id>
                                <con2:expr>
                                  <con1:xqueryText>"PAYMENT  METHOD NOT VALID FOR THIS CONTRACT"</con1:xqueryText>
                                </con2:expr>
                              </con2:assign>
                            </con2:default>
                          </con2:ifThenElse>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "INTL_CHQ_US"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:wsCallout>
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e71</con1:id>
                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                            <con2:operation>Pagoderecaudolocalylineachqin</con2:operation>
                            <con2:request>
                              <con2:body>$REQUEST</con2:body>
                            </con2:request>
                            <con2:response>
                              <con2:body>RESPONSE</con2:body>
                            </con2:response>
                            <con2:requestTransform>
                              <con2:assign varName="REQUEST">
                                <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e72</con1:id>
                                <con2:expr>
                                  <con1:xqueryTransform>
                                    <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoEnLineaChequeInternacionalUSIn"/>
                                    <con1:param name="autenticacionRequestHeader">
                                      <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                    </con1:param>
                                    <con1:param name="pagoRecaudo">
                                      <con1:path>$body/pag:pagoRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="outputParameters">
                                      <con1:path>$RESPONSEconsultarRelacionOperacionRecaudo</con1:path>
                                    </con1:param>
                                    <con1:param name="uuid">
                                      <con1:path>fn:string($uuid)</con1:path>
                                    </con1:param>
                                  </con1:xqueryTransform>
                                </con2:expr>
                              </con2:assign>
                            </con2:requestTransform>
                            <con2:responseTransform/>
                          </con2:wsCallout>
                        </con2:actions>
                      </con2:case>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>$paymentMethod = "INTL_CHQ_NON_US"</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="validationMessage">
                            <con1:id>_ActionId-8243934656246586943-73377284.13f80ce05be.-7e70</con1:id>
                            <con2:expr>
                              <con1:xqueryText>"NOT YET IMPLEMENTED"</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:actions>
                      </con2:case>
                    </con2:ifThenElse>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$type = "REFERENCED"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-69d2</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "CASH"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6993</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>Pagoderecaudoreferenciadoefec</con2:operation>
                        <con2:request>
                          <con2:body>$REQUEST</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSE</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUEST">
                            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-695b</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReferenciadoEfectivoIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                                <con1:param name="uuid">
                                  <con1:path>fn:string($uuid)</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "ACCT_DEBIT"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="proxyTrace">
                        <con1:id>_ActionId-8445316673925629495--4c6113cd.145ae9e8b19.-7bfd</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"prePagoRecaudoRefDbCta"</con1:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con2:wsCallout>
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-68b7</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>Pagoderecaudoreferenciadodbcta</con2:operation>
                        <con2:request>
                          <con2:body>$REQUEST</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSE</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUEST">
                            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-680f</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReferenciadoDebitoCuentaIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                                <con1:param name="uuid">
                                  <con1:path>fn:string($uuid)</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "OWN_CHEQUE"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-687f</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>Pagorecaudoreferenciadoficochq</con2:operation>
                        <con2:request>
                          <con2:body>$REQUEST</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSE</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUEST">
                            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-67d7</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReferenciadoChequePropioIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                                <con1:param name="uuid">
                                  <con1:path>fn:string($uuid)</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "OTHER_BANK_CHEQUE"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:wsCallout>
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6847</con1:id>
                        <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>Pagorecaudoreferenciadochqotrbco</con2:operation>
                        <con2:request>
                          <con2:body>$REQUEST</con2:body>
                        </con2:request>
                        <con2:response>
                          <con2:body>RESPONSE</con2:body>
                        </con2:response>
                        <con2:requestTransform>
                          <con2:assign varName="REQUEST">
                            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-679f</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReferenciadoChequeOtroBancoIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="pagoRecaudo">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                                <con1:param name="uuid">
                                  <con1:path>fn:string($uuid)</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform/>
                      </con2:wsCallout>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "CREDIT_CARD"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="contractPaymentMethods">
                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-78e1</con1:id>
                        <con2:expr>
                          <con1:xqueryText>fn:string($RESPONSEConsultadetallecontratorecaudo/WSCOLLECTIONCONDSType/gWSCOLLECTIONCONDSDetailType/mWSCOLLECTIONCONDSDetailType/PAYMENTMETHOD/text())</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con2:ifThenElse>
                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7800</con1:id>
                        <con2:case>
                          <con2:condition>
                            <con1:xqueryText>fn:contains($contractPaymentMethods,'CREDIT.CARD')</con1:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:wsCallout>
                              <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77fc</con1:id>
                              <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/obtenerSecuencia/biz/obtenerSecuencia_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:operation>obtenerSecuencia</con2:operation>
                              <con2:request>
                                <con2:body>$REQRefNumber</con2:body>
                              </con2:request>
                              <con2:response>
                                <con2:body>RSPRefNumber</con2:body>
                              </con2:response>
                              <con2:requestTransform>
                                <con2:assign varName="REQRefNumber">
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77ff</con1:id>
                                  <con2:expr>
                                    <con1:xqueryTransform>
                                      <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoObtenerSecuencia"/>
                                      <con1:param name="semilla">
                                        <con1:path>fn:substring(fn-bea:date-to-string-with-format("yyyyMMdd",fn:current-date()),4)</con1:path>
                                      </con1:param>
                                      <con1:param name="tipoSecuencia">
                                        <con1:path>"CC_PURCHASE"</con1:path>
                                      </con1:param>
                                    </con1:xqueryTransform>
                                  </con2:expr>
                                </con2:assign>
                              </con2:requestTransform>
                              <con2:responseTransform>
                                <con2:assign varName="purchaseRefNumber">
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77fe</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>data($RSPRefNumber/ns0:PV_SECUENCIA)</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                                <con2:assign varName="secuenciaCodigoError">
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77fd</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>data($RSPRefNumber/ns0:PV_CODIGO_ERROR)</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:responseTransform>
                            </con2:wsCallout>
                            <con2:ifThenElse>
                              <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77fb</con1:id>
                              <con2:case>
                                <con2:condition>
                                  <con1:xqueryText>$secuenciaCodigoError = 'SUCCESS'</con1:xqueryText>
                                </con2:condition>
                                <con2:actions>
                                  <con2:wsCallout>
                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f8</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>registrarConsumo</con2:operation>
                                    <con2:request>
                                      <con2:body>$REQRegistraConsumo</con2:body>
                                    </con2:request>
                                    <con2:response>
                                      <con2:body>RSPRegistraConsumo</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                      <con2:assign varName="REQRegistraConsumo">
                                        <con1:id>_ActionId-6675339917960387799-2b9952c5.14c95f87a0c.-7eb0</con1:id>
                                        <con2:expr>
                                          <con1:xqueryTransform>
                                            <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistroConsumoTC"/>
                                            <con1:param name="pagoRecaudo1">
                                              <con1:path>$body/pag:pagoRecaudo</con1:path>
                                            </con1:param>
                                            <con1:param name="purchaseDescription">
                                              <con1:path>$contractName</con1:path>
                                            </con1:param>
                                            <con1:param name="purchaseRefNumber">
                                              <con1:path>$purchaseRefNumber</con1:path>
                                            </con1:param>
                                          </con1:xqueryTransform>
                                        </con2:expr>
                                      </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                      <con2:assign varName="confAlcance">
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f9</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                        </con2:expr>
                                      </con2:assign>
                                    </con2:responseTransform>
                                  </con2:wsCallout>
                                  <con2:replace varName="proxyTrace">
                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f7</con1:id>
                                    <con2:expr>
                                      <con1:xqueryText>"prePagoRecaudoLineaTC"</con1:xqueryText>
                                    </con2:expr>
                                  </con2:replace>
                                  <con2:ifThenElse>
                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f6</con1:id>
                                    <con2:case>
                                      <con2:condition>
                                        <con1:xqueryText>$confAlcance = '00'</con1:xqueryText>
                                      </con2:condition>
                                      <con2:actions>
                                        <con1:wsCallout xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                          <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f2</con5:id>
                                          <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                          <con1:operation>obtenerParametrizacion</con1:operation>
                                          <con1:request>
                                            <con1:body>$REQobtenerParametrizacion</con1:body>
                                          </con1:request>
                                          <con1:response>
                                            <con1:body>RESobtenerParametrizacion</con1:body>
                                          </con1:response>
                                          <con1:requestTransform>
                                            <con1:assign varName="REQobtenerParametrizacion">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f5</con5:id>
                                              <con1:expr>
                                                <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                  <con4:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                                  <con4:param name="nombreParametros">
                                                    <con4:path>"T24T113.HNLDEBITAACCTNO"</con4:path>
                                                  </con4:param>
                                                </con4:xqueryTransform>
                                              </con1:expr>
                                            </con1:assign>
                                          </con1:requestTransform>
                                          <con1:responseTransform>
                                            <con1:assign varName="statusParametrizacion">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f4</con5:id>
                                              <con1:expr>
                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_CODE/text())</con5:xqueryText>
                                              </con1:expr>
                                            </con1:assign>
                                            <con1:assign varName="debitAccount">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f3</con5:id>
                                              <con1:expr>
                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:CONFIGURACIONES/osb1:CONFIGURACIONES_ITEM[osb1:NAME="T24T113.HNLDEBITAACCTNO"]/osb1:VALUE/text())</con5:xqueryText>
                                              </con1:expr>
                                            </con1:assign>
                                          </con1:responseTransform>
                                        </con1:wsCallout>
                                        <con2:ifThenElse>
                                          <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f1</con1:id>
                                          <con2:case>
                                            <con2:condition>
                                              <con1:xqueryText>$statusParametrizacion = "SUCCESS"</con1:xqueryText>
                                            </con2:condition>
                                            <con2:actions>
                                              <con2:wsCallout>
                                                <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77ef</con1:id>
                                                <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/pagoRecaudos/Resources/PagoRecaudos" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con2:operation>Pagoderecaudoreferenciadodbcta</con2:operation>
                                                <con2:request>
                                                  <con2:body>$REQUEST</con2:body>
                                                </con2:request>
                                                <con2:response>
                                                  <con2:body>RESPONSE</con2:body>
                                                </con2:response>
                                                <con2:requestTransform>
                                                  <con2:assign varName="REQUEST">
                                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77f0</con1:id>
                                                    <con2:expr>
                                                      <con1:xqueryTransform>
                                                        <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReferenciadoTCIn"/>
                                                        <con1:param name="autenticacionRequestHeader">
                                                          <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                                        </con1:param>
                                                        <con1:param name="pagoRecaudo">
                                                          <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                        </con1:param>
                                                        <con1:param name="uuid">
                                                          <con1:path>fn:string($uuid)</con1:path>
                                                        </con1:param>
                                                        <con1:param name="debitAccount">
                                                          <con1:path>$debitAccount</con1:path>
                                                        </con1:param>
                                                      </con1:xqueryTransform>
                                                    </con2:expr>
                                                  </con2:assign>
                                                </con2:requestTransform>
                                                <con2:responseTransform/>
                                              </con2:wsCallout>
                                              <con2:ifThenElse>
                                                <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77ee</con1:id>
                                                <con2:case>
                                                  <con2:condition>
                                                    <con1:xqueryText>fn:upper-case(data($RESPONSE/Status/successIndicator)) != 'SUCCESS'</con1:xqueryText>
                                                  </con2:condition>
                                                  <con2:actions>
                                                    <con2:wsCallout>
                                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77eb</con1:id>
                                                      <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                      <con2:operation>reversarConsumo</con2:operation>
                                                      <con2:request>
                                                        <con2:body>$REQReversarConsumo</con2:body>
                                                      </con2:request>
                                                      <con2:response>
                                                        <con2:body>RSPReversarConsumo</con2:body>
                                                      </con2:response>
                                                      <con2:requestTransform>
                                                        <con2:assign varName="REQReversarConsumo">
                                                          <con1:id>_ActionId-6675339917960387799-2b9952c5.14c95f87a0c.-7e22</con1:id>
                                                          <con2:expr>
                                                            <con1:xqueryTransform>
                                                              <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReversarConsumoTC"/>
                                                              <con1:param name="pagoRecaudo1">
                                                                <con1:path>$body/pag:pagoRecaudo</con1:path>
                                                              </con1:param>
                                                              <con1:param name="consumoNORResponse1">
                                                                <con1:path>$RSPRegistraConsumo</con1:path>
                                                              </con1:param>
                                                              <con1:param name="purchaseDescription">
                                                                <con1:path>$contractName</con1:path>
                                                              </con1:param>
                                                              <con1:param name="purchaseRefNumber">
                                                                <con1:path>$purchaseRefNumber</con1:path>
                                                              </con1:param>
                                                            </con1:xqueryTransform>
                                                          </con2:expr>
                                                        </con2:assign>
                                                      </con2:requestTransform>
                                                      <con2:responseTransform>
                                                        <con2:assign varName="statusReversionConsumo">
                                                          <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77ec</con1:id>
                                                          <con2:expr>
                                                            <con1:xqueryText>fn:string($RSPReversarConsumo/tns:ReservarNORResult/tns:estatusConfirmacion/text())</con1:xqueryText>
                                                          </con2:expr>
                                                        </con2:assign>
                                                      </con2:responseTransform>
                                                    </con2:wsCallout>
                                                    <con2:ifThenElse>
                                                      <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77ea</con1:id>
                                                      <con2:case>
                                                        <con2:condition>
                                                          <con1:xqueryText>$statusReversionConsumo != '00'</con1:xqueryText>
                                                        </con2:condition>
                                                        <con2:actions>
                                                          <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e9</con5:id>
                                                            <con1:expr>
                                                              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"UNHANDLED PAYMENT FAILURE"</con5:xqueryText>
                                                            </con1:expr>
                                                          </con1:assign>
                                                        </con2:actions>
                                                      </con2:case>
                                                      <con2:default/>
                                                    </con2:ifThenElse>
                                                  </con2:actions>
                                                </con2:case>
                                                <con2:default/>
                                              </con2:ifThenElse>
                                            </con2:actions>
                                          </con2:case>
                                          <con2:default>
                                            <con1:assign varName="validationMessage" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e8</con5:id>
                                              <con1:expr>
                                                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($RESobtenerParametrizacion/osb1:ERROR_MESSAGE/text())</con5:xqueryText>
                                              </con1:expr>
                                            </con1:assign>
                                          </con2:default>
                                        </con2:ifThenElse>
                                      </con2:actions>
                                    </con2:case>
                                    <con2:default>
                                      <con2:assign varName="validationMessage">
                                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e7</con1:id>
                                        <con2:expr>
                                          <con1:xqueryText>fn:string($RSPRegistraConsumo/tns:ConsumoNORResult/tns:mensajeConfirmacion/text())</con1:xqueryText>
                                        </con2:expr>
                                      </con2:assign>
                                    </con2:default>
                                  </con2:ifThenElse>
                                  <con2:replace varName="proxyTrace">
                                    <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e6</con1:id>
                                    <con2:expr>
                                      <con1:xqueryText>"postPagoRecaudoLineaTC"</con1:xqueryText>
                                    </con2:expr>
                                  </con2:replace>
                                </con2:actions>
                              </con2:case>
                              <con2:default>
                                <con2:assign varName="validationMessage">
                                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e5</con1:id>
                                  <con2:expr>
                                    <con1:xqueryText>"FAILED TO GET SEQUENCE"</con1:xqueryText>
                                  </con2:expr>
                                </con2:assign>
                              </con2:default>
                            </con2:ifThenElse>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con2:assign varName="validationMessage">
                            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-77e4</con1:id>
                            <con2:expr>
                              <con1:xqueryText>"PAYMENT  METHOD NOT VALID FOR THIS CONTRACT"</con1:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:default>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "INTL_CHQ_US"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="validationMessage">
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-69cc</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"NOT YET IMPLEMENTED"</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con1:skip>
                        <con1:id>_ActionId-5287575374379343148-58b168e1.13e8b93a7f1.-7fe4</con1:id>
                      </con1:skip>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$paymentMethod = "INTL_CHQ_NON_US"</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="validationMessage">
                        <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-69cb</con1:id>
                        <con2:expr>
                          <con1:xqueryText>"NOT YET IMPLEMENTED"</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con1:skip>
                        <con1:id>_ActionId-4820195311093095523--4489cdf9.13e32416c5e.-7f02</con1:id>
                      </con1:skip>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con1:id>_ActionId-7438187448497954357-3c1c20a8.14bff768350.-7fac</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$validationMessage = ""</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="validationMessage">
                        <con1:id>_ActionId-7438187448497954357-3c1c20a8.14bff768350.-7faa</con1:id>
                        <con2:expr>
                          <con1:xqueryText>fn:string-join($RESPONSE/Status/messages/text(),'')</con1:xqueryText>
                        </con2:expr>
                      </con2:assign>
                    </con2:actions>
                  </con2:case>
                  <con2:default/>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con1:skip>
                <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-6ef1</con1:id>
              </con1:skip>
            </con2:default>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PipelinePairNode1_response">
      <con:stage name="consultaUsuario" errorHandler="_onErrorHandler-2493995588525419875--30cd2246.1515ea270a3.-79df">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79fa</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>fn:string($RESPONSE/Status/successIndicator/text()) = "Success" and
$validationMessage = ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="proxyTrace">
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79f4</con1:id>
                  <con2:expr>
                    <con1:xqueryText>"preConsultaUsuario"</con1:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:wsCallout>
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79e0</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/Core/Resources/CoreBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>Consultadeusuariosdelsistema</con2:operation>
                  <con2:request>
                    <con2:body>$REQUESTConsultadeusuariosdelsistema</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RESPONSEConsultadeusuariosdelsistema</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:ifThenElse>
                      <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79e4</con1:id>
                      <con2:case>
                        <con2:condition>
                          <con1:xqueryText>count($RESPONSE/TELLERType) > 0</con1:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="REQUESTConsultadeusuariosdelsistema">
                            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79e3</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaUsuarioTellerIn"/>
                                <con1:param name="autenticacionRequestHeader">
                                  <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                                </con1:param>
                                <con1:param name="tELLERType">
                                  <con1:path>$RESPONSE/TELLERType</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:assign>
                        </con2:actions>
                      </con2:case>
                      <con2:default>
                        <con2:assign varName="REQUESTConsultadeusuariosdelsistema">
                          <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79e2</con1:id>
                          <con2:expr>
                            <con1:xqueryTransform>
                              <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaUsuarioTransferIn"/>
                              <con1:param name="autenticacionRequestHeader">
                                <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                              </con1:param>
                              <con1:param name="fUNDSTRANSFERType">
                                <con1:path>$RESPONSE/FUNDSTRANSFERType</con1:path>
                              </con1:param>
                            </con1:xqueryTransform>
                          </con2:expr>
                        </con2:assign>
                        <con2:assign varName="cuentaTemp">
                          <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79e1</con1:id>
                          <con2:expr>
                            <con1:xqueryText>fn:string($RESPONSE/FUNDSTRANSFERType/DEBITACCTNO/text())</con1:xqueryText>
                          </con2:expr>
                        </con2:assign>
                      </con2:default>
                    </con2:ifThenElse>
                  </con2:requestTransform>
                  <con2:responseTransform/>
                </con2:wsCallout>
                <con2:assign varName="branchName">
                  <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f6a</con1:id>
                  <con2:expr>
                    <con1:xqueryText>fn:string($RESPONSEConsultadeusuariosdelsistema/WSUSERType/gWSUSERDetailType/mWSUSERDetailType/BRANCHNAME/text())</con1:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="consultaCuenta" errorHandler="_onErrorHandler-2493995588525419875--30cd2246.1515ea270a3.-79a5">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con2:replace varName="proxyTrace">
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79b0</con1:id>
            <con2:expr>
              <con1:xqueryText>"preConsultaDetalleCuenta"</con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79aa</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>fn:string($cuentaTemp) != "" and
fn:string($RESPONSE/Status/successIndicator/text()) = "Success" and
$validationMessage = ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79a7</con1:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>Consultadedetallesdelacuenta</con2:operation>
                  <con2:request>
                    <con2:body>$REQUESTConsultadedetallesdelacuenta</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body>RESPONSEConsultadedetallesdelacuenta</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="REQUESTConsultadedetallesdelacuenta">
                      <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79a9</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaDetalleCuentaIn"/>
                          <con1:param name="autenticacionRequestHeader">
                            <con1:path>$header/aut:AutenticacionRequestHeader</con1:path>
                          </con1:param>
                          <con1:param name="cuentaTemp">
                            <con1:path>fn:string($cuentaTemp)</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:assign varName="cuenta">
                      <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79a8</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoConsultaDetalleCuentaOut"/>
                          <con1:param name="consultadedetallesdelacuentaResponse">
                            <con1:path>$RESPONSEConsultadedetallesdelacuenta</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:assign>
                  </con2:responseTransform>
                </con2:wsCallout>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="cuenta">
                <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79a6</con1:id>
                <con2:expr>
                  <con1:xqueryText>""</con1:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="proxyResponse">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoRecaudoTypes" prefix="pag"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con1:comment>Condicion para formar respuesta dependiendo de que el request venía completo o no (REQUIRED FIELDS NOT SUPPLIED).</con1:comment>
            <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-7123</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$validationMessage != ""</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-70eb</con1:id>
                  <con2:expr>
                    <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ fn:string($validationMessage) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:replace contents-only="true" varName="body">
                  <con1:id>_ActionId-932390660712874977-3cac6535.13d5ad01207.-70ce</con1:id>
                  <con2:expr>
                    <con1:xqueryText>&lt;pag:pagoRecaudoResponse/></con1:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>fn:string($RESPONSE/Status/successIndicator/text()) != "Success"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace contents-only="true" varName="header">
                  <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f68</con1:id>
                  <con2:expr>
                    <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>{ fn:string($RESPONSE/Status/successIndicator/text()) }</successIndicator>
      <messages>{ fn:string-join($RESPONSE/Status/messages/text()," ") }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:replace contents-only="true" varName="body">
                  <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f66</con1:id>
                  <con2:expr>
                    <con1:xqueryText>&lt;pag:pagoRecaudoResponse/></con1:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:replace varName="proxyTrace">
                <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f64</con1:id>
                <con2:expr>
                  <con1:xqueryText>"preRegistraRelPago"</con1:xqueryText>
                </con2:expr>
              </con2:replace>
              <con2:wsCallout>
                <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f60</con1:id>
                <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/recaudos/Resources/ActualizarEstadoRelacionOperacionRecaudo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                <con2:operation>actualizarEstadoRelacionOperacionRecaudo</con2:operation>
                <con2:request>
                  <con2:body>$REQUESTactualizarEstadoRelacionOperacionRecaudo</con2:body>
                </con2:request>
                <con2:response>
                  <con2:body>RESPONSEactualizarEstadoRelacionOperacionRecaudo</con2:body>
                </con2:response>
                <con2:requestTransform>
                  <con2:assign varName="REQUESTactualizarEstadoRelacionOperacionRecaudo">
                    <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f61</con1:id>
                    <con2:expr>
                      <con1:xqueryTransform>
                        <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoActualizarEstadoRelacionOperRecaudoIn"/>
                        <con1:param name="codigoDeudor">
                          <con1:path>fn:string($body/pag:pagoRecaudo/DEBTOR_CODE/text())</con1:path>
                        </con1:param>
                        <con1:param name="codigoContrato">
                          <con1:path>fn:string($body/pag:pagoRecaudo/CONTRACT_ID/text())</con1:path>
                        </con1:param>
                        <con1:param name="estadoNuevo">
                          <con1:path>"2"</con1:path>
                        </con1:param>
                        <con1:param name="estadoAnterior">
                          <con1:path>"1"</con1:path>
                        </con1:param>
                        <con1:param name="codigoFactura">
                          <con1:path>fn:string($body/pag:pagoRecaudo/BILL_INFORMATION/BILL_NUMBER/text())</con1:path>
                        </con1:param>
                      </con1:xqueryTransform>
                    </con2:expr>
                  </con2:assign>
                </con2:requestTransform>
                <con2:responseTransform/>
              </con2:wsCallout>
              <con2:ifThenElse>
                <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f58</con1:id>
                <con2:case>
                  <con2:condition>
                    <con1:xqueryText>count($RESPONSE/TELLERType) > 0</con1:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:replace varName="header" contents-only="true">
                      <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f57</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoTellerHeaderOut"/>
                          <con1:param name="status">
                            <con1:path>$RESPONSE/Status</con1:path>
                          </con1:param>
                          <con1:param name="tELLERType">
                            <con1:path>$RESPONSE/TELLERType</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                    <con2:replace contents-only="true" varName="body">
                      <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f56</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoTellerOut"/>
                          <con1:param name="consultadeusuariosdelsistemaResponse">
                            <con1:path>$RESPONSEConsultadeusuariosdelsistema</con1:path>
                          </con1:param>
                          <con1:param name="tELLERType">
                            <con1:path>$RESPONSE/TELLERType</con1:path>
                          </con1:param>
                          <con1:param name="consultadetallecontratorecaudoResponse">
                            <con1:path>$RESPONSEConsultadetallecontratorecaudo</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con2:actions>
                </con2:case>
                <con2:default>
                  <con2:replace contents-only="true" varName="header">
                    <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f55</con1:id>
                    <con2:expr>
                      <con1:xqueryTransform>
                        <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoTransferHeaderOut"/>
                        <con1:param name="fUNDSTRANSFERType">
                          <con1:path>$RESPONSE/FUNDSTRANSFERType</con1:path>
                        </con1:param>
                        <con1:param name="status">
                          <con1:path>$RESPONSE/Status</con1:path>
                        </con1:param>
                      </con1:xqueryTransform>
                    </con2:expr>
                  </con2:replace>
                  <con2:replace varName="body" contents-only="true">
                    <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f54</con1:id>
                    <con2:expr>
                      <con1:xqueryTransform>
                        <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoTransferOut"/>
                        <con1:param name="consultadetallecontratorecaudoResponse">
                          <con1:path>$RESPONSEConsultadetallecontratorecaudo</con1:path>
                        </con1:param>
                        <con1:param name="cuenta">
                          <con1:path>fn:string($cuenta)</con1:path>
                        </con1:param>
                        <con1:param name="fUNDSTRANSFERType">
                          <con1:path>$RESPONSE/FUNDSTRANSFERType</con1:path>
                        </con1:param>
                        <con1:param name="branchName">
                          <con1:path>$branchName</con1:path>
                        </con1:param>
                      </con1:xqueryTransform>
                    </con2:expr>
                  </con2:replace>
                  <con4:route>
                    <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f53</con1:id>
                    <con4:service ref="Middleware/v2/BusinessServices/CNV/registrarRecibo/biz/registrarRecibo_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con4:operation>registrarRecibo</con4:operation>
                    <con4:outboundTransform>
                      <con2:replace contents-only="true" varName="body">
                        <con1:id>_ActionId-1441057060407173480-6da19e72.1518254fbc4.-7f52</con1:id>
                        <con2:expr>
                          <con1:xqueryTransform>
                            <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistrarReciboIn"/>
                            <con1:param name="txnDate">
                              <con1:path>fn:string($header/aut:ResponseHeader/valueDate/text())</con1:path>
                            </con1:param>
                            <con1:param name="dealslip">
                              <con1:path>fn:string($body/pag:pagoRecaudoResponse/BILL_DETAIL/text())</con1:path>
                            </con1:param>
                            <con1:param name="inputter">
                              <con1:path>fn:string($body/pag:pagoRecaudoResponse/INPUTTER/text())</con1:path>
                            </con1:param>
                            <con1:param name="debtorCode">
                              <con1:path>fn:string(fn:tokenize($reqParams,"\|")[3])</con1:path>
                            </con1:param>
                            <con1:param name="altTxnId">
                              <con1:path>""</con1:path>
                            </con1:param>
                            <con1:param name="contractId">
                              <con1:path>fn:string(fn:tokenize($reqParams,"\|")[2])</con1:path>
                            </con1:param>
                            <con1:param name="transactionId">
                              <con1:path>fn:string($header/aut:ResponseHeader/transactionId/text())</con1:path>
                            </con1:param>
                          </con1:xqueryTransform>
                        </con2:expr>
                      </con2:replace>
                    </con4:outboundTransform>
                  </con4:route>
                </con2:default>
              </con2:ifThenElse>
            </con2:default>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="registroEnBitacora">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoRecaudoTypes" prefix="pag"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con1:comment>Condición para guardar en bitácora la respuesta del core. Esto depende del parametro T24C001.LOGENABLED de la tabla parametrizacion_middleware.</con1:comment>
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7a1d</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$logEnabled = "TRUE"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="rspUuidBitacora">
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7a1c</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/UUID/obtenerUUID"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="rspTimeStamp">
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7a1b</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/TimeStamp/obtenerTimestamp"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con4:route>
                  <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7a1a</con1:id>
                  <con4:service ref="Middleware/Business_Resources/recaudos/Resources/registrarRspRecaudo_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con4:operation>registrarRspRecaudo</con4:operation>
                  <con4:outboundTransform>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7a19</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistrarRsp"/>
                          <con1:param name="string3">
                            <con1:path>$reqUuidBitacora</con1:path>
                          </con1:param>
                          <con1:param name="string4">
                            <con1:path>$reqParams</con1:path>
                          </con1:param>
                          <con1:param name="string1">
                            <con1:path>$rspUuidBitacora</con1:path>
                          </con1:param>
                          <con1:param name="string2">
                            <con1:path>$rspTimeStamp</con1:path>
                          </con1:param>
                          <con1:param name="string5">
                            <con1:path>$proxyTrace</con1:path>
                          </con1:param>
                          <con1:param name="responseHeader1">
                            <con1:path>$header/aut:ResponseHeader</con1:path>
                          </con1:param>
                          <con1:param name="pagoRecaudoResponse1">
                            <con1:path>$body/pag:pagoRecaudoResponse</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con4:outboundTransform>
                </con4:route>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8848777042473091319--23eafd38.13c2a05c9f3.-6605">
      <con:stage name="proxyFault">
        <con:context>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaFICOPENTypes" prefix="con"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoRecaudoTypes" prefix="pag"/>
        </con:context>
        <con:actions>
          <con2:replace contents-only="true" varName="header">
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-65cb</con1:id>
            <con2:expr>
              <con1:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{ concat(fn:string($fault/ctx:errorCode/text()), ": ", fn:string($fault/ctx:reason/text())) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:replace contents-only="true" varName="body">
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-65ca</con1:id>
            <con2:expr>
              <con1:xqueryText>&lt;pag:pagoRecaudoResponse/></con1:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con1:comment>Condición para guardar en bitácora la respuesta del core. Esto depende del parametro T24C001.LOGENABLED de la tabla parametrizacion_middleware.</con1:comment>
            <con1:id>_ActionId-7708640245266169760-49b60068.145295445de.-7fcd</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$logEnabled = "TRUE"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="errUuidBitacora">
                  <con1:id>_ActionId-7708640245266169760-49b60068.145295445de.-7f95</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/UUID/obtenerUUID"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="errTimeStamp">
                  <con1:id>_ActionId-7708640245266169760-49b60068.145295445de.-7f79</con1:id>
                  <con2:expr>
                    <con1:xqueryTransform>
                      <con1:resource ref="Middleware/Business_Resources/general/TimeStamp/obtenerTimestamp"/>
                    </con1:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con4:route>
                  <con1:id>_ActionId-4577606443375125713-4946857e.151a7391d3d.-7f74</con1:id>
                  <con4:service ref="Middleware/Business_Resources/recaudos/Resources/registrarRspRecaudo_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con4:operation>registrarRspRecaudo</con4:operation>
                  <con4:outboundTransform>
                    <con2:replace varName="body" contents-only="true">
                      <con1:id>_ActionId-4577606443375125713-4946857e.151a7391d3d.-7f52</con1:id>
                      <con2:expr>
                        <con1:xqueryTransform>
                          <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoRegistrarRsp"/>
                          <con1:param name="string3">
                            <con1:path>$reqUuidBitacora</con1:path>
                          </con1:param>
                          <con1:param name="string4">
                            <con1:path>$reqParams</con1:path>
                          </con1:param>
                          <con1:param name="string1">
                            <con1:path>$errUuidBitacora</con1:path>
                          </con1:param>
                          <con1:param name="string2">
                            <con1:path>$errTimeStamp</con1:path>
                          </con1:param>
                          <con1:param name="string5">
                            <con1:path>$proxyTrace</con1:path>
                          </con1:param>
                          <con1:param name="responseHeader1">
                            <con1:path>$header/aut:ResponseHeader</con1:path>
                          </con1:param>
                          <con1:param name="pagoRecaudoResponse1">
                            <con1:path>$body/pag:pagoRecaudoResponse</con1:path>
                          </con1:param>
                        </con1:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con4:outboundTransform>
                </con4:route>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-7642</con1:id>
            <con2:case>
              <con2:condition>
                <con1:xqueryText>$paymentMethod = "CREDIT_CARD"</con1:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-763e</con1:id>
                  <con2:case>
                    <con2:condition>
                      <con1:xqueryText>$confAlcance = '00' and fn:empty($RESPONSE)</con1:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con4:route>
                        <con1:id>_ActionId-8698969333149841878--3e1b28ee.14bdb5bc351.-763d</con1:id>
                        <con4:service ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>reversarConsumo</con4:operation>
                        <con4:outboundTransform>
                          <con2:replace varName="body" contents-only="true">
                            <con1:id>_ActionId-6675339917960387799-2b9952c5.14c95f87a0c.-7dea</con1:id>
                            <con2:expr>
                              <con1:xqueryTransform>
                                <con1:resource ref="Middleware/Business_Resources/pagoRecaudos/PagoRecaudo/pagoRecaudoReversarConsumoTC"/>
                                <con1:param name="pagoRecaudo1">
                                  <con1:path>$body/pag:pagoRecaudo</con1:path>
                                </con1:param>
                                <con1:param name="consumoNORResponse1">
                                  <con1:path>$RSPRegistraConsumo</con1:path>
                                </con1:param>
                                <con1:param name="purchaseDescription">
                                  <con1:path>$contractName</con1:path>
                                </con1:param>
                                <con1:param name="purchaseRefNumber">
                                  <con1:path>$purchaseRefNumber</con1:path>
                                </con1:param>
                              </con1:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con4:outboundTransform>
                      </con4:route>
                    </con2:actions>
                  </con2:case>
                  <con2:default/>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
          <con1:reply>
            <con1:id>_ActionId-8848777042473091319--23eafd38.13c2a05c9f3.-65c9</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-2493995588525419875--30cd2246.1515ea270a3.-79df">
      <con:stage name="consultaUsuarioFault">
        <con:context/>
        <con:actions>
          <con2:assign varName="branchName">
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79d0</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:string($RESPONSE/FUNDSTRANSFERType/LROTHEROFFCER/text())</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con1:resume>
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-79b4</con1:id>
          </con1:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-2493995588525419875--30cd2246.1515ea270a3.-79a5">
      <con:stage name="consultaCuentaFault">
        <con:context/>
        <con:actions>
          <con2:assign varName="cuenta">
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7987</con1:id>
            <con2:expr>
              <con1:xqueryText>fn:string($RESPONSE/FUNDSTRANSFERType/DEBITACCTNO/text())</con1:xqueryText>
            </con2:expr>
          </con2:assign>
          <con1:resume>
            <con1:id>_ActionId-2493995588525419875--30cd2246.1515ea270a3.-7965</con1:id>
          </con1:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:flow>
      <con:pipeline-node name="PipelinePairNode1">
        <con:request>PipelinePairNode1_request</con:request>
        <con:response>PipelinePairNode1_response</con:response>
      </con:pipeline-node>
    </con:flow>
  </ser:router>
</xml-fragment>