<?xml version="1.0" encoding="UTF-8"?>
<bpel:process name="sjConsultaListasCliente"
              targetNamespace="http://www.example.com/flow/Middleware/v2/Resources/ConsultaListasCliente/sj/sjConsultaListasCliente"
              xmlns:tns="http://www.example.com/flow/Middleware/v2/Resources/ConsultaListasCliente/sj/sjConsultaListasCliente"
              xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
              xmlns:rescon="http://www.bea.com/alsb/flow/resources/config"
              xmlns:bea="http://www.bea.com/bpel/ui/extensions"
              xmlns:ext="http://www.bea.com/bpel/extensions"
              xmlns:expr="http://www.bea.com/wli/sb/stages/config"
              xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config"
              xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaListasClientePS" 
              bea:name="sjConsultaListasCliente" xmlns:ns1="T24WebServicesImpl" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareSOAApplication/ConsultarListaFatca/consultarListaFatca" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/InterbancaSOAApplication/ObtenerParametrizacion/obtenerParametrizacion" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/conDatoTarjetaGT/consultaListaOFAC/consultaListaOFAC" xmlns:osb="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" xmlns:sjc="http://www.ficohsa.com.hn/middleware.services/sjConsultaListasCliente" xmlns:ns4="http://www.ficohsa.com.hn/middleware.services/ConsultadelistaclientesNoFATCAPS/" xmlns:ns5="http://www.ficohsa.com.hn/middleware.services/listasClientesNoFATCAPS/" xmlns:ns6="http://www.ficohsa.com.hn/middleware.services/listaClientesFATCAPS/" xmlns:ns7="http://xmlns.oracle.com/pcbpel/adapter/db/DatabaseAdapters/OSBRegistraPagosTCMasterData/consultaClientesPartesRelacionadas">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaListasCliente" partnerLinkType="tns:sjConsultaListasCliente"
                          myRole="sjConsultaListasCliente">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="consultasClienteBS"
		partnerLinkType="tns:consultasClienteBS_plnkType"
		partnerRole="consultasClienteBS_PartnerRole">
	   </bpel:partnerLink>
	   
	   <bpel:partnerLink name="ObtenerParametrizacion"
	   	partnerLinkType="tns:ObtenerParametrizacion_plnkType"
	   	partnerRole="ObtenerParametrizacion_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaListaOFAC_db"
	   	partnerLinkType="tns:consultaListaOFAC_db_plnkType"
	   	partnerRole="consultaListaOFAC_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ListaClientesNoFATCAHN"
	   	partnerLinkType="tns:ListaClientesNoFATCAHN_plnkType"
	   	partnerRole="ListaClientesNoFATCAHN_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ListaClientesFATCAHN"
	   	partnerLinkType="tns:ListaClientesFATCAHN_plnkType"
	   	partnerRole="ListaClientesFATCAHN_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaClientesPartesRelacionadas_db"
	   	partnerLinkType="tns:consultaClientesPartesRelacionadas_db_plnkType"
	   	partnerRole="consultaClientesPartesRelacionadas_db_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request"
	                      messageType="bind:sjConsultaListasClienteRequest">
	       </bpel:variable>
	       <bpel:variable name="response"
                       messageType="bind:sjConsultaListasClienteResponse">
	       </bpel:variable>
    
    <bpel:variable name="REQConsListaNegra"
		messageType="ns1:Consultadelistanegra">
    </bpel:variable>
    <bpel:variable name="RSPConsListaNegra"
    	messageType="ns1:ConsultadelistanegraResponse">
    </bpel:variable>
    <bpel:variable name="REQConsListaPEP"
    	messageType="ns1:ConsultadelistaPEP">
    </bpel:variable>
    <bpel:variable name="RSPConsListaPEP"
    	messageType="ns1:ConsultadelistaPEPResponse">
    </bpel:variable>
    <bpel:variable name="REQConsListaFatca" messageType="ns6:ConsultadelistaclientesFATCARequest">
    </bpel:variable>
    <bpel:variable name="RSPConsListaFatca" messageType="ns6:ConsultadelistaclientesFATCAResponse">
    </bpel:variable>
    <bpel:variable name="REQConsListaGris"
    	messageType="ns1:ConsultaListaGris">
    </bpel:variable>
    <bpel:variable name="RSPConsListaGris"
    	messageType="ns1:ConsultaListaGrisResponse">
    </bpel:variable>
    <bpel:variable name="REQObtenerParametrizacion"
    	messageType="ns2:args_in_msg">
    </bpel:variable>
    <bpel:variable name="RSPObtenerParametrizacion"
    	messageType="ns2:args_out_msg">
    </bpel:variable>
    <bpel:variable name="REQConsultaListaOFAC"
    	messageType="ns3:args_in_msg">
    </bpel:variable>
    <bpel:variable name="RSPConsultaListaOFAC"
    	messageType="ns3:args_out_msg">
    </bpel:variable>
    
    
    <bpel:variable name="REQConsultadelistaclientesNoFATCA"
    	messageType="ns5:ConsultadelistaclientesNoFATCARequest">
    </bpel:variable>
    <bpel:variable name="RSPConsultadelistaclientesNoFATCA"
    	messageType="ns5:ConsultadelistaclientesNoFATCAResponse">
    </bpel:variable>
    <bpel:variable name="REQConsPartRelac"
    	messageType="ns7:args_in_msg">
    </bpel:variable>
    <bpel:variable name="RSPConsPartRelac"
    	messageType="ns7:args_out_msg">
    </bpel:variable></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaListasCliente" operation="consultaListasCliente" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="Middleware/v2/Resources/ConsultaListasCliente/wsdl/sjConsultaListasCliente" binding="bind:sjConsultaListasClientePSSOAP"/>
            </rescon:receiveInfo>
        </bpel:receive>
        <bpel:flow>
        	<bpel:scope bea:name="ConsultaListaNegra">
        		<bpel:sequence>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<trf:assign varName="REQConsListaNegra.parameters">
        						<trf:expr>
        							<expr:xqueryTransform>
        								<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaListaNegraIn"></expr:resource>
        								<expr:param name="sjConsultaListasClienteRequest1">
        									<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:invoke operation="Consultadelistanegra" partnerLink="consultasClienteBS" inputVariable="REQConsListaNegra" outputVariable="RSPConsListaNegra">
        				<rescon:invokeInfo>
        					<rescon:service isProxy="false" ref="Middleware/Business_Resources/consultasCliente/Resources/consultasClienteBS"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        	</bpel:scope>
        	<bpel:scope bea:name="ConsultaListaPEP">
        		<bpel:sequence>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<trf:assign varName="REQConsListaPEP.parameters">
        						<trf:expr>
        							<expr:xqueryTransform>
        								<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaListaPEPIn"></expr:resource>
        								<expr:param name="sjConsultaListasClienteRequest1">
        									<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:invoke operation="ConsultadelistaPEP" partnerLink="consultasClienteBS" inputVariable="REQConsListaPEP" outputVariable="RSPConsListaPEP">
        				<rescon:invokeInfo>
        					<rescon:service isProxy="false" ref="Middleware/Business_Resources/consultasCliente/Resources/consultasClienteBS"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        	</bpel:scope>
        <bpel:scope bea:name="ConsultaListaFatca">
		<bpel:sequence>
			
			
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign varName="REQConsListaFatca.parameters">
						<trf:expr>
							<expr:xqueryText>$request.inputParameters</expr:xqueryText></trf:expr></trf:assign>
				</bpel:extensionAssignOperation>
			</bpel:assign>
			<bpel:invoke operation="ConsultadelistaclientesFATCA" partnerLink="ListaClientesFATCAHN" inputVariable="REQConsListaFatca" outputVariable="RSPConsListaFatca">
				<rescon:invokeInfo>
					<rescon:service isProxy="true" ref="Middleware/v2/ProxyServices/ListaClientesFATCAHN"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        </bpel:scope>
        <bpel:scope bea:name="ConsultaListaGris">
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<trf:assign varName="REQConsListaGris.parameters">
        					<trf:expr>
        						<expr:xqueryTransform>
        							<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaListaGrisIn"></expr:resource>
        							<expr:param name="sjConsultaListasClienteRequest1">
        								<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		</bpel:assign>
        		<bpel:invoke operation="ConsultaListaGris" partnerLink="consultasClienteBS" inputVariable="REQConsListaGris" outputVariable="RSPConsListaGris">
        			<rescon:invokeInfo>
        				<rescon:service isProxy="false" ref="Middleware/Business_Resources/consultasCliente/Resources/consultasClienteBS"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        </bpel:scope>
        <bpel:scope bea:name="ConsultaListaOFAC">
        	<bpel:variables>
        		<bpel:variable name="levenshteinName"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="errorCode" type="xsd:string"></bpel:variable>
        		<bpel:variable name="customerName" type="xsd:string"></bpel:variable>
        		<bpel:variable name="customerStatus"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="levenshteinParameter"
        			type="xsd:string">
        		</bpel:variable></bpel:variables>
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<trf:assign varName="levenshteinName">
        					<trf:expr>
        						<expr:xqueryText>&quot;FICBCO0177.LEVENSHTEIN.OFAC&quot;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation>
        				<bpel:documentation></bpel:documentation>
        				<trf:assign
        					varName="REQObtenerParametrizacion.InputParameters">
        					<trf:expr>
        						<expr:xqueryTransform>
        							<expr:resource
        								ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"></expr:resource>
        							
        							<expr:param name="nombreParametros">
	<expr:path>$levenshteinName</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        			</bpel:assign>
        		
        		
        		
        		<bpel:invoke operation="obtenerParametrizacion" partnerLink="ObtenerParametrizacion" inputVariable="REQObtenerParametrizacion" outputVariable="RSPObtenerParametrizacion">
        			<rescon:invokeInfo>
        				<rescon:service isProxy="false" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion"></rescon:service></rescon:invokeInfo></bpel:invoke>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<bpel:documentation></bpel:documentation>
        				<trf:assign varName="errorCode">
        					<trf:expr>
        						<expr:xqueryText>upper-case(string($RSPObtenerParametrizacion.OutputParameters/osb:ERROR_CODE/text()))</expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		</bpel:assign>
        		<bpel:if>
        			<bpel:condition>$errorCode = 'SUCCESS'</bpel:condition>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		
	
	<bpel:extensionAssignOperation>
		<trf:assign varName="levenshteinParameter">
			<trf:expr>
				<expr:xqueryText>string($RSPObtenerParametrizacion.OutputParameters/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$levenshteinName]/osb:VALUE/text())</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	<bpel:extensionAssignOperation>
			<trf:assign varName="REQConsultaListaOFAC.InputParameters">
				<trf:expr>
					<expr:xqueryTransform>
						<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaListaOFACIn"></expr:resource>
						
						
						
						
						
						
						
						
						
						
						
						
						
						
						<expr:param name="levenshtein">
							<expr:path>$levenshteinParameter</expr:path></expr:param>
						<expr:param name="customerName">
							<expr:path>''</expr:path></expr:param>
						<expr:param name="customerLegalId">
							<expr:path>fn:string($request.inputParameters/sjc:CUSTOMER_LEGAL_ID/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:invoke operation="consultaListaOFAC" partnerLink="consultaListaOFAC_db" inputVariable="REQConsultaListaOFAC" outputVariable="RSPConsultaListaOFAC">
        				<rescon:invokeInfo>
        					<rescon:service isProxy="false" ref="Middleware/v2/BusinessServices/consultaListaOFAC/biz/consultaListaOFAC_db"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        			<bpel:else>
        				<bpel:sequence>
        					<bpel:empty></bpel:empty>
        				</bpel:sequence>
        			</bpel:else>
        		</bpel:if></bpel:sequence>
        </bpel:scope>
        <bpel:scope>
        	<bpel:sequence>
        		<bpel:scope bea:name="ConsultaListaClientesNoFATCA">
        			<bpel:sequence>
        				<bpel:assign>
        					<bpel:extensionAssignOperation>
        						<trf:assign
        							varName="REQConsultadelistaclientesNoFATCA.parameters">
        							<trf:expr>
        								<expr:xqueryText>$request.inputParameters</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        				<bpel:invoke
        					operation="ConsultadelistaclientesNoFATCA"
        					outputVariable="RSPConsultadelistaclientesNoFATCA"
        					partnerLink="ListaClientesNoFATCAHN"
        					inputVariable="REQConsultadelistaclientesNoFATCA">
        					<rescon:invokeInfo>
        						<rescon:service
        							ref="Middleware/v2/ProxyServices/ListaClientesNoFATCAHN"
        							isProxy="true"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence></bpel:scope>
        	</bpel:sequence>
        </bpel:scope>
        <bpel:scope bea:name="ConsultaPartesRelacionadas">
        	
        	<bpel:sequence>
        		
        	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="REQConsPartRelac.InputParameters">
				<trf:expr>
					<expr:xqueryTransform>
						<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaPartesRelacionadasIn"></expr:resource>
						<expr:param name="sjConsultaListasClienteRequest1">
							<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        	</bpel:assign>
        	<bpel:invoke operation="consultaClientesPartesRelacionadas" partnerLink="consultaClientesPartesRelacionadas_db" inputVariable="REQConsPartRelac" outputVariable="RSPConsPartRelac">
        		<rescon:invokeInfo>
        			<rescon:service isProxy="false" ref="Middleware/v2/BusinessServices/ConsultaClientesPartesRelacionadas/biz/consultaClientesPartesRelacionadas_db"></rescon:service></rescon:invokeInfo></bpel:invoke></bpel:sequence>
        </bpel:scope>
        </bpel:flow>
        
        <bpel:assign>
        	
        <bpel:extensionAssignOperation>
		<trf:assign varName="response.outputParameters">
			<trf:expr>
				<expr:xqueryTransform>
					<expr:resource ref="Middleware/v2/Resources/ConsultaListasCliente/xq/sjConsultaListasClienteOut"></expr:resource>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<expr:param name="consultadelistagrisResponse1">
						<expr:path>$RSPConsListaGris.parameters</expr:path></expr:param>
					<expr:param name="RSPPartRelac">
						<expr:path>$RSPConsPartRelac.OutputParameters</expr:path></expr:param>
					<expr:param name="outputParameters">
						<expr:path>$RSPConsultaListaOFAC.OutputParameters</expr:path></expr:param>
					<expr:param name="outputParameters1">
						<expr:path>$RSPConsListaFatca.result</expr:path></expr:param>
					<expr:param name="consultadelistaPEPResponse1">
						<expr:path>$RSPConsListaPEP.parameters</expr:path></expr:param>
					<expr:param name="consultadeclientesnoFATCAResponse">
						<expr:path>$RSPConsultadelistaclientesNoFATCA.result</expr:path></expr:param>
					<expr:param name="consultadelistanegraResponse1">
						<expr:path>$RSPConsListaNegra.parameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        </bpel:extensionAssignOperation></bpel:assign>
        <bpel:reply partnerLink="sjConsultaListasCliente" operation="consultaListasCliente" variable="response"></bpel:reply>
    </bpel:sequence>
</bpel:process>