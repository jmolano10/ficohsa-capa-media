<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/publish/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false">
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con4:SoapBindingType" xmlns:con4="http://www.bea.com/wli/sb/services/bindings/config">
      <con4:wsdl ref="Middleware/v2/Resources/TransferenciasACHRecibidas/wsdl/transferenciasACHRecibidasPS"/>
      <con4:port>
        <con4:name>transferenciasACHRecibidasPSSOAP</con4:name>
        <con4:namespace>http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasPS/</con4:namespace>
      </con4:port>
      <con4:selector type="SOAP body"/>
      <con4:WSI-compliant>false</con4:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>local</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:inbound-properties/>
    <tran:all-headers>true</tran:all-headers>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-2610459578228753383-1aa70613.16ae5802f12.-7ae3">
    <con:pipeline type="request" name="PagoTC_request">
      <con:stage name="ParametrizacionMiddleware">
        <con:context>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
        </con:context>
        <con:actions>
          <con1:assign varName="balanceCurrency">
            <con2:id>_ActionId-4089100666458915325--118af25b.17c040ee44e.-68e9</con2:id>
            <con1:expr>
              <con2:xqueryText>string($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="ServiceId">
            <con2:id>_ActionId-6099950342708189220--7e157c2e.17ba1d5c117.-74c7</con2:id>
            <con1:expr>
              <con2:xqueryText>'FICBCO0191'</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="merchantNumberPName ">
            <con2:id>_ActionId-6099950342708189220--7e157c2e.17ba1d5c117.-74aa</con2:id>
            <con1:expr>
              <con2:xqueryText>concat($ServiceId,'.',	string($header/aut:RequestHeader/Region/SourceBank/text()),
		'.',
	upper-case(string($header/aut:RequestHeader/Authentication/UserName/text())),
	'.MERCHANT_NUMBER')</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="correoParam">
            <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7d61</con2:id>
            <con1:expr>
              <con2:xqueryText>'FICBCO0191.EMAIL'</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:wsCallout>
            <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7d44</con2:id>
            <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>obtenerParametrizacion</con1:operation>
            <con1:request>
              <con1:body>$REQObtenerParametrizacion</con1:body>
            </con1:request>
            <con1:response>
              <con1:body>RSPObtenerParametrizacion</con1:body>
            </con1:response>
            <con1:requestTransform>
              <con1:assign varName="REQObtenerParametrizacion">
                <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7d0c</con2:id>
                <con1:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                    <con2:param name="nombreParametros">
                      <con2:path>fn:concat(
	$correoParam,'||',
	$merchantNumberPName
	)</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con1:expr>
              </con1:assign>
            </con1:requestTransform>
            <con1:responseTransform>
              <con1:assign varName="errorCode">
                <con2:id>_ActionId-6809855940837178741--20441cc8.16bdc572230.-7d23</con2:id>
                <con1:expr>
                  <con2:xqueryText>fn:upper-case(fn:string($RSPObtenerParametrizacion/osb:ERROR_CODE/text()))</con2:xqueryText>
                </con1:expr>
              </con1:assign>
              <con1:assign varName="validationMessage">
                <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7cd4</con2:id>
                <con1:expr>
                  <con2:xqueryText>if($errorCode = 'SUCCESS') then(
	''
)else(
	fn:string($RSPObtenerParametrizacion/osb:ERROR_MESSAGE/text())
)</con2:xqueryText>
                </con1:expr>
              </con1:assign>
              <con1:assign varName="validationMessageService">
                <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7cb7</con2:id>
                <con1:expr>
                  <con2:xqueryText>$validationMessage</con2:xqueryText>
                </con1:expr>
              </con1:assign>
              <con1:assign varName="correo">
                <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c60</con2:id>
                <con1:expr>
                  <con2:xqueryText>fn:string($RSPObtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$correoParam]/osb:VALUE/text())</con2:xqueryText>
                </con1:expr>
              </con1:assign>
              <con1:assign varName="merchantNumber ">
                <con2:id>_ActionId-6099950342708189220--7e157c2e.17ba1d5c117.-72e9</con2:id>
                <con1:expr>
                  <con2:xqueryText>$RSPObtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME = $merchantNumberPName]/osb:VALUE/text()</con2:xqueryText>
                </con1:expr>
              </con1:assign>
            </con1:responseTransform>
          </con1:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="RegistraNuevoACHRecibido" errorHandler="_onErrorHandler-8057391077676709090--f2f6334.16cc0ef6e3d.-7f58">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registroNuevoACHRecibido" prefix="reg"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c44</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c3a</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/RegistroNuevoACHRecibido/biz/registroNuevoACHRecibido_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>registroNuevoACHRecibido</con1:operation>
                  <con1:request>
                    <con1:body>$REQRegistroNuevoACHRecibido</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPRegistroNuevoACHRecibido</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQRegistroNuevoACHRecibido">
                      <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c3e</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/registroNuevoACHRecibidoIn"/>
                          <con2:param name="transferenciasACHRecibidas">
                            <con2:path>$body/tran:transferenciasACHRecibidas</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c3d</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:upper-case(fn:string($RSPRegistroNuevoACHRecibido/reg:PV_SUCCESINDICATOR/text()))</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c3c</con2:id>
                      <con1:expr>
                        <con2:xqueryText>if($errorCode = 'SUCCESS') then(
	''
)else(
	'R31-Error del sistema'
)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessageService">
                      <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c3b</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$validationMessage</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="achSequence">
                      <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3cf3</con2:id>
                      <con1:expr>
                        <con2:xqueryText>xs:decimal($RSPRegistroNuevoACHRecibido/reg:PN_ACHSECUENCIA/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ConsultaDatosTarjetaCredito" errorHandler="_onErrorHandler-2169741114947710695-5d04c505.17e217c5f80.-7b55">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaDatosTarjetaCreditoTypes" prefix="con"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f5a</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f4b</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/OSB/ConsultaDatosTarjetaCredito_v3/biz/ConsultaDatosTarjetaCredito_v3" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>consultaDatosTarjetaCredito</con1:operation>
                  <con1:request>
                    <con1:body>$REQconsultaDatosTarjetaCredito</con1:body>
                    <con1:header>$REQHconsultaDatosTarjetaCredito</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPconsultaDatosTarjetaCredito</con1:body>
                    <con1:header>RSPHconsultaDatosTarjetaCredito</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="proceso">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f58</con2:id>
                      <con1:expr>
                        <con2:xqueryText>1</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQHconsultaDatosTarjetaCredito">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7add</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$header</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQconsultaDatosTarjetaCredito">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f57</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/consultaDatosTarjetaIn"/>
                          <con2:param name="cardNumber">
                            <con2:path>string($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/DESTINATION/text())</con2:path>
                          </con2:param>
                          <con2:param name="org">
                            <con2:path>''</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="cardStatus">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f56</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:upper-case(fn:string($RSPconsultaDatosTarjetaCredito/CARD_CURRENCY_INFORMATION[1]/CREDIT_CARD_STATUS/text()))</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="messages">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f55</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($RSPHconsultaDatosTarjetaCredito/aut:ResponseHeader/messages/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="success">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f54</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:upper-case(fn:string($RSPHconsultaDatosTarjetaCredito/aut:ResponseHeader/successIndicator/text()))</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validacionConsultaDatosTarjetaCredito">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f53</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaDatosTarjetaCredito"/>
                          <con2:param name="cardStatus">
                            <con2:path>$cardStatus</con2:path>
                          </con2:param>
                          <con2:param name="messages">
                            <con2:path>$messages</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>$success</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f52</con2:id>
                      <con1:expr>
                        <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaDatosTarjetaCredito/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaDatosTarjetaCredito/ESTADO_PROCESO/text())

return
	if($codigoErrorProceso ='')then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f51</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/VALIDACION_MENSAJE/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f50</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f4f</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f4e</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="org">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f4d</con2:id>
                      <con1:expr>
                        <con2:xqueryText>if ($RSPconsultaDatosTarjetaCredito/CARD_CURRENCY_INFORMATION[1]/CURRENCY/text() = string($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text())) then
(
	$RSPconsultaDatosTarjetaCredito/CARD_CURRENCY_INFORMATION[1]/ORG/text()
)
else
(
	$RSPconsultaDatosTarjetaCredito/CARD_CURRENCY_INFORMATION[2]/ORG/text()
)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="customerId">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7f4c</con2:id>
                      <con1:expr>
                        <con2:xqueryText>string($RSPconsultaDatosTarjetaCredito/CUSTOMER_ID[1]/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ConsultaSaldosTarjetaCredito" errorHandler="_onErrorHandler-3938559305267874468-208a6455.172b98d0838.-7f3a">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://tempuri.org/" prefix="tem"/>
          <con2:varNsDecl namespace="http://schemas.datacontract.org/2004/07/Business.Entities" prefix="bus"/>
          <con2:varNsDecl namespace="http://schemas.datacontract.org/2004/07/Core.Entities" prefix="core"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7fac</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7f72</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/OSB/consultaSaldosTarjetaCredito_v2/biz/consultaSaldosTarjetaCredito" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>consultaSaldosTarjetaCredito</con1:operation>
                  <con1:request>
                    <con1:body>$REQConsultaSaldosTarjetaCredito</con1:body>
                    <con1:header>$REQHConsultaSaldosTarjetaCredito</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPConsultaSaldosTarjetaCredito</con1:body>
                    <con1:header>RSPHConsultaSaldosTarjetaCredito</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="proceso">
                      <con2:id>_ActionId-8856931896756827538--37456ddd.16b5157321a.-74b7</con2:id>
                      <con1:expr>
                        <con2:xqueryText>2</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQHConsultaSaldosTarjetaCredito">
                      <con2:id>_ActionId-6832425211396364118-4757ae47.17e2fe23c97.-7ab9</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$header</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQConsultaSaldosTarjetaCredito">
                      <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7f38</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/consultaSaldosTarjetaCreditoIn"/>
                          <con2:param name="cardNumber">
                            <con2:path>fn:string($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/DESTINATION/text())</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="validacionConsultaSaldosTarjetaCredito">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7a4a</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaSaldosTarjetaCredito"/>
                          <con2:param name="messages">
                            <con2:path>if(fn:upper-case(fn:string($RSPHConsultaSaldosTarjetaCredito/aut:ResponseHeader/messages/text())) = ('', 'CONSULTA EXITOSA')) then(
	''
)else(
	fn:string($RSPHConsultaSaldosTarjetaCredito/aut:ResponseHeader/messages/text())
)</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>fn:upper-case(fn:string($RSPHConsultaSaldosTarjetaCredito/aut:ResponseHeader/successIndicator/text()))</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7a2d</con2:id>
                      <con1:expr>
                        <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaSaldosTarjetaCredito/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaSaldosTarjetaCredito/ESTADO_PROCESO/text())

return
	if($codigoErrorProceso ='')then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7a10</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/VALIDACION_MENSAJE/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-6659357583103300107--413b72c2.16c0afe899e.-7da4</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-79f3</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-79d6</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="RegistroACHRecibido" errorHandler="_onErrorHandler-1198664836547443832--209b81e8.16b27de23a4.-7da6">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaSaldosTarjetaCreditoTypes" prefix="con1"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registroNuevoACHRecibido" prefix="reg"/>
          <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7e55</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7e1b</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/SvcACHRecibido/biz/svcACHRecibido" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>RegistroACHRecibida</con1:operation>
                  <con1:request>
                    <con1:body>$REQRegistroACHRecibida</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPRegistroACHRecibida</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="proceso">
                      <con2:id>_ActionId-8856931896756827538--37456ddd.16b5157321a.-7900</con2:id>
                      <con1:expr>
                        <con2:xqueryText>3</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="currency">
                      <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3e7a</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text()</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="consultaSaldosDetalle">
                      <con2:id>_ActionId-8986104880294255706--17ce448.16bc2ae117a.-7fab</con2:id>
                      <con1:expr>
                        <con2:xqueryText><![CDATA[if($currency = 'HNL') then(
      if(fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENCY/text()) = 'HNL') then(
         <CONSULTA_SALDOS_RESPONSE>
            <TCCCY>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENCY/text()) }</TCCCY>
            <TC_CURRENT_AMT>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENT_BALANCE/text()) }</TC_CURRENT_AMT>
         </CONSULTA_SALDOS_RESPONSE>
      )else(
         <CONSULTA_SALDOS_RESPONSE>
            <TCCCY>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[2]/CURRENCY/text()) }</TCCCY>
            <TC_CURRENT_AMT>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[2]/CURRENT_BALANCE/text()) }</TC_CURRENT_AMT>
         </CONSULTA_SALDOS_RESPONSE>
      )
)else(
   
      if(fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENCY/text()) = 'USD') then(
         <CONSULTA_SALDOS_RESPONSE>
            <TCCCY>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENCY/text()) }</TCCCY>
            <TC_CURRENT_AMT>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[1]/CURRENT_BALANCE/text()) }</TC_CURRENT_AMT>
         </CONSULTA_SALDOS_RESPONSE>	
      )else(
         <CONSULTA_SALDOS_RESPONSE>
            <TCCCY>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[2]/CURRENCY/text()) }</TCCCY>
            <TC_CURRENT_AMT>{ fn:string($RSPConsultaSaldosTarjetaCredito/con1:consultaSaldosTarjetaCreditoResponseType/con1:consultaSaldosTarjetaCreditoResponseRecordType[2]/CURRENT_BALANCE/text()) }</TC_CURRENT_AMT>
         </CONSULTA_SALDOS_RESPONSE>	
      )
)]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQRegistroACHRecibida">
                      <con2:id>_ActionId-1198664836547443832--209b81e8.16b27de23a4.-7de1</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/registroACHRecibidaTCIn"/>
                          <con2:param name="transferenciasACHRecibidas">
                            <con2:path>$body/tran:transferenciasACHRecibidas</con2:path>
                          </con2:param>
                          <con2:param name="customerId">
                            <con2:path>$customerId</con2:path>
                          </con2:param>
                          <con2:param name="tcccy">
                            <con2:path>fn:string($consultaSaldosDetalle/TCCCY/text())</con2:path>
                          </con2:param>
                          <con2:param name="tcCurrentAmt">
                            <con2:path>fn:string($consultaSaldosDetalle/TC_CURRENT_AMT/text())</con2:path>
                          </con2:param>
                          <con2:param name="idProduct">
                            <con2:path>'Creditca'</con2:path>
                          </con2:param>
                          <con2:param name="requestHeader1">
                            <con2:path>$header/aut:RequestHeader</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="validacionRegistroACHRecibida">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-799e</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoRegistroACHRecibida"/>
                          <con2:param name="messages">
                            <con2:path>if(fn:string-join($RSPRegistroACHRecibida/Status/messages, ' ') = '') then(
	''
)else(
	fn:string-join($RSPRegistroACHRecibida/Status/messages, '. ')
)</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>fn:upper-case(fn:string($RSPRegistroACHRecibida/Status/successIndicator/text()))</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7981</con2:id>
                      <con1:expr>
                        <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionRegistroACHRecibida/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionRegistroACHRecibida/ESTADO_PROCESO/text())

return
	if($codigoErrorProceso ='' or $estadoProceso = 'PENDING')then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7964</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionRegistroACHRecibida/VALIDACION_MENSAJE/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-6659357583103300107--413b72c2.16c0afe899e.-7e18</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionRegistroACHRecibida/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7947</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionRegistroACHRecibida/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-792a</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionRegistroACHRecibida/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validDate">
                      <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3e49</con2:id>
                      <con1:expr>
                        <con2:xqueryText>let $date:= fn:string($RSPRegistroACHRecibida/FICOHNACHONLINEType/gDATETIME/DATETIME/text())
let $year:= concat("20", substring($date, 1, 2))
let $month:= substring($date, 3, 2) 
let $day:= substring($date, 5, 2)
return(
	fn:concat($year,"-",$month,"-",$day)
)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ConsultaRegistroACHRecibido" errorHandler="_onErrorHandler-8856931896756827538--37456ddd.16b5157321a.-7f59">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-781c</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7810</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/SvcACHRecibido/biz/svcACHRecibido" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>ConsultaRegistroACHRecibido</con1:operation>
                  <con1:request>
                    <con1:body>$REQConsultaRegistroACHRecibido</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPConsultaRegistroACHRecibido</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="proceso">
                      <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7815</con2:id>
                      <con1:expr>
                        <con2:xqueryText>4</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQConsultaRegistroACHRecibido">
                      <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7814</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/consultaRegistroACHRecibidoIn"/>
                          <con2:param name="requestHeader1">
                            <con2:path>$header/aut:RequestHeader</con2:path>
                          </con2:param>
                          <con2:param name="transactionId">
                            <con2:path>fn:string($RSPRegistroACHRecibida/Status/transactionId/text())</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="validacionConsultaRegistroACHRecibido">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-77da</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaRegistroACHRecibido"/>
                          <con2:param name="txnStatus">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/TXNSTATUS/text()) = '') then(
	''
)else(
	fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/TXNSTATUS/text()))
)</con2:path>
                          </con2:param>
                          <con2:param name="messages">
                            <con2:path>if(fn:string-join($RSPConsultaRegistroACHRecibido/Status/messages, ' ') = '') then(
	''
)else(
	fn:string-join($RSPConsultaRegistroACHRecibido/Status/messages, '. ')
)</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/Status/successIndicator/text()))</con2:path>
                          </con2:param>
                          <con2:param name="idRejection">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDREJECTION/text()) = '') then(
	''
)else(
	fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDREJECTION/text())
)</con2:path>
                          </con2:param>
                          <con2:param name="zeroRecords">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/ZERORECORDS/text()) = '') then(
	''
)else(
	fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/ZERORECORDS/text()))
)</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-77bd</con2:id>
                      <con1:expr>
                        <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaRegistroACHRecibido/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())

return
	if($codigoErrorProceso ='' or $estadoProceso = 'PENDING')then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-77a0</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/VALIDACION_MENSAJE/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-6659357583103300107--413b72c2.16c0afe899e.-7dde</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7783</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7766</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="successIndicatorT24">
                      <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7811</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$estadoProceso</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="IDTXNT24">
                      <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3e66</con2:id>
                      <con1:expr>
                        <con2:xqueryText>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDTXNT24/text()) = '') then (
	''
)else(
	fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDTXNT24/text())
)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="refControlT24">
                      <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3cd0</con2:id>
                      <con1:expr>
                        <con2:xqueryText>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/ID/text()) = '') then(
	''
)else(
    fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/ID/text())
)</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ValidaEstadoT24Error">
        <con:context/>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-2610459578228753383-1aa70613.16ae5802f12.-7b4b</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$successIndicatorT24 != 'SUCCESS'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="proceso">
                  <con2:id>_ActionId-2610459578228753383-1aa70613.16ae5802f12.-7b1f</con2:id>
                  <con1:expr>
                    <con2:xqueryText>5</con2:xqueryText>
                  </con1:expr>
                </con1:assign>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="PagosWSTCParameters">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con1:assign varName="currencyType">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3df4</con2:id>
            <con1:expr>
              <con2:xqueryText>if($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text() = "HNL")then(
	1
)else if($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text() = "USD")then(
	2
)else()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="currency">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3df2</con2:id>
            <con1:expr>
              <con2:xqueryText>$body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/CURRENCY/text()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="sourceBank">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3dd5</con2:id>
            <con1:expr>
              <con2:xqueryText>$header/aut:RequestHeader/Region/SourceBank/text()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="destinationBank">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3db8</con2:id>
            <con1:expr>
              <con2:xqueryText>$header/aut:RequestHeader/Region/DestinationBank/text()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="userName">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3d9b</con2:id>
            <con1:expr>
              <con2:xqueryText>$header/aut:RequestHeader/Authentication/UserName/text()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="paymentAmount">
            <con2:id>_ActionId-8278516430081350894--5da8e40c.17c0a00fef5.-3d7e</con2:id>
            <con1:expr>
              <con2:xqueryText>$body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/AMOUNT/text()</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="cardNumber">
            <con2:id>_ActionId-4089100666458915325--118af25b.17c040ee44e.-5f98</con2:id>
            <con1:expr>
              <con2:xqueryText>string($body/tran:transferenciasACHRecibidas/TRANSACTION_DETAILS/TRANSACTION_DETAIL/DESTINATION/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
      <con:stage name="RegistrarPagosWSTC" errorHandler="_onErrorHandler-2169741114947710695-5d04c505.17e217c5f80.-7aa2">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/T24_P_APLICA_TC/" prefix="t241"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registraPagoTC" prefix="reg"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b02</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage = '' and $successIndicatorT24 = 'SUCCESS'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7afe</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/OSB/RegistrarTransaccionTCDB_v2/biz/RegistrarTransaccionTCDB_v2" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>registrarTransaccionTCDB</con1:operation>
                  <con1:request>
                    <con1:body>$REQregistrarTransaccionTCDB</con1:body>
                    <con1:header>$REQHregistrarTransaccionTCDB</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPregistrarTransaccionTCDB</con1:body>
                    <con1:header>RSPHregistrarTransaccionTCDB</con1:header>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQHregistrarTransaccionTCDB">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7aa5</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$header</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQregistrarTransaccionTCDB">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b01</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/registrarTransaccionTCDBIn"/>
                          <con2:param name="currencyType">
                            <con2:path>$currencyType</con2:path>
                          </con2:param>
                          <con2:param name="transactionCurrency">
                            <con2:path>$currency</con2:path>
                          </con2:param>
                          <con2:param name="destinationBank">
                            <con2:path>if($destinationBank = '')then(
	$sourceBank
)else(
	$destinationBank
)</con2:path>
                          </con2:param>
                          <con2:param name="cardNumber">
                            <con2:path>$cardNumber</con2:path>
                          </con2:param>
                          <con2:param name="exchangeRate">
                            <con2:path>''</con2:path>
                          </con2:param>
                          <con2:param name="org">
                            <con2:path>$org</con2:path>
                          </con2:param>
                          <con2:param name="validDate">
                            <con2:path>$validDate</con2:path>
                          </con2:param>
                          <con2:param name="referenceNumber">
                            <con2:path>$IDTXNT24</con2:path>
                          </con2:param>
                          <con2:param name="sourceBank">
                            <con2:path>$sourceBank</con2:path>
                          </con2:param>
                          <con2:param name="userName">
                            <con2:path>$userName</con2:path>
                          </con2:param>
                          <con2:param name="channelSequence">
                            <con2:path>''</con2:path>
                          </con2:param>
                          <con2:param name="paymentAmount">
                            <con2:path>$paymentAmount</con2:path>
                          </con2:param>
                          <con2:param name="merchantNumber">
                            <con2:path>$merchantNumber</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b00</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($RSPHregistrarTransaccionTCDB/aut:ResponseHeader/successIndicator/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessage">
                      <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7aff</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($RSPHregistrarTransaccionTCDB/aut:ResponseHeader/messages/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ValidaEstadoVasaErrorReversar" errorHandler="_onErrorHandler-8449774593363210483-74977004.16b6b0054a4.-76d9">
        <con:context>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/T24_P_APLICA_TC/" prefix="t24"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-3193859396475235595-d8155bc.16b2d4a82ae.-734f</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>($successIndicatorT24 = 'SUCCESS' and $validationMessage ='')</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-5307347117402605997-6046616f.16b43247201.-7e3d</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/SvcACHRecibido/biz/svcACHRecibido" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>ReversionACHRecibido</con1:operation>
                  <con1:request>
                    <con1:body>$REQReversionACHRecibido</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPReversionACHRecibido</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQReversionACHRecibido">
                      <con2:id>_ActionId-5307347117402605997-6046616f.16b43247201.-7dcd</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/reversionACHRecibidoIn"/>
                          <con2:param name="pxpErrorCode">
                            <con2:path>$errorCode</con2:path>
                          </con2:param>
                          <con2:param name="pxpResult">
                            <con2:path>$estadoProceso</con2:path>
                          </con2:param>
                          <con2:param name="transactionId">
                            <con2:path>fn:string($RSPRegistroACHRecibida/Status/transactionId/text())</con2:path>
                          </con2:param>
                          <con2:param name="requestHeader1">
                            <con2:path>$header/aut:RequestHeader</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="validacionReversionACHRecibido">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-74a2</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoReversionACHRecibido"/>
                          <con2:param name="messages">
                            <con2:path>if(fn:string-join($RSPReversionACHRecibido/Status/messages, ' ') = '') then(
	''
)else(
	fn:string-join($RSPReversionACHRecibido/Status/messages, '. ')
)</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>fn:upper-case(fn:string($RSPReversionACHRecibido/Status/successIndicator/text()))</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7485</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionReversionACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="validationMessageServiceT24">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7468</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionReversionACHRecibido/VALIDACION_MENSAJE/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-744b</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$errorCode</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-742e</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$validationMessage</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ValidaEstadoVasaErrorReversarConsulta" errorHandler="_onErrorHandler-8449774593363210483-74977004.16b6b0054a4.-7685">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-3193859396475235595-d8155bc.16b2d4a82ae.-7317</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage =''  and $successIndicatorT24 = 'SUCCESS'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-5307347117402605997-6046616f.16b43247201.-7e05</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/SvcACHRecibido/biz/svcACHRecibido" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>ConsultaRegistroACHRecibido</con1:operation>
                  <con1:request>
                    <con1:body>$REQConsultaRegistroACHRecibido</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPConsultaRegistroACHRecibido</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="proceso">
                      <con2:id>_ActionId-6809855940837178741--20441cc8.16bdc572230.-7f93</con2:id>
                      <con1:expr>
                        <con2:xqueryText>5</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="REQConsultaRegistroACHRecibido">
                      <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7559</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/consultaRegistroACHRecibidoIn"/>
                          <con2:param name="requestHeader1">
                            <con2:path>$header/aut:RequestHeader</con2:path>
                          </con2:param>
                          <con2:param name="transactionId">
                            <con2:path>fn:string($RSPReversionACHRecibido/Status/transactionId/text())</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="validacionConsultaRegistroACHRecibido">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-732c</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaPagoTC"/>
                          <con2:param name="txnStatus">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/TXNSTATUS/text()) = '') then(
	''
)else(
	fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/TXNSTATUS/text()))
)</con2:path>
                          </con2:param>
                          <con2:param name="messages">
                            <con2:path>if(fn:string-join($RSPConsultaRegistroACHRecibido/Status/messages, ' ') = '') then(
	''
)else(
	fn:string-join($RSPConsultaRegistroACHRecibido/Status/messages, '. ')
)</con2:path>
                          </con2:param>
                          <con2:param name="successIndicator">
                            <con2:path>fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/Status/successIndicator/text()))</con2:path>
                          </con2:param>
                          <con2:param name="idRejection">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDREJECTION/text()) = '') then(
	''
)else(
	fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDREJECTION/text())
)</con2:path>
                          </con2:param>
                          <con2:param name="zeroRecords">
                            <con2:path>if(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/ZERORECORDS/text()) = '') then(
	''
)else(
	fn:upper-case(fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/ZERORECORDS/text()))
)</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="estadoProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-72d7</con2:id>
                      <con1:expr>
                        <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codigoErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-72ba</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$codigoErrorProceso</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con1:assign varName="mensajeErrorProceso">
                      <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-729d</con2:id>
                      <con1:expr>
                        <con2:xqueryText>$mensajeErrorProceso</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="ActualizaRegistroACHRecibido" errorHandler="_onErrorHandler-6776779128661372419-641ada74.16b7567c1a3.-7f21">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registroNuevoACHRecibido" prefix="reg"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/actualizaRegistroACHCreditoT24" prefix="act"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-5435316606558602824--21d5e1c5.16b90896ea6.-7f38</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessageService = '' or $validationMessage =''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id>_ActionId-5435316606558602824--21d5e1c5.16b90896ea6.-7f34</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ACH/Recibido/ActualizaRegistroACHCreditoT24/biz/actualizaRegistroACHCreditoT24_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>actualizaRegistroACHCreditoT24</con1:operation>
                  <con1:request>
                    <con1:body>$REQActualizaRegistroACHCreditoT24</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>RSPActualizaRegistroACHCreditoT24</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="REQActualizaRegistroACHCreditoT24">
                      <con2:id>_ActionId-5435316606558602824--21d5e1c5.16b90896ea6.-7f35</con2:id>
                      <con1:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/actualizaRegistroACHCreditoT24In"/>
                          <con2:param name="achSecuencia">
                            <con2:path>$achSequence</con2:path>
                          </con2:param>
                          <con2:param name="mensajeErrorProceso">
                            <con2:path>if(fn:string($mensajeErrorProceso) ='')then(
    ''
)else(
	fn:substring($mensajeErrorProceso, 1, 500)
)</con2:path>
                          </con2:param>
                          <con2:param name="refTransaccionT24">
                            <con2:path>$IDTXNT24</con2:path>
                          </con2:param>
                          <con2:param name="refControlT24">
                            <con2:path>$refControlT24</con2:path>
                          </con2:param>
                          <con2:param name="idCliente">
                            <con2:path>if($customerId = '')then(

	xs:decimal(0)
	
)else(

	$customerId

)</con2:path>
                          </con2:param>
                          <con2:param name="estadoProceso">
                            <con2:path>$estadoProceso</con2:path>
                          </con2:param>
                          <con2:param name="codigoProceso">
                            <con2:path>xs:decimal($proceso)</con2:path>
                          </con2:param>
                          <con2:param name="codigoErrorProceso">
                            <con2:path>$codigoErrorProceso</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:assign varName="errorCode">
                      <con2:id>_ActionId-4089100666458915325--118af25b.17c040ee44e.-5f60</con2:id>
                      <con1:expr>
                        <con2:xqueryText>string($RSPActualizaRegistroACHCreditoT24/act:PV_SUCCESINDICATOR/text())</con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="PagoTC_response">
      <con:stage name="FlujoSalida">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse>
            <con2:id>_ActionId-8659886797973966094-40ebebe1.16b563e8101.-7fc9</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText>$validationMessage ='' and $successIndicatorT24 = 'SUCCESS'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace contents-only="true" varName="header">
                  <con2:id>_ActionId-8659886797973966094-40ebebe1.16b563e8101.-7f91</con2:id>
                  <con1:expr>
                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
    <successIndicator>{ $errorCode }</successIndicator>
    <transactionId>{ fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDTXNT24/text()) }</transactionId>
    <valueDate>{ fn:concat('20', fn:substring(fn:string($RSPRegistroACHRecibida/FICOHNACHONLINEType/gDATETIME/DATETIME/text()), 1, 6)) }</valueDate>
</aut:ResponseHeader>]]></con2:xqueryText>
                  </con1:expr>
                </con1:replace>
                <con1:replace contents-only="true" varName="body">
                  <con2:id>_ActionId-8659886797973966094-40ebebe1.16b563e8101.-7d98</con2:id>
                  <con1:expr>
                    <con2:xqueryTransform>
                      <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/transferenciaACHRecibidasOut"/>
                      <con2:param name="errorCode">
                        <con2:path>fn:string($header/aut:ResponseHeader/successIndicator/text())</con2:path>
                      </con2:param>
                      <con2:param name="valueDate">
                        <con2:path>fn:concat('20', fn:substring(fn:string($RSPRegistroACHRecibida/FICOHNACHONLINEType/gDATETIME/DATETIME/text()), 1, 6))</con2:path>
                      </con2:param>
                      <con2:param name="transferenciasACHRecibidas">
                        <con2:path>$body/tran:transferenciasACHRecibidas</con2:path>
                      </con2:param>
                      <con2:param name="errorMessage">
                        <con2:path>fn:string($header/aut:ResponseHeader/messages/text())</con2:path>
                      </con2:param>
                      <con2:param name="beneficiaryId">
                        <con2:path>fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/CUSTOMERID/text())</con2:path>
                      </con2:param>
                      <con2:param name="transactionId">
                        <con2:path>fn:string($RSPConsultaRegistroACHRecibido/WSACHINCOMINGCONFIRMType/gWSACHINCOMINGCONFIRMDetailType/mWSACHINCOMINGCONFIRMDetailType/IDTXNT24/text())</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:replace>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:replace contents-only="true" varName="header">
                <con2:id>_ActionId-8659886797973966094-40ebebe1.16b563e8101.-7f59</con2:id>
                <con1:expr>
                  <con2:xqueryText><![CDATA[<aut:ResponseHeader>
    <successIndicator>{ $errorCode }</successIndicator>
    <messages>{ $validationMessage }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                </con1:expr>
              </con1:replace>
              <con1:replace contents-only="true" varName="body">
                <con2:id>_ActionId-8659886797973966094-40ebebe1.16b563e8101.-7f3c</con2:id>
                <con1:expr>
                  <con2:xqueryText>&lt;tran:transferenciasACHRecibidasResponse/></con2:xqueryText>
                </con1:expr>
              </con1:replace>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-2610459578228753383-1aa70613.16ae5802f12.-7ae3">
      <con:stage name="ManejoError">
        <con:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/transferenciasACHRecibidasTypes" prefix="tran"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-3086365471015771609--2998599b.16b0e4ff7a5.-6f51</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($fault/ctx:errorCode/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorMessage">
            <con2:id>_ActionId-3086365471015771609--2998599b.16b0e4ff7a5.-6f34</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($fault/ctx:reason/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:replace contents-only="true" varName="header">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-720a</con2:id>
            <con1:expr>
              <con2:xqueryText><![CDATA[<aut:ResponseHeader>
    <successIndicator>{ $errorCode }</successIndicator>
    <messages>{ $errorMessage }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
            </con1:expr>
          </con1:replace>
          <con1:replace contents-only="true" varName="body">
            <con2:id>_ActionId-3086365471015771609--2998599b.16b0e4ff7a5.-6e6f</con2:id>
            <con1:expr>
              <con2:xqueryText>&lt;tran:transferenciasACHRecibidasResponse/></con2:xqueryText>
            </con1:expr>
          </con1:replace>
          <con2:reply>
            <con2:id>_ActionId-3086365471015771609--2998599b.16b0e4ff7a5.-6e52</con2:id>
          </con2:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-1198664836547443832--209b81e8.16b27de23a4.-7da6">
      <con:stage name="ManejoErrorRegistroACHRecibido">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionRegistroACHRecibida">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-78f2</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoRegistroACHRecibida"/>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
    if($faultString != "") then (
        $faultString
    ) else (
        string($fault/ctx:reason/text())
    )</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
    if($faultCode != "") then (
        $faultCode
    ) else (
        string($fault/ctx:errorCode/text())
    )</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-78d5</con2:id>
            <con1:expr>
              <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionRegistroACHRecibida/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionRegistroACHRecibida/ESTADO_PROCESO/text())

return
	if($estadoProceso = 'PENDING') then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-78b8</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionRegistroACHRecibida/VALIDACION_MENSAJE/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-6659357583103300107--413b72c2.16c0afe899e.-7dfb</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionRegistroACHRecibida/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-789b</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionRegistroACHRecibida/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-787e</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionRegistroACHRecibida/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-5485374114221718546-3a0c952b.16b2d477e70.-7eaa</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8856931896756827538--37456ddd.16b5157321a.-7f59">
      <con:stage name="ManejoErrorConsultaRegistroACHRecibido">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionConsultaRegistroACHRecibido">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-772e</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaRegistroACHRecibido"/>
                <con2:param name="txnStatus">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
if($faultString != "") then (
   $faultString
) else (
   string($fault/ctx:reason/text())
)</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
if($faultCode != "") then (
   $faultCode
) else (
   string($fault/ctx:errorCode/text())
)</con2:path>
                </con2:param>
                <con2:param name="idRejection">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="zeroRecords">
                  <con2:path>''</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7711</con2:id>
            <con1:expr>
              <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaRegistroACHRecibido/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())

return
	if($estadoProceso = 'PENDING') then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-76f4</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/VALIDACION_MENSAJE/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-6659357583103300107--413b72c2.16c0afe899e.-7d87</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-76d7</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-76ba</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="successIndicatorT24">
            <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-77eb</con2:id>
            <con1:expr>
              <con2:xqueryText>$estadoProceso</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-8856931896756827538--37456ddd.16b5157321a.-7dec</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8449774593363210483-74977004.16b6b0054a4.-76d9">
      <con:stage name="ManejoErrorValidaEstadoVasaErrorReversar">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionReversionACHRecibido">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-73f6</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoReversionACHRecibido"/>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
if($faultString != "") then (
   $faultString
) else (
   string($fault/ctx:reason/text())
)</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
if($faultCode != "") then (
   $faultCode
) else (
   string($fault/ctx:errorCode/text())
)</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-73d9</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionReversionACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessageServiceT24">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-73bc</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionReversionACHRecibido/VALIDACION_MENSAJE/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-739f</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionReversionACHRecibido/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7382</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:concat('T24 - Reversion ACH Recibido: ', fn:string($validacionReversionACHRecibido/MENSAJE_ERROR_PROCESO/text()), ' - ', 'Vasa - AplicaTCT24: ', $aplicaTCT24Message)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-8449774593363210483-74977004.16b6b0054a4.-7686</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8449774593363210483-74977004.16b6b0054a4.-7685">
      <con:stage name="ManejoErrorValidaEstadoVasaErrorReversarConsulta">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionConsultaRegistroACHRecibido">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-72f4</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaPagoTC"/>
                <con2:param name="txnStatus">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
if($faultString != "") then (
   $faultString
) else (
   string($fault/ctx:reason/text())
)</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
if($faultCode != "") then (
   $faultCode
) else (
   string($fault/ctx:errorCode/text())
)</con2:path>
                </con2:param>
                <con2:param name="idRejection">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="zeroRecords">
                  <con2:path>''</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7263</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7246</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-6546418901690141175--15de03f4.16bb7f81337.-7229</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaRegistroACHRecibido/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-8806483461432136182-52556c9e.16b8f09112c.-7c7d</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6776779128661372419-641ada74.16b7567c1a3.-7f21">
      <con:stage name="ManejoErrorActualizaRegistroACHRecibido">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="asuntoCorreo">
            <con2:id>_ActionId-6776779128661372419-641ada74.16b7567c1a3.-7f09</con2:id>
            <con1:expr>
              <con2:xqueryText>'Error realizando la actualizacion registro de ACH Enviado'</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeCorreo">
            <con2:id>_ActionId-6776779128661372419-641ada74.16b7567c1a3.-7ef3</con2:id>
            <con1:expr>
              <con2:xqueryText>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())
return
	if($faultString != "") then (
		fn:concat('Ocurrio un error al momento de realizar la actualizacion del registro en la base de datos en ACH Recibidos: ', fn:string($fault/ctx:errorCode/text()), ' ',$faultString)
	) else (
		fn:concat('Ocurrio un error al momento de realizar la actualizacion del registro en la base de datos en ACH Recibidos: ', fn:string($fault/ctx:errorCode/text()), ' ',fn:string($fault/ctx:reason/text()))
	)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con3:route>
            <con2:id>_ActionId-6776779128661372419-641ada74.16b7567c1a3.-7ee1</con2:id>
            <con3:service ref="Middleware/v2/BusinessServices/ITB/enviarCorreo/biz/enviarCorreo_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con3:operation>enviarCorreo</con3:operation>
            <con3:outboundTransform>
              <con1:replace contents-only="true" varName="body">
                <con2:id>_ActionId-6776779128661372419-641ada74.16b7567c1a3.-7eb9</con2:id>
                <con1:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="Middleware/v2/Resources/Genericos/enviarCorreoIn"/>
                    <con2:param name="asunto">
                      <con2:path>$asuntoCorreo</con2:path>
                    </con2:param>
                    <con2:param name="mensaje">
                      <con2:path>$mensajeCorreo</con2:path>
                    </con2:param>
                    <con2:param name="direccion">
                      <con2:path>$correo</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con1:expr>
              </con1:replace>
            </con3:outboundTransform>
          </con3:route>
          <con2:resume>
            <con2:id>_ActionId-6776779128661372419-641ada74.16b7567c1a3.-7e9e</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-8057391077676709090--f2f6334.16cc0ef6e3d.-7f58">
      <con:stage name="ManejoErrorRegistraNuevoACHRecibido">
        <con:context/>
        <con:actions>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-8057391077676709090--f2f6334.16cc0ef6e3d.-7f39</con2:id>
            <con1:expr>
              <con2:xqueryText>'ERROR'</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-8057391077676709090--f2f6334.16cc0ef6e3d.-7f20</con2:id>
            <con1:expr>
              <con2:xqueryText>'R31-Error del sistema'</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessageService">
            <con2:id>_ActionId-8057391077676709090--f2f6334.16cc0ef6e3d.-7f0b</con2:id>
            <con1:expr>
              <con2:xqueryText>$validationMessage</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-8057391077676709090--f2f6334.16cc0ef6e3d.-7ef0</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3938559305267874468-208a6455.172b98d0838.-7f3a">
      <con:stage name="ManejoError_ConsultaSaldosTarjetaCredito">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionConsultaSaldosTarjetaCredito">
            <con2:id>_ActionId-5770977433949198700--f56b78c.172c873dcd5.-7e94</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaSaldosTarjetaCredito"/>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
    if($faultString != "") then (
        $faultString
    ) else (
        string($fault/ctx:reason/text())
    )</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
    if($faultCode != "") then (
        $faultCode
    ) else (
        string($fault/ctx:errorCode/text())
    )</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7ecc</con2:id>
            <con1:expr>
              <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaSaldosTarjetaCredito/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaSaldosTarjetaCredito/ESTADO_PROCESO/text())

return
	if($estadoProceso = 'PENDING') then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7eaf</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/VALIDACION_MENSAJE/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7e5a</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7e3d</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7e20</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaSaldosTarjetaCredito/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-3938559305267874468-208a6455.172b98d0838.-7e77</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-2169741114947710695-5d04c505.17e217c5f80.-7b55">
      <con:stage name="ManejoError_ConsultaDatosTarjetaCredito">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
        </con:context>
        <con:actions>
          <con1:assign varName="validacionConsultaDatosTarjetaCredito">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b4e</con2:id>
            <con1:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/v2/Resources/TransferenciasACHRecibidas/xq/estadoProcesoConsultaDatosTarjetaCredito"/>
                <con2:param name="cardStatus">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="messages">
                  <con2:path>let $faultString := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text())

return
    if($faultString != "") then (
        $faultString
    ) else (
        string($fault/ctx:reason/text())
    )</con2:path>
                </con2:param>
                <con2:param name="successIndicator">
                  <con2:path>let $faultCode := string($fault/ctx:details/con1:ReceivedFaultDetail/con1:faultcode/text())

return
    if($faultCode != "") then (
        $faultCode
    ) else (
        string($fault/ctx:errorCode/text())
    )</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b4d</con2:id>
            <con1:expr>
              <con2:xqueryText>let $codigoErrorProceso := fn:string($validacionConsultaDatosTarjetaCredito/CODIGO_ERROR_PROCESO/text())
let $estadoProceso := fn:string($validacionConsultaDatosTarjetaCredito/ESTADO_PROCESO/text())

return
	if($estadoProceso = 'PENDING') then(
		$estadoProceso
	)else(
		$codigoErrorProceso
	)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b4c</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/VALIDACION_MENSAJE/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="estadoProceso">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b4b</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/ESTADO_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="codigoErrorProceso">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b4a</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/CODIGO_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="mensajeErrorProceso">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7b49</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($validacionConsultaDatosTarjetaCredito/MENSAJE_ERROR_PROCESO/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-2169741114947710695-5d04c505.17e217c5f80.-7aa2">
      <con:stage name="validacionRegistrarPagoWSTC ">
        <con:context>
          <con2:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registraPagoTC" prefix="reg"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
        </con:context>
        <con:actions>
          <con1:assign varName="errorCode">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7a65</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($RSPHregistrarTransaccionTCDB/aut:ResponseHeader/successIndicator/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="validationMessage">
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7a64</con2:id>
            <con1:expr>
              <con2:xqueryText>fn:string($RSPHregistrarTransaccionTCDB/aut:ResponseHeader/messages/text())</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con2:resume>
            <con2:id>_ActionId-2169741114947710695-5d04c505.17e217c5f80.-7a63</con2:id>
          </con2:resume>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:flow>
      <con:pipeline-node name="PagoTC">
        <con:request>PagoTC_request</con:request>
        <con:response>PagoTC_response</con:response>
      </con:pipeline-node>
    </con:flow>
  </ser:router>
</xml-fragment>