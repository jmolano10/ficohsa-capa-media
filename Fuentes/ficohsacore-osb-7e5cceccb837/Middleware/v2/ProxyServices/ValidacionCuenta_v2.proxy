<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false">
    <ser:security>
      <con:custom-token-authentication xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
        <con:username-password>
          <con:username-selector>
            <con:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:AutenticacionRequestHeader/UserName/text()</con:xpath>
            <con:variable>header</con:variable>
          </con:username-selector>
          <con:password-selector>
            <con:xpath>declare namespace aut='http://www.ficohsa.com.hn/middleware.services/autType';
./aut:AutenticacionRequestHeader/Password/text()</con:xpath>
            <con:variable>header</con:variable>
          </con:password-selector>
        </con:username-password>
      </con:custom-token-authentication>
    </ser:security>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con4:SoapBindingType" xmlns:con4="http://www.bea.com/wli/sb/services/bindings/config">
      <con4:wsdl ref="Middleware/Business_Resources/validacionCuenta/ValidacionCuenta/validacionCuentaPS"/>
      <con4:port>
        <con4:name>validacionCuentaPSSOAP</con4:name>
        <con4:namespace>http://www.ficohsa.com.hn/middleware.services/validacionCuentaPS/</con4:namespace>
      </con4:port>
      <con4:selector type="SOAP body"/>
      <con4:WSI-compliant>false</con4:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/Middleware/OperationsAndExecution/CalculationServices/ValidacionCuenta_v2</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-8978621965144933415-63d099ef.1400bdf707f.-7f44">
    <con1:pipeline type="error" name="_onErrorHandler-8978621965144933415-63d099ef.1400bdf707f.-7f44">
      <con1:stage name="stage1">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
        </con1:context>
        <con1:actions>
          <con3:assign varName="errorCode">
            <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7f36</con2:id>
            <con3:expr>
              <con2:xqueryText>fn:string($fault/ctx:errorCode/text())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:assign varName="errorMessage">
            <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7f19</con2:id>
            <con3:expr>
              <con2:xqueryText>fn:string($fault/ctx:reason/text())</con2:xqueryText>
            </con3:expr>
          </con3:assign>
          <con3:wsCallout>
            <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7ea2</con2:id>
            <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con3:operation>mapeoErrores</con3:operation>
            <con3:request>
              <con3:body>$rqMapeoErrores</con3:body>
            </con3:request>
            <con3:response>
              <con3:body>rpMapeoErrores</con3:body>
            </con3:response>
            <con3:requestTransform>
              <con3:assign varName="rqMapeoErrores">
                <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7ea4</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                    <con2:param name="CODIGO_ERROR">
                      <con2:path>$errorCode</con2:path>
                    </con2:param>
                    <con2:param name="MENSAJE_ERROR">
                      <con2:path>$errorMessage</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:assign>
            </con3:requestTransform>
            <con3:responseTransform>
              <con3:replace contents-only="true" varName="header">
                <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7ea3</con2:id>
                <con3:expr>
                  <con2:xqueryTransform>
                    <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                    <con2:param name="mapeoErroresResponse1">
                      <con2:path>$rpMapeoErrores</con2:path>
                    </con2:param>
                    <con2:param name="successIndicator">
                      <con2:path>$errorCode</con2:path>
                    </con2:param>
                  </con2:xqueryTransform>
                </con3:expr>
              </con3:replace>
            </con3:responseTransform>
          </con3:wsCallout>
          <con3:replace contents-only="true" varName="body">
            <con2:id>_ActionId-8978621965144933415-63d099ef.1400bdf707f.-7ed6</con2:id>
            <con3:expr>
              <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
            </con3:expr>
          </con3:replace>
          <con2:reply>
            <con2:id>_ActionId-8978621965144933415-63d099ef.1400bdf707f.-7e9c</con2:id>
          </con2:reply>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="request" name="PipelinePairNode1_request">
      <con1:stage name="stage1">
        <con1:context>
          <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCuentaEquivalente" prefix="con"/>
          <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb2"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultasType" prefix="con1"/>
          <con2:varNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
          <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
          <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaMapeoCuentaT24Citi" prefix="con2"/>
        </con1:context>
        <con1:actions>
          <con3:assign varName="validationMessage">
            <con2:id>_ActionId-5617238416689377426-3e91c78d.14012c1fd40.-7f8c</con2:id>
            <con3:expr>
              <con2:xqueryTransform>
                <con2:resource ref="Middleware/Business_Resources/validacionCuenta/ValidacionCuenta/validacionCuentaValidate"/>
                <con2:param name="validacionCuenta">
                  <con2:path>$body/val:validacionCuenta</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con3:expr>
          </con3:assign>
          <con3:ifThenElse>
            <con2:id>_ActionId-5617238416689377426-3e91c78d.14012c1fd40.-7f6f</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:assign varName="accountFound">
                  <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-729a</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountNameFound">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-74ae</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountCurrencyFound">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7474</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountPostingRestrictFound">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7491</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountInactiveMarkerFound">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64dc</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountCancelled">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7261</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:wsCallout>
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7c33</con2:id>
                  <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                  <con3:request>
                    <con3:body>$ReqConsPorcentajeLev</con3:body>
                  </con3:request>
                  <con3:response>
                    <con3:body>RspConsPorcentajeLev</con3:body>
                  </con3:response>
                  <con3:requestTransform>
                    <con3:assign varName="ReqConsPorcentajeLev">
                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7bc4</con2:id>
                      <con3:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinIn"/>
                          <con2:param name="autenticacionRequestHeader1">
                            <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con3:expr>
                    </con3:assign>
                  </con3:requestTransform>
                  <con3:responseTransform>
                    <con3:assign varName="PorcentajeLevenstein">
                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7b55</con2:id>
                      <con3:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinOut"/>
                          <con2:param name="outputParameters1">
                            <con2:path>$RspConsPorcentajeLev</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con3:expr>
                    </con3:assign>
                  </con3:responseTransform>
                </con3:wsCallout>
                <con3:assign varName="errorMessage">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-68e9</con2:id>
                  <con3:expr>
                    <con2:xqueryText>"false"</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountNumberInput">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6e9b</con2:id>
                  <con3:expr>
                    <con2:xqueryText>data($body/val:validacionCuenta/ACCOUNT_NUMBER)</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="checkCancelledInput">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6e99</con2:id>
                  <con3:expr>
                    <con2:xqueryText>data($body/val:validacionCuenta/CHECK_CANCELLED_YES_NO)</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:assign varName="accountNameInput">
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6e97</con2:id>
                  <con3:expr>
                    <con2:xqueryText>data($body/val:validacionCuenta/ACCOUNT_NAME)</con2:xqueryText>
                  </con3:expr>
                </con3:assign>
                <con3:ifThenElse>
                  <con2:id>_ActionId-4622942435621005335--a1316ed.14735f9a269.-7e95</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>1 = 1</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-6f58</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerGuiones(java.lang.String)</con3:method>
                        <con3:expr>
                          <con2:xqueryText>$accountNumberInput</con2:xqueryText>
                        </con3:expr>
                      </con3:javaCallout>
                      <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7a29</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerCerosIzquierda(java.lang.String)</con3:method>
                        <con3:expr>
                          <con2:xqueryText>$accountNumber</con2:xqueryText>
                        </con3:expr>
                      </con3:javaCallout>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7f02</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>fn:string-length($accountNumber) > 6</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:assign varName="abksAccountNumber">
                              <con2:id>_ActionId-8211930521877768350-29367dc.15232a51cd2.-7fc1</con2:id>
                              <con3:expr>
                                <con2:xqueryText>$accountNumber</con2:xqueryText>
                              </con3:expr>
                            </con3:assign>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:assign varName="abksAccountNumber">
                            <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7ec6</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:concat("00",$accountNumber)</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:default>
                      </con3:ifThenElse>
                      <con3:wsCallout>
                        <con2:id>_ActionId-8211930521877768350-29367dc.15232a51cd2.-7fbd</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/EvaluaCuentaAbanks/biz/EvaluaCuentaAbanks" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>EvaluaCuentaAbanks</con3:operation>
                        <con3:request>
                          <con3:body>$ReqEvalCuentaAbanks</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>RspEvalCuentaAbanks</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="ReqEvalCuentaAbanks">
                            <con2:id>_ActionId-8211930521877768350-29367dc.15232a51cd2.-7fbe</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/EvaluarCuentaAbanksIn"/>
                                <con2:param name="accountNumber">
                                  <con2:path>$abksAccountNumber</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform/>
                      </con3:wsCallout>
                      <con3:javaCallout varName="mod11Response">
                        <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7963</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static boolean DigitoVerificadorMod11(java.lang.String)</con3:method>
                        <con3:expr>
                          <con2:xqueryText>$accountNumber</con2:xqueryText>
                        </con3:expr>
                      </con3:javaCallout>
                      <con3:assign varName="xmlForEach">
                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6cf1</con2:id>
                        <con3:expr>
                          <con2:xqueryText><![CDATA[<body>
	<parent>
		<item>1</item>
		<item>2</item>
		<item>3</item>
	</parent>
</body>]]></con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:assign varName="successIndicatorForEach">
                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6bf8</con2:id>
                        <con3:expr>
                          <con2:xqueryText>""</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:wsCallout>
                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6343</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>obtenerParametrizacion</con3:operation>
                        <con3:request>
                          <con3:body>$ReqObtParam</con3:body>
                        </con3:request>
                        <con3:response>
                          <con3:body>RspObtParam</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                          <con3:assign varName="ReqObtParam">
                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-630b</con2:id>
                            <con3:expr>
                              <con2:xqueryTransform>
                                <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                <con2:param name="nombreParametros">
                                  <con2:path>"VALIDACIONCUENTA.DELAYTIME"</con2:path>
                                </con2:param>
                              </con2:xqueryTransform>
                            </con3:expr>
                          </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                          <con3:assign varName="delayTime">
                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-62d3</con2:id>
                            <con3:expr>
                              <con2:xqueryText>fn:string($RspObtParam/osb2:CONFIGURACIONES/osb2:CONFIGURACIONES_ITEM[osb2:NAME="VALIDACIONCUENTA.DELAYTIME"]/osb2:VALUE/text())</con2:xqueryText>
                            </con3:expr>
                          </con3:assign>
                        </con3:responseTransform>
                      </con3:wsCallout>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7946</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>$mod11Response = 'true'</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:foreach>
                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6d17</con2:id>
                              <con3:variable>xmlForEach</con3:variable>
                              <con3:expression>
                                <con2:xpathText>./parent/item</con2:xpathText>
                              </con3:expression>
                              <con3:value-variable>item</con3:value-variable>
                              <con3:index-variable>itemIndex</con3:index-variable>
                              <con3:total-variable>itemCount</con3:total-variable>
                              <con3:actions>
                                <con3:ifThenElse>
                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c5b</con2:id>
                                  <con3:case>
                                    <con3:condition>
                                      <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions/>
                                  </con3:case>
                                  <con3:default>
                                    <con3:ifThenElse>
                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-629b</con2:id>
                                      <con3:case>
                                        <con3:condition>
                                          <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                          <con3:javaCallout varName="">
                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6263</con2:id>
                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                            <con3:method>public static void sleep(int)</con3:method>
                                            <con3:expr>
                                              <con2:xqueryText>$delayTime</con2:xqueryText>
                                            </con3:expr>
                                          </con3:javaCallout>
                                        </con3:actions>
                                      </con3:case>
                                      <con3:default/>
                                    </con3:ifThenElse>
                                    <con3:wsCallout>
                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c47</con2:id>
                                      <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                      <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                      <con3:request>
                                        <con3:body>$REQDetallesCuenta</con3:body>
                                      </con3:request>
                                      <con3:response>
                                        <con3:body>RSPDetallesCuenta</con3:body>
                                      </con3:response>
                                      <con3:requestTransform>
                                        <con3:assign varName="REQDetallesCuenta">
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c4b</con2:id>
                                          <con3:expr>
                                            <con2:xqueryTransform>
                                              <con2:resource ref="Middleware/Business_Resources/validacionCuenta/ConsultaCuentaEquivalente/ConsultaDetallesCuentaIn"/>
                                              <con2:param name="accountNumber">
                                                <con2:path>$accountNumber</con2:path>
                                              </con2:param>
                                              <con2:param name="autenticacionRequestHeader1">
                                                <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                              </con2:param>
                                            </con2:xqueryTransform>
                                          </con3:expr>
                                        </con3:assign>
                                      </con3:requestTransform>
                                      <con3:responseTransform>
                                        <con3:assign varName="DetallesCuentasSuccessIndicator">
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c4a</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="accountNameResponse">
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c49</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="zeroRecords">
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6c48</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="successIndicatorForEach">
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6bbd</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                      </con3:responseTransform>
                                    </con3:wsCallout>
                                  </con3:default>
                                </con3:ifThenElse>
                              </con3:actions>
                            </con3:foreach>
                            <con3:ifThenElse>
                              <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7777</con2:id>
                              <con3:case>
                                <con3:condition>
                                  <con2:xqueryText>$DetallesCuentasSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                </con3:condition>
                                <con3:actions>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7707</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:javaCallout varName="levensteinDistance">
                                          <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7705</con2:id>
                                          <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                          <con3:className>ficohsa.utilities.Utilities</con3:className>
                                          <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                          <con3:expr>
                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                          </con3:expr>
                                          <con3:expr>
                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                          </con3:expr>
                                        </con3:javaCallout>
                                        <con3:ifThenElse>
                                          <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7d64</con2:id>
                                          <con3:case>
                                            <con3:condition>
                                              <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                            </con3:condition>
                                            <con3:actions>
                                              <con3:assign varName="accountFound">
                                                <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7d63</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountNameFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7834</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountCurrencyFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-77de</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountPostingRestrictFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-77a4</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountInactiveMarkerFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-66a4</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                            </con3:actions>
                                          </con3:case>
                                          <con3:default>
                                            <con3:assign varName="errorMessage">
                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6e5f</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                          </con3:default>
                                        </con3:ifThenElse>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:assign varName="accountFound">
                                        <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e5b</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:assign varName="accountNameFound">
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7782</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:assign varName="accountCurrencyFound">
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7781</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:assign varName="accountPostingRestrictFound">
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7780</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:assign varName="accountInactiveMarkerFound">
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-664f</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:actions>
                              </con3:case>
                              <con3:default>
                                <con3:ifThenElse>
                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7dc9</con2:id>
                                  <con3:case>
                                    <con3:condition>
                                      <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                      <con3:assign varName="successIndicatorForEach">
                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6ad5</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>""</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:foreach>
                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6ba3</con2:id>
                                        <con3:variable>xmlForEach</con3:variable>
                                        <con3:expression>
                                          <con2:xpathText>./parent/item</con2:xpathText>
                                        </con3:expression>
                                        <con3:value-variable>item</con3:value-variable>
                                        <con3:index-variable>itemIndex</con3:index-variable>
                                        <con3:total-variable>itemCount</con3:total-variable>
                                        <con3:actions>
                                          <con3:ifThenElse>
                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a51</con2:id>
                                            <con3:case>
                                              <con3:condition>
                                                <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                              </con3:condition>
                                              <con3:actions/>
                                            </con3:case>
                                            <con3:default>
                                              <con3:ifThenElse>
                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-61ba</con2:id>
                                                <con3:case>
                                                  <con3:condition>
                                                    <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                                  </con3:condition>
                                                  <con3:actions>
                                                    <con3:javaCallout varName="">
                                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-61b9</con2:id>
                                                      <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                      <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                      <con3:method>public static void sleep(int)</con3:method>
                                                      <con3:expr>
                                                        <con2:xqueryText>$delayTime</con2:xqueryText>
                                                      </con3:expr>
                                                    </con3:javaCallout>
                                                  </con3:actions>
                                                </con3:case>
                                                <con3:default/>
                                              </con3:ifThenElse>
                                              <con3:wsCallout>
                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a45</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                <con3:request>
                                                  <con3:body>$ReqCuentaCancelada</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                  <con3:body>RspCuentaCancelada</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                  <con3:assign varName="ReqCuentaCancelada">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a4a</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/consultaCuentaCanceladaIn"/>
                                                        <con2:param name="account">
                                                          <con2:path>$accountNumber</con2:path>
                                                        </con2:param>
                                                        <con2:param name="autenticacionRequestHeader1">
                                                          <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                        </con2:param>
                                                      </con2:xqueryTransform>
                                                    </con3:expr>
                                                  </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                  <con3:assign varName="CuentaCanceladaSuccessIndicator">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a49</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                  <con3:assign varName="successIndicatorForEach">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a48</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                  <con3:assign varName="zeroRecords">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a47</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                  <con3:assign varName="accountNameResponse">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a46</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                </con3:responseTransform>
                                              </con3:wsCallout>
                                            </con3:default>
                                          </con3:ifThenElse>
                                        </con3:actions>
                                      </con3:foreach>
                                      <con3:ifThenElse>
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7ccd</con2:id>
                                        <con3:case>
                                          <con3:condition>
                                            <con2:xqueryText>$CuentaCanceladaSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                          </con3:condition>
                                          <con3:actions>
                                            <con3:ifThenElse>
                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7ccc</con2:id>
                                              <con3:case>
                                                <con3:condition>
                                                  <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                  <con3:javaCallout varName="levensteinDistance">
                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7ccb</con2:id>
                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                    <con3:expr>
                                                      <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                    </con3:expr>
                                                    <con3:expr>
                                                      <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:javaCallout>
                                                  <con3:ifThenElse>
                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7cca</con2:id>
                                                    <con3:case>
                                                      <con3:condition>
                                                        <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                      </con3:condition>
                                                      <con3:actions>
                                                        <con3:assign varName="accountFound">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7cc9</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="accountNameFound">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7aa7</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="accountCancelled">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-719b</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                      </con3:actions>
                                                    </con3:case>
                                                    <con3:default>
                                                      <con3:assign varName="errorMessage">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6d63</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                    </con3:default>
                                                  </con3:ifThenElse>
                                                </con3:actions>
                                              </con3:case>
                                              <con3:default>
                                                <con3:assign varName="accountFound">
                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7cc8</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="accountNameFound">
                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-79d9</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="accountCancelled">
                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-70d0</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                              </con3:default>
                                            </con3:ifThenElse>
                                          </con3:actions>
                                        </con3:case>
                                        <con3:default>
                                          <con3:assign varName="errorMessage">
                                            <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6db7</con2:id>
                                            <con3:expr>
                                              <con2:xqueryText>"Cumple mod 11 pero no se encontró información de la cuenta."</con2:xqueryText>
                                            </con3:expr>
                                          </con3:assign>
                                        </con3:default>
                                      </con3:ifThenElse>
                                    </con3:actions>
                                  </con3:case>
                                  <con3:default>
                                    <con3:assign varName="errorMessage">
                                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6e0b</con2:id>
                                      <con3:expr>
                                        <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                      </con3:expr>
                                    </con3:assign>
                                  </con3:default>
                                </con3:ifThenElse>
                              </con3:default>
                            </con3:ifThenElse>
                            <con3:ifThenElse>
                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a47</con2:id>
                              <con3:case>
                                <con3:condition>
                                  <con2:xqueryText>$accountFound = 'false'</con2:xqueryText>
                                </con3:condition>
                                <con3:actions>
                                  <con3:foreach>
                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a1e</con2:id>
                                    <con3:variable>RspEvalCuentaAbanks</con3:variable>
                                    <con3:expression>
                                      <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>account</con3:value-variable>
                                    <con3:index-variable>index</con3:index-variable>
                                    <con3:total-variable>count</con3:total-variable>
                                    <con3:actions>
                                      <con3:assign varName="mod10Indicator">
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a46</con2:id>
                                        <con3:expr>
                                          <con2:xqueryTransform>
                                            <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/mod10IndicatorIn"/>
                                            <con2:param name="ResponseEvaluaCuentaAbanks">
                                              <con2:path>$RspEvalCuentaAbanks</con2:path>
                                            </con2:param>
                                            <con2:param name="index">
                                              <con2:path>$index</con2:path>
                                            </con2:param>
                                          </con2:xqueryTransform>
                                        </con3:expr>
                                      </con3:assign>
                                      <con3:ifThenElse>
                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a45</con2:id>
                                        <con3:case>
                                          <con3:condition>
                                            <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                          </con3:condition>
                                          <con3:actions>
                                            <con3:assign varName="successIndicatorForEach">
                                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6979</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>""</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                            <con3:foreach>
                                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6a1b</con2:id>
                                              <con3:variable>xmlForEach</con3:variable>
                                              <con3:expression>
                                                <con2:xpathText>./parent/item</con2:xpathText>
                                              </con3:expression>
                                              <con3:value-variable>item</con3:value-variable>
                                              <con3:index-variable>itemIndex</con3:index-variable>
                                              <con3:total-variable>itemCount</con3:total-variable>
                                              <con3:actions>
                                                <con3:ifThenElse>
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69d9</con2:id>
                                                  <con3:case>
                                                    <con3:condition>
                                                      <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions/>
                                                  </con3:case>
                                                  <con3:default>
                                                    <con3:ifThenElse>
                                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6180</con2:id>
                                                      <con3:case>
                                                        <con3:condition>
                                                          <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                          <con3:javaCallout varName="">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-617f</con2:id>
                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                            <con3:method>public static void sleep(int)</con3:method>
                                                            <con3:expr>
                                                              <con2:xqueryText>$delayTime</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:javaCallout>
                                                        </con3:actions>
                                                      </con3:case>
                                                      <con3:default/>
                                                    </con3:ifThenElse>
                                                    <con3:wsCallout>
                                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69cf</con2:id>
                                                      <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                      <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                                      <con3:request>
                                                        <con3:body>$REQDetallesCuenta</con3:body>
                                                      </con3:request>
                                                      <con3:response>
                                                        <con3:body>RSPDetallesCuenta</con3:body>
                                                      </con3:response>
                                                      <con3:requestTransform>
                                                        <con3:assign varName="REQDetallesCuenta">
                                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69d3</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryTransform>
                                                              <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaCuentaForEachIn"/>
                                                              <con2:param name="index">
                                                                <con2:path>$index</con2:path>
                                                              </con2:param>
                                                              <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                              </con2:param>
                                                              <con2:param name="autenticacionRequestHeader1">
                                                                <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                              </con2:param>
                                                            </con2:xqueryTransform>
                                                          </con3:expr>
                                                        </con3:assign>
                                                      </con3:requestTransform>
                                                      <con3:responseTransform>
                                                        <con3:assign varName="DetallesCuentasSuccessIndicator">
                                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69d2</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="successIndicatorForEach">
                                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6940</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="accountNameResponse">
                                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69d1</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="zeroRecords">
                                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-69d0</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                      </con3:responseTransform>
                                                    </con3:wsCallout>
                                                  </con3:default>
                                                </con3:ifThenElse>
                                              </con3:actions>
                                            </con3:foreach>
                                            <con3:ifThenElse>
                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3f</con2:id>
                                              <con3:case>
                                                <con3:condition>
                                                  <con2:xqueryText>$DetallesCuentasSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                  <con3:ifThenElse>
                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3e</con2:id>
                                                    <con3:case>
                                                      <con3:condition>
                                                        <con2:xqueryText>fn:string-length(data($body/val:validacionCuenta/ACCOUNT_NAME)) > 0</con2:xqueryText>
                                                      </con3:condition>
                                                      <con3:actions>
                                                        <con3:javaCallout varName="levensteinDistance">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3d</con2:id>
                                                          <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                          <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                          <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                          <con3:expr>
                                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                          </con3:expr>
                                                          <con3:expr>
                                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:javaCallout>
                                                        <con3:ifThenElse>
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3c</con2:id>
                                                          <con3:case>
                                                            <con3:condition>
                                                              <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                              <con3:assign varName="accountFound">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3b</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                              <con3:assign varName="accountNameFound">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a3a</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                              <con3:assign varName="accountCurrencyFound">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a39</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                              <con3:assign varName="accountPostingRestrictFound">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a38</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                              <con3:assign varName="accountInactiveMarkerFound">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6550</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                            </con3:actions>
                                                          </con3:case>
                                                          <con3:default>
                                                            <con3:assign varName="errorMessage">
                                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a37</con2:id>
                                                              <con3:expr>
                                                                <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                              </con3:expr>
                                                            </con3:assign>
                                                          </con3:default>
                                                        </con3:ifThenElse>
                                                      </con3:actions>
                                                    </con3:case>
                                                    <con3:default>
                                                      <con3:assign varName="accountFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a36</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountNameFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a35</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountCurrencyFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a34</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountPostingRestrictFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a33</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountInactiveMarkerFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6552</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                    </con3:default>
                                                  </con3:ifThenElse>
                                                </con3:actions>
                                              </con3:case>
                                              <con3:default>
                                                <con3:ifThenElse>
                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a32</con2:id>
                                                  <con3:case>
                                                    <con3:condition>
                                                      <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                      <con3:assign varName="successIndicatorForEach">
                                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6885</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>""</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:foreach>
                                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6917</con2:id>
                                                        <con3:variable>xmlForEach</con3:variable>
                                                        <con3:expression>
                                                          <con2:xpathText>./parent/item</con2:xpathText>
                                                        </con3:expression>
                                                        <con3:value-variable>item</con3:value-variable>
                                                        <con3:index-variable>itemIndex</con3:index-variable>
                                                        <con3:total-variable>itemCount</con3:total-variable>
                                                        <con3:actions>
                                                          <con3:ifThenElse>
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68e5</con2:id>
                                                            <con3:case>
                                                              <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                                              </con3:condition>
                                                              <con3:actions/>
                                                            </con3:case>
                                                            <con3:default>
                                                              <con3:ifThenElse>
                                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6146</con2:id>
                                                                <con3:case>
                                                                  <con3:condition>
                                                                    <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                                                  </con3:condition>
                                                                  <con3:actions>
                                                                    <con3:javaCallout varName="">
                                                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6145</con2:id>
                                                                      <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                      <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                      <con3:method>public static void sleep(int)</con3:method>
                                                                      <con3:expr>
                                                                        <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                      </con3:expr>
                                                                    </con3:javaCallout>
                                                                  </con3:actions>
                                                                </con3:case>
                                                                <con3:default/>
                                                              </con3:ifThenElse>
                                                              <con3:wsCallout>
                                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68db</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                <con3:request>
                                                                  <con3:body>$ReqCuentaCancelada</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                  <con3:body>RspCuentaCancelada</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                  <con3:assign varName="ReqCuentaCancelada">
                                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68df</con2:id>
                                                                    <con3:expr>
                                                                      <con2:xqueryTransform>
                                                                        <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaCuentaCanceladaForEachIn"/>
                                                                        <con2:param name="index">
                                                                          <con2:path>$index</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                          <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="autenticacionRequestHeader1">
                                                                          <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                                        </con2:param>
                                                                      </con2:xqueryTransform>
                                                                    </con3:expr>
                                                                  </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                  <con3:assign varName="CuentaCanceladaSuccessIndicator">
                                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68de</con2:id>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                                    </con3:expr>
                                                                  </con3:assign>
                                                                  <con3:assign varName="successIndicatorForEach">
                                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-684c</con2:id>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                                    </con3:expr>
                                                                  </con3:assign>
                                                                  <con3:assign varName="zeroRecords">
                                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68dd</con2:id>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                    </con3:expr>
                                                                  </con3:assign>
                                                                  <con3:assign varName="accountNameResponse">
                                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-68dc</con2:id>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                                    </con3:expr>
                                                                  </con3:assign>
                                                                </con3:responseTransform>
                                                              </con3:wsCallout>
                                                            </con3:default>
                                                          </con3:ifThenElse>
                                                        </con3:actions>
                                                      </con3:foreach>
                                                      <con3:ifThenElse>
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a2c</con2:id>
                                                        <con3:case>
                                                          <con3:condition>
                                                            <con2:xqueryText>$CuentaCanceladaSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                                          </con3:condition>
                                                          <con3:actions>
                                                            <con3:ifThenElse>
                                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a2b</con2:id>
                                                              <con3:case>
                                                                <con3:condition>
                                                                  <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                  <con3:javaCallout varName="levensteinDistance">
                                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a2a</con2:id>
                                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                    </con3:expr>
                                                                    <con3:expr>
                                                                      <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                    </con3:expr>
                                                                  </con3:javaCallout>
                                                                  <con3:ifThenElse>
                                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a29</con2:id>
                                                                    <con3:case>
                                                                      <con3:condition>
                                                                        <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                      </con3:condition>
                                                                      <con3:actions>
                                                                        <con3:assign varName="accountFound">
                                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a28</con2:id>
                                                                          <con3:expr>
                                                                            <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                          </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="accountNameFound">
                                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a27</con2:id>
                                                                          <con3:expr>
                                                                            <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                                          </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="accountCancelled">
                                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a26</con2:id>
                                                                          <con3:expr>
                                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                                          </con3:expr>
                                                                        </con3:assign>
                                                                      </con3:actions>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                      <con3:assign varName="errorMessage">
                                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a25</con2:id>
                                                                        <con3:expr>
                                                                          <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                                        </con3:expr>
                                                                      </con3:assign>
                                                                    </con3:default>
                                                                  </con3:ifThenElse>
                                                                </con3:actions>
                                                              </con3:case>
                                                              <con3:default>
                                                                <con3:assign varName="accountFound">
                                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a24</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountNameFound">
                                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a23</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountCancelled">
                                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a22</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                              </con3:default>
                                                            </con3:ifThenElse>
                                                          </con3:actions>
                                                        </con3:case>
                                                        <con3:default>
                                                          <con3:assign varName="errorMessage">
                                                            <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a21</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryText>"Cumple mod 10 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:assign>
                                                        </con3:default>
                                                      </con3:ifThenElse>
                                                    </con3:actions>
                                                  </con3:case>
                                                  <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a20</con2:id>
                                                      <con3:expr>
                                                        <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                                      </con3:expr>
                                                    </con3:assign>
                                                  </con3:default>
                                                </con3:ifThenElse>
                                              </con3:default>
                                            </con3:ifThenElse>
                                          </con3:actions>
                                        </con3:case>
                                        <con3:default>
                                          <con3:assign varName="errorMessage">
                                            <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a1f</con2:id>
                                            <con3:expr>
                                              <con2:xqueryText>"No cumplió mod 10 ni mod 11."</con2:xqueryText>
                                            </con3:expr>
                                          </con3:assign>
                                        </con3:default>
                                      </con3:ifThenElse>
                                    </con3:actions>
                                  </con3:foreach>
                                </con3:actions>
                              </con3:case>
                              <con3:default/>
                            </con3:ifThenElse>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:foreach>
                            <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7626</con2:id>
                            <con3:variable>RspEvalCuentaAbanks</con3:variable>
                            <con3:expression>
                              <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                            </con3:expression>
                            <con3:value-variable>account</con3:value-variable>
                            <con3:index-variable>index</con3:index-variable>
                            <con3:total-variable>count</con3:total-variable>
                            <con3:actions>
                              <con3:assign varName="mod10Indicator">
                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7fe2</con2:id>
                                <con3:expr>
                                  <con2:xqueryTransform>
                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/mod10IndicatorIn"/>
                                    <con2:param name="ResponseEvaluaCuentaAbanks">
                                      <con2:path>$RspEvalCuentaAbanks</con2:path>
                                    </con2:param>
                                    <con2:param name="index">
                                      <con2:path>$index</con2:path>
                                    </con2:param>
                                  </con2:xqueryTransform>
                                </con3:expr>
                              </con3:assign>
                              <con3:ifThenElse>
                                <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-738e</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:assign varName="successIndicatorForEach">
                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6736</con2:id>
                                      <con3:expr>
                                        <con2:xqueryText>""</con2:xqueryText>
                                      </con3:expr>
                                    </con3:assign>
                                    <con3:foreach>
                                      <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6712</con2:id>
                                      <con3:variable>xmlForEach</con3:variable>
                                      <con3:expression>
                                        <con2:xpathText>./parent/item</con2:xpathText>
                                      </con3:expression>
                                      <con3:value-variable>item</con3:value-variable>
                                      <con3:index-variable>itemIndex</con3:index-variable>
                                      <con3:total-variable>itemCount</con3:total-variable>
                                      <con3:actions>
                                        <con3:ifThenElse>
                                          <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66f3</con2:id>
                                          <con3:case>
                                            <con3:condition>
                                              <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                            </con3:condition>
                                            <con3:actions/>
                                          </con3:case>
                                          <con3:default>
                                            <con3:ifThenElse>
                                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-610c</con2:id>
                                              <con3:case>
                                                <con3:condition>
                                                  <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                  <con3:javaCallout varName="">
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-610b</con2:id>
                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                    <con3:method>public static void sleep(int)</con3:method>
                                                    <con3:expr>
                                                      <con2:xqueryText>$delayTime</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:javaCallout>
                                                </con3:actions>
                                              </con3:case>
                                              <con3:default/>
                                            </con3:ifThenElse>
                                            <con3:wsCallout>
                                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66e9</con2:id>
                                              <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                              <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                              <con3:request>
                                                <con3:body>$REQDetallesCuenta</con3:body>
                                              </con3:request>
                                              <con3:response>
                                                <con3:body>RSPDetallesCuenta</con3:body>
                                              </con3:response>
                                              <con3:requestTransform>
                                                <con3:assign varName="REQDetallesCuenta">
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66ed</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryTransform>
                                                      <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaCuentaForEachIn"/>
                                                      <con2:param name="index">
                                                        <con2:path>$index</con2:path>
                                                      </con2:param>
                                                      <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                        <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                      </con2:param>
                                                      <con2:param name="autenticacionRequestHeader1">
                                                        <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                      </con2:param>
                                                    </con2:xqueryTransform>
                                                  </con3:expr>
                                                </con3:assign>
                                              </con3:requestTransform>
                                              <con3:responseTransform>
                                                <con3:assign varName="DetallesCuentasSuccessIndicator">
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66ec</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="successIndicatorForEach">
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66b0</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="accountNameResponse">
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66eb</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="zeroRecords">
                                                  <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-66ea</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                              </con3:responseTransform>
                                            </con3:wsCallout>
                                          </con3:default>
                                        </con3:ifThenElse>
                                      </con3:actions>
                                    </con3:foreach>
                                    <con3:ifThenElse>
                                      <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-72d4</con2:id>
                                      <con3:case>
                                        <con3:condition>
                                          <con2:xqueryText>$DetallesCuentasSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                          <con3:ifThenElse>
                                            <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-72d3</con2:id>
                                            <con3:case>
                                              <con3:condition>
                                                <con2:xqueryText>fn:string-length(data($body/val:validacionCuenta/ACCOUNT_NAME)) > 0</con2:xqueryText>
                                              </con3:condition>
                                              <con3:actions>
                                                <con3:javaCallout varName="levensteinDistance">
                                                  <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-72d2</con2:id>
                                                  <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                  <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                  <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                  <con3:expr>
                                                    <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                  </con3:expr>
                                                  <con3:expr>
                                                    <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:javaCallout>
                                                <con3:ifThenElse>
                                                  <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-727d</con2:id>
                                                  <con3:case>
                                                    <con3:condition>
                                                      <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                      <con3:assign varName="accountFound">
                                                        <con2:id>_ActionId-9215339147823850600-664dfc8b.149bf85f21e.-7245</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountNameFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7727</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountCurrencyFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7725</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountPostingRestrictFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7723</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                      <con3:assign varName="accountInactiveMarkerFound">
                                                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6516</con2:id>
                                                        <con3:expr>
                                                          <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                                        </con3:expr>
                                                      </con3:assign>
                                                    </con3:actions>
                                                  </con3:case>
                                                  <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6b18</con2:id>
                                                      <con3:expr>
                                                        <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                      </con3:expr>
                                                    </con3:assign>
                                                  </con3:default>
                                                </con3:ifThenElse>
                                              </con3:actions>
                                            </con3:case>
                                            <con3:default>
                                              <con3:assign varName="accountFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7e72</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountNameFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7704</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountCurrencyFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7703</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountPostingRestrictFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7702</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:assign varName="accountInactiveMarkerFound">
                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64f9</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                            </con3:default>
                                          </con3:ifThenElse>
                                        </con3:actions>
                                      </con3:case>
                                      <con3:default>
                                        <con3:ifThenElse>
                                          <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e50</con2:id>
                                          <con3:case>
                                            <con3:condition>
                                              <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                            </con3:condition>
                                            <con3:actions>
                                              <con3:assign varName="successIndicatorForEach">
                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-65b0</con2:id>
                                                <con3:expr>
                                                  <con2:xqueryText>""</con2:xqueryText>
                                                </con3:expr>
                                              </con3:assign>
                                              <con3:foreach>
                                                <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-669f</con2:id>
                                                <con3:variable>xmlForEach</con3:variable>
                                                <con3:expression>
                                                  <con2:xpathText>./parent/item</con2:xpathText>
                                                </con3:expression>
                                                <con3:value-variable>item</con3:value-variable>
                                                <con3:index-variable>itemIndex</con3:index-variable>
                                                <con3:total-variable>itemCount</con3:total-variable>
                                                <con3:actions>
                                                  <con3:ifThenElse>
                                                    <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6686</con2:id>
                                                    <con3:case>
                                                      <con3:condition>
                                                        <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                                      </con3:condition>
                                                      <con3:actions/>
                                                    </con3:case>
                                                    <con3:default>
                                                      <con3:ifThenElse>
                                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-60d2</con2:id>
                                                        <con3:case>
                                                          <con3:condition>
                                                            <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                                          </con3:condition>
                                                          <con3:actions>
                                                            <con3:javaCallout varName="">
                                                              <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-60d1</con2:id>
                                                              <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                              <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                              <con3:method>public static void sleep(int)</con3:method>
                                                              <con3:expr>
                                                                <con2:xqueryText>$delayTime</con2:xqueryText>
                                                              </con3:expr>
                                                            </con3:javaCallout>
                                                          </con3:actions>
                                                        </con3:case>
                                                        <con3:default/>
                                                      </con3:ifThenElse>
                                                      <con3:wsCallout>
                                                        <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6672</con2:id>
                                                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                        <con3:request>
                                                          <con3:body>$ReqCuentaCancelada</con3:body>
                                                        </con3:request>
                                                        <con3:response>
                                                          <con3:body>RspCuentaCancelada</con3:body>
                                                        </con3:response>
                                                        <con3:requestTransform>
                                                          <con3:assign varName="ReqCuentaCancelada">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6676</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaCuentaCanceladaForEachIn"/>
                                                                <con2:param name="index">
                                                                  <con2:path>$index</con2:path>
                                                                </con2:param>
                                                                <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                  <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                </con2:param>
                                                                <con2:param name="autenticacionRequestHeader1">
                                                                  <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                                </con2:param>
                                                              </con2:xqueryTransform>
                                                            </con3:expr>
                                                          </con3:assign>
                                                        </con3:requestTransform>
                                                        <con3:responseTransform>
                                                          <con3:assign varName="CuentaCanceladaSuccessIndicator">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6675</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:assign>
                                                          <con3:assign varName="successIndicatorForEach">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6577</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryText>data($RspCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:assign>
                                                          <con3:assign varName="zeroRecords">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6674</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:assign>
                                                          <con3:assign varName="accountNameResponse">
                                                            <con2:id>_ActionId-9219496418605935127-120cc2f9.14dfd253d62.-6673</con2:id>
                                                            <con3:expr>
                                                              <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:assign>
                                                        </con3:responseTransform>
                                                      </con3:wsCallout>
                                                    </con3:default>
                                                  </con3:ifThenElse>
                                                </con3:actions>
                                              </con3:foreach>
                                              <con3:ifThenElse>
                                                <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e4c</con2:id>
                                                <con3:case>
                                                  <con3:condition>
                                                    <con2:xqueryText>$CuentaCanceladaSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                                  </con3:condition>
                                                  <con3:actions>
                                                    <con3:ifThenElse>
                                                      <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e4a</con2:id>
                                                      <con3:case>
                                                        <con3:condition>
                                                          <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                          <con3:javaCallout varName="levensteinDistance">
                                                            <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e49</con2:id>
                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                            <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                            <con3:expr>
                                                              <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                            </con3:expr>
                                                            <con3:expr>
                                                              <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                            </con3:expr>
                                                          </con3:javaCallout>
                                                          <con3:ifThenElse>
                                                            <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e48</con2:id>
                                                            <con3:case>
                                                              <con3:condition>
                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                              </con3:condition>
                                                              <con3:actions>
                                                                <con3:assign varName="accountFound">
                                                                  <con2:id>_ActionId-2158558874792067774-792c4e8.149e299c2af.-7e47</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountNameFound">
                                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-78fa</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountCancelled">
                                                                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-66c1</con2:id>
                                                                  <con3:expr>
                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                  </con3:expr>
                                                                </con3:assign>
                                                              </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                              <con3:assign varName="errorMessage">
                                                                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6aaa</con2:id>
                                                                <con3:expr>
                                                                  <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                </con3:expr>
                                                              </con3:assign>
                                                            </con3:default>
                                                          </con3:ifThenElse>
                                                        </con3:actions>
                                                      </con3:case>
                                                      <con3:default>
                                                        <con3:assign varName="accountFound">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-7e1e</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($ReqCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="accountNameFound">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-78dd</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>data($RspCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="accountCancelled">
                                                          <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-674d</con2:id>
                                                          <con3:expr>
                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                          </con3:expr>
                                                        </con3:assign>
                                                      </con3:default>
                                                    </con3:ifThenElse>
                                                  </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                  <con3:assign varName="errorMessage">
                                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6a72</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>"Cumple mod 10 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                </con3:default>
                                              </con3:ifThenElse>
                                            </con3:actions>
                                          </con3:case>
                                          <con3:default>
                                            <con3:assign varName="errorMessage">
                                              <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6b50</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                          </con3:default>
                                        </con3:ifThenElse>
                                      </con3:default>
                                    </con3:ifThenElse>
                                  </con3:actions>
                                </con3:case>
                                <con3:default>
                                  <con3:assign varName="errorMessage">
                                    <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-6b88</con2:id>
                                    <con3:expr>
                                      <con2:xqueryText>"No cumplió mod 10 ni mod 11."</con2:xqueryText>
                                    </con3:expr>
                                  </con3:assign>
                                </con3:default>
                              </con3:ifThenElse>
                            </con3:actions>
                          </con3:foreach>
                        </con3:default>
                      </con3:ifThenElse>
                    </con3:actions>
                  </con3:case>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default>
              <con2:skip>
                <con2:id>_ActionId-5617238416689377426-3e91c78d.14012c1fd40.-7f37</con2:id>
              </con2:skip>
            </con3:default>
          </con3:ifThenElse>
          <con3:ifThenElse>
            <con2:comment>Se verifica si se encontró la cuenta o no. En caso de NO haberla encontrado se dispara el flujo de búsqueda de cuenta CITI</con2:comment>
            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-70c0</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$accountFound = 'false'</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:wsCallout>
                  <con2:comment>Se invoca el servicio de negocio (procedimiento almacenado) encargado de buscar si la cuenta corresponde a una cuenta del CITI y en caso exitoso, retornar el número de cuenta de T24 asociado a a uenta del CITI</con2:comment>
                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6fe6</con2:id>
                  <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaMapeoCuentaT24Citi/biz/consultaMapeoCuentaT24Citi_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con3:operation>consultaMapeoCuentaT24Citi</con3:operation>
                  <con3:request>
                    <con3:body>$requestConsultaMapeoCuentaT24Citi</con3:body>
                  </con3:request>
                  <con3:response>
                    <con3:body>responseConsultaMapeoCuentaT24Citi</con3:body>
                  </con3:response>
                  <con3:requestTransform>
                    <con3:assign varName="requestConsultaMapeoCuentaT24Citi">
                      <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6fae</con2:id>
                      <con3:expr>
                        <con2:xqueryTransform>
                          <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/consultaMapeoCuentaT24CitiIn"/>
                          <con2:param name="accountNumber">
                            <con2:path>$accountNumber</con2:path>
                          </con2:param>
                        </con2:xqueryTransform>
                      </con3:expr>
                    </con3:assign>
                  </con3:requestTransform>
                  <con3:responseTransform>
                    <con3:assign varName="consultaMapeoCuentaT24CitiSuccessIndicator">
                      <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6f76</con2:id>
                      <con3:expr>
                        <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:CODIGO_ERROR/text())</con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                  </con3:responseTransform>
                </con3:wsCallout>
                <con3:ifThenElse>
                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6f3e</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>fn:string($consultaMapeoCuentaT24CitiSuccessIndicator) = 'SUCCESS'</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:assign varName="accountNumberT24Citi">
                        <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b4d</con2:id>
                        <con3:expr>
                          <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:NUMERO_CUENTA_T24/text())</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:assign varName="successIndicatorForEach">
                        <con2:id>_ActionId-5512150119302733859-401c5516.1502e9fbaa0.-7e16</con2:id>
                        <con3:expr>
                          <con2:xqueryText>""</con2:xqueryText>
                        </con3:expr>
                      </con3:assign>
                      <con3:foreach>
                        <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bd5</con2:id>
                        <con3:variable>xmlForEach</con3:variable>
                        <con3:expression>
                          <con2:xpathText>./parent/item</con2:xpathText>
                        </con3:expression>
                        <con3:value-variable>item</con3:value-variable>
                        <con3:index-variable>itemIndex</con3:index-variable>
                        <con3:total-variable>itemCount</con3:total-variable>
                        <con3:actions>
                          <con3:ifThenElse>
                            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bde</con2:id>
                            <con3:case>
                              <con3:condition>
                                <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                              </con3:condition>
                              <con3:actions/>
                            </con3:case>
                            <con3:default>
                              <con3:ifThenElse>
                                <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bdd</con2:id>
                                <con3:case>
                                  <con3:condition>
                                    <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                  </con3:condition>
                                  <con3:actions>
                                    <con3:javaCallout varName="">
                                      <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bdc</con2:id>
                                      <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                      <con3:className>ficohsa.utilities.Utilities</con3:className>
                                      <con3:method>public static void sleep(int)</con3:method>
                                      <con3:expr>
                                        <con2:xqueryText>$delayTime</con2:xqueryText>
                                      </con3:expr>
                                    </con3:javaCallout>
                                  </con3:actions>
                                </con3:case>
                                <con3:default/>
                              </con3:ifThenElse>
                              <con3:wsCallout>
                                <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bd6</con2:id>
                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                <con3:request>
                                  <con3:body>$requestDetallesCuentaT24Citi</con3:body>
                                </con3:request>
                                <con3:response>
                                  <con3:body>responseDetallesCuentaT24Citi</con3:body>
                                </con3:response>
                                <con3:requestTransform>
                                  <con3:assign varName="requestDetallesCuentaT24Citi">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bdb</con2:id>
                                    <con3:expr>
                                      <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/Business_Resources/validacionCuenta/ConsultaCuentaEquivalente/ConsultaDetallesCuentaIn"/>
                                        <con2:param name="accountNumber">
                                          <con2:path>$accountNumberT24Citi</con2:path>
                                        </con2:param>
                                        <con2:param name="autenticacionRequestHeader1">
                                          <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                        </con2:param>
                                      </con2:xqueryTransform>
                                    </con3:expr>
                                  </con3:assign>
                                </con3:requestTransform>
                                <con3:responseTransform>
                                  <con3:assign varName="detallesCuentasSuccessIndicator">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bda</con2:id>
                                    <con3:expr>
                                      <con2:xqueryText>data($responseDetallesCuentaT24Citi/Status/successIndicator)</con2:xqueryText>
                                    </con3:expr>
                                  </con3:assign>
                                  <con3:assign varName="accountNameResponse">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bd9</con2:id>
                                    <con3:expr>
                                      <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                    </con3:expr>
                                  </con3:assign>
                                  <con3:assign varName="zeroRecords">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bd8</con2:id>
                                    <con3:expr>
                                      <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                    </con3:expr>
                                  </con3:assign>
                                  <con3:assign varName="successIndicatorForEach">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bd7</con2:id>
                                    <con3:expr>
                                      <con2:xqueryText>data($responseDetallesCuentaT24Citi/Status/successIndicator)</con2:xqueryText>
                                    </con3:expr>
                                  </con3:assign>
                                </con3:responseTransform>
                              </con3:wsCallout>
                            </con3:default>
                          </con3:ifThenElse>
                        </con3:actions>
                      </con3:foreach>
                      <con3:ifThenElse>
                        <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bac</con2:id>
                        <con3:case>
                          <con3:condition>
                            <con2:xqueryText>$detallesCuentasSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con3:ifThenElse>
                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6bab</con2:id>
                              <con3:case>
                                <con3:condition>
                                  <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                </con3:condition>
                                <con3:actions>
                                  <con3:javaCallout varName="levensteinDistance">
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6baa</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                    <con3:expr>
                                      <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                    </con3:expr>
                                    <con3:expr>
                                      <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                    </con3:expr>
                                  </con3:javaCallout>
                                  <con3:ifThenElse>
                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba9</con2:id>
                                    <con3:case>
                                      <con3:condition>
                                        <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                      </con3:condition>
                                      <con3:actions>
                                        <con3:assign varName="accountFound">
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba8</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($requestDetallesCuentaT24Citi/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="accountNameFound">
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba7</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="accountCurrencyFound">
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba6</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="accountPostingRestrictFound">
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba5</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="accountInactiveMarkerFound">
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba4</con2:id>
                                          <con3:expr>
                                            <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                          </con3:expr>
                                        </con3:assign>
                                      </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                      <con3:assign varName="errorMessage">
                                        <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba3</con2:id>
                                        <con3:expr>
                                          <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                        </con3:expr>
                                      </con3:assign>
                                    </con3:default>
                                  </con3:ifThenElse>
                                </con3:actions>
                              </con3:case>
                              <con3:default>
                                <con3:assign varName="accountFound">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba2</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>data($requestDetallesCuentaT24Citi/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="accountNameFound">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba1</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE)</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="accountCurrencyFound">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6ba0</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/CURRENCY)</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="accountPostingRestrictFound">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9f</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/POSTINGRESTRICT)</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:assign varName="accountInactiveMarkerFound">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9e</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>data($responseDetallesCuentaT24Citi/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/INACTIVEMARKER)</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                              </con3:default>
                            </con3:ifThenElse>
                          </con3:actions>
                        </con3:case>
                        <con3:default>
                          <con3:ifThenElse>
                            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9d</con2:id>
                            <con3:case>
                              <con3:condition>
                                <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                              </con3:condition>
                              <con3:actions>
                                <con3:assign varName="successIndicatorForEach">
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9c</con2:id>
                                  <con3:expr>
                                    <con2:xqueryText>""</con2:xqueryText>
                                  </con3:expr>
                                </con3:assign>
                                <con3:foreach>
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b92</con2:id>
                                  <con3:variable>xmlForEach</con3:variable>
                                  <con3:expression>
                                    <con2:xpathText>./parent/item</con2:xpathText>
                                  </con3:expression>
                                  <con3:value-variable>item</con3:value-variable>
                                  <con3:index-variable>itemIndex</con3:index-variable>
                                  <con3:total-variable>itemCount</con3:total-variable>
                                  <con3:actions>
                                    <con3:ifThenElse>
                                      <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9b</con2:id>
                                      <con3:case>
                                        <con3:condition>
                                          <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions/>
                                      </con3:case>
                                      <con3:default>
                                        <con3:ifThenElse>
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b9a</con2:id>
                                          <con3:case>
                                            <con3:condition>
                                              <con2:xqueryText>fn:upper-case($successIndicatorForEach) != ""</con2:xqueryText>
                                            </con3:condition>
                                            <con3:actions>
                                              <con3:javaCallout varName="">
                                                <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b99</con2:id>
                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                <con3:method>public static void sleep(int)</con3:method>
                                                <con3:expr>
                                                  <con2:xqueryText>$delayTime</con2:xqueryText>
                                                </con3:expr>
                                              </con3:javaCallout>
                                            </con3:actions>
                                          </con3:case>
                                          <con3:default/>
                                        </con3:ifThenElse>
                                        <con3:wsCallout>
                                          <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b93</con2:id>
                                          <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                          <con3:operation>Consultadecuentascanceladas</con3:operation>
                                          <con3:request>
                                            <con3:body>$requestCuentaCanceladaT24Citi</con3:body>
                                          </con3:request>
                                          <con3:response>
                                            <con3:body>responseCuentaCanceladaT24Citi</con3:body>
                                          </con3:response>
                                          <con3:requestTransform>
                                            <con3:assign varName="requestCuentaCanceladaT24Citi">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b98</con2:id>
                                              <con3:expr>
                                                <con2:xqueryTransform>
                                                  <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/consultaCuentaCanceladaIn"/>
                                                  <con2:param name="account">
                                                    <con2:path>$accountNumberT24Citi</con2:path>
                                                  </con2:param>
                                                  <con2:param name="autenticacionRequestHeader1">
                                                    <con2:path>$header/aut:AutenticacionRequestHeader</con2:path>
                                                  </con2:param>
                                                </con2:xqueryTransform>
                                              </con3:expr>
                                            </con3:assign>
                                          </con3:requestTransform>
                                          <con3:responseTransform>
                                            <con3:assign varName="CuentaCanceladaSuccessIndicator">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b97</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>data($responseCuentaCanceladaT24Citi/Status/successIndicator)</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                            <con3:assign varName="successIndicatorForEach">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b96</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>data($responseCuentaCanceladaT24Citi/Status/successIndicator)</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                            <con3:assign varName="zeroRecords">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b95</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>data($responseCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                            <con3:assign varName="accountNameResponse">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b94</con2:id>
                                              <con3:expr>
                                                <con2:xqueryText>data($responseCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                              </con3:expr>
                                            </con3:assign>
                                          </con3:responseTransform>
                                        </con3:wsCallout>
                                      </con3:default>
                                    </con3:ifThenElse>
                                  </con3:actions>
                                </con3:foreach>
                                <con3:ifThenElse>
                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b91</con2:id>
                                  <con3:case>
                                    <con3:condition>
                                      <con2:xqueryText>$CuentaCanceladaSuccessIndicator = 'Success' and fn:empty($zeroRecords)</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                      <con3:ifThenElse>
                                        <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b90</con2:id>
                                        <con3:case>
                                          <con3:condition>
                                            <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                          </con3:condition>
                                          <con3:actions>
                                            <con3:javaCallout varName="levensteinDistance">
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8f</con2:id>
                                              <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                              <con3:className>ficohsa.utilities.Utilities</con3:className>
                                              <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                              <con3:expr>
                                                <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                              </con3:expr>
                                              <con3:expr>
                                                <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                              </con3:expr>
                                            </con3:javaCallout>
                                            <con3:ifThenElse>
                                              <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8e</con2:id>
                                              <con3:case>
                                                <con3:condition>
                                                  <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                  <con3:assign varName="accountFound">
                                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8d</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($requestCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                  <con3:assign varName="accountNameFound">
                                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8c</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>data($responseCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                  <con3:assign varName="accountCancelled">
                                                    <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8b</con2:id>
                                                    <con3:expr>
                                                      <con2:xqueryText>'true'</con2:xqueryText>
                                                    </con3:expr>
                                                  </con3:assign>
                                                </con3:actions>
                                              </con3:case>
                                              <con3:default>
                                                <con3:assign varName="errorMessage">
                                                  <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b8a</con2:id>
                                                  <con3:expr>
                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                  </con3:expr>
                                                </con3:assign>
                                              </con3:default>
                                            </con3:ifThenElse>
                                          </con3:actions>
                                        </con3:case>
                                        <con3:default>
                                          <con3:assign varName="accountFound">
                                            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b89</con2:id>
                                            <con3:expr>
                                              <con2:xqueryText>data($requestCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                            </con3:expr>
                                          </con3:assign>
                                          <con3:assign varName="accountNameFound">
                                            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b88</con2:id>
                                            <con3:expr>
                                              <con2:xqueryText>data($responseCuentaCanceladaT24Citi/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME)</con2:xqueryText>
                                            </con3:expr>
                                          </con3:assign>
                                          <con3:assign varName="accountCancelled">
                                            <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b87</con2:id>
                                            <con3:expr>
                                              <con2:xqueryText>'true'</con2:xqueryText>
                                            </con3:expr>
                                          </con3:assign>
                                        </con3:default>
                                      </con3:ifThenElse>
                                    </con3:actions>
                                  </con3:case>
                                  <con3:default>
                                    <con3:assign varName="errorMessage">
                                      <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b86</con2:id>
                                      <con3:expr>
                                        <con2:xqueryText>"No se encontró información de la cuenta."</con2:xqueryText>
                                      </con3:expr>
                                    </con3:assign>
                                  </con3:default>
                                </con3:ifThenElse>
                              </con3:actions>
                            </con3:case>
                            <con3:default>
                              <con3:assign varName="errorMessage">
                                <con2:id>_ActionId-3873799402672000523-3784cf0c.1502a38e940.-6b85</con2:id>
                                <con3:expr>
                                  <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                </con3:expr>
                              </con3:assign>
                            </con3:default>
                          </con3:ifThenElse>
                        </con3:default>
                      </con3:ifThenElse>
                    </con3:actions>
                  </con3:case>
                  <con3:default>
                    <con3:assign varName="errorCode">
                      <con2:id>_ActionId-6068590239963606408--77eac1b1.15066a6936f.-7fc9</con2:id>
                      <con3:expr>
                        <con2:xqueryText>$consultaMapeoCuentaT24CitiSuccessIndicator</con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                    <con3:assign varName="errorMessage">
                      <con2:id>_ActionId-6068590239963606408--77eac1b1.15066a6936f.-7fac</con2:id>
                      <con3:expr>
                        <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:DESCRIPCION_ERROR/text())</con2:xqueryText>
                      </con3:expr>
                    </con3:assign>
                  </con3:default>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default/>
          </con3:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:pipeline type="response" name="PipelinePairNode1_response">
      <con1:stage name="stage1">
        <con1:context>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
          <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
        </con1:context>
        <con1:actions>
          <con3:ifThenElse>
            <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64d2</con2:id>
            <con3:case>
              <con3:condition>
                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
              </con3:condition>
              <con3:actions>
                <con3:ifThenElse>
                  <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64d1</con2:id>
                  <con3:case>
                    <con3:condition>
                      <con2:xqueryText>$accountFound != 'false'</con2:xqueryText>
                    </con3:condition>
                    <con3:actions>
                      <con3:replace varName="header" contents-only="true">
                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64d0</con2:id>
                        <con3:expr>
                          <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>SUCCESS&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                        </con3:expr>
                      </con3:replace>
                      <con3:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64cf</con2:id>
                        <con3:expr>
                          <con2:xqueryTransform>
                            <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ValidacionCuentaOut"/>
                            <con2:param name="accountFound">
                              <con2:path>$accountFound</con2:path>
                            </con2:param>
                            <con2:param name="accountPostingRestrictFound">
                              <con2:path>$accountPostingRestrictFound</con2:path>
                            </con2:param>
                            <con2:param name="accountCancelled">
                              <con2:path>$accountCancelled</con2:path>
                            </con2:param>
                            <con2:param name="accountInactiveMarkerFound">
                              <con2:path>$accountInactiveMarkerFound</con2:path>
                            </con2:param>
                            <con2:param name="accountCurrencyFound">
                              <con2:path>$accountCurrencyFound</con2:path>
                            </con2:param>
                            <con2:param name="accountNameFound">
                              <con2:path>$accountNameFound</con2:path>
                            </con2:param>
                          </con2:xqueryTransform>
                        </con3:expr>
                      </con3:replace>
                    </con3:actions>
                  </con3:case>
                  <con3:default>
                    <con3:wsCallout>
                      <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7dc8</con2:id>
                      <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                      <con3:operation>mapeoErrores</con3:operation>
                      <con3:request>
                        <con3:body>$rqMapeoErrores</con3:body>
                      </con3:request>
                      <con3:response>
                        <con3:body>rpMapeoErrores</con3:body>
                      </con3:response>
                      <con3:requestTransform>
                        <con3:assign varName="rqMapeoErrores">
                          <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7d90</con2:id>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                              <con2:param name="CODIGO_ERROR">
                                <con2:path>'ERROR'</con2:path>
                              </con2:param>
                              <con2:param name="MENSAJE_ERROR">
                                <con2:path>$errorMessage</con2:path>
                              </con2:param>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:assign>
                      </con3:requestTransform>
                      <con3:responseTransform>
                        <con3:replace contents-only="true" varName="header">
                          <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7d58</con2:id>
                          <con3:expr>
                            <con2:xqueryTransform>
                              <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                              <con2:param name="mapeoErroresResponse1">
                                <con2:path>$rpMapeoErrores</con2:path>
                              </con2:param>
                              <con2:param name="successIndicator">
                                <con2:path>"NO RECORDS"</con2:path>
                              </con2:param>
                            </con2:xqueryTransform>
                          </con3:expr>
                        </con3:replace>
                      </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:replace varName="body" contents-only="true">
                      <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64cd</con2:id>
                      <con3:expr>
                        <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                      </con3:expr>
                    </con3:replace>
                  </con3:default>
                </con3:ifThenElse>
              </con3:actions>
            </con3:case>
            <con3:default>
              <con3:wsCallout>
                <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7fde</con2:id>
                <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                <con3:operation>mapeoErrores</con3:operation>
                <con3:request>
                  <con3:body>$rqMapeoErrores</con3:body>
                </con3:request>
                <con3:response>
                  <con3:body>rpMapeoErrores</con3:body>
                </con3:response>
                <con3:requestTransform>
                  <con3:assign varName="rqMapeoErrores">
                    <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7fa6</con2:id>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                        <con2:param name="CODIGO_ERROR">
                          <con2:path>"ERROR"</con2:path>
                        </con2:param>
                        <con2:param name="MENSAJE_ERROR">
                          <con2:path>fn:string($validationMessage)</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:assign>
                </con3:requestTransform>
                <con3:responseTransform>
                  <con3:replace contents-only="true" varName="header">
                    <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7f6e</con2:id>
                    <con3:expr>
                      <con2:xqueryTransform>
                        <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                        <con2:param name="mapeoErroresResponse1">
                          <con2:path>$rpMapeoErrores</con2:path>
                        </con2:param>
                        <con2:param name="successIndicator">
                          <con2:path>"ERROR"</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con3:expr>
                  </con3:replace>
                </con3:responseTransform>
              </con3:wsCallout>
              <con3:replace contents-only="true" varName="body">
                <con2:id>_ActionId-7690649009170148709--5492b9b0.149e37fe6a7.-64cb</con2:id>
                <con3:expr>
                  <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                </con3:expr>
              </con3:replace>
            </con3:default>
          </con3:ifThenElse>
        </con1:actions>
      </con1:stage>
    </con1:pipeline>
    <con1:flow>
      <con1:pipeline-node name="PipelinePairNode1">
        <con1:request>PipelinePairNode1_request</con1:request>
        <con1:response>PipelinePairNode1_response</con1:response>
      </con1:pipeline-node>
    </con1:flow>
  </ser:router>
</xml-fragment>