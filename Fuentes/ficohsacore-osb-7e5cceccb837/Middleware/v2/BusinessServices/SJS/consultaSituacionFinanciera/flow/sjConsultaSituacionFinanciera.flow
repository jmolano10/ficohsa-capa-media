<?xml version="1.0" encoding="UTF-8"?>
<bpel:process name="sjConsultaSituacionFinanciera"
              targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/flow/sjConsultaSituacionFinanciera"
              xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/flow/sjConsultaSituacionFinanciera"
              xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
              xmlns:rescon="http://www.bea.com/alsb/flow/resources/config"
              xmlns:bea="http://www.bea.com/bpel/ui/extensions"
              xmlns:ext="http://www.bea.com/bpel/extensions"
              xmlns:expr="http://www.bea.com/wli/sb/stages/config"
              xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config"
              xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinancieraPS" 
              bea:name="sjConsultaSituacionFinanciera" xmlns:ns1="http://www.ficohsa.com.hn/middleware.services/consultaSituacionFinancieraHNPS/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns0="http://www.ficohsa.com.hn/middleware.services/consultaSituacionFinancieraTypes" xmlns:ns2="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinanciera" xmlns:ns3="http://www.ficohsa.com.hn/middleware.services/consultaSituacionFinancieraGTPS/" xmlns:ns4="http://www.ficohsa.com.hn/middleware.services/consultaSituacionFinancieraNIPS/" xmlns:ns5="http://www.ficohsa.com.hn/middleware.services/consultaSituacionFinancieraPAPS/">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaSituacionFinanciera" partnerLinkType="tns:sjConsultaSituacionFinanciera"
                          myRole="sjConsultaSituacionFinanciera">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSituacionFinancieraHN"
		partnerLinkType="tns:ConsultaSituacionFinancieraHN_plnkType"
		partnerRole="ConsultaSituacionFinancieraHN_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSituacionFinancieraGT"
	   	partnerLinkType="tns:ConsultaSituacionFinancieraGT_plnkType"
	   	partnerRole="ConsultaSituacionFinancieraGT_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSituacionFinancieraNI"
	   	partnerLinkType="tns:ConsultaSituacionFinancieraNI_plnkType"
	   	partnerRole="ConsultaSituacionFinancieraNI_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSituacionFinancieraPA"
	   	partnerLinkType="tns:ConsultaSituacionFinancieraPA_plnkType"
	   	partnerRole="ConsultaSituacionFinancieraPA_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request"
	                      messageType="bind:sjConsultaSituacionFinancieraRequest">
	       </bpel:variable>
	       <bpel:variable name="response"
                       messageType="bind:sjConsultaSituacionFinancieraResponse">
	       </bpel:variable>
    <bpel:variable name="temp" type="xsd:anyType"></bpel:variable></bpel:variables>

    
	<bpel:sequence>
        <bpel:receive partnerLink="sjConsultaSituacionFinanciera" operation="ConsultaSituacionFinanciera" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/wsdl/sjConsultaSituacionFinanciera" binding="bind:sjConsultaSituacionFinancieraPSSOAP"/>
            </rescon:receiveInfo>
        </bpel:receive>
        
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="temp">
        			<trf:expr>
        				<expr:xqueryText>&lt;ResponseHeader&gt;
	&lt;responses/&gt;
&lt;/ResponseHeader&gt;</expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;outputParameters/&gt;</expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:flow bea:name="ConsultaSituacionFinancieraPorPais">
        	<bpel:scope bea:name="HN01">
        		<bpel:variables>
        			<bpel:variable
        				name="REQConsultaSituacionFinancieraHN"
        				messageType="ns1:consultaSituacionFinancieraHNRequest">
        			</bpel:variable>
        			<bpel:variable
        				name="RSPConsultaSituacionFinancieraHN"
        				messageType="ns1:consultaSituacionFinancieraHNResponse">
        			</bpel:variable>
        			</bpel:variables>
        		<bpel:faultHandlers>
        			
        			
        			<bpel:catchAll ext:soapFaultVariable="fault">
        				<bpel:sequence>
        					<bpel:empty></bpel:empty>
        				
	<bpel:assign>
		
		
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;ERROR&lt;/successIndicator&gt;
	&lt;messages&gt;Error invocando servicio HN&lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation></bpel:assign>
	</bpel:sequence>
        			</bpel:catchAll></bpel:faultHandlers>
        		<bpel:sequence>
        			<bpel:assign>
        				<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraHN">
        					<trf:assign varName="REQConsultaSituacionFinancieraHN.parameters">
        						<trf:expr>
        							<expr:xqueryTransform>
        								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/xq/sjConsultaSituacionFinancieraIn"></expr:resource>
        								
        								
        								<expr:param name="sjConsultaSituacionFinanciera">
        									<expr:path>$request.inputParameters</expr:path></expr:param>
        								<expr:param name="country">
        									<expr:path>'HN01'</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation bea:name="REQHConsultaSituacionFinancieraHN">
		<trf:assign varName="REQConsultaSituacionFinancieraHN.RequestHeader">
			<trf:expr>
				<expr:xqueryText>$request.RequestHeader</expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation></bpel:assign>
        			<bpel:if>
        				<bpel:condition>count($REQConsultaSituacionFinancieraHN.parameters/REGION/CUSTOMERS/CUSTOMER) &gt; 0 or
count($REQConsultaSituacionFinancieraHN.parameters/REGION/PRODUCTS/PRODUCT) &gt; 0</bpel:condition>
        				<bpel:sequence>
        					<bpel:empty></bpel:empty>
        				
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:replace contents-only="false" varName="REQConsultaSituacionFinancieraHN.RequestHeader">
				<trf:location>
					<expr:xpathText>./Region</expr:xpathText></trf:location>
				<trf:expr>
					<expr:xqueryText>&lt;Region&gt;
	&lt;SourceBank&gt;HN01&lt;/SourceBank&gt;
	&lt;DestinationBank&gt;HN01&lt;/DestinationBank&gt;
&lt;/Region&gt;</expr:xqueryText></trf:expr></trf:replace>
		</bpel:extensionAssignOperation>
	</bpel:assign>
	<bpel:invoke
		outputVariable="RSPConsultaSituacionFinancieraHN"
		operation="ConsultaSituacionFinancieraHN"
		inputVariable="REQConsultaSituacionFinancieraHN"
		partnerLink="ConsultaSituacionFinancieraHN">
		<rescon:invokeInfo>
			<rescon:service isProxy="true"
				ref="Middleware/v2/ProxyServices/ConsultaSituacionFinancieraHN"></rescon:service></rescon:invokeInfo></bpel:invoke>
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;{ fn:string($RSPConsultaSituacionFinancieraHN.ResponseHeader/successIndicator/text()) } &lt;/successIndicator&gt;
	&lt;messages&gt;{ fn:string($RSPConsultaSituacionFinancieraHN.ResponseHeader/messages/text())	} &lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        				<bpel:else>
        					<bpel:sequence>
        						<bpel:empty></bpel:empty>
        					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;SUCCESS&lt;/successIndicator&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        				</bpel:else>
        			</bpel:if>
        			</bpel:sequence>
        	</bpel:scope>
        	
        
        <bpel:scope bea:name="GT01">
		<bpel:variables>
			
			
			<bpel:variable name="REQConsultaSituacionFinancieraGT"
				messageType="ns3:consultaSituacionFinancieraGTRequest">
			</bpel:variable>
			<bpel:variable name="RSPConsultaSituacionFinancieraGT"
				messageType="ns3:consultaSituacionFinancieraGTResponse">
			</bpel:variable></bpel:variables>
	<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty></bpel:empty>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;ERROR&lt;/successIndicator&gt;
	&lt;messages&gt;Error invocando servicio GT&lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
				</bpel:assign></bpel:sequence>
			</bpel:catchAll></bpel:faultHandlers>
	<bpel:sequence>
		<bpel:assign>
			<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraGT">
				<trf:assign varName="REQConsultaSituacionFinancieraGT.parameters">
					<trf:expr>
						<expr:xqueryTransform>
							<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/xq/sjConsultaSituacionFinancieraIn"></expr:resource>
							
							<expr:param name="sjConsultaSituacionFinanciera">
								<expr:path>$request.inputParameters</expr:path></expr:param>
							<expr:param name="country">
								<expr:path>'GT01'</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
			</bpel:extensionAssignOperation>
		<bpel:extensionAssignOperation
		bea:name="REQHConsultaSituacionFinancieraGT">
		<bpel:documentation></bpel:documentation>
		<trf:assign varName="REQConsultaSituacionFinancieraGT.RequestHeader">
			<trf:expr>
				<expr:xqueryText>$request.RequestHeader</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation></bpel:assign>
		
		<bpel:if>
			<bpel:condition>count($REQConsultaSituacionFinancieraGT.parameters/REGION/CUSTOMERS/CUSTOMER) &gt; 0 or
count($REQConsultaSituacionFinancieraGT.parameters/REGION/PRODUCTS/PRODUCT) &gt; 0</bpel:condition>
			<bpel:sequence>
				<bpel:empty></bpel:empty>
			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:replace contents-only="false" varName="REQConsultaSituacionFinancieraGT.RequestHeader">
				<trf:location>
					<expr:xpathText>./Region</expr:xpathText></trf:location>
				<trf:expr>
					<expr:xqueryText>&lt;Region&gt;
	&lt;SourceBank&gt;GT01&lt;/SourceBank&gt;
	&lt;DestinationBank&gt;GT01&lt;/DestinationBank&gt;
&lt;/Region&gt;</expr:xqueryText></trf:expr></trf:replace>
		</bpel:extensionAssignOperation>
			</bpel:assign>
			<bpel:invoke operation="ConsultaSituacionFinancieraGT" partnerLink="ConsultaSituacionFinancieraGT" inputVariable="REQConsultaSituacionFinancieraGT" outputVariable="RSPConsultaSituacionFinancieraGT">
				<rescon:invokeInfo>
					<rescon:service isProxy="true" ref="Middleware/v2/ProxyServices/ConsultaSituacionFinancieraGT"></rescon:service></rescon:invokeInfo></bpel:invoke>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:insert varName="temp">
						<trf:location>
							<expr:xpathText>./responses</expr:xpathText></trf:location>
						<trf:where>last-child</trf:where>
						<trf:expr>
							<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;{ fn:string($RSPConsultaSituacionFinancieraGT.ResponseHeader/successIndicator/text()) } &lt;/successIndicator&gt;
	&lt;messages&gt;{ fn:string($RSPConsultaSituacionFinancieraGT.ResponseHeader/messages/text())	} &lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
			<bpel:else>
				<bpel:sequence>
					<bpel:empty></bpel:empty>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;SUCCESS&lt;/successIndicator&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
			</bpel:else>
		</bpel:if>
		
		</bpel:sequence>
        </bpel:scope>
        <bpel:scope bea:name="PA01">
        	<bpel:variables>
        		<bpel:variable name="REQConsultaSituacionFinancieraPA"
        			messageType="ns5:consultaSituacionFinancieraPARequest">
        		</bpel:variable>
        		<bpel:variable name="RSPConsultaSituacionFinancieraPA"
        			messageType="ns5:consultaSituacionFinancieraPAResponse">
        		</bpel:variable></bpel:variables>
        	<bpel:faultHandlers>
        		<bpel:catchAll>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;ERROR&lt;/successIndicator&gt;
	&lt;messages&gt;Error invocando servicio PA&lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
        			</bpel:assign></bpel:sequence>
        		</bpel:catchAll></bpel:faultHandlers>
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraPA">
        				<trf:assign varName="REQConsultaSituacionFinancieraPA.parameters">
        					<trf:expr>
        						<expr:xqueryTransform>
        							<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/xq/sjConsultaSituacionFinancieraIn"></expr:resource>
        							
        							<expr:param name="sjConsultaSituacionFinanciera">
        								<expr:path>$request.inputParameters</expr:path></expr:param>
        							<expr:param name="country">
        								<expr:path>'PA01'</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation bea:name="REQHConsultaSituacionFinancieraPA">
        				<trf:assign varName="REQConsultaSituacionFinancieraPA.RequestHeader">
        					<trf:expr>
        						<expr:xqueryText>$request.RequestHeader</expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		</bpel:assign>
        		<bpel:if>
        			<bpel:condition>count($REQConsultaSituacionFinancieraPA.parameters/REGION/CUSTOMERS/CUSTOMER) != 0 or
count($REQConsultaSituacionFinancieraPA.parameters/REGION/PRODUCTS/PRODUCT) != 0</bpel:condition>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:replace contents-only="false" varName="REQConsultaSituacionFinancieraPA.RequestHeader">
				<trf:location>
					<expr:xpathText>./Region</expr:xpathText></trf:location>
				<trf:expr>
					<expr:xqueryText>&lt;Region&gt;
	&lt;SourceBank&gt;PA01&lt;/SourceBank&gt;
	&lt;DestinationBank&gt;PA01&lt;/DestinationBank&gt;
&lt;/Region&gt;</expr:xqueryText></trf:expr></trf:replace>
		</bpel:extensionAssignOperation>
        			</bpel:assign>
	<bpel:invoke operation="ConsultaSituacionFinancieraPA" partnerLink="ConsultaSituacionFinancieraPA" inputVariable="REQConsultaSituacionFinancieraPA" outputVariable="RSPConsultaSituacionFinancieraPA">
        				<rescon:invokeInfo>
        					<rescon:service isProxy="true" ref="Middleware/v2/ProxyServices/ConsultaSituacionFinancieraPA"></rescon:service></rescon:invokeInfo></bpel:invoke>
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;{ fn:string($RSPConsultaSituacionFinancieraPA.ResponseHeader/successIndicator/text()) } &lt;/successIndicator&gt;
	&lt;messages&gt;{ fn:string($RSPConsultaSituacionFinancieraPA.ResponseHeader/messages/text())	} &lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
	</bpel:assign></bpel:sequence>
        			<bpel:else>
        				<bpel:sequence>
        					<bpel:empty></bpel:empty>
        				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;SUCCESS&lt;/successIndicator&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        			</bpel:else>
        		</bpel:if>
        		</bpel:sequence>
        </bpel:scope>
        <bpel:scope bea:name="NI01">
        	<bpel:variables>
        		<bpel:variable name="REQConsultaSituacionFinancieraNI"
        			messageType="ns4:consultaSituacionFinancieraNIRequest">
        		</bpel:variable>
        		<bpel:variable name="RSPConsultaSituacionFinancieraNI"
        			messageType="ns4:consultaSituacionFinancieraNIResponse">
        		</bpel:variable></bpel:variables>
        	<bpel:faultHandlers>
        		<bpel:catchAll>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;ERROR&lt;/successIndicator&gt;
	&lt;messages&gt;Error invocando servicio NI&lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
        			</bpel:assign></bpel:sequence>
        		</bpel:catchAll></bpel:faultHandlers>
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraNI">
        				<trf:assign varName="REQConsultaSituacionFinancieraNI.parameters">
        					<trf:expr>
        						<expr:xqueryTransform>
        							<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinanciera/xq/sjConsultaSituacionFinancieraIn"></expr:resource>
        							
        							<expr:param name="sjConsultaSituacionFinanciera">
        								<expr:path>$request.inputParameters</expr:path></expr:param>
        							<expr:param name="country">
        								<expr:path>'NI01'</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		<bpel:extensionAssignOperation bea:name="REQHConsultaSituacionFinancieraNI">
		<trf:assign varName="REQConsultaSituacionFinancieraNI.RequestHeader">
			<trf:expr>
				<expr:xqueryText>$request.RequestHeader</expr:xqueryText></trf:expr></trf:assign>
        		</bpel:extensionAssignOperation></bpel:assign>
        		<bpel:if>
        			<bpel:condition>count($REQConsultaSituacionFinancieraNI.parameters/REGION/CUSTOMERS/CUSTOMER) &gt; 0 or
count($REQConsultaSituacionFinancieraNI.parameters/REGION/PRODUCTS/PRODUCT) &gt; 0</bpel:condition>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:replace contents-only="false" varName="REQConsultaSituacionFinancieraNI.RequestHeader">
				<trf:location>
					<expr:xpathText>./Region</expr:xpathText></trf:location>
				<trf:expr>
					<expr:xqueryText>&lt;Region&gt;
	&lt;SourceBank&gt;NI01&lt;/SourceBank&gt;
	&lt;DestinationBank&gt;NI01&lt;/DestinationBank&gt;
&lt;/Region&gt;</expr:xqueryText></trf:expr></trf:replace>
		</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:invoke operation="ConsultaSituacionFinancieraNI" partnerLink="ConsultaSituacionFinancieraNI" inputVariable="REQConsultaSituacionFinancieraNI" outputVariable="RSPConsultaSituacionFinancieraNI">
        				<rescon:invokeInfo>
        					<rescon:service isProxy="true" ref="Middleware/v2/ProxyServices/ConsultaSituacionFinancieraNI"></rescon:service></rescon:invokeInfo></bpel:invoke>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<trf:insert varName="temp">
        						<trf:location>
        							<expr:xpathText>./responses</expr:xpathText></trf:location>
        						<trf:where>last-child</trf:where>
        						<trf:expr>
        							<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;{ fn:string($RSPConsultaSituacionFinancieraNI.ResponseHeader/successIndicator/text()) } &lt;/successIndicator&gt;
	&lt;messages&gt;{ fn:string($RSPConsultaSituacionFinancieraNI.ResponseHeader/messages/text())	} &lt;/messages&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        			<bpel:else>
        				<bpel:sequence>
        					<bpel:empty></bpel:empty>
        				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="temp">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;response&gt;
	&lt;successIndicator&gt;SUCCESS&lt;/successIndicator&gt;
&lt;/response&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        			</bpel:else>
        		</bpel:if>
        		</bpel:sequence>
        </bpel:scope></bpel:flow>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.ResponseHeader">
        			<trf:expr>
        				<expr:xqueryText>&lt;aut:ResponseHeader&gt;
	&lt;successIndicator&gt;
		{
			let $numberErrors := count($temp/responses/response[fn:upper-case(successIndicator) != 'SUCCESS'])
			return
				if($numberErrors = 0) then(
					'SUCCESS'
				)else(
					'ERROR'
				)
    	}
	&lt;/successIndicator&gt;
	&lt;messages&gt;{ fn:string-join($temp/responses/response/messages, '. ') }&lt;/messages&gt;
&lt;/aut:ResponseHeader&gt;</expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        	
        </bpel:assign>
        <bpel:reply partnerLink="sjConsultaSituacionFinanciera" operation="ConsultaSituacionFinanciera" variable="response"></bpel:reply>
    </bpel:sequence>
</bpel:process>