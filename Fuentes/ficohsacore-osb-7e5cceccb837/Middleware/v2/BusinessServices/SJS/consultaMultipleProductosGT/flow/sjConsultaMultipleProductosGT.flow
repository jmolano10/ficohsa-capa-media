<bpel:process name="sjConsultaMultipleProductosGT.flow" targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/flow/sjConsultaMultipleProductosGT.flow" bea:name="sjConsultaMultipleProductosGT.flow" xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/flow/sjConsultaMultipleProductosGT.flow" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaCertificadoDeposito/ConsultaCertificadoDeposito" xmlns:ccd="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCertificadoDeposito" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaGeneralPrestamo/ConsultaGeneralPrestamo" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareRegionalSOAApplication/ConsultaMaestraSaldoCuenta/consultaMaestraSaldoCuenta" xmlns:cmsc="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaMaestraSaldoCuenta" xmlns:cgp="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaGeneralPrestamo" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaTasaCambio/ConsultaTasaCambio" xmlns:ctc="http://www.ficohsa.com.hn/middleware.services/consultaTasaCambioTypes" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/AbanksGTSOAApplication/ConsultaSaldosTarjetaCredito/consultaSaldosTarjetaCredito" xmlns:cstc="http://alcance.local/wsinfotarjetas/" xmlns:ns5="http://www.ficohsa.com.hn/middleware.services/sjConsultaMultipleProductosGT" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaMultipleProductosGT" xmlns:ns7="http://www.ficohsa.com.hn/middleware.services/consultaTasaCambioPS/" xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/PruebaSuma/consultaMaestraSaldoCuenta/consultaMaestraSaldoCuenta" xmlns:ns8="http://www.ficohsa.com.hn/middleware.services/consultaMaestraSaldoCuentaPS/" xmlns:ns9="http://www.ficohsa.com.hn/middleware.services/consultaSaldosTarjetaCreditoPS/" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType">
    <rescon:importInfo>
    	<rescon:wsdl-import
    		ref="Middleware/Business_Resources/ConsultasCuenta/ConsultaMaestraSaldoCuenta/consultaMaestraSaldoCuentaPS">
    	</rescon:wsdl-import></rescon:importInfo>
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaMultipleProductosGT.flow" partnerLinkType="tns:sjConsultaMultipleProductosGT.flow" myRole="sjConsultaMultipleProductosGT.flow">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaCertificadoDeposito_db" partnerLinkType="tns:ConsultaCertificadoDeposito_db_plnkType" partnerRole="ConsultaCertificadoDeposito_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaGeneralPrestamo_db" partnerLinkType="tns:ConsultaGeneralPrestamo_db_plnkType" partnerRole="ConsultaGeneralPrestamo_db_PartnerRole">
	   </bpel:partnerLink>
	   
	   <bpel:partnerLink name="ConsultaTasaCambio_db"
	   	partnerLinkType="tns:ConsultaTasaCambio_db_plnkType"
	   	partnerRole="ConsultaTasaCambio_db_PartnerRole">
	   </bpel:partnerLink>
	   
	   <bpel:partnerLink name="consultaMaestraSaldoCuenta_db"
	   	partnerLinkType="tns:consultaMaestraSaldoCuenta_db_plnkType"
	   	partnerRole="consultaMaestraSaldoCuenta_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSaldosTarjetaCredito"
	   	partnerLinkType="tns:ConsultaSaldosTarjetaCredito_plnkType"
	   	partnerRole="ConsultaSaldosTarjetaCredito_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="ns5:sjConsultaMultipleProductosGTRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="ns5:sjConsultaMultipleProductosGTResponse">
	       </bpel:variable>
    <bpel:variable name="productoxTipo" type="xsd:anyType"/>
    <bpel:variable name="totalTipos" type="xsd:int"/>
	   	
	   	
	   	
	   	
	   	
	   	
	   	<bpel:variable name="REQConsultaTasaCambio"
	   		messageType="ns7:consultaTasaCambioRequest">
	   	</bpel:variable>
	   	<bpel:variable name="RSPConsultaTasaCambio"
	   		messageType="ns7:consultaTasaCambioResponse">
	   	</bpel:variable></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaMultipleProductosGT.flow" operation="consultaProductosGT" createInstance="yes" variable="request">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/wsdl/sjConsultaMultipleProductosGT" binding="ns5:sjConsultaMultipleProductosGTPSSOAP"/>
            </rescon:receiveInfo>
        </bpel:receive>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;outputParameters>
	&lt;bind:ASSETS/>
	&lt;bind:LIABILITIES/>
&lt;/outputParameters></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
		<trf:assign varName="productoxTipo">
			<trf:expr>
				<expr:xqueryTransform>
					<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/agruparTipos"/>
					<expr:param name="sjConsultaMultipleProductosGT">
						<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        </bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
        	<trf:assign varName="totalTipos">
        		<trf:expr>
        			<expr:xqueryText>count($productoxTipo/TYPE)</expr:xqueryText></trf:expr></trf:assign>
        </bpel:extensionAssignOperation></bpel:assign>
        <bpel:forEach parallel="yes" counterName="typePosition">
        	<bpel:startCounterValue>1</bpel:startCounterValue>
        	<bpel:finalCounterValue>$totalTipos</bpel:finalCounterValue>
        	<bpel:scope>
        		<bpel:variables>
        			<bpel:variable name="type" type="xsd:string"/>
        			
        			
        			<bpel:variable name="totalProductos" type="xsd:int">
        			</bpel:variable>
        			<bpel:variable name="successIndicator" type="xsd:string">
        			</bpel:variable>
        			<bpel:variable name="tasa" type="xsd:string"></bpel:variable></bpel:variables>
        		<bpel:sequence>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<trf:assign varName="type">
        						<trf:expr>
        							<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/NAME_TYPE/text())</expr:xqueryText></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:if>
        				<bpel:condition>$type="AHO"
or
$type="CHQ"</bpel:condition>
        				<bpel:sequence>
        					<bpel:empty/>
        				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			
			
			<bpel:variables>
				<bpel:variable name="REQConsultaMaestraSaldoCuenta" messageType="ns2:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RSPConsultaMaestraSaldoCuenta" messageType="ns2:args_out_msg">
				</bpel:variable>
				<bpel:variable name="ID" type="xsd:string"></bpel:variable></bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty/>
						<bpel:assign>
							<bpel:extensionAssignOperation>
								<trf:insert varName="response.outputParameters">
									<trf:location>
										<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
									<trf:where>last-child</trf:where>
									<trf:expr>
										<expr:xqueryText>&lt;bind:ASSET&gt;
	&lt;bind:ID&gt;{string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO EL PRODUCTO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:ASSET&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				<bpel:assign>
					
					<bpel:extensionAssignOperation>
						<trf:assign varName="REQConsultaMaestraSaldoCuenta.InputParameters">
							<trf:expr>
								<expr:xqueryText>&lt;ns0:InputParameters&gt;

      &lt;cmsc:PV_ACCOUNT_NUMBER&gt;{ string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text()) }&lt;/cmsc:PV_ACCOUNT_NUMBER&gt;

&lt;/ns0:InputParameters&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
				<bpel:invoke partnerLink="consultaMaestraSaldoCuenta_db" operation="consultaMaestraSaldoCuenta" inputVariable="REQConsultaMaestraSaldoCuenta" outputVariable="RSPConsultaMaestraSaldoCuenta">
					<rescon:invokeInfo>
						<rescon:service isProxy="false" ref="Middleware/v2/BusinessServices/ABKGT/consultaMaestraSaldoCuenta/biz/consultaMaestraSaldoCuenta_db"/></rescon:invokeInfo></bpel:invoke>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="ID">
							<trf:expr>
								<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation>
						<trf:insert varName="response.outputParameters">
							<trf:location>
								<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
							<trf:where>last-child</trf:where>
							<trf:expr>
								<expr:xqueryTransform>
									<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaMaestraSaldoCuentaOut"/>
									
									
									
									
									
									
									
									
									
									
									<expr:param name="ID">
										<expr:path>$ID</expr:path></expr:param>
									<expr:param name="outputParameters">
										<expr:path>$RSPConsultaMaestraSaldoCuenta.OutputParameters</expr:path></expr:param>
									<expr:param name="TYPE">
										<expr:path>$type</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:forEach>
	</bpel:sequence>
        				
        				<bpel:elseif>
        					<bpel:condition>$type="DEP"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        					</bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			
			
			<bpel:variables>
				<bpel:variable name="REQConsultaCertificadoDeposito" messageType="ns1:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RSPConsultaCertificadoDeposito" messageType="ns1:args_out_msg">
				</bpel:variable>
				<bpel:variable name="ID" type="xsd:string"></bpel:variable></bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;bind:ASSET&gt;
	&lt;bind:ID&gt;{string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO EL PRODUCTO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:ASSET&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
					</bpel:assign></bpel:sequence>
				</bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="REQConsultaCertificadoDeposito.InputParameters">
							<trf:expr>
								<expr:xqueryText>&lt;ns0:InputParameters&gt;
     
      &lt;ccd:DEPOSIT_NUMBER&gt;{ string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text()) }&lt;/ccd:DEPOSIT_NUMBER&gt;

&lt;/ns0:InputParameters&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
				<bpel:invoke partnerLink="ConsultaCertificadoDeposito_db" inputVariable="REQConsultaCertificadoDeposito" outputVariable="RSPConsultaCertificadoDeposito" operation="ConsultaCertificadoDeposito">
					<rescon:invokeInfo>
						<rescon:service isProxy="false" ref="Middleware/v2/BusinessServices/ABKGT/consultaCertificadoDeposito/biz/ConsultaCertificadoDeposito_db"/></rescon:invokeInfo></bpel:invoke>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="ID">
							<trf:expr>
								<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation>
						<trf:insert varName="response.outputParameters">
							<trf:location>
								<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
							<trf:where>last-child</trf:where>
							<trf:expr>
								<expr:xqueryTransform>
									<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaCertificadoDepositoOut"/>
									
									
									<expr:param name="ID">
										<expr:path>$ID</expr:path></expr:param>
									<expr:param name="outputParameters">
										<expr:path>$RSPConsultaCertificadoDeposito.OutputParameters</expr:path></expr:param>
									<expr:param name="TYPE">
										<expr:path>$type</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
		</bpel:scope>
	</bpel:forEach>
	
        					
        					
        					</bpel:sequence>
        				</bpel:elseif>
        				
        				<bpel:elseif>
        					<bpel:condition>$type="FPC"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					
	
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>for $productID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return(
&lt;bind:ASSET&gt;
	&lt;bind:ID&gt;{ data($productID) }&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;PRODUCTO NO IMPLEMENTADO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:ASSET&gt;
)</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
	</bpel:assign></bpel:sequence>
        				</bpel:elseif>
        				<bpel:elseif>
        					<bpel:condition>$type="PTM"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			
			<bpel:variables>
				<bpel:variable name="REQConsultaGeneralPrestamo" messageType="ns0:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RSPConsultaGeneralPrestamo" messageType="ns0:args_out_msg">
				</bpel:variable>
				<bpel:variable name="ID" type="xsd:string"></bpel:variable></bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty/>
						<bpel:assign>
							<bpel:extensionAssignOperation>
								<trf:insert varName="response.outputParameters">
									<trf:location>
										<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
									<trf:where>last-child</trf:where>
									<trf:expr>
										<expr:xqueryText>&lt;bind:LIABILITY&gt;
	&lt;bind:ID&gt;{string($productoxTipo/TYPES/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO EL PRODUCTO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:LIABILITY&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="REQConsultaGeneralPrestamo.InputParameters">
							<trf:expr>
								<expr:xqueryText>&lt;ns1:InputParameters&gt;

    &lt;cgp:LOAN_ID&gt;{ string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text()) }&lt;/cgp:LOAN_ID&gt;

&lt;/ns1:InputParameters&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
				
				<bpel:invoke operation="ConsultaGeneralPrestamo" partnerLink="ConsultaGeneralPrestamo_db" inputVariable="REQConsultaGeneralPrestamo" outputVariable="RSPConsultaGeneralPrestamo">
					<rescon:invokeInfo>
						<rescon:service isProxy="false" ref="Middleware/v2/BusinessServices/ABKGT/consultaGeneralPrestamo/biz/ConsultaGeneralPrestamo_db"/></rescon:invokeInfo></bpel:invoke>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="ID">
							<trf:expr>
								<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation>
						<trf:insert varName="response.outputParameters">
							<trf:location>
								<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
							<trf:where>last-child</trf:where>
							<trf:expr>
								<expr:xqueryTransform>
									<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaGeneralPrestamoOut"/>
									
									
									
									
									
									
									
									
									
									<expr:param name="outputParameters">
										<expr:path>$RSPConsultaGeneralPrestamo.OutputParameters</expr:path></expr:param>
									<expr:param name="ID">
										<expr:path>$ID</expr:path></expr:param>
									<expr:param name="TYPE">
										<expr:path>$type</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:forEach>
	</bpel:sequence>
        				</bpel:elseif>
        				
        				<bpel:elseif>
        					<bpel:condition>$type=&quot;TRC&quot;</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty></bpel:empty>
        					<bpel:scope>
		<bpel:faultHandlers>
			<bpel:catch faultName="tns:tasaDeCambioFault">
				<bpel:sequence>
					<bpel:empty></bpel:empty>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>for $productID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return(
&lt;bind:LIABILITY&gt;
	&lt;bind:ID&gt;{ data($productID) }&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO LA TASA DE CAMBIO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:LIABILITY&gt;
)</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
			</bpel:catch>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty></bpel:empty>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>for $productID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return(
&lt;bind:LIABILITY&gt;
	&lt;bind:ID&gt;{ data($productID) }&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO LA TASA DE CAMBIO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:LIABILITY&gt;
)</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
			</bpel:catchAll></bpel:faultHandlers>
	<bpel:sequence>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign
						varName="REQConsultaTasaCambio.RequestHeader">
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource
									ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaTasaCambioHeaderIn"></expr:resource>
								<expr:param
									name="sjConsultaMultipleProductosGT">
									<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation>
				<bpel:extensionAssignOperation>
					<trf:assign
						varName="REQConsultaTasaCambio.parameters">
						<trf:expr>
							<expr:xqueryText>&lt;ctc:consultaTasaCambio&gt;
     &lt;SOURCE_CURRENCY&gt;GTQ&lt;/SOURCE_CURRENCY&gt;
     &lt;TARGET_CURRENCY&gt;USD&lt;/TARGET_CURRENCY&gt;
&lt;/ctc:consultaTasaCambio&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
			<bpel:invoke outputVariable="RSPConsultaTasaCambio"
				inputVariable="REQConsultaTasaCambio" operation="consultaTasaCambio"
				partnerLink="ConsultaTasaCambio_db">
				<rescon:invokeInfo>
					<rescon:service
						ref="Middleware/v2/ProxyServices/ConsultaTasaCambio"
						isProxy="true"></rescon:service></rescon:invokeInfo></bpel:invoke>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<bpel:documentation></bpel:documentation>
					<trf:assign varName="successIndicator">
						<trf:expr>
							<expr:xqueryText>upper-case(string($RSPConsultaTasaCambio.ResponseHeader/successIndicator/text()))</expr:xqueryText></trf:expr></trf:assign>
				</bpel:extensionAssignOperation>
			</bpel:assign>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<bpel:documentation></bpel:documentation>
					<trf:assign varName="totalProductos">
						<trf:expr>
							<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign>
				</bpel:extensionAssignOperation>
			</bpel:assign>
			<bpel:if>
				<bpel:condition>$successIndicator = 'SUCCESS'</bpel:condition>
				<bpel:sequence>
					<bpel:empty></bpel:empty>
					<bpel:assign>
						<bpel:extensionAssignOperation>
							<trf:assign varName="tasa">
								<trf:expr>
									<expr:xqueryText>data($RSPConsultaTasaCambio.result/ctc:consultaTasaCambioResponseType/ctc:consultaTasaCambioResponseRecordType/BUY_RATE)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:forEach parallel="yes"
						counterName="positionProduct">
						<bpel:startCounterValue>1</bpel:startCounterValue>
						<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
						<bpel:scope>
							<bpel:variables>
								
								
								<bpel:variable name="ID"
									type="xsd:string">
								</bpel:variable>
								<bpel:variable
									name="REQConsultaSaldosTarjetaCredito"
									messageType="ns9:consultaSaldosTarjetaCreditoRequest">
								</bpel:variable>
								<bpel:variable
									name="RSPConsultaSaldosTarjetaCedito"
									messageType="ns9:consultaSaldosTarjetaCreditoResponse">
								</bpel:variable></bpel:variables>
							<bpel:faultHandlers>
								<bpel:catchAll>
									<bpel:sequence>
										<bpel:empty></bpel:empty>
										<bpel:assign>
											<bpel:extensionAssignOperation>
												<trf:insert
													varName="response.outputParameters">
													<trf:location>
														<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
													<trf:where>last-child</trf:where>
													<trf:expr>
														<expr:xqueryText>&lt;bind:LIABILITY&gt;
	&lt;bind:ID&gt;{string($productoxTipo/TYPES/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}&lt;/bind:ID&gt;
	&lt;bind:TYPE&gt;{$type}&lt;/bind:TYPE&gt;
	&lt;bind:SOURCE_BANK&gt;GT01&lt;/bind:SOURCE_BANK&gt;
	&lt;bind:SUCCESS_INDICATOR&gt;ERROR&lt;/bind:SUCCESS_INDICATOR&gt;
	&lt;bind:ERROR_MESSAGE&gt;ERROR CONSULTANDO EL PRODUCTO&lt;/bind:ERROR_MESSAGE&gt;
&lt;/bind:LIABILITY&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
							<bpel:sequence>
								<bpel:assign>
									<bpel:extensionAssignOperation>
										<bpel:documentation></bpel:documentation>
										<trf:assign varName="ID">
											<trf:expr>
												<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:xqueryText></trf:expr></trf:assign>
									</bpel:extensionAssignOperation>
									<bpel:extensionAssignOperation>
										<trf:assign
											varName="REQConsultaSaldosTarjetaCredito.RequestHeader">
											<trf:expr>
												<expr:xqueryText>&lt;aut:RequestHeader&gt;
    &lt;Authentication&gt;
        &lt;UserName&gt;{fn:string($request.inputParameters/bind:USERNAME/text())}&lt;/UserName&gt;
        &lt;Password&gt;{fn:string($request.inputParameters/bind:PASSWORD/text())}&lt;/Password&gt;
	&lt;/Authentication&gt;
    &lt;Region&gt;
        &lt;SourceBank&gt;GT01&lt;/SourceBank&gt;
        &lt;DestinationBank&gt;GT01&lt;/DestinationBank&gt;
    &lt;/Region&gt;
&lt;/aut:RequestHeader&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
									<bpel:extensionAssignOperation>
										<trf:assign varName="REQConsultaSaldosTarjetaCredito.parameters">
											<trf:expr>
												<expr:xqueryTransform>
													<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaSaldosTarjetaCreditoIn"></expr:resource>
													<expr:param name="card_number">
														<expr:path>$ID</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
									</bpel:extensionAssignOperation></bpel:assign>
								<bpel:invoke operation="consultaSaldosTarjetaCredito"
									partnerLink="ConsultaSaldosTarjetaCredito" inputVariable="REQConsultaSaldosTarjetaCredito" outputVariable="RSPConsultaSaldosTarjetaCedito">
									<rescon:invokeInfo>
										<rescon:service
											ref="Middleware/v2/ProxyServices/ConsultaSaldosTarjetaCredito"
											isProxy="true"></rescon:service></rescon:invokeInfo></bpel:invoke>
								
								<bpel:assign>
									
									<bpel:extensionAssignOperation>
										<trf:insert
											varName="response.outputParameters">
											<trf:location>
												<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
											<trf:where>last-child</trf:where>
											<trf:expr>
												<expr:xqueryTransform>
													<expr:resource
														ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosGT/xq/consultaSaldosTarjetaCreditoOut"></expr:resource>
													
													
													
													
													
													
													
													
													
													
													
													
													<expr:param name="productType">
														<expr:path>$type</expr:path></expr:param>
													<expr:param name="responseHeader">
														<expr:path>$RSPConsultaSaldosTarjetaCedito.ResponseHeader</expr:path></expr:param>
													<expr:param name="consultaSaldosTarjetaCreditoResponse">
														<expr:path>$RSPConsultaSaldosTarjetaCedito.result</expr:path></expr:param>
													<expr:param name="productID">
														<expr:path>$ID</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:forEach></bpel:sequence>
				<bpel:else>
					<bpel:sequence>
						<bpel:empty></bpel:empty>
						
						<bpel:throw faultName="tns:tasaDeCambioFault"></bpel:throw></bpel:sequence></bpel:else></bpel:if></bpel:sequence>
        					</bpel:scope>
	
	
	
	
	
	
	
        					
        					</bpel:sequence>
        				</bpel:elseif>
        				<bpel:else>
        					<bpel:sequence>
        						<bpel:empty/>
        					</bpel:sequence>
        				</bpel:else>
        			</bpel:if></bpel:sequence>
        	</bpel:scope>
        </bpel:forEach>
        <bpel:reply partnerLink="sjConsultaMultipleProductosGT.flow" operation="consultaProductosGT" variable="response"/>
    </bpel:sequence>
</bpel:process>