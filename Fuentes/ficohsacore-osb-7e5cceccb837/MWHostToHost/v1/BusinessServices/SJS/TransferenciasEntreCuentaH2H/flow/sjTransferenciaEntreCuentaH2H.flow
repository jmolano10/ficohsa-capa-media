<?xml version="1.0" encoding="UTF-8"?>
<bpel:process name="sjTransferenciaEntreCuentaH2H"
              targetNamespace="http://www.example.com/flow/MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/flow/sjTransferenciaEntreCuentaH2H"
              xmlns:tns="http://www.example.com/flow/MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/flow/sjTransferenciaEntreCuentaH2H"
              xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
              xmlns:rescon="http://www.bea.com/alsb/flow/resources/config"
              xmlns:bea="http://www.bea.com/bpel/ui/extensions"
              xmlns:ext="http://www.bea.com/bpel/extensions"
              xmlns:expr="http://www.bea.com/wli/sb/stages/config"
              xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config"
              xmlns:bind="http://www.ficohsa.com.hn/middleware.services/transferenciaEntreCuentaH2HPS/" 
              bea:name="sjTransferenciaEntreCuentaH2H" xmlns:ns1="http://www.ficohsa.com.hn/middleware.services/transferenciasType" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns0="http://www.ficohsa.com.hn/middleware.services/sjTransferenciaEntreCuentaH2HPS/" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/CuentasPorCliente/CuentasPorCliente/CuentasPorCliente" xmlns:ns3="http://www.ficohsa.com.hn/middleware.services/transferenciaCuentasPS/" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/sp/CuentasPorCliente">
    <rescon:importInfo>
    	<rescon:schema-import
    		ref="Middleware/v2/Resources/TransferenciaCuentas/xsd/transferenciaCuentasType">
    	</rescon:schema-import>
    	<rescon:wsdl-import
    		ref="MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/wsdl/sjTransferenciaEntreCuentaH2H">
    	</rescon:wsdl-import>
    	<rescon:wsdl-import
    		ref="Middleware/v2/Resources/TransferenciaCuentas/wsdl/transferenciaCuentasPS">
    	</rescon:wsdl-import></rescon:importInfo>
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjTransferenciaEntreCuentaH2H" partnerLinkType="tns:sjTransferenciaEntreCuentaH2H"
                          myRole="sjTransferenciaEntreCuentaH2H">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="CuentasPorCliente_db"
		partnerLinkType="tns:CuentasPorCliente_db_plnkType"
		partnerRole="CuentasPorCliente_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="TransferenciaCuentas"
	   	partnerLinkType="tns:TransferenciaCuentas_plnkType"
	   	partnerRole="TransferenciaCuentas_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="ns0:sjTransferenciaEntreCuentaH2H">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="ns0:sjTransferenciaEntreCuentaH2HResponse">
	       </bpel:variable>
    
    
    <bpel:variable name="TempREQ" type="xsd:anyType"></bpel:variable>
    <bpel:variable name="ConsultaCuentaIN"
    	messageType="ns2:args_in_msg">
    </bpel:variable>
    <bpel:variable name="ConsultaCuentaOUT"
    	messageType="ns2:args_out_msg">
    </bpel:variable>
    <bpel:variable name="TranferenciaCuentaREQ"
    	messageType="ns3:transferenciaCuentasRequest">
    </bpel:variable>
    <bpel:variable name="TransferenciaCuentaRSP"
    	messageType="ns3:transferenciaCuentasResponse">
    </bpel:variable></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjTransferenciaEntreCuentaH2H" operation="sjTransferenciaEntreCuentaH2H" createInstance="yes" variable="request">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/wsdl/sjTransferenciaEntreCuentaH2H" binding="ns0:sjTransferenciaEntreCuentaH2HPSSOAP"/>
            </rescon:receiveInfo>
        </bpel:receive>
        <bpel:scope>
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<bpel:documentation></bpel:documentation>
        				<trf:assign varName="response.outputParameters">
        					<trf:expr>
        						<expr:xqueryText>&lt;outputParameters&gt;
	&lt;SUCCESS_INDICATOR&gt;SUCCESS&lt;/SUCCESS_INDICATOR&gt;
	&lt;TRANSFERS_INT/&gt;
&lt;/outputParameters&gt;</expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation>
        				<trf:assign varName="TempREQ">
        					<trf:expr>
        						<expr:xqueryText>&lt;requestTemp&gt;
	&lt;TRANSFERS_INT/&gt;
&lt;/requestTemp&gt;</expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		</bpel:assign></bpel:sequence>
        </bpel:scope>
        
        <bpel:scope>
        	<bpel:variables>
        		<bpel:variable name="consultaCuentaError"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="trace" type="xsd:string"></bpel:variable>
        		<bpel:variable name="bodyTransaction"
        			type="xsd:anyType">
        		</bpel:variable>
        		<bpel:variable name="transfer" type="xsd:anyType"></bpel:variable>
        		<bpel:variable name="indice" type="xsd:integer"></bpel:variable>
        		</bpel:variables>
        	<bpel:faultHandlers>
        		<bpel:catchAll>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="transfer">
				<trf:expr>
					<expr:xqueryText>&lt;NODE&gt;
	&lt;TRANSFER_INT&gt;
		&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
		&lt;ERROR_MESSAGE&gt;Ocurrio un error al consultar las cuentas.&lt;/ERROR_MESSAGE&gt;
	&lt;/TRANSFER_INT&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation>
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./TRANSFERS_INT</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
		<trf:expr>
			<expr:xqueryText>$transfer/*</expr:xqueryText></trf:expr></trf:insert>
        			</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        		</bpel:catchAll></bpel:faultHandlers>
        	
        	<bpel:sequence>
        		<bpel:forEach parallel="yes" counterName="accountIndex">
        			<bpel:startCounterValue>1</bpel:startCounterValue>
        			<bpel:finalCounterValue>count($request.inputParameters/TRANSFERS_INT/TRANSFER_INT)</bpel:finalCounterValue>
        			<bpel:scope>
        				<bpel:sequence>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign varName="indice">
        								<trf:expr>
        									<expr:xqueryText>$accountIndex</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						
        						<bpel:extensionAssignOperation>
        							<trf:assign varName="ConsultaCuentaIN.InputParameters">
        								<trf:expr>
        									<expr:xqueryTransform>
        										<expr:resource ref="MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/xq/sjConsultaCuentaClienteIN"></expr:resource>
        										
        										
        										
        										
        										
        										
        										
        										
        										
        										
        										
        										<expr:param name="Pais">
        											<expr:path>$request.inputParameters/SOURCE_BANK/text()</expr:path></expr:param>
        										<expr:param name="Cliente">
        											<expr:path>$request.inputParameters/CUSTOMER_ID/text()</expr:path></expr:param>
        										<expr:param name="Cuenta">
        											<expr:path>data($request.inputParameters/TRANSFERS_INT/TRANSFER_INT[$accountIndex]/DEBIT_ACCOUNT/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        					</bpel:assign>
        					<bpel:invoke operation="CuentasPorCliente" partnerLink="CuentasPorCliente_db" inputVariable="ConsultaCuentaIN" outputVariable="ConsultaCuentaOUT">
        						<rescon:invokeInfo>
        							<rescon:service isProxy="false" ref="MWHostToHost/v1/BusinessServices/INTFC/consultaCuentasPorClienteH2H/biz/CuentasPorCliente_db"></rescon:service></rescon:invokeInfo></bpel:invoke>
        					<bpel:assign>
        						
        						
        						
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign varName="consultaCuentaError">
        								<trf:expr>
        									<expr:xqueryText>fn:upper-case(string($ConsultaCuentaOUT.OutputParameters/ns4:PV_CODIGOMENSAJE))</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						
        						<bpel:extensionAssignOperation>
        							<trf:assign varName="trace">
        								<trf:expr>
        									<expr:xqueryText>string($request.inputParameters/TRANSFERS_INT/TRANSFER_INT[ xs:int($accountIndex) ]/TRACE/text())</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        					</bpel:assign>
        					<bpel:if>
        						<bpel:condition>$consultaCuentaError = 'SUCCESS'</bpel:condition>
        						<bpel:sequence>
        							<bpel:empty></bpel:empty>
        						<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="bodyTransaction">
				<trf:expr>
					<expr:xqueryText>&lt;NODE&gt;
	{$request.inputParameters/TRANSFERS_INT/TRANSFER_INT[ xs:int($accountIndex) ]}
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        						<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:insert varName="TempREQ">
			<trf:location>
				<expr:xpathText>./TRANSFERS_INT</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>$bodyTransaction/*</expr:xqueryText></trf:expr></trf:insert>
        						</bpel:extensionAssignOperation></bpel:assign>
        						</bpel:sequence>
        						<bpel:else>
        							<bpel:sequence>
        								<bpel:empty></bpel:empty>
        							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="transfer">
				<trf:expr>
					<expr:xqueryText>&lt;NODE&gt;
	&lt;TRANSFER_INT&gt;
		&lt;SUCCESS_INDICATOR&gt;{ string($ConsultaCuentaOUT.OutputParameters/ns4:PV_CODIGOMENSAJE) }&lt;/SUCCESS_INDICATOR&gt;
		&lt;ERROR_MESSAGE&gt;{ string($ConsultaCuentaOUT.OutputParameters/ns4:PV_DESCRIPCIONMENSAJE) }&lt;/ERROR_MESSAGE&gt;
		&lt;TRACE&gt;{ $trace}&lt;/TRACE&gt;
	&lt;/TRANSFER_INT&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        							<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./TRANSFERS_INT</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>$transfer/*</expr:xqueryText></trf:expr></trf:insert>
        							</bpel:extensionAssignOperation></bpel:assign>
        							</bpel:sequence>
        						</bpel:else>
        					</bpel:if></bpel:sequence>
        			</bpel:scope>
        		</bpel:forEach>
        		</bpel:sequence>
        </bpel:scope>
        <bpel:scope>
        	<bpel:variables>
        		<bpel:variable name="successIndicator"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="errorMessage" type="xsd:string"></bpel:variable>
        		<bpel:variable name="transactionId" type="xsd:string"></bpel:variable>
        		<bpel:variable name="validationMessage"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="orderingCustomer" type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="transfer" type="xsd:anyType"></bpel:variable>
        		<bpel:variable name="trace" type="xsd:string"></bpel:variable>
        		<bpel:variable name="countTransaction" type="xsd:integer"></bpel:variable>
        		
        		
        		
        		<bpel:variable name="Debit_customer"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="Credit_customer"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="Debit_currency"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="Credit_currency"
        			type="xsd:string">
        		</bpel:variable>
        		<bpel:variable name="Debit_amount" type="xsd:string"></bpel:variable>
        		<bpel:variable name="Credit_amount" type="xsd:string"></bpel:variable>
        		<bpel:variable name="Exchange_rate" type="xsd:string"></bpel:variable>
        		<bpel:variable name="debit_account" type="xsd:string"></bpel:variable>
        		<bpel:variable name="credit_account"
        			type="xsd:string">
        		</bpel:variable></bpel:variables>
        	<bpel:faultHandlers>
        		<bpel:catchAll>
        			<bpel:sequence>
        				<bpel:empty></bpel:empty>
        			<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="transfer">
				<trf:expr>
					<expr:xqueryText>&lt;NODE&gt;
	&lt;TRANSFER_INT&gt;
		&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
		&lt;ERROR_MESSAGE&gt;Ocurrio un error al realizar la transferencia&lt;/ERROR_MESSAGE&gt;
	&lt;/TRANSFER_INT&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        			<bpel:extensionAssignOperation>
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./TRANSFERS_INT</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
		<trf:expr>
			<expr:xqueryText>$transfer/*</expr:xqueryText></trf:expr></trf:insert>
        			</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        		</bpel:catchAll></bpel:faultHandlers>
        	<bpel:sequence>
        		<bpel:forEach parallel="yes" counterName="transferIndex">
        			<bpel:startCounterValue>1</bpel:startCounterValue>
        			<bpel:finalCounterValue>count($TempREQ/TRANSFERS_INT/TRANSFER_INT)</bpel:finalCounterValue>
        			<bpel:scope>
        				<bpel:sequence>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<trf:assign varName="TranferenciaCuentaREQ.RequestHeader">
        								<trf:expr>
        									<expr:xqueryText>&lt;aut:RequestHeader&gt;
	&lt;Authentication&gt;
		&lt;UserName&gt;{ upper-case(string($request.inputParameters/USER_NAME/text())) }&lt;/UserName&gt;
		&lt;Password&gt;{ string($request.inputParameters/PASSWORD/text()) }&lt;/Password&gt;
	&lt;/Authentication&gt;
	&lt;Region&gt;
		&lt;SourceBank&gt;{ string($request.inputParameters/SOURCE_BANK/text()) }&lt;/SourceBank&gt;
		&lt;DestinationBank&gt;&lt;/DestinationBank&gt;
	&lt;/Region&gt;
&lt;/aut:RequestHeader&gt;</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        					<bpel:extensionAssignOperation>
		<trf:assign varName="TranferenciaCuentaREQ.parameters">
			<trf:expr>
				<expr:xqueryTransform>
					<expr:resource ref="MWHostToHost/v1/BusinessServices/SJS/TransferenciasEntreCuentaH2H/xq/sjTranferenciaCuentaIN"></expr:resource>
					
					<expr:param name="transferIndex">
						<expr:path>$transferIndex</expr:path></expr:param>
					<expr:param name="sjTransferenciaCuentaRequest">
						<expr:path>$TempREQ</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        					</bpel:extensionAssignOperation></bpel:assign>
        					<bpel:invoke operation="transferenciaCuentas" partnerLink="TransferenciaCuentas" inputVariable="TranferenciaCuentaREQ" outputVariable="TransferenciaCuentaRSP">
        						<rescon:invokeInfo>
        							<rescon:service isProxy="true" ref="Middleware/v2/ProxyServices/TransferenciaCuentas"></rescon:service></rescon:invokeInfo></bpel:invoke>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<trf:assign varName="trace">
        								<trf:expr>
        									<expr:xqueryText>string($TempREQ/TRANSFERS_INT/TRANSFER_INT[ xs:int($transferIndex) ]/TRACE/text())</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        					<bpel:extensionAssignOperation>
		<trf:assign varName="successIndicator">
			<trf:expr>
				<expr:xqueryText>fn:upper-case(string($TransferenciaCuentaRSP.ResponseHeader/successIndicator))</expr:xqueryText></trf:expr></trf:assign>
        					</bpel:extensionAssignOperation></bpel:assign>
        					<bpel:if>
        						<bpel:condition>$successIndicator = 'SUCCESS'</bpel:condition>
        						<bpel:sequence>
        							<bpel:empty></bpel:empty>
        						<bpel:assign>
		
	
	
	
	
	
	
	<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:assign varName="transactionId">
			<trf:expr>
				<expr:xqueryText>string($TransferenciaCuentaRSP.ResponseHeader/transactionId)</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:assign varName="debit_account">
			<trf:expr>
				<expr:xqueryText>string($TransferenciaCuentaRSP.result/DEBIT_ACCOUNT)</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	
	
	<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:assign varName="credit_account">
			<trf:expr>
				<expr:xqueryText>string($TransferenciaCuentaRSP.result/CREDIT_ACCOUNT)</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	
	
	
	
	<bpel:extensionAssignOperation>
		<bpel:documentation></bpel:documentation>
		<trf:assign varName="Credit_customer">
			<trf:expr>
				<expr:xqueryText>string($TransferenciaCuentaRSP.result/CREDIT_CUSTOMER)</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	
	
	
	<bpel:extensionAssignOperation>
		<trf:assign varName="Debit_customer">
			<trf:expr>
				<expr:xqueryText>string($TransferenciaCuentaRSP.result/DEBIT_CUSTOMER)</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	
	
	
	
	
        						
	
        						
        						
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign
        								varName="Debit_currency">
        								<trf:expr>
        									<expr:xqueryText>string($TransferenciaCuentaRSP.result/DEBIT_CURRENCY)</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						
        						
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign
        								varName="Credit_currency">
        								<trf:expr>
        									<expr:xqueryText>string($TransferenciaCuentaRSP.result/CREDIT_CURRENCY)</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign
        								varName="Debit_amount">
        								<trf:expr>
        									<expr:xqueryText>string($TransferenciaCuentaRSP.result/DEBIT_AMOUNT)</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign
        								varName="Credit_amount">
        								<trf:expr>
        									<expr:xqueryText>string($TransferenciaCuentaRSP.result/CREDIT_AMOUNT)</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign
        								varName="Exchange_rate">
        								<trf:expr>
        									<expr:xqueryText>string($TransferenciaCuentaRSP.result/EXCHANGE_RATE)</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						<bpel:extensionAssignOperation>
        							<bpel:documentation></bpel:documentation>
        							<trf:assign varName="transfer">
        								<trf:expr>
        									<expr:xqueryText>&lt;NODE&gt;
	&lt;TRANSFER_INT&gt;
		&lt;SUCCESS_INDICATOR&gt;{ $successIndicator }&lt;/SUCCESS_INDICATOR&gt;
		&lt;TRACE&gt;{ $trace}&lt;/TRACE&gt;
		&lt;TRANSACTION_ID&gt;{ $transactionId } &lt;/TRANSACTION_ID&gt;
	    &lt;DEBIT_ACCOUNT&gt;{ $debit_account }&lt;/DEBIT_ACCOUNT&gt;
		&lt;CREDIT_ACCOUNT&gt;{ $credit_account }&lt;/CREDIT_ACCOUNT&gt;
		&lt;DEBIT_CUSTOMER&gt;{ $Debit_customer }&lt;/DEBIT_CUSTOMER&gt;
		&lt;CREDIT_CUSTOMER&gt;{ $Credit_customer }&lt;/CREDIT_CUSTOMER&gt;
		&lt;DEBIT_CURRENCY&gt;{ $Debit_currency }&lt;/DEBIT_CURRENCY&gt;
		&lt;CREDIT_CURRENCY&gt;{ $Credit_currency }&lt;/CREDIT_CURRENCY&gt;
		&lt;DEBIT_AMOUNT&gt;{ $Debit_amount }&lt;/DEBIT_AMOUNT&gt;
		&lt;CREDIT_AMOUNT&gt;{ $Credit_amount }&lt;/CREDIT_AMOUNT&gt;
		&lt;EXCHANGE_RATE&gt;{ $Exchange_rate }&lt;/EXCHANGE_RATE&gt;
	&lt;/TRANSFER_INT&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						</bpel:assign></bpel:sequence>
        						<bpel:else>
        							<bpel:sequence>
        								<bpel:empty></bpel:empty>
        							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="errorMessage">
				<trf:expr>
					<expr:xqueryText>string($TransferenciaCuentaRSP.ResponseHeader/messages)</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        							<bpel:extensionAssignOperation>
		<trf:assign varName="transfer">
			<trf:expr>
				<expr:xqueryText>&lt;NODE&gt;
	&lt;TRANSFER_INT&gt;
		&lt;SUCCESS_INDICATOR&gt;{ $successIndicator }&lt;/SUCCESS_INDICATOR&gt;
		&lt;ERROR_MESSAGE&gt;{ $errorMessage }&lt;/ERROR_MESSAGE&gt;
		&lt;TRACE&gt;{ $trace}&lt;/TRACE&gt;
	&lt;/TRANSFER_INT&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
        							</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        						</bpel:else>
        					</bpel:if>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<trf:insert varName="response.outputParameters">
        								<trf:location>
        									<expr:xpathText>./TRANSFERS_INT</expr:xpathText></trf:location>
        								<trf:where>last-child</trf:where>
        							<trf:expr>
        								<expr:xqueryText>$transfer/*</expr:xqueryText></trf:expr></trf:insert>
        						</bpel:extensionAssignOperation>
        					</bpel:assign></bpel:sequence>
        			</bpel:scope>
        		</bpel:forEach></bpel:sequence></bpel:scope>
        <bpel:reply partnerLink="sjTransferenciaEntreCuentaH2H" operation="sjTransferenciaEntreCuentaH2H" variable="response"></bpel:reply>
    </bpel:sequence>
</bpel:process>