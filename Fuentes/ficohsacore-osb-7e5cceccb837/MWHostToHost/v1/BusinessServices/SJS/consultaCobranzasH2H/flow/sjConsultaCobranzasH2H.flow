<bpel:process name="sjConsultaCobranzasH2H" targetNamespace="http://www.example.com/flow/MWHostToHost/v1/BusinessServices/SJS/consultaCobranzasH2H/flow/sjConsultaCobranzasH2H" bea:name="sjConsultaCobranzasH2H" xmlns:tns="http://www.example.com/flow/MWHostToHost/v1/BusinessServices/SJS/consultaCobranzasH2H/flow/sjConsultaCobranzasH2H" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaCobranzasH2HPS/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/DbAdapters/Project1/consultaConvenioH2H" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/Application1/Project1/consultaParametrosCBR" xmlns:cbr="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaParametrosCBR" xmlns:conv="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaConvenioH2H" xmlns:ns2="http://www.ficohsa.com.hn/middleware.services/consultaRecaudoPS/" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns3="http://www.ficohsa.com.hn/middleware.services/sjCobranzasH2HTypes">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaCobranzasH2H" partnerLinkType="tns:sjConsultaCobranzasH2H" myRole="sjConsultaCobranzasH2H">
	       </bpel:partnerLink>
	   
	   <bpel:partnerLink name="consultaParametrosCBR_db" partnerLinkType="tns:consultaParametrosCBR_db_plnkType" partnerRole="consultaParametrosCBR_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaRecaudo_v2" partnerLinkType="tns:consultaRecaudo_v2_plnkType" partnerRole="consultaRecaudo_v2_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="bind:sjConsultaCobranzasH2HRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="bind:sjConsultaCobranzasH2HResponse">
	       </bpel:variable>
    
    
    <bpel:variable name="errorAmount" type="xsd:anyType"></bpel:variable>
    <bpel:variable name="successAmount" type="xsd:anyType"></bpel:variable></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaCobranzasH2H" operation="sjConsulta" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                <rescon:wsdl ref="MWHostToHost/v1/BusinessServices/SJS/consultaCobranzasH2H/wsdl/sjConsultaCobranzasH2H" binding="bind:sjConsultaCobranzasH2HPSSOAP"/>
            </rescon:receiveInfo>
        </bpel:receive>
        <bpel:scope bea:name="PrepararParametros">
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation bea:name="Salida">
        				<trf:assign varName="response.outputParameters">
        					<trf:expr>
        						<expr:xqueryText>&lt;outputParameters>
	&lt;SUCCESS_INDICATOR>SUCCESS&lt;/SUCCESS_INDICATOR>
	&lt;SERVICES/>
&lt;/outputParameters></expr:xqueryText></trf:expr></trf:assign>
        			</bpel:extensionAssignOperation>
        		
        		<bpel:extensionAssignOperation bea:name="errorAmount">
		<trf:assign varName="errorAmount">
			<trf:expr>
				<expr:xqueryText>&lt;NODE/&gt;</expr:xqueryText></trf:expr></trf:assign>
        		</bpel:extensionAssignOperation>
        		<bpel:extensionAssignOperation bea:name="successAmount">
        			<trf:assign varName="successAmount">
        				<trf:expr>
        					<expr:xqueryText>&lt;NODE/&gt;</expr:xqueryText></trf:expr></trf:assign>
        		</bpel:extensionAssignOperation></bpel:assign>
        		</bpel:sequence>
        </bpel:scope>
        <bpel:scope>
        	<bpel:sequence>
        		<bpel:forEach parallel="yes" counterName="serviceIndex">
        			<bpel:startCounterValue>1</bpel:startCounterValue>
        			<bpel:finalCounterValue>count($request.inputParameters/SERVICES/SERVICE)</bpel:finalCounterValue>
        			<bpel:scope>
        				<bpel:variables>
        					
        					
        					
        					<bpel:variable name="successIndicator" type="xsd:string">
        					</bpel:variable>
        					<bpel:variable name="REQConsultaParametrosCBR" messageType="ns0:args_in_msg">
        					</bpel:variable>
        					<bpel:variable name="RSPConsultaParametrosCBR" messageType="ns0:args_out_msg">
        					</bpel:variable>
        					<bpel:variable name="contractId" type="xsd:string">
        					</bpel:variable>
        					
        					<bpel:variable name="numDebtors" type="xsd:int">
        					</bpel:variable>
        					<bpel:variable name="serviceName"
        						type="xsd:string">
        					</bpel:variable>
        					
        					<bpel:variable name="service" type="xsd:anyType">
        					</bpel:variable>
        					<bpel:variable name="serviceId"
        						type="xsd:string">
        					</bpel:variable></bpel:variables>
        				
        				<bpel:faultHandlers>
        					<bpel:catch faultName="tns:ERROR">
        						<bpel:sequence>
        							<bpel:empty></bpel:empty>
        						<bpel:assign>
		<bpel:extensionAssignOperation bea:name="errorService">
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./SERVICES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;SERVICE&gt;
	&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
	&lt;ERROR_MESSAGE&gt;Se produjo un error al consultar la información general del servicio.&lt;/ERROR_MESSAGE&gt;
	&lt;ID&gt;{ $serviceId }&lt;/ID&gt;
&lt;/SERVICE&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation>
		<bpel:extensionAssignOperation bea:name="errorAmount">
			<trf:insert varName="errorAmount">
				<trf:location>
					<expr:xpathText>.</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>let $num := count($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR)

	for $i in 1 to $num
	return
		&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        					</bpel:catch>
        					<bpel:catch faultName="tns:NO_RECORDS">
        						<bpel:sequence>
        							<bpel:empty></bpel:empty>
        						<bpel:assign>
		<bpel:extensionAssignOperation bea:name="noRecordsService">
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./SERVICES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;SERVICE&gt;
	&lt;SUCCESS_INDICATOR&gt;NO RECORDS&lt;/SUCCESS_INDICATOR&gt;
	&lt;ERROR_MESSAGE&gt;Ningún contrato asociado al servicio devolvió información.&lt;/ERROR_MESSAGE&gt;
	&lt;ID&gt;{ $serviceId }&lt;/ID&gt;
&lt;/SERVICE&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation>
		<bpel:extensionAssignOperation bea:name="errorAmount">
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="errorAmount">
				<trf:location>
					<expr:xpathText>.</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>let $num := count($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR)

	for $i in 1 to $num
	return
		&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        					</bpel:catch>
        					<bpel:catchAll>
        						<bpel:sequence>
        							<bpel:empty/>
        						<bpel:assign>
		<bpel:extensionAssignOperation bea:name="errorService">
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./SERVICES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;SERVICE&gt;
	&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
	&lt;ERROR_MESSAGE&gt;Se produjo un error en la ejecución del servicio ConsultaCobranzasH2H.&lt;/ERROR_MESSAGE&gt;
	&lt;ID&gt;{ $serviceId }&lt;/ID&gt;
&lt;/SERVICE&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation>
		<bpel:extensionAssignOperation bea:name="errorAmount">
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="errorAmount">
				<trf:location>
					<expr:xpathText>.</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>let $num := count($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR)

	for $i in 1 to $num
	return
		&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        					</bpel:catchAll></bpel:faultHandlers>
        				<bpel:sequence>
        					
        					
        					
        					
        					<bpel:assign>
        						<bpel:extensionAssignOperation
        							bea:name="serviceId">
        							<bpel:documentation></bpel:documentation>
        							<trf:assign varName="serviceId">
        								<trf:expr>
        									<expr:xqueryText>string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/ID/text())</expr:xqueryText></trf:expr></trf:assign>
        						</bpel:extensionAssignOperation>
        						
        					</bpel:assign>
        					<bpel:if>
        						<bpel:condition>count($request.inputParameters/SERVICES/SERVICE[ number($serviceIndex) ]/CONTRACT_ID) &gt; 0</bpel:condition>
        						<bpel:sequence>
        							<bpel:empty/>
        						<bpel:assign>
		<bpel:extensionAssignOperation bea:name="contractId">
			<bpel:documentation></bpel:documentation>
			<trf:assign varName="contractId">
				<trf:expr>
					<expr:xqueryText>string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/CONTRACT_ID/text())</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        						</bpel:assign>
	<bpel:assign>
		<bpel:extensionAssignOperation bea:name="serviceName">
			<bpel:documentation></bpel:documentation>
			<trf:assign varName="serviceName">
				<trf:expr>
					<expr:xqueryText>string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/NAME/text())</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        						</bpel:assign>
	<bpel:scope
		bea:name="ConsultaParametrosCBR">
		<bpel:sequence>
			<bpel:assign>
				
				<bpel:extensionAssignOperation
					bea:name="REQConsultaParametrosCBR">
					<trf:assign
						varName="REQConsultaParametrosCBR.InputParameters">
						<trf:expr>
							<expr:xqueryText>&lt;InputParameters&gt;
	&lt;cbr:PV_IDSERVICIO&gt;{ $serviceId }&lt;/cbr:PV_IDSERVICIO&gt;
	&lt;cbr:PV_OPERACION&gt;CON&lt;/cbr:PV_OPERACION&gt;
&lt;/InputParameters&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
			<bpel:invoke outputVariable="RSPConsultaParametrosCBR"
				operation="consultaParametrosCBR"
				inputVariable="REQConsultaParametrosCBR"
				partnerLink="consultaParametrosCBR_db">
				<rescon:invokeInfo>
					<rescon:service isProxy="false"
						ref="MWHostToHost/v1/BusinessServices/ABKHN/consultaParametrosCBR/biz/consultaParametrosCBR_db"></rescon:service></rescon:invokeInfo></bpel:invoke>
			<bpel:assign>
				<bpel:extensionAssignOperation
					bea:name="successIndicator">
					<trf:assign varName="successIndicator">
						<trf:expr>
							<expr:xqueryText>string($RSPConsultaParametrosCBR.OutputParameters/cbr:PV_CODIGOMENSAJE/text())</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope>
        						<bpel:if>
        							<bpel:condition>$successIndicator = 'SUCCESS'</bpel:condition>
        							<bpel:sequence>
        								<bpel:empty></bpel:empty>
        							<bpel:assign>
		<bpel:extensionAssignOperation bea:name="service">
		<trf:assign varName="service">
			<trf:expr>
				<expr:xqueryText>&lt;NODE&gt;
	&lt;SERVICE&gt;
		&lt;SUCCESS_INDICATOR&gt;Success&lt;/SUCCESS_INDICATOR&gt;
		&lt;ID&gt;{ $serviceId }&lt;/ID&gt;
		&lt;NAME&gt;{ $serviceName }&lt;/NAME&gt;
		&lt;DEBTORS/&gt;
	&lt;/SERVICE&gt;
&lt;/NODE&gt;</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
	<bpel:extensionAssignOperation bea:name="numDebtors">
			<bpel:documentation></bpel:documentation>
			<trf:assign varName="numDebtors">
				<trf:expr>
					<expr:xqueryText>count($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR)</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        							
        							</bpel:assign>
	<bpel:forEach
		counterName="debtorIndex" parallel="yes">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$numDebtors</bpel:finalCounterValue>
		<bpel:scope>
			<bpel:variables>
				<bpel:variable messageType="ns2:consultaRecaudoRequest"
					name="REQConsultaRecaudoV2"></bpel:variable>
				<bpel:variable messageType="ns2:consultaRecaudoResponse"
					name="RSPConsultaRecaudoV2"></bpel:variable>
				<bpel:variable name="trace" type="xsd:string"></bpel:variable>
				<bpel:variable name="debtorCode" type="xsd:string"></bpel:variable></bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty></bpel:empty>
						<bpel:assign>
							<bpel:extensionAssignOperation
								bea:name="errorDebtor">
								<trf:insert
									varName="service">
									<trf:location>
										<expr:xpathText>./SERVICE/DEBTORS</expr:xpathText></trf:location>
									<trf:where>last-child</trf:where>
									
									<trf:expr>
	<expr:xqueryText>&lt;DEBTOR&gt;
	&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
	&lt;ERROR_MESSAGE&gt;Falló la invocación del servicio consulta recaudo.&lt;/ERROR_MESSAGE&gt;
	&lt;TRACE&gt;{ $trace }&lt;/TRACE&gt;
	&lt;CODE&gt;{ $debtorCode }&lt;/CODE&gt;
&lt;/DEBTOR&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation>
							<bpel:extensionAssignOperation
								bea:name="errorAmount">
								<bpel:documentation></bpel:documentation>
								<trf:insert varName="errorAmount">
									<trf:location>
										<expr:xpathText>.</expr:xpathText></trf:location>
									<trf:where>last-child</trf:where>
									<trf:expr>
										<expr:xqueryText>&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
							</bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				<bpel:assign>
					
					<bpel:extensionAssignOperation bea:name="trace">
						<trf:assign varName="trace">
							<trf:expr>
								<expr:xqueryText>string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR[ xs:int($debtorIndex) ]/TRACE/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation bea:name="debtorCode">
						<trf:assign varName="debtorCode">
							<trf:expr>
								<expr:xqueryText>string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR[ xs:int($debtorIndex) ]/CODE/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation
						bea:name="REQConsultaRecaudoBody">
						<trf:assign
							varName="REQConsultaRecaudoV2.parameters">
							<trf:expr>
								<expr:xqueryTransform>
									<expr:resource
										ref="MWHostToHost/v1/BusinessServices/SJS/consultaCobranzasH2H/xq/consultaRecaudosIn"></expr:resource>
									
									
									<expr:param name="DEBTOR">
										<expr:path>$request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR[ xs:int($debtorIndex) ]</expr:path></expr:param>
									<expr:param name="PT_CAMPOSPORSERVICIO">
										<expr:path>$RSPConsultaParametrosCBR.OutputParameters/cbr:PT_CAMPOSPORSERVICIO</expr:path></expr:param>
									<expr:param name="localCurrency">
										<expr:path>'HNL'</expr:path></expr:param>
									<expr:param name="contractId">
										<expr:path>$contractId</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation>
					</bpel:assign>
				<bpel:if>
					<bpel:condition>count($REQConsultaRecaudoV2.parameters/CONTRACT_ID) &gt; 0</bpel:condition>
					<bpel:sequence>
						<bpel:empty></bpel:empty>
						<bpel:scope bea:name="ConsultaRecaudo">
							<bpel:sequence>
								<bpel:assign>
									<bpel:extensionAssignOperation
										bea:name="REQConsultaRecaudoHeader">
										<trf:assign
											varName="REQConsultaRecaudoV2.RequestHeader">
											<trf:expr>
												<expr:xqueryText>&lt;aut:RequestHeader&gt;
	&lt;Authentication&gt;
		&lt;UserName&gt;{ upper-case(string($request.inputParameters/USER_NAME/text())) }&lt;/UserName&gt;
		&lt;Password&gt;{ string($request.inputParameters/PASSWORD/text()) }&lt;/Password&gt;
	&lt;/Authentication&gt;
	&lt;Region&gt;
		&lt;SourceBank&gt;{ string($request.inputParameters/SOURCE_BANK/text()) }&lt;/SourceBank&gt;
		&lt;DestinationBank&gt;&lt;/DestinationBank&gt;
	&lt;/Region&gt;
&lt;/aut:RequestHeader&gt;</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
								<bpel:invoke
									partnerLink="consultaRecaudo_v2" operation="consultaRecaudo"
									outputVariable="RSPConsultaRecaudoV2"
									inputVariable="REQConsultaRecaudoV2">
									<rescon:invokeInfo>
										<rescon:service
											ref="MWHostToHost/v1/BusinessServices/OSB/consultaRecaudo_v2/biz/consultaRecaudo_v2"
											isProxy="false"></rescon:service></rescon:invokeInfo></bpel:invoke>
								<bpel:assign>
									<bpel:extensionAssignOperation
										bea:name="debtor">
										<trf:insert varName="service">
											<trf:location>
												<expr:xpathText>./SERVICE/DEBTORS</expr:xpathText></trf:location>
											<trf:where>last-child</trf:where>
											<trf:expr>
												
												<expr:xqueryTransform>
	<expr:resource ref="MWHostToHost/v1/BusinessServices/SJS/consultaCobranzasH2H/xq/consultaRecaudosOut"></expr:resource>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<expr:param name="requestCurrency">
		<expr:path>fn:string($request.inputParameters/SERVICES/SERVICE[ xs:int($serviceIndex) ]/DEBTORS/DEBTOR[ xs:int($debtorIndex) ]/CURRENCY/text())</expr:path></expr:param>
	<expr:param name="code">
		<expr:path>$debtorCode</expr:path></expr:param>
	<expr:param name="responseHeader">
		<expr:path>$RSPConsultaRecaudoV2.ResponseHeader</expr:path></expr:param>
	<expr:param name="localCurrency">
		<expr:path>'HNL'</expr:path></expr:param>
	<expr:param name="consultaRecaudoResponse">
		<expr:path>$RSPConsultaRecaudoV2.result</expr:path></expr:param>
	<expr:param name="trace">
		<expr:path>$trace</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign>
								<bpel:if>
									<bpel:condition>string($RSPConsultaRecaudoV2.ResponseHeader/successIndicator/text()) != 'Success'</bpel:condition>
									<bpel:sequence>
										<bpel:empty></bpel:empty>
									<bpel:assign>
		<bpel:extensionAssignOperation bea:name="errorAmount">
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="errorAmount">
				<trf:location>
					<expr:xpathText>.</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
									</bpel:assign></bpel:sequence>
									<bpel:else>
										<bpel:sequence>
											<bpel:empty></bpel:empty>
										<bpel:assign>
		<bpel:extensionAssignOperation bea:name="successAmount">
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="successAmount">
				<trf:location>
					<expr:xpathText>.</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>&lt;SUCCESS&gt;Success&lt;/SUCCESS&gt;</expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
										</bpel:assign></bpel:sequence>
									</bpel:else>
								</bpel:if></bpel:sequence>
						</bpel:scope>
						
						
						
						</bpel:sequence>
					<bpel:else>
						<bpel:sequence>
							<bpel:empty></bpel:empty>
							<bpel:assign>
								<bpel:extensionAssignOperation
									bea:name="errorDebtor">
									<trf:insert varName="service">
										<trf:location>
											<expr:xpathText>./SERVICE/DEBTORS</expr:xpathText></trf:location>
										<trf:where>last-child</trf:where>
										<trf:expr>
											<expr:xqueryText>&lt;DEBTOR&gt;
	&lt;SUCCESS_INDICATOR&gt;ERROR&lt;/SUCCESS_INDICATOR&gt;
	&lt;ERROR_MESSAGE&gt;Hay campos de entrada que no han sido ingresados.&lt;/ERROR_MESSAGE&gt;
	&lt;TRACE&gt;{ $trace }&lt;/TRACE&gt;
	&lt;CODE&gt;{ $debtorCode }&lt;/CODE&gt;
&lt;/DEBTOR&gt;</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation>
								<bpel:extensionAssignOperation
									bea:name="errorAmount">
									<bpel:documentation></bpel:documentation>
									<trf:insert varName="errorAmount">
										<trf:location>
											<expr:xpathText>.</expr:xpathText></trf:location>
										<trf:where>last-child</trf:where>
										<trf:expr>
											<expr:xqueryText>&lt;ERROR&gt;Error&lt;/ERROR&gt;</expr:xqueryText></trf:expr></trf:insert>
								</bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:else></bpel:if>
				</bpel:sequence></bpel:scope></bpel:forEach>
	<bpel:assign>
		<bpel:extensionAssignOperation bea:name="salida">
			<bpel:documentation></bpel:documentation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./SERVICES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText>$service/*</expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        							<bpel:else>
        								<bpel:sequence>
        									<bpel:empty></bpel:empty>
        								<bpel:throw
		faultName="tns:ERROR" bea:name="ERROR">
        								</bpel:throw></bpel:sequence>
        							</bpel:else>
        						</bpel:if></bpel:sequence>
        						<bpel:else>
        							<bpel:sequence>
        								<bpel:empty/>
        							
	
        							
        							
        							<bpel:throw
		faultName="tns:NO_RECORDS" bea:name="NO_RECORDS">
        							</bpel:throw>
	</bpel:sequence>
        						</bpel:else>
        					</bpel:if></bpel:sequence></bpel:scope></bpel:forEach>
        		<bpel:assign>
        			<bpel:extensionAssignOperation bea:name="updateSucces">
        				<trf:insert varName="response.outputParameters">
        					<trf:location>
        						<expr:xpathText>./SUCCESS_INDICATOR</expr:xpathText></trf:location>
        					<trf:where>after</trf:where>
        				<trf:expr>
        					<expr:xqueryText>&lt;SUCCESS_AMOUNT&gt;{ count($successAmount/SUCCESS) }&lt;/SUCCESS_AMOUNT&gt;</expr:xqueryText></trf:expr></trf:insert>
        			</bpel:extensionAssignOperation>
        		<bpel:extensionAssignOperation bea:name="updateError">
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./SUCCESS_AMOUNT</expr:xpathText></trf:location>
			<trf:where>after</trf:where>
		<trf:expr>
			<expr:xqueryText>&lt;ERROR_AMOUNT&gt;{ count($errorAmount/ERROR) }&lt;/ERROR_AMOUNT&gt;</expr:xqueryText></trf:expr></trf:insert>
        		</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        </bpel:scope>
        
        <bpel:reply partnerLink="sjConsultaCobranzasH2H" operation="sjConsulta" variable="response"/>
    </bpel:sequence>
</bpel:process>