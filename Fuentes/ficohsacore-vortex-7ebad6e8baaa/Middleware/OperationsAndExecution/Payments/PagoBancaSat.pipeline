<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/Business_Resources/PagoBancaSat/wsdl/pagoBancaSatPS"/>
            <con:binding>
                <con:name>pagoBancaSatPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com.hn/middleware.services/pagoBancaSatPS/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="true" aggregationInterval="360" level="action"/>
            <oper:tracingEnabled>true</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con1:router errorHandler="_onErrorHandler-3874666855867608048-4a639cf6.15c6613ce90.-72d2" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
        <con1:pipeline type="request" name="ValidacionesGenerales_request">
            <con1:stage name="ValidacionXSD">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoBancaSatTypes" prefix="pag"/>
                </con1:context>
                <con1:actions>
                    <con3:validate>
                        <con2:id>_ActionId-3874666855867608048-4a639cf6.15c6613ce90.-7263</con2:id>
                        <con3:schema ref="Middleware/Business_Resources/PagoBancaSat/xsd/pagoBancaSatTypes"/>
                        <con3:schemaElement xmlns:pag="http://www.ficohsa.com.hn/middleware.services/pagoBancaSatTypes">pag:pagoBancaSatRequest</con3:schemaElement>
                        <con3:varName>body</con3:varName>
                        <con3:location>
                            <con2:xpathText>./pag:pagoBancaSatRequest</con2:xpathText>
                        </con3:location>
                    </con3:validate>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="ValidacionesGenerales_response">
            <con1:stage name="MapeoError">
                <con:context xmlns:jms="http://www.bea.com/wli/sb/transports/jms" xmlns:con4="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
                    <con5:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions xmlns:jms="http://www.bea.com/wli/sb/transports/jms" xmlns:con4="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
                    <con5:ifThenElse xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3874666855867608048-4a639cf6.15c6613ce90.-70a7</con6:id>
                        <con5:case>
                            <con5:condition>
                                <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">fn:upper-case(fn:string($header/aut:ResponseHeader/successIndicator/text())) != "SUCCESS"</con6:xqueryText>
                            </con5:condition>
                            <con5:actions>
                                <con5:wsCallout>
                                    <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3874666855867608048-4a639cf6.15c6613ce90.-70a4</con6:id>
                                    <con5:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con5:operation>mapeoErrores</con5:operation>
                                    <con5:request>
                                        <con5:body>REQMapeoErrores</con5:body>
                                    </con5:request>
                                    <con5:response>
                                        <con5:body>RSPMapeoErrores</con5:body>
                                    </con5:response>
                                    <con5:requestTransform>
                                        <con5:assign varName="REQMapeoErrores">
                                            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3874666855867608048-4a639cf6.15c6613ce90.-70a6</con6:id>
                                            <con5:expr>
                                                <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                                                    <con5:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                                                    <con5:param name="CODIGO_ERROR">
                                                        <con5:path>fn:upper-case(fn:string($header/aut:ResponseHeader/successIndicator/text()))</con5:path>
                                                    </con5:param>
                                                    <con5:param name="MENSAJE_ERROR">
                                                        <con5:path>fn:concat("FICOSP019","$#$",fn:string-join($header/aut:ResponseHeader/messages, '||'))</con5:path>
                                                    </con5:param>
                                                </con5:xqueryTransform>
                                            </con5:expr>
                                        </con5:assign>
                                    </con5:requestTransform>
                                    <con5:responseTransform>
                                        <con5:replace varName="header" contents-only="true">
                                            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3874666855867608048-4a639cf6.15c6613ce90.-70a5</con6:id>
                                            <con5:expr>
                                                <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                                                    <con5:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                                                    <con5:param name="mapeoErroresResponse1">
                                                        <con5:path>$RSPMapeoErrores</con5:path>
                                                    </con5:param>
                                                    <con5:param name="successIndicator">
                                                        <con5:path>fn:string($header/aut:ResponseHeader/successIndicator/text())</con5:path>
                                                    </con5:param>
                                                </con5:xqueryTransform>
                                            </con5:expr>
                                        </con5:replace>
                                    </con5:responseTransform>
                                </con5:wsCallout>
                            </con5:actions>
                        </con5:case>
                        <con5:default/>
                    </con5:ifThenElse>
                </con:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="error" name="_onErrorHandler-3874666855867608048-4a639cf6.15c6613ce90.-72d2">
            <con1:stage name="ManejoError">
                <con4:context xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoBancaSatTypes" prefix="pag"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con4:context>
                <con4:actions xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con4:assign varName="errorCode" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3341727536239699829--4607dfd.15d0a40d462.-5972</con5:id>
                        <con4:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($fault/ctx:errorCode/text())</con5:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con4:assign varName="errorMessage" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3341727536239699829--4607dfd.15d0a40d462.-5971</con5:id>
                        <con4:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:string($fault/ctx:reason/text())</con5:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con5:wsCallout xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3341727536239699829--4607dfd.15d0a40d462.-596e</con6:id>
                        <con5:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con5:operation>mapeoErrores</con5:operation>
                        <con5:request>
                            <con5:body>reqMapeoErrores</con5:body>
                        </con5:request>
                        <con5:response>
                            <con5:body>respMapeoErrores</con5:body>
                        </con5:response>
                        <con5:requestTransform>
                            <con5:assign varName="reqMapeoErrores">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3341727536239699829--4607dfd.15d0a40d462.-5970</con6:id>
                                <con5:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                                        <con6:param name="MENSAJE_ERROR">
                                            <con6:path>fn:concat("FICOSP019","$#$", $errorMessage)</con6:path>
                                        </con6:param>
                                        <con6:param name="CODIGO_ERROR">
                                            <con6:path>$errorCode</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con5:expr>
                            </con5:assign>
                        </con5:requestTransform>
                        <con5:responseTransform>
                            <con5:replace contents-only="true" varName="header">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3341727536239699829--4607dfd.15d0a40d462.-596f</con6:id>
                                <con5:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                                        <con6:param name="mapeoErroresResponse1">
                                            <con6:path>$respMapeoErrores</con6:path>
                                        </con6:param>
                                        <con6:param name="successIndicator">
                                            <con6:path>$errorCode</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con5:expr>
                            </con5:replace>
                        </con5:responseTransform>
                    </con5:wsCallout>
                    <con3:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-3341727536239699829--4607dfd.15d0a40d462.-596d</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;pag:pagoBancaSatResponse/></con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:reply>
                        <con2:id>_ActionId-3341727536239699829--4607dfd.15d0a40d462.-596c</con2:id>
                    </con2:reply>
                </con4:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="PagoBancaSat_request">
            <con1:stage name="PagoBSat">
                <con1:context>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/PagoISV_TC_Declaraguate" prefix="pag1"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/TRANSACCION_BANCASAT" prefix="ns0"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="par"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoBancaSatTypes" prefix="pag"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/osbConOrgSequence" prefix="osb"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="Transacccion">
                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cfa</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$body/pag:pagoBancaSatRequest/TRANSACTION_TYPE</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cdc</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$Transacccion="CREDIT CARD PAYMENT"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7fbb</con2:id>
                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>obtenerParametrizacion</con3:operation>
                                    <con3:request>
                                        <con3:body>REQobtenerParametrizacion</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPobtenerParametrizacion</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="paramMerchantName">
                                            <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7f7b</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>'MERCHANTPAGOBANCASAT'</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="REQobtenerParametrizacion">
                                            <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7f2e</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                                    <con2:param name="nombreParametros">
                                                        <con2:path>$paramMerchantName</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:assign varName="errorCode">
                                            <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7ef5</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>string($RSPobtenerParametrizacion/par:ERROR_CODE/text())</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="validationMessage">
                                            <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7edc</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>string($RSPobtenerParametrizacion/par:ERROR_MESSAGE/text())</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:assign varName="paramValueMerchant">
                                            <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7ec1</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>fn:string($RSPobtenerParametrizacion/par:CONFIGURACIONES/par:CONFIGURACIONES_ITEM[par:NAME = $paramMerchantName]/par:VALUE/text())</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7eb0</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$validationMessage = ''</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7ea8</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/MasterDataGT/conOrgSequence/biz/osbConOrgSequence_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>osbConOrgSequence</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQOsbConOrgSequence</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPOsbConOrgSequence</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQOsbConOrgSequence">
                                                        <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7eab</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/osbConOrgSequenceIn"/>
                                                                <con2:param name="pagoBancaSatRequest">
                                                                    <con2:path>$body/pag:pagoBancaSatRequest</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="codigoErrorTC">
                                                        <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7eaa</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>let $errorCode := fn:string($RSPOsbConOrgSequence/osb:CodigoError/text())
return 
	if($errorCode = '0') then(
		'SUCCESS'
	)else(
		'ERROR'
	)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="mensajeErrorTC">
                                                        <con2:id>_ActionId-8599278032565793894-6fe39906.1735323cee6.-7ea9</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>if($codigoErrorTC = 'SUCCESS') then(
	''
)else(
	fn:string($RSPOsbConOrgSequence/osb:MensajeError/text())
)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-79d7</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$mensajeErrorTC = ''</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="refereciaConsumo">
                                                <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7aef</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>let $currentDate  := (current-date())  
let $currentTime  := (current-time())  
let $yearFormat  := ("YY")  
let $lastYearDigitIndex  := (2)  
let $yearDaysFormat  := ("D")  
let $yearDaysSize  := (3)  
let $yearDaysPad  := ('0')  
let $hoursSize  := (2)  
let $hoursPad  := ('0')  
let $minutesSize  := (2)  
let $minutesPad  := ('0')  
let $lastYearDigit  := (substring(fn-bea:date-to-string-with-format($yearFormat, $currentDate), $lastYearDigitIndex))  
let $yearDays  := (fn-bea:pad-left(fn-bea:date-to-string-with-format($yearDaysFormat, $currentDate), $yearDaysSize, $yearDaysPad))  
let $hours  := (fn-bea:pad-left(xs:string(hours-from-time($currentTime)), $hoursSize, $hoursPad))  
let $minutes  := (fn-bea:pad-left(xs:string(minutes-from-time($currentTime)), $minutesSize, $minutesPad))  
return
	(concat($lastYearDigit ,$yearDays, $hours, $minutes, string($RSPOsbConOrgSequence/osb:SequenceValue/text())))</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7bb5</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/VisionPlusGT/onlineTransactions_v4/biz/onlineTransactions_v4" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>OnlinePaymentV4</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQOnlinePaymentV4</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPOnlinePaymentV4</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQOnlinePaymentV4">
                                                        <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7b7d</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/onlinePaymentV4In"/>
                                                                <con2:param name="pagoBancaSatRequest">
                                                                    <con2:path>$body/pag:pagoBancaSatRequest</con2:path>
                                                                </con2:param>
                                                                <con2:param name="refereciaConsumo">
                                                                    <con2:path>$refereciaConsumo</con2:path>
                                                                </con2:param>
                                                                <con2:param name="requestType">
                                                                    <con2:path>"A"</con2:path>
                                                                </con2:param>
                                                                <con2:param name="outputParameters">
                                                                    <con2:path>$RSPOsbConOrgSequence</con2:path>
                                                                </con2:param>
                                                                <con2:param name="referenceMerchant">
                                                                    <con2:path>$paramValueMerchant</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="vPrespCode">
                                                        <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7b45</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPOnlinePaymentV4/VPrespCode/text())</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="codigoErrorTC">
                                                        <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7b28</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>if($vPrespCode = '000') then(
	'SUCCESS'
)else(
	'ERROR'
)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="mensajeErrorTC">
                                                        <con2:id>_ActionId-2877506078870525851--7965cb27.17237794db8.-7ad2</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>if ($codigoErrorTC = 'SUCCESS') then (
    ''
)else(
	fn:string($RSPOnlinePaymentV4/ActionDescription/text())
)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-78a8</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$mensajeErrorTC =''</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-78a0</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ABKGT/BancaSat/PagoISVTCDeclaraguate/biz/PagoISV_TC_Declaraguate_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>PagoISV_TC_Declaraguate</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQRegistarPago</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPRegistrarPago</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQRegistarPago">
                                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-78a3</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/registraPagoTCGTIN"/>
                                                                <con2:param name="Estado">
                                                                    <con2:path>'P'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="MetodoPago">
                                                                    <con2:path>'CREDIT_CARD'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="Convenio">
                                                                    <con2:path>'9999'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="TipoPago">
                                                                    <con2:path>'Pago ISV TC'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="pagoBancaSatRequest1">
                                                                    <con2:path>$body/pag:pagoBancaSatRequest</con2:path>
                                                                </con2:param>
                                                                <con2:param name="Canal">
                                                                    <con2:path>$header/aut:AutenticacionRequestHeader/UserName/text()</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="codigoErrorTC">
                                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-78a2</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>data($RSPRegistrarPago/pag1:PV_ERROR/text())</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="mensajeErrorTC">
                                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-78a1</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>data($RSPRegistrarPago/pag1:PV_MENSAJE_ERROR/text())</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:wsCallout>
                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7ccc</con2:id>
                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ABKGT/BancaSat/transaccionBancaSat/biz/TRANSACCION_BANCASAT_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con3:operation>TRANSACCION_BANCASAT</con3:operation>
                                <con3:request>
                                    <con3:body>REQtransaccionBancaSat</con3:body>
                                </con3:request>
                                <con3:response>
                                    <con3:body>RSPtransaccionBancaSat</con3:body>
                                </con3:response>
                                <con3:requestTransform>
                                    <con3:assign varName="REQtransaccionBancaSat">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cd3</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatTransaccion"/>
                                                <con2:param name="cuentaDebito">
                                                    <con2:path>xs:string($body/pag:pagoBancaSatRequest/DEBIT_ACCOUNT/text())</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:assign>
                                </con3:requestTransform>
                                <con3:responseTransform>
                                    <con3:assign varName="codError">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cd2</con2:id>
                                        <con3:expr>
                                            <con2:xqueryText>xs:string($RSPtransaccionBancaSat/ns0:PV_CODIGOMENSAJE/text())</con2:xqueryText>
                                        </con3:expr>
                                    </con3:assign>
                                    <con3:ifThenElse>
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cd1</con2:id>
                                        <con3:case>
                                            <con3:condition>
                                                <con2:xqueryText>$codError = 'SUCCESS'</con2:xqueryText>
                                            </con3:condition>
                                            <con3:actions>
                                                <con3:assign varName="tipoTransaccionBancaSat">
                                                    <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cd0</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryTransform>
                                                            <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatTransacconOut"/>
                                                            <con2:param name="outputParameters1">
                                                                <con2:path>$RSPtransaccionBancaSat</con2:path>
                                                            </con2:param>
                                                        </con2:xqueryTransform>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:actions>
                                        </con3:case>
                                        <con3:default>
                                            <con3:assign varName="msjError">
                                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7ccf</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>xs:string($RSPtransaccionBancaSat/ns0:PV_DESCRIPCIONMENSAJE/text())</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con5:replace contents-only="true" varName="header" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
                                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7cce</con6:id>
                                                <con5:expr>
                                                    <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config"><![CDATA[<aut:ResponseHeader>
         <successIndicator>{$codError}</successIndicator>
         <messages>{$msjError}</messages>
</aut:ResponseHeader>]]></con6:xqueryText>
                                                </con5:expr>
                                            </con5:replace>
                                            <con2:reply>
                                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7ccd</con2:id>
                                            </con2:reply>
                                        </con3:default>
                                    </con3:ifThenElse>
                                </con3:responseTransform>
                            </con3:wsCallout>
                            <con3:wsCallout>
                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7c75</con2:id>
                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ICB/BancaSatService/biz/BancaSatService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con3:operation>AplicaCargoCuenta</con3:operation>
                                <con3:request>
                                    <con3:body>REQAplicaCargoCuenta</con3:body>
                                    <con3:header>REQHAplicaCargoCuenta</con3:header>
                                </con3:request>
                                <con3:response>
                                    <con3:body>RSPAplicaCargoCuenta</con3:body>
                                    <con3:header>RSPHAplicaCargoCuenta</con3:header>
                                </con3:response>
                                <con3:requestTransform>
                                    <con3:assign varName="REQHAplicaCargoCuenta">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7c78</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatHeaderIn"/>
                                                <con2:param name="serviceAccount">
                                                    <con2:path>"ICBWS"</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:assign>
                                    <con3:replace varName="body" contents-only="true">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7c77</con2:id>
                                        <con3:location>
                                            <con2:xpathText>./pag:pagoBancaSatRequest/TRANSACTION_TYPE</con2:xpathText>
                                        </con3:location>
                                        <con3:expr>
                                            <con2:xqueryText>$tipoTransaccionBancaSat</con2:xqueryText>
                                        </con3:expr>
                                    </con3:replace>
                                    <con3:assign varName="REQAplicaCargoCuenta">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7c76</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatIn"/>
                                                <con2:param name="pagoBancaSatRequest">
                                                    <con2:path>$body/pag:pagoBancaSatRequest</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:assign>
                                </con3:requestTransform>
                                <con3:responseTransform/>
                            </con3:wsCallout>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="PagoBancaSat_response">
            <con1:stage name="FlujoSalida">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/pagoBancaSatTypes" prefix="pag"/>
                    <con2:varNsDecl namespace="urn:tailored.icbanking.services.bancasat" prefix="urn"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7ea3</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$Transacccion="CREDIT CARD PAYMENT"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="header" contents-only="true">
                                    <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7c0d</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatISVTCHeaderOut"/>
                                            <con2:param name="CodigoError">
                                                <con2:path>$codigoErrorTC</con2:path>
                                            </con2:param>
                                            <con2:param name="transaction_reference">
                                                <con2:path>$refereciaConsumo</con2:path>
                                            </con2:param>
                                            <con2:param name="MensajeError">
                                                <con2:path>$mensajeErrorTC</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con3:replace>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7e55</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$codigoErrorTC='SUCCESS'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace varName="body" contents-only="true">
                                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7b4a</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatISVTCOut"/>
                                                        <con2:param name="Moneda">
                                                            <con2:path>$body/pag:pagoBancaSatRequest/BILL_INFORMATION/CURRENCY/text()</con2:path>
                                                        </con2:param>
                                                        <con2:param name="Monto">
                                                            <con2:path>$body/pag:pagoBancaSatRequest/PAYMENT_AMOUNT/text()</con2:path>
                                                        </con2:param>
                                                        <con2:param name="TarjetaCredito">
                                                            <con2:path>$body/pag:pagoBancaSatRequest/CREDIT_CARD_PAYMENT_INFO/CREDIT_CARD/text()</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con3:expr>
                                            </con3:replace>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7b67</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;pag:pagoBancaSatResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace varName="header" contents-only="true">
                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7ea1</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatHeaderOut"/>
                                        <con2:param name="aplicaCargoCuentaMessageOut">
                                            <con2:path>$RSPAplicaCargoCuenta</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                            <con3:ifThenElse>
                                <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7e9d</con2:id>
                                <con3:case>
                                    <con3:condition>
                                        <con2:xqueryText>fn:upper-case(fn:string($header/aut:ResponseHeader/successIndicator/text())) != "SUCCESS"</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                        <con3:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7e9c</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;pag:pagoBancaSatResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:actions>
                                </con3:case>
                                <con3:default>
                                    <con3:replace contents-only="true" varName="body">
                                        <con2:id>_ActionId-1187244163730608563--7e0230e6.16c493a2d96.-7e9b</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/Business_Resources/PagoBancaSat/xq/pagoBancaSatOut"/>
                                                <con2:param name="aplicaCargoCuentaMessageOut">
                                                    <con2:path>$RSPAplicaCargoCuenta</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:replace>
                                </con3:default>
                            </con3:ifThenElse>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:flow>
            <con1:pipeline-node name="ValidacionesGenerales">
                <con1:request>ValidacionesGenerales_request</con1:request>
                <con1:response>ValidacionesGenerales_response</con1:response>
            </con1:pipeline-node>
            <con1:pipeline-node name="PagoBancaSat">
                <con1:request>PagoBancaSat_request</con1:request>
                <con1:response>PagoBancaSat_response</con1:response>
            </con1:pipeline-node>
        </con1:flow>
    </con1:router>
</con:pipelineEntry>