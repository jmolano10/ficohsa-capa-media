<bpel:process name="ConsultaPrestamosCliente" targetNamespace="http://www.example.com/flow/Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/ConsultaPrestamosCliente" bea:name="ConsultaPrestamosCliente" xmlns:tns="http://www.example.com/flow/Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/ConsultaPrestamosCliente" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="ConsultaPrestamosCliente" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/InterbancaSOAApplication/ConsultaListaPrestamos/consultaListaPrestamos" xmlns:ns0="http://www.bea.com/wli/sb/stages/logging/config" xmlns:top="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_K_CONSULTALISTAPRESTAMOS/TOPLEVEL-24OSB_CON_LISTA_PRESTA/" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/InterbancaSOAApplication/ConsultaGeneralPrestamo/consultaGeneralPrestamo" xmlns:ns3="http://www.ficohsa.com.hn/middleware.services/consultaGeneralPrestamoPS/" xmlns:ns4="T24WebServicesImpl" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <bpel:partnerLinks>
        <bpel:partnerLink name="ConsultaPrestamosCliente" partnerLinkType="tns:ConsultaPrestamosCliente" myRole="ConsultaPrestamosCliente">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="consultaListaPrestamosBS" partnerLinkType="tns:consultaListaPrestamosBS_plnkType" partnerRole="consultaListaPrestamosBS_PartnerRole">
	   </bpel:partnerLink>
	   
	   <bpel:partnerLink name="ConsultaGeneralPrestamo" partnerLinkType="tns:ConsultaGeneralPrestamo_plnkType" partnerRole="ConsultaGeneralPrestamo_PartnerRole">
	   </bpel:partnerLink>
	   </bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="bind:ConsultaPrestamosClienteRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="bind:ConsultaPrestamosClienteResponse">
	       </bpel:variable>
    <bpel:variable name="REQConsultaListPrestamos" messageType="ns1:args_in_msg">
    </bpel:variable>
    <bpel:variable name="RSPConsultaListaPrestamos" messageType="ns1:args_out_msg">
    </bpel:variable>
    
    
    
	   	
	   	</bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="ConsultaPrestamosCliente" operation="ConsultaPrestamosCliente" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/consultaPrestamos/ConsultaPrestamosCliente" binding="bind:ConsultaPrestamosClienteBinding"/></rescon:receiveInfo>
        </bpel:receive>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<bpel:documentation/>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;bind:ConsultaPrestamoTypeResponse>
	&lt;bind:LOAN_DETAILS>
	&lt;/bind:LOAN_DETAILS>
&lt;/bind:ConsultaPrestamoTypeResponse></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:scope bea:name="PrestamosAbanks">
        	<bpel:sequence>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<trf:assign varName="REQConsultaListPrestamos.InputParameters">
        					<trf:expr>
        						<expr:xqueryTransform>
        							<expr:resource ref="Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/consultaPrestamos/ConsultaPrestamosClienteIn"/>
        							<expr:param name="consultaPrestamoTypeRequest1">
        								<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        		<bpel:invoke inputVariable="REQConsultaListPrestamos" outputVariable="RSPConsultaListaPrestamos" partnerLink="consultaListaPrestamosBS" operation="consultaListaPrestamos">
        			<rescon:invokeInfo><rescon:service ref="Middleware/Business_Resources/consultasCliente/Resources/consultaListaPrestamosBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
        		<bpel:forEach counterName="counter" parallel="yes">
        			<bpel:startCounterValue>number(1)</bpel:startCounterValue>
        			<bpel:finalCounterValue>count($RSPConsultaListaPrestamos.OutputParameters/top:LIABILITY_NUMBER/top:ITEM)</bpel:finalCounterValue>
        			<bpel:scope>
        				<bpel:variables>
        					<bpel:variable messageType="ns3:consultaGeneralPrestamoResponse" name="RSPConsultaGeneralPrestamoLocal"/>
        					<bpel:variable messageType="ns3:consultaGeneralPrestamoRequest" name="ReqConsultaGeneralPrestamoLocal"/></bpel:variables>
        				<bpel:sequence>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<bpel:documentation/>
        							<trf:assign varName="ReqConsultaGeneralPrestamoLocal.AutenticacionRequestHeader">
        								<trf:expr>
        									<expr:xqueryTransform>
        										<expr:resource ref="Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/consultaPrestamos/ConsultaPrestamosClienteHeaderIn"/>
        										<expr:param name="consultaPrestamoTypeRequest1">
        											<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation>
        						<bpel:extensionAssignOperation>
        							<trf:assign varName="ReqConsultaGeneralPrestamoLocal.parameters">
        								<trf:expr>
        									<expr:xqueryTransform>
        										<expr:resource ref="Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/consultaPrestamos/sjConsultaDetallePtmoAbanksIn"/>
        										<expr:param name="outputParameters1">
        											<expr:path>$RSPConsultaListaPrestamos.OutputParameters</expr:path></expr:param>
        										<expr:param name="counter">
        											<expr:path>$counter</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        					<bpel:invoke ext:txnPropagation="Supports" outputVariable="RSPConsultaGeneralPrestamoLocal" inputVariable="ReqConsultaGeneralPrestamoLocal" partnerLink="ConsultaGeneralPrestamo" operation="consultaGeneralPrestamo">
        						<rescon:invokeInfo><rescon:service ref="Middleware/OperationsAndExecution/CustomerLoans/ConsultaGeneralPrestamo" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
        					<bpel:assign>
        						<bpel:extensionAssignOperation>
        							<trf:insert varName="response.outputParameters">
        								<trf:location>
        									<expr:xpathText>./bind:LOAN_DETAILS</expr:xpathText></trf:location>
        								<trf:where>last-child</trf:where>
        								<trf:expr>
        									<expr:xqueryTransform>
        										<expr:resource ref="Middleware/Business_Resources/consultasCliente/consultaPasivosCliente/consultaPrestamos/sjConsultaDetallePtmoAbanksOut"/>
        										<expr:param name="consultaGeneralPrestamoResponse1">
        											<expr:path>$RSPConsultaGeneralPrestamoLocal.result</expr:path></expr:param>
        										<expr:param name="consultaGeneralPrestamo1">
        											<expr:path>$ReqConsultaGeneralPrestamoLocal.parameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:forEach></bpel:sequence></bpel:scope>
        
        
        
        
        
        
        
        
        
        <bpel:if>
        	<bpel:condition>count($response.outputParameters/bind:LOAN_DETAILS/bind:LOAN_DETAIL) > 0</bpel:condition>
        	<bpel:sequence>
        		<bpel:empty/>
        		<bpel:assign>
        			<bpel:extensionAssignOperation>
        				<trf:insert varName="response.outputParameters">
        					<trf:where>first-child</trf:where>
        					<trf:expr>
        						
        						<expr:xqueryText>&lt;bind:OVERALL_SUCCESS_INDICATOR>SUCCESS&lt;/bind:OVERALL_SUCCESS_INDICATOR></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        	<bpel:else>
        		<bpel:sequence>
        			<bpel:empty/>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<trf:insert varName="response.outputParameters">
        						<trf:where>first-child</trf:where>
        						<trf:expr>
        							
        							<expr:xqueryText>&lt;bind:OVERALL_SUCCESS_INDICATOR>NO RECORDS&lt;/bind:OVERALL_SUCCESS_INDICATOR></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:else></bpel:if>
        <bpel:reply partnerLink="ConsultaPrestamosCliente" operation="ConsultaPrestamosCliente" variable="response"/>
    </bpel:sequence>
</bpel:process>