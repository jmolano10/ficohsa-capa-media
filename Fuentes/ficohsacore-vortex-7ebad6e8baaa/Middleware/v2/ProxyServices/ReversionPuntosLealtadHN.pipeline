<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/v2/Resources/ReversionPuntosLealtad/wsdl/reversionPuntosLealtadPS"/>
            <con:binding>
                <con:name>programaLealtadPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com.hn/middleware.services/programaLealtad/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="false" aggregationInterval="10" level="pipeline"/>
            <oper:tracingEnabled>false</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con:router errorHandler="_onErrorHandler-228986986890076959--39440fe3.1793d3082dc.-7a37" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
        <con:pipeline type="request" name="HN01_ReversionPuntosLealtad_request">
            <con:stage name="ValidacionXSD">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                </con:context>
                <con:actions xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:validate>
                        <con1:id>_ActionId-5929453687317993818--4045713b.17957b579b2.-7cc0</con1:id>
                        <con2:schema ref="Middleware/v2/Resources/ProgramaLealtad/xsd/programaLealtadTypes"/>
                        <con2:schemaElement xmlns:prog="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes">prog:reversionPuntosLealtad</con2:schemaElement>
                        <con2:varName>body</con2:varName>
                        <con2:location>
                            <con1:xpathText>./prog:reversionPuntosLealtad</con1:xpathText>
                        </con2:location>
                    </con2:validate>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaInformacionLealtad">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/conInfoLealtad" prefix="inf"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con1:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/sjConsultaTipoTarjeta" prefix="sjc"/>
                    <con1:varNsDecl namespace="http://alcance.local/wsinfotarjetas/" prefix="wsin"/>
                </con:context>
                <con:actions xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:assign varName="customerIdType">
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-7900</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn:string($body/prog:reversionPuntosLealtad/CUSTOMER_ID_TYPE/text())</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="customerIdValue">
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-78ff</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn:string($body/prog:reversionPuntosLealtad/CUSTOMER_ID_VALUE/text())</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-78fe</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$customerIdType = "CARD_NUMBER"</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="codigoPais">
                                    <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d4e</con1:id>
                                    <con2:expr>
                                        <con1:xqueryTransform>
                                            <con1:resource ref="Middleware/v2/Resources/Generales/xq/convertirCodigoPais"/>
                                            <con1:param name="sentidoConversion">
                                                <con1:path>"OSB-ISO3"</con1:path>
                                            </con1:param>
                                            <con1:param name="codigoPais">
                                                <con1:path>string($header/aut:RequestHeader/Region/SourceBank/text())</con1:path>
                                            </con1:param>
                                        </con1:xqueryTransform>
                                    </con2:expr>
                                </con2:assign>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d3e</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ProcesosHN/conInfoLealtad/biz/conInfoLealtad_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>conInfoLealtad</con2:operation>
                                    <con2:request>
                                        <con2:body>REQConInfoLealtad</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>RSPConInfoLealtad</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="REQConInfoLealtad">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d45</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/conInfoLealtadHNIn"/>
                                                    <con1:param name="cardNumber">
                                                        <con1:path>$customerIdValue</con1:path>
                                                    </con1:param>
                                                    <con1:param name="country">
                                                        <con1:path>$codigoPais</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="legalId">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d44</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:RowSet/inf:Row/inf:Column[@name = 'legalId']/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="customerName">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d43</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:RowSet/inf:Row/inf:Column[@name = 'customerName']/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="cardType">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d42</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:RowSet/inf:Row/inf:Column[@name = 'cardType']/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="logo">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7d80</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:RowSet/inf:Row/inf:Column[upper-case(@name) = 'LOGO']/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="errorCode">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d40</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:CodigoError/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="validationMessage">
                                            <con1:id>_ActionId-2855374019086028894--5af4a86.17bef4c0ef6.-7d3f</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPConInfoLealtad/inf:MensajeError/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:assign varName="errorCode">
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7f5d</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>'ERROR'</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="validationMessage">
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7f40</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>'CUSTOMER_ID_TYPE no soportado'</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con1:skip>
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7f23</con1:id>
                            </con1:skip>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaProgramaLealtad">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaProgramaLealtad" prefix="con"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7eb5</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$validationMessage = '' and $cardType = 'DEBIT'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="programaLealtad">
                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7e7d</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>'1'</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7e45</con1:id>
                                <con2:case>
                                    <con2:condition>
                                        <con1:xqueryText>$validationMessage = ''</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:wsCallout>
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7dd5</con1:id>
                                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/INTFC/consultaProgramaLealtad/biz/consultaProgramaLealtad_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                            <con2:operation>consultaProgramaLealtad</con2:operation>
                                            <con2:request>
                                                <con2:body>REQconsultaProgramaLealtad</con2:body>
                                            </con2:request>
                                            <con2:response>
                                                <con2:body>RSPconsultaProgramaLealtad</con2:body>
                                            </con2:response>
                                            <con2:requestTransform>
                                                <con2:assign varName="REQconsultaProgramaLealtad">
                                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7d9d</con1:id>
                                                    <con2:expr>
                                                        <con1:xqueryTransform>
                                                            <con1:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/consultaProgramaLealtadIn"/>
                                                            <con1:param name="logo">
                                                                <con1:path>$logo</con1:path>
                                                            </con1:param>
                                                            <con1:param name="codigoPais">
                                                                <con1:path>string($header/aut:RequestHeader/Region/SourceBank/text())</con1:path>
                                                            </con1:param>
                                                        </con1:xqueryTransform>
                                                    </con2:expr>
                                                </con2:assign>
                                            </con2:requestTransform>
                                            <con2:responseTransform>
                                                <con2:assign varName="errorCode">
                                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7d48</con1:id>
                                                    <con2:expr>
                                                        <con1:xqueryText>string($RSPconsultaProgramaLealtad/con:PV_CODIGOMENSAJE/text())</con1:xqueryText>
                                                    </con2:expr>
                                                </con2:assign>
                                                <con2:assign varName="validationMessage">
                                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7d2b</con1:id>
                                                    <con2:expr>
                                                        <con1:xqueryText>string($RSPconsultaProgramaLealtad/con:PV_DESCRIPCIONMENSAJE/text())</con1:xqueryText>
                                                    </con2:expr>
                                                </con2:assign>
                                                <con2:assign varName="logoInfinite">
                                                    <con1:id>_ActionId-8829602200032484330-773c0adc.191e19910fc.-7f8d</con1:id>
                                                    <con2:expr>
                                                        <con1:xqueryText>'625'</con1:xqueryText>
                                                    </con2:expr>
                                                </con2:assign>
                                                <con2:assign varName="programaLealtad">
                                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7d0e</con1:id>
                                                    <con2:expr>
                                                        <con1:xqueryText>if($validationMessage = "") then (
	if($logo = $logoInfinite and exists($body/prog:reversionPuntosLealtad/PROGRAM_ID/text())) then (
		$body/prog:reversionPuntosLealtad/PROGRAM_ID/text()
	) else (
		string($RSPconsultaProgramaLealtad/con:PV_CODIGOLEALTAD/text())
	)
) else ( '' )</con1:xqueryText>
                                                    </con2:expr>
                                                </con2:assign>
                                            </con2:responseTransform>
                                        </con2:wsCallout>
                                    </con2:actions>
                                </con2:case>
                                <con2:default>
                                    <con1:skip>
                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7e0d</con1:id>
                                    </con1:skip>
                                </con2:default>
                            </con2:ifThenElse>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="Reversion" errorHandler="_onErrorHandler-5065599615476409446--3d859a3d.17cc20b320c.-77ec">
                <con:context>
                    <con1:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/conTransaccionRedencion" prefix="con"/>
                    <con1:userNsDecl namespace="http://www.procesa.com/fdcs" prefix="fdcs"/>
                    <con1:userNsDecl namespace="http://redemption.ws.mcrewards.mastercard.com/" prefix="mrs"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                        <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ed4</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn:string($validationMessage) = "" and $programaLealtad = '1'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ed0</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/Mastercard/RedemptionService/biz/RedemptionService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>creditRedemption</con2:operation>
                                    <con2:request>
                                        <con2:body>REQcreditRedemption</con2:body>
                                        <con2:header>REQHeadercreditRedemption</con2:header>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>RSPcreditRedemption</con2:body>
                                        <con2:header>RSPHeadercreditRedemption</con2:header>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="REQHeadercreditRedemption">
                                            <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ed3</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>&lt;soap-env:Header/></con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:replace contents-only="true" varName="REQHeadercreditRedemption">
                                            <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ed2</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/MRSIdentity"/>
                                                    <con1:param name="institutionName">
                                                        <con1:path>"banficohsahnd"</con1:path>
                                                    </con1:param>
                                                    <con1:param name="appID">
                                                        <con1:path>fn-bea:trim($legalId)</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:replace>
                                        <con2:assign varName="REQcreditRedemption">
                                            <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ed1</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="Middleware/v2/Resources/ReversionPuntosLealtad/xq/creditRedemptionIn"/>
                                                    <con1:param name="reversionPuntosLealtad">
                                                        <con1:path>$body/prog:reversionPuntosLealtad</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="creditRedemptionId">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-754b</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPcreditRedemption/mrs:creditResults/mrs:redemptionId/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="availablePoints">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-752e</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPcreditRedemption/mrs:pointsAvailable/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="txnAmount">
                                            <con1:id>_ActionId-6835064179981542154--7636fdf2.17cc7cede2a.-7fe4</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>xs:decimal($RSPcreditRedemption/mrs:creditResults/mrs:totalPointsCredited/text()) * -1</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn:string($validationMessage) = "" and $programaLealtad = '2'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7b7c</con1:id>
                                    <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/MasterData/conTransaccionRedencion/biz/conTransaccionRedencion_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>conTransaccionRedencion</con2:operation>
                                    <con2:request>
                                        <con2:body>REQconTransaccionRedencion</con2:body>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body>RSPconTransaccionRedencion</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="REQconTransaccionRedencion">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7b44</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="Middleware/v2/Resources/ReversionPuntosLealtad/xq/conTransaccionRedencion"/>
                                                    <con1:param name="pais">
                                                        <con1:path>$codigoPais</con1:path>
                                                    </con1:param>
                                                    <con1:param name="cardNumber">
                                                        <con1:path>string($body/prog:reversionPuntosLealtad/CUSTOMER_ID_VALUE/text())</con1:path>
                                                    </con1:param>
                                                    <con1:param name="transactionID">
                                                        <con1:path>string($body/prog:reversionPuntosLealtad/REDEMPTION_ID/text())</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:assign varName="errorCode">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7a48</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>string($RSPconTransaccionRedencion/con:CodigoError/text())</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="validationMessage">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7a2b</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>let $rowCount := count($RSPconTransaccionRedencion/con:RowSet/con:Row)
return
if($errorCode = '-1')then (
 
 if($rowCount > 0)then(
    string($RSPconTransaccionRedencion/con:MensajeError/text())
 )else('No se retornaron Filas') 
 
)else(string($RSPconTransaccionRedencion/con:MensajeError/text()))</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="rowAlt">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-792b</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>for $row in $RSPconTransaccionRedencion/con:RowSet/con:Row
	where $row/con:Column[upper-case(@name) = 'TIPOORG']/text() = "ALT"
	return $row</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="lmsAccount">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7a0e</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'LMSCUENTA'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="org">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7948</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'ORG'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="schema">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-790e</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'LMSESQUEMA'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="txnCode">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-78f0</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'CODIGOTRANSACCION'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="txnAmount">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-78d3</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>let $txnAmount := data($rowAlt/con:Column[upper-case(@name) = 'MONTO'])
return
if($txnAmount != "")then(
	xs:decimal($txnAmount) div 1000
)else(
	0
)</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="description">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-78b6</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'DESCRIPCION'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="groupCode">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7899</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'GRUPOPROMOCIONAL'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="tableType">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-787c</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'TIPOPLAN'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="tablePriority">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-785f</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'PRIORIDADPLAN'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="referenceNumber">
                                            <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7842</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>data($rowAlt/con:Column[upper-case(@name) = 'IDENTIFICADORTRANSACCION'])</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                                <con2:ifThenElse>
                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-79d6</con1:id>
                                    <con2:case>
                                        <con2:condition>
                                            <con1:xqueryText>$validationMessage = '' and $lmsAccount != ''</con1:xqueryText>
                                        </con2:condition>
                                        <con2:actions>
                                            <con2:wsCallout>
                                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-799e</con1:id>
                                                <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/VisionPlus/visionPlus/biz/visionPlus" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con2:operation>PointsAdjustmentCreation</con2:operation>
                                                <con2:request>
                                                    <con2:body>REQPointsAdjustmentCreation</con2:body>
                                                </con2:request>
                                                <con2:response>
                                                    <con2:body>RSPPointsAdjustmentCreation</con2:body>
                                                </con2:response>
                                                <con2:requestTransform>
                                                    <con2:assign varName="REQPointsAdjustmentCreation">
                                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7966</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryTransform>
                                                                <con1:resource ref="Middleware/v2/Resources/ReversionPuntosLealtad/xq/pointsAdjustmentCreationIn"/>
                                                                <con1:param name="accountNumber">
                                                                    <con1:path>$lmsAccount</con1:path>
                                                                </con1:param>
                                                                <con1:param name="txnCode">
                                                                    <con1:path>$txnCode</con1:path>
                                                                </con1:param>
                                                                <con1:param name="groupCode">
                                                                    <con1:path>$groupCode</con1:path>
                                                                </con1:param>
                                                                <con1:param name="referenceNumber">
                                                                    <con1:path>$referenceNumber</con1:path>
                                                                </con1:param>
                                                                <con1:param name="tablePriority">
                                                                    <con1:path>$tablePriority</con1:path>
                                                                </con1:param>
                                                                <con1:param name="description">
                                                                    <con1:path>$description</con1:path>
                                                                </con1:param>
                                                                <con1:param name="txnAmount">
                                                                    <con1:path>$txnAmount</con1:path>
                                                                </con1:param>
                                                                <con1:param name="schema">
                                                                    <con1:path>$schema</con1:path>
                                                                </con1:param>
                                                                <con1:param name="tableType">
                                                                    <con1:path>$tableType</con1:path>
                                                                </con1:param>
                                                                <con1:param name="org">
                                                                    <con1:path>$org</con1:path>
                                                                </con1:param>
                                                            </con1:xqueryTransform>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:requestTransform>
                                                <con2:responseTransform>
                                                    <con2:assign varName="errorCode">
                                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-780a</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>let $svcReturn := string($RSPPointsAdjustmentCreation/SVC-RETURN/text())
return
if($svcReturn != 'P') then (
	string($RSPPointsAdjustmentCreation/fdcs:ReturnCodes/RC[1]/Code/text())
) else ('Success')</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                    <con2:assign varName="validationMessage">
                                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-77ed</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>if(upper-case($errorCode) != "SUCCESS") then (
	string($RSPPointsAdjustmentCreation/fdcs:ReturnCodes/RC[1]/Desc/text())
) else ('')</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                    <con2:assign varName="creditRedemptionId">
                                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-75a0</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>''</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                    <con2:assign varName="availablePoints">
                                                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7583</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>''</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:responseTransform>
                                            </con2:wsCallout>
                                            <con2:ifThenElse>
                                                <con1:id>_ActionId-3369909889075663833--49c5703a.17d0aaf35f0.-7f93</con1:id>
                                                <con2:case>
                                                    <con2:condition>
                                                        <con1:xqueryText>$validationMessage = ""</con1:xqueryText>
                                                    </con2:condition>
                                                    <con2:actions>
                                                        <con2:wsCallout>
                                                            <con1:id>_ActionId-3369909889075663833--49c5703a.17d0aaf35f0.-7f5b</con1:id>
                                                            <con2:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/VisionPlus/visionPlus/biz/visionPlus" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                            <con2:operation>PointsAdjustmentInquiry</con2:operation>
                                                            <con2:request>
                                                                <con2:body>REQPointsAdjustmentInquiry</con2:body>
                                                            </con2:request>
                                                            <con2:response>
                                                                <con2:body>RSPPointsAdjustmentInquiry</con2:body>
                                                            </con2:response>
                                                            <con2:requestTransform>
                                                                <con2:assign varName="REQPointsAdjustmentInquiry">
                                                                    <con1:id>_ActionId-3369909889075663833--49c5703a.17d0aaf35f0.-7f23</con1:id>
                                                                    <con2:expr>
                                                                        <con1:xqueryTransform>
                                                                            <con1:resource ref="Middleware/v2/Resources/VisionPlus/xq/pointsAdjustmentInquiryIn"/>
                                                                            <con1:param name="accountNumber">
                                                                                <con1:path>$lmsAccount</con1:path>
                                                                            </con1:param>
                                                                            <con1:param name="scheme">
                                                                                <con1:path>$schema</con1:path>
                                                                            </con1:param>
                                                                            <con1:param name="org">
                                                                                <con1:path>$org</con1:path>
                                                                            </con1:param>
                                                                        </con1:xqueryTransform>
                                                                    </con2:expr>
                                                                </con2:assign>
                                                            </con2:requestTransform>
                                                            <con2:responseTransform>
                                                                <con2:assign varName="availablePoints">
                                                                    <con1:id>_ActionId-3369909889075663833--49c5703a.17d0aaf35f0.-7eeb</con1:id>
                                                                    <con2:expr>
                                                                        <con1:xqueryText>let $available := fn-bea:trim(string($RSPPointsAdjustmentInquiry/GPXAIO-OPEN-TO-RED-ON-SCR/text()))
return
if($available != "")then(
	xs:decimal($available) div 1000
)else(
	''
)</con1:xqueryText>
                                                                    </con2:expr>
                                                                </con2:assign>
                                                            </con2:responseTransform>
                                                        </con2:wsCallout>
                                                    </con2:actions>
                                                </con2:case>
                                                <con2:default/>
                                            </con2:ifThenElse>
                                        </con2:actions>
                                    </con2:case>
                                    <con2:default/>
                                </con2:ifThenElse>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con1:skip>
                                <con1:id>_ActionId-2709048691667742058-1f0a9440.179477e8e7e.-7ecf</con1:id>
                            </con1:skip>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="HN01_ReversionPuntosLealtad_response">
            <con:stage name="FlujoSalida">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                </con:context>
                <con:actions xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:replace contents-only="true" varName="header">
                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7664</con1:id>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[<aut:ResponseHeader>
{
	if($validationMessage = '') then (
		<successIndicator>Success</successIndicator>
	) else (
		<successIndicator>{ $errorCode }</successIndicator>,
		<messages>{ $validationMessage }</messages>
	)
}
</aut:ResponseHeader>]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-7790</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>fn:string($validationMessage) = ""</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace contents-only="true" varName="body">
                                    <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-778e</con1:id>
                                    <con2:expr>
                                        <con1:xqueryTransform>
                                            <con1:resource ref="Middleware/v2/Resources/ReversionPuntosLealtad/xq/reversionPuntosLealtadHNOut"/>
                                            <con1:param name="customerName">
                                                <con1:path>$customerName</con1:path>
                                            </con1:param>
                                            <con1:param name="totalPointsCredited">
                                                <con1:path>$txnAmount</con1:path>
                                            </con1:param>
                                            <con1:param name="legalId">
                                                <con1:path>$legalId</con1:path>
                                            </con1:param>
                                            <con1:param name="creditRedemptionId">
                                                <con1:path>$creditRedemptionId</con1:path>
                                            </con1:param>
                                            <con1:param name="pointsAvailable">
                                                <con1:path>$availablePoints</con1:path>
                                            </con1:param>
                                            <con1:param name="redemptionId">
                                                <con1:path>string($body/prog:reversionPuntosLealtad/REDEMPTION_ID/text())</con1:path>
                                            </con1:param>
                                        </con1:xqueryTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:replace contents-only="true" varName="body">
                                <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-778c</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>&lt;prog:reversionPuntosLealtadResponse/></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-228986986890076959--39440fe3.1793d3082dc.-7a37">
            <con:stage name="ManejoError">
                <con:context>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-7a15</con1:id>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[<aut:ResponseHeader>
    <messageId>-1</messageId>
    <successIndicator>ERROR</successIndicator>
    <messages>{ string($fault/ctx:reason/text()) }</messages>
</aut:ResponseHeader>]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-79f7</con1:id>
                        <con2:expr>
                            <con1:xqueryText>&lt;prog:reversionPuntosLealtadResponse/></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con1:reply>
                        <con1:id>_ActionId-228986986890076959--39440fe3.1793d3082dc.-79e0</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="_onErrorHandler-5065599615476409446--3d859a3d.17cc20b320c.-77ec">
            <con:stage name="ManejoErrorReversion">
                <con:context>
                    <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1"/>
                    <con1:userNsDecl namespace="http://common.ws.mcrewards.mastercard.com/" prefix="con2"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-777e</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con1:xqueryText>$programaLealtad = '1'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="errorCode">
                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7683</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>string($fault/ctx:details/con1:ReceivedFaultDetail/con1:detail/con2:ErrorResp/con2:code/text())</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                                <con2:assign varName="validationMessage">
                                    <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7666</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>string($fault/ctx:details/con1:ReceivedFaultDetail/con1:detail/con2:ErrorResp/con2:description/text())</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:assign varName="errorCode">
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-7710</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>string($fault/ctx:errorCode/text())</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="validationMessage">
                                <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-76f3</con1:id>
                                <con2:expr>
                                    <con1:xqueryText>string($fault/ctx:reason/text())</con1:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:default>
                    </con2:ifThenElse>
                    <con1:resume>
                        <con1:id>_ActionId-5065599615476409446--3d859a3d.17cc20b320c.-76bb</con1:id>
                    </con1:resume>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="HN01_ReversionPuntosLealtad">
                <con:request>HN01_ReversionPuntosLealtad_request</con:request>
                <con:response>HN01_ReversionPuntosLealtad_response</con:response>
            </con:pipeline-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>