<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/v2/Resources/ConsultaPuntosLealtad/wsdl/consultaPuntosLealtadPS"/>
            <con:binding>
                <con:name>consultaPuntosLealtadPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com.hn/middleware.services/programaLealtad/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="true" aggregationInterval="360" level="action"/>
            <oper:tracingEnabled>false</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con2:router errorHandler="_onErrorHandler-5062500776767059966-38a7cdd4.16b00a94253.-7fe5" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/services/security/config">
        <con:pipeline type="request" name="ConsultaPuntosLealtad_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con:stage name="ValidacionXSD">
                <con:context>
                    <con4:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-9085855897659605180-1cf2a77.1795d71885a.-7e4b</con4:id>
                        <con1:schema ref="Middleware/v2/Resources/ProgramaLealtad/xsd/programaLealtadTypes"/>
                        <con1:schemaElement xmlns:prog="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes">prog:consultaPuntosLealtad</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con4:xpathText xmlns:con4="http://www.bea.com/wli/sb/stages/config">./prog:consultaPuntosLealtad</con4:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaPuntosLealtad">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con4:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con4:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7f93</con4:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/CLIENTDATA/consultaPuntosLealtad/biz/consultaPuntosLealtad_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>consultaPuntosLealtad</con1:operation>
                        <con1:request>
                            <con1:body>REQconsultaPuntosLealtad</con1:body>
                        </con1:request>
                        <con1:response>
                            <con1:body>RSPconsultaPuntosLealtad</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="REQconsultaPuntosLealtad">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7f5b</con4:id>
                                <con1:expr>
                                    <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                        <con4:resource ref="Middleware/v2/Resources/ConsultaPuntosLealtad/xq/consultaPuntosLealtadIn"/>
                                        <con4:param name="requestHeader">
                                            <con4:path>$header/aut:RequestHeader</con4:path>
                                        </con4:param>
                                        <con4:param name="consultaPuntosLealtad">
                                            <con4:path>$body/prog:consultaPuntosLealtad</con4:path>
                                        </con4:param>
                                    </con4:xqueryTransform>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="errorCode">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7f23</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaPuntosLealtad/con1:PV_CODIGO_ERROR/text())</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="validationMessage">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7f06</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaPuntosLealtad/con1:PV_MENSAJE_ERROR/text())</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="legalId">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7ee9</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:LEGAL_ID/text())</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="availablePoints">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7ecc</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE)</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="customerName">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7eaf</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:CUSTOMER_NAME/text())</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="cashEquivalent">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e92</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:CASH_EQUIVALENT)</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="cashCurrency">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e5a</con4:id>
                                <con1:expr>
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">for $CASH_CURRENCY in $RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:CASH_CURRENCY
return(
	if(string($CASH_CURRENCY/text()) != "") then (
		data($CASH_CURRENCY)
	) else ('')
)</con4:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaInformacionCliente">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/conDatoCuenta" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e22</con4:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">not(exists($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE))</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="customerIdType">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e20</con4:id>
                                    <con1:expr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($body/prog:consultaPuntosLealtad/CUSTOMER_ID_TYPE/text())</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="customerIdValue">
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e1e</con4:id>
                                    <con1:expr>
                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($body/prog:consultaPuntosLealtad/CUSTOMER_ID_VALUE/text())</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:ifThenElse>
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e08</con4:id>
                                    <con1:case>
                                        <con1:condition>
                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$customerIdType = "CARD_NUMBER"</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:assign varName="codigoPais">
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e07</con4:id>
                                                <con1:expr>
                                                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                        <con2:resource ref="Middleware/v2/Resources/Generales/xq/convertirCodigoPais"/>
                                                        <con2:param name="sentidoConversion">
                                                            <con2:path>'OSB-ISO3'</con2:path>
                                                        </con2:param>
                                                        <con2:param name="codigoPais">
                                                            <con2:path>fn:string($header/aut:RequestHeader/Region/SourceBank/text())</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con1:expr>
                                            </con1:assign>
                                            <con1:wsCallout>
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e02</con4:id>
                                                <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/MasterDataGT/conDatoCuenta/biz/conDatoCuenta_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>conDatoCuenta</con1:operation>
                                                <con1:request>
                                                    <con1:body>REQconDatoCuenta</con1:body>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body>RSPconDatoCuenta</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="REQconDatoCuenta">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e06</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                                <con2:resource ref="Middleware/v2/Resources/MasterDataGT/xq/conDatoCuentaGTIn"/>
                                                                <con2:param name="accountNumber">
                                                                    <con2:path>$customerIdValue</con2:path>
                                                                </con2:param>
                                                                <con2:param name="countryCode">
                                                                    <con2:path>$codigoPais</con2:path>
                                                                </con2:param>
                                                                <con2:param name="org">
                                                                    <con2:path>''</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:validate>
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e05</con4:id>
                                                        <con1:schema ref="Middleware/v2/BusinessServices/MasterDataGT/conDatoCuenta/xsd/conDatoCuenta_sp"/>
                                                        <con1:schemaElement xmlns:con="http://xmlns.oracle.com/pcbpel/adapter/db/sp/conDatoCuenta">con:InputParameters</con1:schemaElement>
                                                        <con1:varName>REQconDatoCuenta</con1:varName>
                                                    </con1:validate>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="errorCode">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e04</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RSPconDatoCuenta/con:CodigoError/text())</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="validationMessage">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e03</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if($errorCode =  '-1')then(
	''
)else(
	fn:string($RSPconDatoCuenta/con:MensajeError/text())
	)</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                            <con1:ifThenElse>
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e01</con4:id>
                                                <con1:case>
                                                    <con1:condition>
                                                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$validationMessage = ''</con2:xqueryText>
                                                    </con1:condition>
                                                    <con1:actions>
                                                        <con1:assign varName="registroDatoCuenta">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7e00</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">for $rowBase in $RSPconDatoCuenta/con:RowSet/con:Row
	where $rowBase/con:Column[upper-case(@name) = 'TIPOORG']/text() = "BASE"
return
     
     $rowBase</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="customerId">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dff</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn:string($registroDatoCuenta/con:Column[@name='CUST_NBR']/text())</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="customerName">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dfe</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn:string($registroDatoCuenta/con:Column[@name='nombre_cliente']/text())</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="legalId">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dfd</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn:string($registroDatoCuenta/con:Column[@name='legal_id']/text())</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="logo">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dfc</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn:string($registroDatoCuenta/con:Column[@name='logo']/text())</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="org">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dfb</con4:id>
                                                            <con1:expr>
                                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($registroDatoCuenta/con:Column[@name='ORG']/text())</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="accountNumber">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7dfa</con4:id>
                                                            <con1:expr>
                                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($registroDatoCuenta/con:Column[@name='LMS_ACC']/text())</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="scheme">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df9</con4:id>
                                                            <con1:expr>
                                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($registroDatoCuenta/con:Column[@name='LMS_Scheme']/text())</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="nit">
                                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df8</con4:id>
                                                            <con1:expr>
                                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">fn-bea:trim(string($registroDatoCuenta/con:Column[@name='driver_lic']/text()))</con4:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                    </con1:actions>
                                                </con1:case>
                                                <con1:default>
                                                    <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                        <con2:id>_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df7</con2:id>
                                                    </con2:skip>
                                                </con1:default>
                                            </con1:ifThenElse>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:assign varName="errorCode">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df6</con4:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'ERROR'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="validationMessage">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df5</con4:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'CUSTOMER_ID_TYPE no soportado'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con3:skip xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                            <con3:id>_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7df4</con3:id>
                                        </con3:skip>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="ObtenerParametrizacion">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c40</con2:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">not(exists($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE)) and $validationMessage = ""</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3f</con2:id>
                                    <con1:case>
                                        <con1:condition>
                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$logo != ""</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c39</con2:id>
                                                <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>obtenerParametrizacion</con1:operation>
                                                <con1:request>
                                                    <con1:body>REQobtenerParametrizacion</con1:body>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body>RSPobtenerParametrizacion</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="institutionNameParameter">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3e</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'FICBCO0229.MRS.INSTITUTION.NAME'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="REQobtenerParametrizacion">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3d</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                                <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                                                <con2:param name="nombreParametros">
                                                                    <con2:path>$institutionNameParameter</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="errorCode">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3c</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RSPobtenerParametrizacion/osb:ERROR_CODE/text())</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="validationMessage">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3b</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RSPobtenerParametrizacion/osb:ERROR_MESSAGE/text())</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="institutionName">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c3a</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if($validationMessage = "") then (
	fn:string($RSPobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[ osb:NAME = $institutionNameParameter ]/osb:VALUE/text())
) else (
	""
)</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:assign varName="errorCode">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c38</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'ERROR'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="validationMessage">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c37</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">"No se encontr√≥ logo para la tarjeta."</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c36</con2:id>
                                        </con2:skip>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:id>_ActionId-5861678652477054474-14066f34.16afb18db2e.-3c35</con2:id>
                            </con2:skip>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaProgramaLealtad">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaProgramaLealtad" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-795d</con4:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">not(exists($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE)) and $validationMessage = ""</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7958</con4:id>
                                    <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/INTFC/consultaProgramaLealtad/biz/consultaProgramaLealtad_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>consultaProgramaLealtad</con1:operation>
                                    <con1:request>
                                        <con1:body>REQconsultaProgramaLealtad</con1:body>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body>RSPconsultaProgramaLealtad</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="REQconsultaProgramaLealtad">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-795c</con4:id>
                                            <con1:expr>
                                                <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                    <con2:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/consultaProgramaLealtadIn"/>
                                                    <con2:param name="logo">
                                                        <con2:path>$logo</con2:path>
                                                    </con2:param>
                                                    <con2:param name="codigoPais">
                                                        <con2:path>fn:string($header/aut:RequestHeader/Region/SourceBank/text())</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:assign varName="errorCode">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-795b</con4:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaProgramaLealtad/con:PV_CODIGOMENSAJE/text())</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="validationMessage">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-795a</con4:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($RSPconsultaProgramaLealtad/con:PV_DESCRIPCIONMENSAJE/text())</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="programaLealtad">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7959</con4:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if($validationMessage = "") then (
	string($RSPconsultaProgramaLealtad/con:PV_CODIGOLEALTAD/text())
) else ( '' )</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:id>_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7957</con2:id>
                            </con2:skip>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaPuntos">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://customer.ws.mcrewards.mastercard.com/" prefix="cus" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.procesa.com/fdcs" prefix="fdcs" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-39d1</con2:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">not(exists($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE)) and $validationMessage = ""</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-3961</con2:id>
                                    <con1:case>
                                        <con1:condition>
                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$programaLealtad = "1"</con4:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7e9f</con4:id>
                                                <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/Mastercard/CustomerService/biz/CustomerService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>getRTRPreferences</con1:operation>
                                                <con1:request>
                                                    <con1:body>REQgetPointDetails</con1:body>
                                                    <con1:header>REQHeadergetPointDetails</con1:header>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body>RSPgetPointDetails</con1:body>
                                                    <con1:header>RSPHeadergetPointDetails</con1:header>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="REQHeadergetPointDetails">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7e67</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">&lt;soap-env:Header/></con4:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:replace varName="REQHeadergetPointDetails" contents-only="true">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7e4a</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                <con4:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/MRSIdentity"/>
                                                                <con4:param name="institutionName">
                                                                    <con4:path>$institutionName</con4:path>
                                                                </con4:param>
                                                                <con4:param name="appID">
                                                                    <con4:path>$nit</con4:path>
                                                                </con4:param>
                                                            </con4:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:replace>
                                                    <con1:assign varName="REQgetPointDetails">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7e2d</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                <con4:resource ref="Middleware/v2/Resources/ConsultaPuntosLealtad/xq/getPointDetailsInGT"/>
                                                            </con4:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="availablePoints">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7df5</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($RSPgetPointDetails/cus:AvailablePoints)</con4:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:case>
                                        <con1:condition>
                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$programaLealtad = "2"</con4:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7ed7</con4:id>
                                                <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/VisionPlus/visionPlus/biz/visionPlus" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>PointsAdjustmentInquiry</con1:operation>
                                                <con1:request>
                                                    <con1:body>REQPointsAdjustmentInquiry</con1:body>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body>RSPPointsAdjustmentInquiry</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="REQPointsAdjustmentInquiry">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7edc</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                                                <con2:resource ref="Middleware/v2/Resources/VisionPlus/xq/pointsAdjustmentInquiryIn"/>
                                                                <con2:param name="accountNumber">
                                                                    <con2:path>$accountNumber</con2:path>
                                                                </con2:param>
                                                                <con2:param name="scheme">
                                                                    <con2:path>$scheme</con2:path>
                                                                </con2:param>
                                                                <con2:param name="org">
                                                                    <con2:path>$org</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:validate>
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7edb</con4:id>
                                                        <con1:schema ref="Middleware/v2/BusinessServices/VisionPlus/visionPlus/xsd/XMLSchema_769155616"/>
                                                        <con1:schemaElement xmlns:fdcs="http://www.procesa.com/fdcs">fdcs:PointsAdjustmentInquiryRequest</con1:schemaElement>
                                                        <con1:varName>REQPointsAdjustmentInquiry</con1:varName>
                                                    </con1:validate>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="errorCode">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7eda</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn-bea:trim(string($RSPPointsAdjustmentInquiry/fdcs:ReturnCodes/RC/Code/text()))</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="validationMessage">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7ed9</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">let $svcReturn := string($RSPPointsAdjustmentInquiry/SVC-RETURN/text())
return
if($svcReturn != "P") then (
	 fn-bea:trim(string($RSPPointsAdjustmentInquiry/fdcs:ReturnCodes/RC/Desc/text()))
)else(
	''
)</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="availablePoints">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-251563045651411653-33b2bdfc.1727002e1b8.-7ed8</con4:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">let $available := fn-bea:trim(string($RSPPointsAdjustmentInquiry/GPXAIO-OPEN-TO-RED-ON-SCR/text()))
return
if($available != "")then(
	xs:decimal($available) div 1000
)else(
	0
)</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:assign varName="errorCode">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-380f</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'ERROR'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="validationMessage">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-37f2</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'Programa de lealtad no soportado'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="EquivalenciaEfectivo">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaProgramaLealtad" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                    <con1:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/canjearPuntosEfectivo" prefix="can" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2e96</con2:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$validationMessage = "" and not(exists($RSPconsultaPuntosLealtad/con1:PT_PUNTOS_LEALTAD/con1:BALANCE))</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2e5e</con2:id>
                                    <con1:case>
                                        <con1:condition>
                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($body/prog:consultaPuntosLealtad/RETURN_CASH_EQUIVALENT/text()) = "YES"
and xs:decimal($availablePoints) > xs:decimal(0)</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2e26</con2:id>
                                                <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ABKGT/canjearPuntosEfectivo/biz/canjearPuntosEfectivo_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>canjearPuntosEfectivo</con1:operation>
                                                <con1:request>
                                                    <con1:body>REQcanjearPuntosEfectivo</con1:body>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body>RSPcanjearPuntosEfectivo</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="REQcanjearPuntosEfectivo">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2dee</con2:id>
                                                        <con1:expr>
                                                            <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                                <con4:resource ref="Middleware/v2/Resources/ProgramaLealtad/xq/canjearPuntosEfectivoGTIn"/>
                                                                <con4:param name="logo">
                                                                    <con4:path>$logo</con4:path>
                                                                </con4:param>
                                                                <con4:param name="tipoConversion">
                                                                    <con4:path>"1"</con4:path>
                                                                </con4:param>
                                                                <con4:param name="montoConversion">
                                                                    <con4:path>$availablePoints</con4:path>
                                                                </con4:param>
                                                                <con4:param name="cashRedemptionType">
                                                                    <con4:path>$body/prog:consultaPuntosLealtad/CASH_REDEMPTION</con4:path>
                                                                </con4:param>
                                                            </con4:xqueryTransform>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="errorCode">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2db6</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:string($RSPcanjearPuntosEfectivo/can:PV_CODIGOMENSAJE/text())</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="validationMessage">
                                                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2d99</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">if (fn:upper-case($RSPcanjearPuntosEfectivo/can:PV_CODIGOMENSAJE/text()) = "SUCCESS") then (
	""
) else (
	fn:string($RSPcanjearPuntosEfectivo/can:PV_DESCRIPCIONMENSAJE/text())
)</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="cashEquivalent">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7bc5</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">data($RSPcanjearPuntosEfectivo/can:PN_VALORSALIDA)</con4:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="cashCurrency">
                                                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7ba8</con4:id>
                                                        <con1:expr>
                                                            <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">'GTQ'</con4:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:assign varName="RSPcanjearPuntosEfectivo">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2d61</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<can:OutputParameters>
	<can:PN_VALORSALIDA/>
	<can:PN_FACTORCANJE/>
	<can:PV_CODIGOMENSAJE/>
	<can:PV_DESCRIPCIONMENSAJE/>
</can:OutputParameters>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con2:skip xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-5861678652477054474-14066f34.16afb18db2e.-2d44</con2:id>
                                        </con2:skip>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="RegistraPuntosLealtad">
                <con:context>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaPuntosLealtad" prefix="con1" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con4:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/registraPuntosLealtad" prefix="reg" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con4:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                    <con4:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7c88</con4:id>
                        <con1:case>
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">upper-case($RSPconsultaPuntosLealtad/con1:PV_CODIGO_ERROR/text()) != "SUCCESS" and $validationMessage = ""</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7c50</con4:id>
                                    <con1:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/CLIENTDATA/registraPuntosLealtad/biz/registraPuntosLealtad_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>registraPuntosLealtad</con1:operation>
                                    <con1:request>
                                        <con1:body>REQregistraPuntosLealtad</con1:body>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body>RSPregistraPuntosLealtad</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="REQregistraPuntosLealtad">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7be2</con4:id>
                                            <con1:expr>
                                                <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                                    <con4:resource ref="Middleware/v2/Resources/ConsultaPuntosLealtad/xq/registraPuntosLealtadIn"/>
                                                    <con4:param name="cashEquivalent">
                                                        <con4:path>$cashEquivalent</con4:path>
                                                    </con4:param>
                                                    <con4:param name="customerName">
                                                        <con4:path>$customerName</con4:path>
                                                    </con4:param>
                                                    <con4:param name="balance">
                                                        <con4:path>$availablePoints</con4:path>
                                                    </con4:param>
                                                    <con4:param name="requestHeader">
                                                        <con4:path>$header/aut:RequestHeader</con4:path>
                                                    </con4:param>
                                                    <con4:param name="consultaPuntosLealtad">
                                                        <con4:path>$body/prog:consultaPuntosLealtad</con4:path>
                                                    </con4:param>
                                                    <con4:param name="cashCurrency">
                                                        <con4:path>$cashCurrency</con4:path>
                                                    </con4:param>
                                                    <con4:param name="legalId">
                                                        <con4:path>$legalId</con4:path>
                                                    </con4:param>
                                                </con4:xqueryTransform>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:assign varName="errorCode">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7b70</con4:id>
                                            <con1:expr>
                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPregistraPuntosLealtad/reg:PV_CODIGO_ERROR/text())</con4:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="validationMessage">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8994312958660251846--6a5928c6.1830a51fbba.-7b53</con4:id>
                                            <con1:expr>
                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">string($RSPregistraPuntosLealtad/reg:PV_MENSAJE_ERROR/text())</con4:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="ConsultaPuntosLealtad_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con:stage name="FlujoSalida">
                <con:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                    <con1:replace varName="header" contents-only="true">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2cd6</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<aut:ResponseHeader>
{
	if($validationMessage = '') then (
		<successIndicator>Success</successIndicator>
	)else(
		<successIndicator>{ $errorCode }</successIndicator>,
		<messages>{ $validationMessage }</messages>
	)
}
</aut:ResponseHeader>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2cb9</con2:id>
                        <con1:case>
                            <con1:condition>
                                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">string($header/aut:ResponseHeader/successIndicator/text()) = "Success"</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:replace contents-only="true" varName="body">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2c81</con2:id>
                                    <con1:expr>
                                        <con4:xqueryTransform xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                                            <con4:resource ref="Middleware/v2/Resources/ConsultaPuntosLealtad/xq/consultaPuntosLealtadGTOut"/>
                                            <con4:param name="legalId">
                                                <con4:path>$legalId</con4:path>
                                            </con4:param>
                                            <con4:param name="availablePoints">
                                                <con4:path>$availablePoints</con4:path>
                                            </con4:param>
                                            <con4:param name="customerName">
                                                <con4:path>$customerName</con4:path>
                                            </con4:param>
                                            <con4:param name="cashCurrency">
                                                <con4:path>$cashCurrency</con4:path>
                                            </con4:param>
                                            <con4:param name="cashEquivalent">
                                                <con4:path>$cashEquivalent</con4:path>
                                            </con4:param>
                                            <con4:param name="isCashEquivalent">
                                                <con4:path>fn:string($body/prog:consultaPuntosLealtad/RETURN_CASH_EQUIVALENT/text())</con4:path>
                                            </con4:param>
                                        </con4:xqueryTransform>
                                    </con1:expr>
                                </con1:replace>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:replace varName="body" contents-only="true">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5861678652477054474-14066f34.16afb18db2e.-2c47</con2:id>
                                <con1:expr>
                                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;prog:consultaPuntosLealtadResponse/></con2:xqueryText>
                                </con1:expr>
                            </con1:replace>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con2:pipeline type="error" name="_onErrorHandler-5062500776767059966-38a7cdd4.16b00a94253.-7fe5">
            <con2:stage name="ManejoError">
                <con2:context>
                    <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/programaLealtadTypes" prefix="prog"/>
                    <con:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con2:context>
                <con2:actions>
                    <con1:replace varName="header" contents-only="true">
                        <con:id>_ActionId-5062500776767059966-38a7cdd4.16b00a94253.-7f77</con:id>
                        <con1:expr>
                            <con:xqueryText><![CDATA[<aut:ResponseHeader>
	<messageId>-1</messageId>
	<successIndicator>ERROR</successIndicator>
	<messages>{string($fault/ctx:reason/text())}</messages>
</aut:ResponseHeader>]]></con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="true">
                        <con:id>_ActionId-5062500776767059966-38a7cdd4.16b00a94253.-7f5a</con:id>
                        <con1:expr>
                            <con:xqueryText>&lt;prog:consultaPuntosLealtadResponse/></con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con:reply>
                        <con:id>_ActionId-5062500776767059966-38a7cdd4.16b00a94253.-7f07</con:id>
                    </con:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con:pipeline-node name="ConsultaPuntosLealtad">
                <con:request>ConsultaPuntosLealtad_request</con:request>
                <con:response>ConsultaPuntosLealtad_response</con:response>
            </con:pipeline-node>
        </con:flow>
    </con2:router>
</con:pipelineEntry>