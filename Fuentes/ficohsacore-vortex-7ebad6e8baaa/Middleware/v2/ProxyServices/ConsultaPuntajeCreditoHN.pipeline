<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/v2/Resources/ConsultaPuntajeCredito/wsdl/consultaPuntajeCreditoPS"/>
            <con:binding>
                <con:name>consultaPuntajeCreditoPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com/middleware.services/consultaPuntajeCreditoPS/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="true" aggregationInterval="360" level="action"/>
            <oper:tracingEnabled>false</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con1:router errorHandler="_onErrorHandler-1473810702047277080-2322cc71.17041e60ed0.-43d2" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
        <con1:pipeline type="request" name="ConsultaPuntajeCredito_request">
            <con1:stage name="ObtieneValoresGenerales">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.bea.com/wli/sb/services/security/config" prefix="conf"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="uuid">
                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6687</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:substring(fn-bea:uuid(), 1, 50)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="customerLegalId">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4c98</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:CUSTOMER_LEGAL_ID)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="productNumber">
                        <con2:id>_ActionId-1217089678451410660-3c361403.17063bf97a3.-7f14</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:PAYMENT_INFO/con:PRODUCT_NUMBER)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="productType">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4121</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:PAYMENT_INFO/con:PRODUCT_TYPE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="userNameT24">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-410e</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn-bea:lookupBasicCredentials(concat("Middleware/Security/", upper-case($header/aut:RequestHeader/Authentication/UserName)))/conf:username/text()</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="passwordT24">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-40fc</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn-bea:lookupBasicCredentials(concat("Middleware/Security/", upper-case($header/aut:RequestHeader/Authentication/UserName)))/conf:password/text()</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="paymentAmount">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5378</con2:id>
                        <con3:expr>
                            <con2:xqueryText>'0.00'</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ConsultaDatosCliente">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.bea.com/wli/sb/services/security/config" prefix="conf"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-41db</con2:id>
                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v3/ProxyServices/ConsultaCliente" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>consultaCliente</con3:operation>
                        <con3:request>
                            <con3:body>REQconsultaCliente</con3:body>
                            <con3:header>REQconsultaClienteHeader</con3:header>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPconsultaCliente</con3:body>
                            <con3:header>RSPconsultaClienteHeader</con3:header>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQconsultaCliente">
                                <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4c9a</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/consultaClienteIn"/>
                                        <con2:param name="customerLegalId">
                                            <con2:path>$customerLegalId</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="REQconsultaClienteHeader">
                                <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4c4c</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>$header</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="returnCodeClienteInfo">
                                <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-3fbc</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($RSPconsultaClienteHeader/aut:ResponseHeader/successIndicator)</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-3f9a</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:contains(fn:upper-case($returnCodeClienteInfo), 'SUCCESS')</con2:xqueryText>
                            </con3:condition>
                            <con3:actions/>
                        </con3:case>
                        <con3:default>
                            <con3:replace contents-only="true" varName="header">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.4d3d</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'Ocurrió un error obteniendo la información general del cliente.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.4d3b</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con2:reply>
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.4d3f</con2:id>
                            </con2:reply>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ObtenerDatosCliente">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaClientesTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="customerId">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-406e</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaCliente/con:CUSTOMER_ID)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="gender">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4038</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaCliente/con:GENDER)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="dateOfBirth">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-401d</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaCliente/con:DATE_OF_BIRTH)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="targetName">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4009</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaCliente/con:TARGET_DESCRIPTION)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="smsPhone">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-3ff5</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaCliente/con:PHONE_INFO/con:PHONE_NUMBER_ITEM[con:PHONE_TYPE='SMS' and con:PHONE_ORDER='1']/con:PHONE_NUMBER)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ObtieneDatosCreditScore">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaDatoAplicacionTypes" prefix="cos"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-762e</con2:id>
                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/ConsultaDatoAplicacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>consultaDatoAplicacion</con3:operation>
                        <con3:request>
                            <con3:body>REQconsultaCosto</con3:body>
                            <con3:header>REQconsultaCostoHeader</con3:header>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPconsultaCosto</con3:body>
                            <con3:header>RSPconsultaCostoHeader</con3:header>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQconsultaCostoHeader">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-75f0</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>$header</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="REQconsultaCosto">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-760b</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/ConsultaDatoAplicacion/xq/consultaDatoAplicacionIn"/>
                                        <con2:param name="applicationName">
                                            <con2:path>'CREDITSCORE'</con2:path>
                                        </con2:param>
                                        <con2:param name="dataIdentifier">
                                            <con2:path>fn:concat('QUERY_COST_FOR_CUSTOMER:',$customerId)</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:ifThenElse>
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-75c7</con2:id>
                                <con3:case>
                                    <con3:condition>
                                        <con2:xqueryText>fn:upper-case($RSPconsultaCostoHeader/aut:ResponseHeader/successIndicator/text()) = 'SUCCESS'</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                        <con3:assign varName="queryCostUSD">
                                            <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-7529</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>fn:string($RSPconsultaCosto/cos:DATA_VALUE)</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:actions>
                                </con3:case>
                                <con3:default>
                                    <con3:replace contents-only="true" varName="body">
                                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-7575</con2:id>
                                        <con3:expr>
                                            <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                        </con3:expr>
                                    </con3:replace>
                                    <con3:replace contents-only="true" varName="header">
                                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-7573</con2:id>
                                        <con3:expr>
                                            <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ fn:concat('Error obteniendo el costo de consulta para cliente: ', $customerLegalId) }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                        </con3:expr>
                                    </con3:replace>
                                    <con2:reply>
                                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-754d</con2:id>
                                    </con2:reply>
                                </con3:default>
                            </con3:ifThenElse>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ObtieneParametrosMiddleware">
                <con1:context>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb"/>
                    <con2:userNsDecl namespace="http://www.bea.com/wli/sb/services/security/config" prefix="conf"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="idService">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-5077</con2:id>
                        <con3:expr>
                            <con2:xqueryText>'FICBCO0396'</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="scoreProviderServiceAccountParam">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-5055</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:concat($idService, '.SERVICEACCOUNT.SCORE.PROV')</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="queryScoreCreditAccountParam">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-503b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:concat($idService, '.QUERY.SCORE.CREDIT.ACCOUNT')</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="descriptionCreditScoreParam">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5290</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:concat($idService, '.SCORE.CREDIT.TXN.DESC')</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="transactionTypeCreditScoreParam">
                        <con2:id>_ActionId-4364991132927312080-2a1e3a0b.1751b2281f5.-6b7c</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:concat($idService, '.SCORE.CREDIT.TXN.TYPE')</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:wsCallout>
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-5018</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>obtenerParametrizacion</con3:operation>
                        <con3:request>
                            <con3:body>REQobtenerParametrizacion</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPobtenerParametrizacion</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQobtenerParametrizacion">
                                <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4ff5</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                        <con2:param name="nombreParametros">
                                            <con2:path>fn:concat($scoreProviderServiceAccountParam, '||', $queryScoreCreditAccountParam, '||', $descriptionCreditScoreParam, '||', $transactionTypeCreditScoreParam)</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform/>
                    </con3:wsCallout>
                    <con3:assign varName="scoreProviderServiceAccount">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4fb9</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$scoreProviderServiceAccountParam]/osb:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="queryScoreCreditAccount">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4fde</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$queryScoreCreditAccountParam]/osb:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="userNameScoreProvider">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4f98</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn-bea:lookupBasicCredentials(concat("Middleware/Security/", $scoreProviderServiceAccount))/conf:username/text()</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="passwordScoreProvider">
                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4f7a</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn-bea:lookupBasicCredentials(concat("Middleware/Security/", $scoreProviderServiceAccount))/conf:password/text()</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="descriptionCreditScore">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.52a7</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$descriptionCreditScoreParam]/osb:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="transactionTypeCreditScore">
                        <con2:id>_ActionId-4364991132927312080-2a1e3a0b.1751b2281f5.-6b74</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPobtenerParametrizacion/osb:CONFIGURACIONES/osb:CONFIGURACIONES_ITEM[osb:NAME=$transactionTypeCreditScoreParam]/osb:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="CobraConsulta">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaTasaCambioTypes" prefix="exr"/>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultasType" prefix="cdc"/>
                    <con2:userNsDecl namespace="http://alcance.local/wsinfotarjetas/" prefix="ait"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6d3e</con2:id>
                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/ConsultaTasaCambio" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>consultaTasaCambio</con3:operation>
                        <con3:request>
                            <con3:body>REQconsultaTasaCambio</con3:body>
                            <con3:header>REQconsultaTasaCambioHeader</con3:header>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPconsultaTasaCambio</con3:body>
                            <con3:header>RSPconsultaTasaCambioHeader</con3:header>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQconsultaTasaCambio">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6d05</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/consultaTasaCambioIn"/>
                                        <con2:param name="targetCurrency">
                                            <con2:path>'USD'</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceCurrency">
                                            <con2:path>'HNL'</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="REQconsultaTasaCambioHeader">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6d26</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>$header</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="exchangeRate">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6cdf</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>xs:decimal($RSPconsultaTasaCambio/exr:consultaTasaCambioResponseType/exr:consultaTasaCambioResponseRecordType/SELL_RATE/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:assign varName="queryCostHNL">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6c60</con2:id>
                        <con3:expr>
                            <con2:xqueryText>xs:decimal($exchangeRate) * xs:decimal($queryCostUSD)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="paymentCurrency">
                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-7d33</con2:id>
                        <con3:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-70a0</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:normalize-space($productType) = 'TRC'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6e3f</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>xs:decimal($queryCostHNL) > 0</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="paymentAmount">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6ead</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>fn:string(fn-bea:decimal-round(xs:decimal($queryCostHNL), 2))</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:assign varName="paymentCurrency">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e9f</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>'HNL'</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f68</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>InformacionTarjeta</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQconsultaInformacionTarjeta</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPconsultaInformacionTarjeta</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQconsultaInformacionTarjeta">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f6c</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/consultaInformacionTarjetaIn"/>
                                                                <con2:param name="cardNumber">
                                                                    <con2:path>$productNumber</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="cardInformationStatus">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f6b</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaInformacionTarjeta/ait:InformacionTarjetaActualResult/ait:EstatusConfirmacion)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="cardInformationMessage">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f1f</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaInformacionTarjeta/ait:InformacionTarjetaActualResult/ait:MensajeConfirmacion)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="cardCustomerId">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f6a</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaInformacionTarjeta/ait:InformacionTarjetaActualResult/ait:CodigoClienteCuenta)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="cardExpirationDate">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f69</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaInformacionTarjeta/ait:InformacionTarjetaActualResult/ait:FechaVencimiento)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                            <con3:assign varName="cardExpirationDateAlt">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6d52</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>fn:concat(fn:substring($cardExpirationDate, 5, 2), fn:substring($cardExpirationDate, 3, 2))</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6f08</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:normalize-space($customerId) != fn:normalize-space($cardCustomerId)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:replace contents-only="true" varName="body">
                                                            <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6ef7</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:replace>
                                                        <con3:replace contents-only="true" varName="header">
                                                            <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6ee8</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'La tarjeta provista no existe o no pertenece al cliente especificado.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:replace>
                                                        <con2:reply>
                                                            <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6ed7</con2:id>
                                                        </con2:reply>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default/>
                                            </con3:ifThenElse>
                                            <con3:assign varName="currentDate">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e66</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>fn-bea:date-to-string-with-format("yyyyMMdd", fn:current-date())</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:assign varName="reference">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e52</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>fn-bea:dateTime-to-string-with-format("yyMMddhhmmss", fn:current-dateTime())</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e8a</con2:id>
                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>registrarConsumo</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQregistrarConsumo</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPregistrarConsumo</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQregistrarConsumo">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e79</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/registraConsumoTarjetaCreditoIn"/>
                                                                <con2:param name="expirationDate">
                                                                    <con2:path>$cardExpirationDateAlt</con2:path>
                                                                </con2:param>
                                                                <con2:param name="amount">
                                                                    <con2:path>xs:double($paymentAmount)</con2:path>
                                                                </con2:param>
                                                                <con2:param name="reference">
                                                                    <con2:path>$reference</con2:path>
                                                                </con2:param>
                                                                <con2:param name="channel">
                                                                    <con2:path>'1'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="cardNumber">
                                                                    <con2:path>$productNumber</con2:path>
                                                                </con2:param>
                                                                <con2:param name="description">
                                                                    <con2:path>$descriptionCreditScore</con2:path>
                                                                </con2:param>
                                                                <con2:param name="currency">
                                                                    <con2:path>'340'</con2:path>
                                                                </con2:param>
                                                                <con2:param name="date">
                                                                    <con2:path>$currentDate</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="cardConsumeStatus">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e3e</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaInformacionTarjeta/ait:InformacionTarjetaActualResult/ait:EstatusConfirmacion)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="cardConsumeMessage">
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e24</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPregistrarConsumo/ait:ConsumoNORResult/ait:mensajeConfirmacion)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                            <con3:assign varName="uuid">
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-667a</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>$reference</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6e08</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>$cardConsumeStatus = '00'</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions/>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:replace contents-only="true" varName="body">
                                                        <con2:id>_ActionId-4006904942302140122-23d4d2d1.176e052788b.-7ff8</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:replace>
                                                    <con3:replace contents-only="true" varName="header">
                                                        <con2:id>_ActionId-4006904942302140122-23d4d2d1.176e052788b.-7ff6</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ $cardConsumeMessage }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:replace>
                                                    <con2:reply>
                                                        <con2:id>_ActionId-4006904942302140122-23d4d2d1.176e052788b.-7ff4</con2:id>
                                                    </con2:reply>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:normalize-space($productType) = 'AHO' or fn:normalize-space($productType) = 'CHQ'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6e68</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>xs:decimal($queryCostUSD) > 0</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4e35</con2:id>
                                                <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/ConsultaDetallesCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con3:operation>consultaDetallesCuenta</con3:operation>
                                                <con3:request>
                                                    <con3:body>REQconsultaDetallesCuenta</con3:body>
                                                    <con3:header>REQconsultaDetallesCuentaHeader</con3:header>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RSPconsultaDetallesCuenta</con3:body>
                                                    <con3:header>RSPconsultaDetallesCuentaHeader</con3:header>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="REQconsultaDetallesCuenta">
                                                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4dff</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/consultaDetallesCuentaIn"/>
                                                                <con2:param name="accountNumber">
                                                                    <con2:path>fn:normalize-space($productNumber)</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="REQconsultaDetallesCuentaHeader">
                                                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4e22</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>$header</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform>
                                                    <con3:assign varName="accountCustomerId">
                                                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4de5</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaDetallesCuenta/cdc:consultaDetallesCuentaResponseType/cdc:consultaDetallesCuentaResponseRecordType/CUSTOMER_ID)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="accountCurrency">
                                                        <con2:id>_ActionId-2713776719766209725-6f318ee7.1708dfcaea5.-4d1c</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn:string($RSPconsultaDetallesCuenta/cdc:consultaDetallesCuentaResponseType/cdc:consultaDetallesCuentaResponseRecordType/CURRENCY)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:responseTransform>
                                            </con3:wsCallout>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54ae</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:normalize-space($customerId) != fn:normalize-space($accountCustomerId)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:replace contents-only="true" varName="body">
                                                            <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54af</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:replace>
                                                        <con3:replace contents-only="true" varName="header">
                                                            <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b0</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'La cuenta a debitar no existe o no pertenece al cliente especificado.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:replace>
                                                        <con2:reply>
                                                            <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b1</con2:id>
                                                        </con2:reply>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b2</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>$accountCurrency = 'USD'</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:assign varName="paymentAmount">
                                                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b3</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>fn:string(fn-bea:decimal-round(xs:decimal($queryCostUSD), 2))</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>$accountCurrency = 'HNL'</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:assign varName="paymentAmount">
                                                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b4</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>fn:string(fn-bea:decimal-round(xs:decimal($queryCostHNL), 2))</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:replace contents-only="true" varName="body">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b5</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:replace>
                                                            <con3:replace contents-only="true" varName="header">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b6</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'Moneda de cuenta no soportada.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:replace>
                                                            <con2:reply>
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b7</con2:id>
                                                            </con2:reply>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                    <con3:assign varName="paymentCurrency">
                                                        <con2:id>_ActionId-5824909835603656535-22ed4c40.171e5ddb182.-75fb</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>$accountCurrency</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="lockEndDate">
                                                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b8</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn-bea:date-to-string-with-format("yyyMMdd", xs:date(fn:current-date() + xdt:dayTimeDuration("P3D")))</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:wsCallout>
                                                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54bd</con2:id>
                                                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/BloqueoFondosCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con3:operation>bloqueoFondosCuenta</con3:operation>
                                                        <con3:request>
                                                            <con3:body>REQbloqueoFondosCuenta</con3:body>
                                                            <con3:header>REQbloqueoFondosCuentaHeader</con3:header>
                                                        </con3:request>
                                                        <con3:response>
                                                            <con3:body>RSPbloqueoFondosCuenta</con3:body>
                                                            <con3:header>RSPbloqueoFondosCuentaHeader</con3:header>
                                                        </con3:response>
                                                        <con3:requestTransform>
                                                            <con3:assign varName="REQbloqueoFondosCuentaHeader">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54b9</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>$header</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                            <con3:assign varName="REQbloqueoFondosCuenta">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54ba</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryTransform>
                                                                        <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/bloqueaFondosCuentaIn"/>
                                                                        <con2:param name="endDate">
                                                                            <con2:path>$lockEndDate</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="accountNumber">
                                                                            <con2:path>$productNumber</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="description">
                                                                            <con2:path>$descriptionCreditScore</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="blockAmount">
                                                                            <con2:path>$paymentAmount</con2:path>
                                                                        </con2:param>
                                                                    </con2:xqueryTransform>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:requestTransform>
                                                        <con3:responseTransform>
                                                            <con3:assign varName="lockReference">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54bb</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>fn:string($RSPbloqueoFondosCuentaHeader/aut:ResponseHeader/transactionId)</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                            <con3:assign varName="lockSuccessIndicator">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54bc</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>fn:string($RSPbloqueoFondosCuentaHeader/aut:ResponseHeader/successIndicator)</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:responseTransform>
                                                    </con3:wsCallout>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54be</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($lockSuccessIndicator) = 'SUCCESS'</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions/>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:replace contents-only="true" varName="body">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54bf</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:replace>
                                                            <con3:replace varName="header" contents-only="true">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54c0</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'No fue posible reservar los fondos para la transacción.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:replace>
                                                            <con2:reply>
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.54c1</con2:id>
                                                            </con2:reply>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:normalize-space($productType) = ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6f49</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>xs:decimal($queryCostUSD) > 0</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace contents-only="true" varName="body">
                                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6e28</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                                </con3:expr>
                                            </con3:replace>
                                            <con3:replace contents-only="true" varName="header">
                                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6e10</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'El costo de la consulta es: ', $queryCostUSD, ', debe proporcionar un producto para realizar el pago.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                                </con3:expr>
                                            </con3:replace>
                                            <con2:reply>
                                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6dea</con2:id>
                                            </con2:reply>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6f2b</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace contents-only="true" varName="header">
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6f11</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ 'ERROR' }</successIndicator>
	<messages>{ 'Debe proporcionarse un tipo de producto válido.' }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con2:reply>
                                <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-6eee</con2:id>
                            </con2:reply>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ObtenerDatosAdicionales">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="hostSource">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-695b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='IPV4_ADDRESS']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="geoipCity">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-68c5</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='GEOIP_CITY']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="geoipRegion">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-693f</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='GEOIP_REGION']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="geoipCountry">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-691f</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='GEOIP_COUNTRY']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="geoipLatitude">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-68e1</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='GEOIP_APROX_LATITUDE']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="geoipLongitude">
                        <con2:id>_ActionId-7301796032729713973--d1c377b.1707e0813fa.-68fa</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/con:consultaPuntajeCredito/con:ADDITIONAL_INFO/con:KV_PAIR/con:KEY[.='GEOIP_APROX_LONGITUDE']/../con:VALUE)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ConsultaPuntajeCredito">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-7484245297157996820--4b8b6639.16f33a64050.-79c4</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/External/Outgoing/BusinessServices/Equifax/biz/consultaPuntajeCredito" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>Score</con3:operation>
                        <con3:request>
                            <con3:body>REQconsultaPuntajeCredito</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPconsultaPuntajeCredito</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQconsultaPuntajeCredito">
                                <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4a06</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/External/Outgoing/BusinessServices/Equifax/xq/consultaPuntajeCreditoIn"/>
                                        <con2:param name="documentType">
                                            <con2:path>'1'</con2:path>
                                        </con2:param>
                                        <con2:param name="password">
                                            <con2:path>$passwordScoreProvider</con2:path>
                                        </con2:param>
                                        <con2:param name="documentId">
                                            <con2:path>$customerLegalId</con2:path>
                                        </con2:param>
                                        <con2:param name="username">
                                            <con2:path>$userNameScoreProvider</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform/>
                    </con3:wsCallout>
                    <con3:assign varName="REQheader">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.52f1</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$header</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="ConsultaPuntajeCredito_response">
            <con1:stage name="ProcesamientoConsultaEquifax">
                <con1:context>
                    <con2:userNsDecl namespace="http://wsscore.equifax.com.hn" prefix="eqx"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="equifaxResponseCode">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.51f8</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaPuntajeCredito/eqx:response/eqx:codigoRetorno/text())</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="creditScoreValue">
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.520b</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($RSPconsultaPuntajeCredito/eqx:response/eqx:scoreConsumidor/eqx:scoreActual)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="DesbloqueoFondos_CobroFinal">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.509e</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:normalize-space($productType) = 'TRC'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6d90</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$equifaxResponseCode = '00'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions/>
                                    </con3:case>
                                    <con3:default>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-67c8</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>xs:decimal($paymentAmount) > 0</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:wsCallout>
                                                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-67c6</con2:id>
                                                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/transaccionesAlcance/biz/transaccionesAlcance" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con3:operation>reversarConsumo</con3:operation>
                                                        <con3:request>
                                                            <con3:body>REQreversarConsumo</con3:body>
                                                        </con3:request>
                                                        <con3:response>
                                                            <con3:body>RSPreversarConsumo</con3:body>
                                                        </con3:response>
                                                        <con3:requestTransform>
                                                            <con3:assign varName="REQreversarConsumo">
                                                                <con2:id>_ActionId-4006904942302140122-23d4d2d1.176e052788b.-7f9c</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryTransform>
                                                                        <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/reversaConsumoIn"/>
                                                                        <con2:param name="consumeCode">
                                                                            <con2:path>$cardConsumeMessage</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="expirationDate">
                                                                            <con2:path>$cardExpirationDateAlt</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="channel">
                                                                            <con2:path>'1'</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="amount">
                                                                            <con2:path>xs:double($paymentAmount)</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="reference">
                                                                            <con2:path>$reference</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="description">
                                                                            <con2:path>$descriptionCreditScore</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="cardNumber">
                                                                            <con2:path>$productNumber</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="currency">
                                                                            <con2:path>'340'</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="date">
                                                                            <con2:path>$currentDate</con2:path>
                                                                        </con2:param>
                                                                    </con2:xqueryTransform>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:requestTransform>
                                                        <con3:responseTransform/>
                                                    </con3:wsCallout>
                                                </con3:actions>
                                            </con3:case>
                                            <con3:default/>
                                        </con3:ifThenElse>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:normalize-space($productType) = 'AHO' or fn:normalize-space($productType) = 'CHQ'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.50b6</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:empty($lockReference)</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions/>
                                    </con3:case>
                                    <con3:default>
                                        <con3:wsCallout>
                                            <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.517f</con2:id>
                                            <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/DesbloqueoFondosCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                            <con3:operation>desbloqueoFondosCuenta</con3:operation>
                                            <con3:request>
                                                <con3:body>REQdesbloqueoFondosCuenta</con3:body>
                                                <con3:header>REQdesbloqueoFondosCuentaHeader</con3:header>
                                            </con3:request>
                                            <con3:response>
                                                <con3:body>RSPdesbloqueoFondosCuenta</con3:body>
                                                <con3:header>RSPdesbloqueoFondosCuentaHeader</con3:header>
                                            </con3:response>
                                            <con3:requestTransform>
                                                <con3:assign varName="REQdesbloqueoFondosCuenta">
                                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.519d</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryTransform>
                                                            <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/desbloqueoFondosCuentaIn"/>
                                                            <con2:param name="lockReference">
                                                                <con2:path>$lockReference</con2:path>
                                                            </con2:param>
                                                        </con2:xqueryTransform>
                                                    </con3:expr>
                                                </con3:assign>
                                                <con3:assign varName="REQdesbloqueoFondosCuentaHeader">
                                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.51ba</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryText>$REQheader</con2:xqueryText>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:requestTransform>
                                            <con3:responseTransform>
                                                <con3:assign varName="unlockSuccessIndicator">
                                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.51e9</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryText>$RSPdesbloqueoFondosCuentaHeader/aut:ResponseHeader/successIndicator/text()</con2:xqueryText>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:responseTransform>
                                        </con3:wsCallout>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5229</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>$equifaxResponseCode = '00'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:wsCallout>
                                                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5242</con2:id>
                                                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/TransferenciaCuentas" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con3:operation>transferenciaCuentas</con3:operation>
                                                        <con3:request>
                                                            <con3:body>REQtransferenciaCuentas</con3:body>
                                                            <con3:header>REQtransferenciaCuentasHeader</con3:header>
                                                        </con3:request>
                                                        <con3:response>
                                                            <con3:body>RSPtransferenciaCuentas</con3:body>
                                                            <con3:header>RSPtransferenciaCuentasHeader</con3:header>
                                                        </con3:response>
                                                        <con3:requestTransform>
                                                            <con3:assign varName="REQtransferenciaCuentas">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.526e</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryTransform>
                                                                        <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/transferenciaCuentasIn"/>
                                                                        <con2:param name="debitAccount">
                                                                            <con2:path>$productNumber</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="creditAccount">
                                                                            <con2:path>$queryScoreCreditAccount</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="description">
                                                                            <con2:path>$descriptionCreditScore</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="transactionType">
                                                                            <con2:path>$transactionTypeCreditScore</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="transferAmount">
                                                                            <con2:path>$paymentAmount</con2:path>
                                                                        </con2:param>
                                                                        <con2:param name="currency">
                                                                            <con2:path>$accountCurrency</con2:path>
                                                                        </con2:param>
                                                                    </con2:xqueryTransform>
                                                                </con3:expr>
                                                            </con3:assign>
                                                            <con3:assign varName="REQtransferenciaCuentasHeader">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.525e</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>$REQheader</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:requestTransform>
                                                        <con3:responseTransform>
                                                            <con3:assign varName="accountsTransferSuccessIndicator">
                                                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.52c5</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>fn:string($RSPtransferenciaCuentasHeader/aut:ResponseHeader/successIndicator)</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                            <con3:assign varName="uuid">
                                                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6666</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>fn:string($RSPtransferenciaCuentasHeader/aut:ResponseHeader/transactionId)</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:responseTransform>
                                                    </con3:wsCallout>
                                                </con3:actions>
                                            </con3:case>
                                            <con3:default/>
                                        </con3:ifThenElse>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-66e8</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:decimal($paymentAmount) > 0</con2:xqueryText>
                            </con3:condition>
                            <con3:actions/>
                        </con3:case>
                        <con3:default>
                            <con3:assign varName="productType">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-66bf</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>''</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="productNumber">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-66d6</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>''</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="GuardaDatosConsultaScore">
                <con1:context>
                    <con2:userNsDecl namespace="http://wsscore.equifax.com.hn" prefix="eqx"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5475</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$equifaxResponseCode = '00'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="status">
                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5476</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>'SUCCESS'</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:assign varName="statusReason">
                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5477</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>''</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:replace contents-only="true" varName="body">
                                    <con2:id>_ActionId-5824909835603656535-22ed4c40.171e5ddb182.-7533</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="Middleware/v2/Resources/ConsultaPuntajeCredito/xq/consultaPuntajeCreditoOut"/>
                                            <con2:param name="paymentCurrency">
                                                <con2:path>$paymentCurrency</con2:path>
                                            </con2:param>
                                            <con2:param name="equifaxCreditScore">
                                                <con2:path>$RSPconsultaPuntajeCredito</con2:path>
                                            </con2:param>
                                            <con2:param name="paymentAmount">
                                                <con2:path>$paymentAmount</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con3:replace>
                                <con3:replace contents-only="true" varName="header">
                                    <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.5499</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ $status }</successIndicator>
	<transactionId>{ $uuid }</transactionId>
	<messages/>
</aut:ResponseHeader>]]></con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:assign varName="status">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.547a</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>'ERROR'</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="statusReason">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.547b</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($RSPconsultaPuntajeCredito/eqx:response/eqx:mensajeRetorno)</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="productType">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6a54</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>''</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="productNumber">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-6a13</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>''</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="paymentAmount">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-69d6</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>'0.00'</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="paymentCurrency">
                                <con2:id>_ActionId-1458661054384768561-771c3355.172dce0d92a.-68d3</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>''</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.547c</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace contents-only="true" varName="header">
                                <con2:id>_ActionId-3207523341750621818-3aa9ec5a.1711d5b40ed.547d</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>{ $status }</successIndicator>
	<messages>{ fn:concat('EQUIFAX: ', $statusReason, ' | No se realizaron cobros.') }</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                    <con4:route>
                        <con2:id>_ActionId-5824909835603656535-22ed4c40.171e5ddb182.-75ac</con2:id>
                        <con4:service ref="Middleware/v2/BusinessServices/PWS/guardaDatosCreditScore/biz/guardaDatosCreditScore_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>guardaDatosCreditScore</con4:operation>
                        <con4:outboundTransform>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-5824909835603656535-22ed4c40.171e5ddb182.-75aa</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/BusinessServices/PWS/guardaDatosCreditScore/xq/guardaDatosCreditScore"/>
                                        <con2:param name="hostSource">
                                            <con2:path>$hostSource</con2:path>
                                        </con2:param>
                                        <con2:param name="geoipCity">
                                            <con2:path>$geoipCity</con2:path>
                                        </con2:param>
                                        <con2:param name="status">
                                            <con2:path>$status</con2:path>
                                        </con2:param>
                                        <con2:param name="uuid">
                                            <con2:path>$uuid</con2:path>
                                        </con2:param>
                                        <con2:param name="geoipLatitude">
                                            <con2:path>$geoipLatitude</con2:path>
                                        </con2:param>
                                        <con2:param name="geoipRegion">
                                            <con2:path>$geoipRegion</con2:path>
                                        </con2:param>
                                        <con2:param name="customerId">
                                            <con2:path>$customerId</con2:path>
                                        </con2:param>
                                        <con2:param name="gender">
                                            <con2:path>$gender</con2:path>
                                        </con2:param>
                                        <con2:param name="customerLegalId">
                                            <con2:path>$customerLegalId</con2:path>
                                        </con2:param>
                                        <con2:param name="targetDescription">
                                            <con2:path>$targetName</con2:path>
                                        </con2:param>
                                        <con2:param name="dateOfBirth">
                                            <con2:path>$dateOfBirth</con2:path>
                                        </con2:param>
                                        <con2:param name="cellphoneNumber">
                                            <con2:path>$smsPhone</con2:path>
                                        </con2:param>
                                        <con2:param name="geoipLongitude">
                                            <con2:path>$geoipLongitude</con2:path>
                                        </con2:param>
                                        <con2:param name="productNumber">
                                            <con2:path>$productNumber</con2:path>
                                        </con2:param>
                                        <con2:param name="paymentCurrency">
                                            <con2:path>$paymentCurrency</con2:path>
                                        </con2:param>
                                        <con2:param name="creditScore">
                                            <con2:path>$creditScoreValue</con2:path>
                                        </con2:param>
                                        <con2:param name="statusReason">
                                            <con2:path>$statusReason</con2:path>
                                        </con2:param>
                                        <con2:param name="geoipCountry">
                                            <con2:path>$geoipCountry</con2:path>
                                        </con2:param>
                                        <con2:param name="productType">
                                            <con2:path>$productType</con2:path>
                                        </con2:param>
                                        <con2:param name="paymentAmount">
                                            <con2:path>$paymentAmount</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con4:outboundTransform>
                    </con4:route>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="error" name="_onErrorHandler-1473810702047277080-2322cc71.17041e60ed0.-43d2">
            <con1:stage name="ManejoErrores">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaPuntajeCreditoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="errorCode">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-43b8</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($fault/ctx:errorCode/text())</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="errorMessage">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4396</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:substring(fn:string($fault/ctx:reason/text()), 1, 100)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:wsCallout>
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-437b</con2:id>
                        <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>mapeoErrores</con3:operation>
                        <con3:request>
                            <con3:body>REQmapeoErrores</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RSPmapeoErrores</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="REQmapeoErrores">
                                <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4354</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                                        <con2:param name="CODIGO_ERROR">
                                            <con2:path>$errorCode</con2:path>
                                        </con2:param>
                                        <con2:param name="MENSAJE_ERROR">
                                            <con2:path>fn:concat('FICBCO0396', '$#$', $errorMessage)</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:replace contents-only="true" varName="header">
                                <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4330</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                                        <con2:param name="mapeoErroresResponse1">
                                            <con2:path>$RSPmapeoErrores</con2:path>
                                        </con2:param>
                                        <con2:param name="successIndicator">
                                            <con2:path>$errorCode</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-4301</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;con:consultaPuntajeCreditoResponse/></con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:reply>
                        <con2:id>_ActionId-1473810702047277080-2322cc71.17041e60ed0.-42e7</con2:id>
                    </con2:reply>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:flow>
            <con1:pipeline-node name="ConsultaPuntajeCredito">
                <con1:request>ConsultaPuntajeCredito_request</con1:request>
                <con1:response>ConsultaPuntajeCredito_response</con1:response>
            </con1:pipeline-node>
        </con1:flow>
    </con1:router>
</con:pipelineEntry>