<bpel:process name="sjConsultaDetalleContratoRecaudos" targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/flow/sjConsultaDetalleContratoRecaudos" bea:name="sjConsultaDetalleContratoRecaudos" xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/flow/sjConsultaDetalleContratoRecaudos" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaDetalleContratoRecaudosPS/" xmlns:ns1="T24WebServicesImpl" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:con="http://www.ficohsa.com.hn/middleware.services/sjConsultaDetalleContratoRecaudosTypes" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaContratoReferenciado" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareSOAApplication/ConsultaContratoReferenciado/consultaContratoReferenciado" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareSOAApplication/ConsultarRecaudoReferenciadoEnLinea/consultarRecaudoReferenciadoEnLinea" xmlns:osb="http://xmlns.oracle.com/pcbpel/adapter/db/FLINK/OSB_K_RECAUDOS_REF_ONLINE/OSB_CONSULTAR_REF_ONLINE/" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns4="http://www.ficohsa.com.hn/middleware.services/sjConsultaDetalleContratoRecaudosPS" xmlns:con1="http://www.ficohsa.com.hn/middleware.services/consultaDetalleContratoRecaudosTypes" xmlns:ns5="http://www.bea.com/wli/sb/stages/logging/config">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaDetalleContratoRecaudos" partnerLinkType="tns:sjConsultaDetalleContratoRecaudos" myRole="sjConsultaDetalleContratoRecaudos">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="ContratosConvenios" partnerLinkType="tns:ContratosConvenios_plnkType" partnerRole="ContratosConvenios_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaContratoReferenciado_db" partnerLinkType="tns:consultaContratoReferenciado_db_plnkType" partnerRole="consultaContratoReferenciado_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultarRecaudoReferenciadoEnLinea_db" partnerLinkType="tns:consultarRecaudoReferenciadoEnLinea_db_plnkType" partnerRole="consultarRecaudoReferenciadoEnLinea_db_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="ns4:sjConsultaDetalleContratoRecaudosRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="ns4:sjConsultaDetalleContratoRecaudosResponse">
	       </bpel:variable>
    <bpel:variable name="REQContratosConvenios" messageType="ns1:Consultadetallecontratorecaudo">
    </bpel:variable>
    <bpel:variable name="RSPContratosConvenios" messageType="ns1:ConsultadetallecontratorecaudoResponse">
    </bpel:variable>
    <bpel:variable name="header" type="xsd:anyType"/>
    <bpel:variable name="body" type="xsd:anyType"/>
    <bpel:variable name="bodyTemp" type="xsd:anyType"/>
    <bpel:variable name="cardCounter" type="xsd:string"/>
    
    
    
    
    </bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaDetalleContratoRecaudos" operation="sjConsultaDetalleContratoRecaudos" createInstance="yes" variable="request">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/wsdl/sjConsultaDetalleContratoRecaudosPS" binding="ns4:sjConsultaDetalleContratoRecaudosPSSOAP"/></rescon:receiveInfo>
        </bpel:receive>
        
        <bpel:assign>
        	
        
	
	
	<bpel:extensionAssignOperation>
		<bpel:documentation/>
		<trf:assign varName="REQContratosConvenios.parameters">
			<trf:expr>
				<expr:xqueryTransform>
					<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/xq/sjConsultaDetalleContratoRecaudosIn"/>
					<expr:param name="sjConsultaDetalleContratoRecaudos">
						<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        </bpel:extensionAssignOperation></bpel:assign>
        
        
        <bpel:invoke operation="Consultadetallecontratorecaudo" partnerLink="ContratosConvenios" inputVariable="REQContratosConvenios" outputVariable="RSPContratosConvenios">
        	<rescon:invokeInfo><rescon:service ref="Middleware/Business_Resources/contratosConvenios/Resources/ContratosConvenios" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
        <bpel:assign>
        	
        
        
        <bpel:extensionAssignOperation>
        	<trf:assign varName="bodyTemp">
        		<trf:expr>
        			<expr:xqueryTransform>
        				<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/xq/sjConsultaDetalleContratoRecaudosOut"/>
        				<expr:param name="consultadetallecontratorecaudoResponse">
        					<expr:path>$RSPContratosConvenios.parameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        </bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
        	<trf:assign varName="response.outputParameters">
        		<trf:expr>
        			<expr:xqueryText>&lt;con:sjConsultaDetalleContratoRecaudosResponse/></expr:xqueryText></trf:expr></trf:assign>
        </bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
        	<bpel:documentation/>
        	<trf:replace contents-only="false" varName="response.outputParameters">
        		<trf:expr>
        			<expr:xqueryText>$bodyTemp</expr:xqueryText></trf:expr></trf:replace>
        </bpel:extensionAssignOperation></bpel:assign>
        
        
        
        <bpel:if bea:name="DefinicionTipoContrato">
        	<bpel:condition>string($bodyTemp/RESPONSE_CODE/text()) = 'Success'</bpel:condition>
        	<bpel:sequence>
        		<bpel:empty/>
        	
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:delete varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./con:sjConsultaDetalleContratoRecaudosResponseType/con:sjConsultaDetalleContratoRecaudosResponseRecordType</expr:xpathText></trf:location></trf:delete>
		</bpel:extensionAssignOperation>
	</bpel:assign>
	
	<bpel:forEach counterName="counter" parallel="yes">
		<bpel:startCounterValue>number(1)</bpel:startCounterValue>
		<bpel:finalCounterValue>count($bodyTemp/con:sjConsultaDetalleContratoRecaudosResponseType/con:sjConsultaDetalleContratoRecaudosResponseRecordType)</bpel:finalCounterValue>
		
		<bpel:scope>
			
			<bpel:variables>
				
				
				
				<bpel:variable name="REQContratoReferenciado" messageType="ns2:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RSPContratoReferenciado" messageType="ns2:args_out_msg">
				</bpel:variable>
				<bpel:variable name="REQUESTconsultarRecaudoReferenciadoEnLinea" messageType="ns3:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RESPONSEconsultarRecaudoReferenciadoEnLinea" messageType="ns3:args_out_msg">
				</bpel:variable>
				<bpel:variable name="successIndicatorConsultarRecaudoReferenciadoEnLinea" type="xsd:string">
				</bpel:variable>
				<bpel:variable name="Record" type="xsd:anyType">
				</bpel:variable>
				<bpel:variable name="infoExchangeType" type="xsd:string">
				</bpel:variable>
				<bpel:variable name="collectionType" type="xsd:string">
				</bpel:variable>
				<bpel:variable name="contractId" type="xsd:string"/>
				<bpel:variable name="type" type="xsd:string"/>
				<bpel:variable name="validationMessage" type="xsd:string">
				</bpel:variable></bpel:variables>
			<bpel:sequence>
				<bpel:assign>
					
					<bpel:extensionAssignOperation>
						<trf:assign varName="cardCounter">
							<trf:expr>
								<expr:xqueryText>$counter</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
					<bpel:extensionAssignOperation>
						<trf:assign varName="validationMessage">
							<trf:expr>
								<expr:xqueryText>' '</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					<bpel:copy keepSrcElementName="yes">
						<bpel:from>$bodyTemp/con:sjConsultaDetalleContratoRecaudosResponseType/con:sjConsultaDetalleContratoRecaudosResponseRecordType[$counter]</bpel:from>
						<bpel:to variable="Record"/>
					</bpel:copy>
					
					
					
					<bpel:extensionAssignOperation>
						<bpel:documentation/>
						<trf:assign varName="infoExchangeType">
							<trf:expr>
								<expr:xqueryText>string($Record/INFO_EXCHANGE_TYPE/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					
					
					<bpel:extensionAssignOperation>
						<trf:assign varName="collectionType">
							<trf:expr>
								<expr:xqueryText>if (string($Record/COLLECTION_TYPE/text()) = "") then (
	" "
) else (
	string($Record/COLLECTION_TYPE/text())
)</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
					
					<bpel:extensionAssignOperation>
						<bpel:documentation/>
						<trf:assign varName="contractId">
							<trf:expr>
								<expr:xqueryText>fn:string($Record/CONTRACT_ID/text())</expr:xqueryText></trf:expr></trf:assign>
					</bpel:extensionAssignOperation></bpel:assign>
				
				
				<bpel:if>
					<bpel:condition>$collectionType = 'MOBILE.RECHARGE'
or
$collectionType = 'MOBILE.PACKAGE'</bpel:condition>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:if>
		<bpel:condition>$collectionType = 'MOBILE.RECHARGE'
</bpel:condition>
		<bpel:sequence>
			<bpel:empty/>
		<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:assign varName="type">
				<trf:expr>
					<expr:xqueryText>'MOBILE_RECHARGE'</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
		</bpel:assign></bpel:sequence>
		<bpel:else>
			<bpel:sequence>
				<bpel:empty/>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<bpel:documentation/>
					<trf:assign varName="type">
						<trf:expr>
							<expr:xqueryText>'MOBILE_PACKAGE'</expr:xqueryText></trf:expr></trf:assign>
				</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
		</bpel:else>
					</bpel:if>
	</bpel:sequence>
					<bpel:else>
						<bpel:sequence>
							<bpel:empty/>
						<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="type">
				<trf:expr>
					<expr:xqueryText>$infoExchangeType</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
						</bpel:assign>
						<bpel:if>
							<bpel:condition>$type = 'REFERENCED'</bpel:condition>
							<bpel:sequence>
								<bpel:empty/>
							
							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="REQContratoReferenciado.InputParameters">
				<trf:expr>
					<expr:xqueryTransform>
						<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/xq/cobranzasIn"/>
						<expr:param name="contractId">
							<expr:path>$contractId</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
	<bpel:invoke operation="consultaContratoReferenciado" partnerLink="consultaContratoReferenciado_db" inputVariable="REQContratoReferenciado" outputVariable="RSPContratoReferenciado">
								<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/CNV/consultaContratosReferenciados/biz/consultaContratoReferenciado_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
							
							<bpel:if>
								<bpel:condition>$RSPContratoReferenciado.OutputParameters/ns0:TIPO_CONTRATO/text() = 'REFERENCED_LOCAL'</bpel:condition>
								<bpel:sequence>
									<bpel:empty/>
								<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="type">
				<trf:expr>
					<expr:xqueryText>'REFERENCED_LOCAL'</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
								</bpel:assign></bpel:sequence>
								<bpel:else>
									<bpel:sequence>
										<bpel:empty/>
									<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:assign varName="REQUESTconsultarRecaudoReferenciadoEnLinea.InputParameters">
				<trf:expr>
					<expr:xqueryTransform>
						<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaDetalleContratoRecaudos/xq/consultaReferenciadoEnLineaIn"/>
						<expr:param name="contractId">
							<expr:path>$contractId</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
									</bpel:assign>
	<bpel:invoke operation="consultarRecaudoReferenciadoEnLinea" partnerLink="consultarRecaudoReferenciadoEnLinea_db" inputVariable="REQUESTconsultarRecaudoReferenciadoEnLinea" outputVariable="RESPONSEconsultarRecaudoReferenciadoEnLinea">
										<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/consultarRecaudoReferenciadoEnLinea/biz/consultarRecaudoReferenciadoEnLinea_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
									<bpel:assign>
										
									<bpel:extensionAssignOperation>
		<trf:assign varName="successIndicatorConsultarRecaudoReferenciadoEnLinea">
			<trf:expr>
				<expr:xqueryText>fn:string($RESPONSEconsultarRecaudoReferenciadoEnLinea.OutputParameters/osb:CODIGO_RESPUESTA/text())</expr:xqueryText></trf:expr></trf:assign>
									</bpel:extensionAssignOperation></bpel:assign>
									<bpel:if>
										<bpel:condition>$successIndicatorConsultarRecaudoReferenciadoEnLinea = 'SUCCESS'</bpel:condition>
										<bpel:sequence>
											<bpel:empty/>
										<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="type">
				<trf:expr>
					<expr:xqueryText>'REFERENCED_ONLINE'</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
										</bpel:assign></bpel:sequence>
										<bpel:elseif>
											<bpel:condition>$successIndicatorConsultarRecaudoReferenciadoEnLinea = 'NO_DATA_FOUND'</bpel:condition>
											<bpel:sequence>
												<bpel:empty/>
											</bpel:sequence>
										</bpel:elseif>
										<bpel:else>
											<bpel:sequence>
												<bpel:empty/>
											<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="validationMessage">
				<trf:expr>
					<expr:xqueryText>$RESPONSEconsultarRecaudoReferenciadoEnLinea.OutputParameters/osb:MENSAJE_RESPUESTA/text()</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
											</bpel:assign></bpel:sequence>
										</bpel:else>
									</bpel:if></bpel:sequence>
								</bpel:else>
							</bpel:if></bpel:sequence>
							<bpel:else>
								<bpel:sequence>
									<bpel:empty/>
								</bpel:sequence>
							</bpel:else>
						</bpel:if></bpel:sequence>
					</bpel:else>
				</bpel:if>
				<bpel:if>
					<bpel:condition>$validationMessage != ' '</bpel:condition>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:replace contents-only="true" varName="response.outputParameters">
				<trf:expr>
					<expr:xqueryText><![CDATA[<con:sjConsultaDetalleContratoRecaudosResponse>
	<RESPONSE_CODE>ERROR</RESPONSE_CODE>
	<RESPONSE_MESSAGE>{ fn:string($validationMessage) }</RESPONSE_MESSAGE>
</con:sjConsultaDetalleContratoRecaudosResponse>]]></expr:xqueryText></trf:expr></trf:replace>
		</bpel:extensionAssignOperation>
					
					</bpel:assign>
					<bpel:reply operation="sjConsultaDetalleContratoRecaudos" partnerLink="sjConsultaDetalleContratoRecaudos" variable="response">
					</bpel:reply>
					<bpel:exit/>
					<bpel:exit/>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					</bpel:sequence>
					<bpel:else>
						<bpel:sequence>
							<bpel:empty/>
						<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="Record">
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText>&lt;CONTRACT_TYPE>{$type}&lt;/CONTRACT_TYPE></expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
						<bpel:extensionAssignOperation>
		<trf:insert varName="response.outputParameters">
			
			<trf:location>
				<expr:xpathText>./con:sjConsultaDetalleContratoRecaudosResponseType</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
		<trf:expr>
			<expr:xqueryText>$Record</expr:xqueryText></trf:expr></trf:insert>
						</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
					</bpel:else>
				</bpel:if></bpel:sequence></bpel:scope></bpel:forEach></bpel:sequence>
        	<bpel:else>
        		<bpel:sequence>
        			<bpel:empty/>
        		</bpel:sequence>
        	</bpel:else>
        </bpel:if>
        
        <bpel:reply partnerLink="sjConsultaDetalleContratoRecaudos" operation="sjConsultaDetalleContratoRecaudos" variable="response"/>
    </bpel:sequence>
</bpel:process>