<bpel:process name="sjConsultaSituacionFinancieraPAInterno" targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/flow/sjConsultaSituacionFinancieraPAInterno" bea:name="sjConsultaSituacionFinancieraPAInterno" xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/flow/sjConsultaSituacionFinancieraPAInterno" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinancieraPAInternoPS" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns0="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinancieraInterno" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/Application1/Project1/consultaSituacionFinanciera" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/insertarSituacionFinanciera/Project1/insertarSituacionFinanciera" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/conDatoTarjetaGT/obtenerSitFinanciera/obtenerSitFinanciera" xmlns:ins="http://xmlns.oracle.com/pcbpel/adapter/db/sp/insertarSituacionFinanciera" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/ConnectionTarjetas/conConsultaSituacionFinanciera/conConsultaSituacionFinanciera" xmlns:ns5="http://xmlns.oracle.com/pcbpel/adapter/db/Ejemplo/conDatoAutorizacionesHistorica/conDatoAutorizacionesHistorica">
    <rescon:importInfo/>
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaSituacionFinancieraPAInterno" partnerLinkType="tns:sjConsultaSituacionFinancieraPAInterno" myRole="sjConsultaSituacionFinancieraPAInterno">
	       </bpel:partnerLink>
	   
	   <bpel:partnerLink name="insertarSituacionFinanciera_db" partnerLinkType="tns:insertarSituacionFinanciera_db_plnkType" partnerRole="insertarSituacionFinanciera_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="obtenerSitFinanciera_db" partnerLinkType="tns:obtenerSitFinanciera_db_plnkType" partnerRole="obtenerSitFinanciera_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="conConsultaSituacionFinanciera_db" partnerLinkType="tns:conConsultaSituacionFinanciera_db_plnkType" partnerRole="conConsultaSituacionFinanciera_db_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="bind:sjConsultaSituacionFinancieraPAInternoRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="bind:sjConsultaSituacionFinancieraPAInternoResponse">
	       </bpel:variable>
    <bpel:variable name="tempResponse" type="xsd:anyType"/>
    <bpel:variable name="core" type="xsd:anyType"/></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaSituacionFinancieraPAInterno" operation="ConsultaSituacionFinancieraPAInterno" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/wsdl/sjConsultaSituacionFinancieraPAInterno" binding="bind:sjConsultaSituacionFinancieraPAInternoPSSOAP"/></rescon:receiveInfo>
        </bpel:receive>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;sjConsultaSituacionFinancieraInternoTypes/></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="tempResponse">
        			<trf:expr>
        				<expr:xqueryText>&lt;ResponseHeader>
	&lt;responses/>
&lt;/ResponseHeader></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="core">
        			<trf:expr>
        				<expr:xqueryText><![CDATA[<CORES>
	<CORE>ABK</CORE>
	<CORE>MasterData</CORE>
</CORES>]]></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:forEach parallel="yes" counterName="counter">
        	<bpel:startCounterValue>number(1)</bpel:startCounterValue>
        	<bpel:finalCounterValue>count($request.inputParameters/GROUPS/GROUP)</bpel:finalCounterValue>
        	<bpel:scope>
        		<bpel:sequence>
        			<bpel:forEach parallel="yes" counterName="counterCore">
        				<bpel:startCounterValue>number(1)</bpel:startCounterValue>
        				<bpel:finalCounterValue>count($core/CORE)</bpel:finalCounterValue>
        				<bpel:scope>
        					<bpel:variables>
        						<bpel:variable name="currentCore" type="xsd:string">
        						</bpel:variable></bpel:variables>
        					<bpel:faultHandlers>
        						<bpel:catchAll>
        							<bpel:sequence>
        								<bpel:empty/>
        							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="tempResponse">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText><![CDATA[<response>
	<successIndicator>ERROR</successIndicator>
	<messages>{ concat('Error insertando registro en ', $currentCore, ' PA01') }</messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
        							</bpel:assign></bpel:sequence>
        						</bpel:catchAll></bpel:faultHandlers>
        					<bpel:sequence>
        						<bpel:assign>
        							<bpel:extensionAssignOperation>
        								<trf:assign varName="currentCore">
        									<trf:expr>
        										<expr:xqueryText>$core/CORE[xs:integer($counterCore)]</expr:xqueryText></trf:expr></trf:assign>
        							</bpel:extensionAssignOperation>
        						</bpel:assign>
        						<bpel:if>
        							<bpel:condition>$currentCore = "ABK"</bpel:condition>
        							<bpel:sequence>
        								<bpel:empty/>
        							<bpel:scope>
		<bpel:variables>
			<bpel:variable name="group" type="ns0:GROUP"/>
			<bpel:variable messageType="ns3:args_in_msg" name="REQObtenerSituacionFinancieraAbanksPA"/>
			<bpel:variable messageType="ns3:args_out_msg" name="RSPObtenerSituacionFinancieraAbanksPA"/>
			<bpel:variable messageType="ns2:args_in_msg" name="REQInsertarSituacionFinancieraAbanksPA"/>
			<bpel:variable messageType="ns2:args_out_msg" name="RSPInsertarSituacionFinancieraAbanksPA"/></bpel:variables>
		<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
					
					<bpel:rethrow/></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="group">
							<trf:assign varName="group">
								<trf:expr>
									<expr:xqueryText>$request.inputParameters/GROUPS/GROUP[xs:integer($counter)]</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQObtenerSituacionFinancieraAbanksPA">
							<trf:assign varName="REQObtenerSituacionFinancieraAbanksPA.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/xq/sjObtenerSitFinancieraAbanksPAIn"/>
										<expr:param name="group">
											<expr:path>$group</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="obtenerSitFinanciera" bea:name="obtenerSituacionFinancieraAbanksPA" partnerLink="obtenerSitFinanciera_db" outputVariable="RSPObtenerSituacionFinancieraAbanksPA" inputVariable="REQObtenerSituacionFinancieraAbanksPA">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/ABKPA/obtenerSitFinanciera/biz/obtenerSitFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke></bpel:sequence></bpel:scope>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQInsertarSituacionFinaniceraAbanksPA">
							<trf:assign varName="REQInsertarSituacionFinancieraAbanksPA.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/xq/insertarSituacionFinancieraAbanksPA"/>
										<expr:param name="outputParameters">
											<expr:path>$RSPObtenerSituacionFinancieraAbanksPA.OutputParameters</expr:path></expr:param>
										<expr:param name="usuario">
											<expr:path>fn:string($request.RequestHeader/Authentication/UserName/text())</expr:path></expr:param>
										<expr:param name="referenciaLlave">
											<expr:path>fn:string($request.inputParameters/UUID/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="insertarSituacionFinanciera" bea:name="InsertarSituacionFinanciera" partnerLink="insertarSituacionFinanciera_db" outputVariable="RSPInsertarSituacionFinancieraAbanksPA" inputVariable="REQInsertarSituacionFinancieraAbanksPA">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/INTFC/insertarSituacionFinanciera/biz/insertarSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="InserccionSituacionFinancieraAbanksPA">
							<trf:insert varName="tempResponse">
								<trf:location>
									<expr:xpathText>./responses</expr:xpathText></trf:location>
								<trf:where>last-child</trf:where>
								<trf:expr>
									<expr:xqueryText><![CDATA[<response>
	<successIndicator>{ fn:string($RSPInsertarSituacionFinancieraAbanksPA.OutputParameters/ins:PV_SUCCESS_INDICADOR/text()) } </successIndicator>
	<messages>{ concat('PA01 ',fn:string($RSPInsertarSituacionFinancieraAbanksPA.OutputParameters/ins:PV_MENSAJE_ERROR/text()))	}</messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope>
			</bpel:sequence></bpel:scope></bpel:sequence>
        							<bpel:elseif>
        								<bpel:condition>$currentCore = "MasterData"</bpel:condition>
        								<bpel:sequence>
        									<bpel:empty/>
        								<bpel:scope>
		<bpel:variables>
			<bpel:variable name="group" type="ns0:GROUP"/>
			<bpel:variable name="REQConsultaSituacionFinancieraMasterData" messageType="ns4:args_in_msg"/>
			<bpel:variable name="RSPConsultaSituacionFinancieraMasterData" messageType="ns4:args_out_msg"/>
			<bpel:variable messageType="ns2:args_in_msg" name="REQInsertarSituacionFinanicera"/>
			<bpel:variable messageType="ns2:args_out_msg" name="RSPInsertarSituacionFinanicera"/></bpel:variables>
		<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
					
					<bpel:rethrow/></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="group">
							<trf:assign varName="group">
								<trf:expr>
									<expr:xqueryText>$request.inputParameters/GROUPS/GROUP[xs:integer($counter)]</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraMasterData">
							<trf:assign varName="REQConsultaSituacionFinancieraMasterData.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/xq/sjConsultaSituacionFinancieraMasterDataIn"/>
										<expr:param name="group">
											<expr:path>$group</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="conConsultaSituacionFinanciera" bea:name="consultaSituacionFinancieraMasterData" partnerLink="conConsultaSituacionFinanciera_db" inputVariable="REQConsultaSituacionFinancieraMasterData" outputVariable="RSPConsultaSituacionFinancieraMasterData">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/MasterData/conConsultaSituacionFinanciera/biz/conConsultaSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke></bpel:sequence></bpel:scope>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQInsertarSituacionFinanicera">
							<trf:assign varName="REQInsertarSituacionFinanicera.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoPA/xq/insertarSituacionFinancieraMasterDataIn"/>
										
										
										
										
										
										
										<expr:param name="referenciaLlave">
											<expr:path>fn:string($request.inputParameters/UUID/text())</expr:path></expr:param>
										<expr:param name="usuario">
											<expr:path>fn:string($request.RequestHeader/Authentication/UserName/text())</expr:path></expr:param>
										<expr:param name="outputParameters1">
											<expr:path>$RSPConsultaSituacionFinancieraMasterData.OutputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="insertarSituacionFinanciera" bea:name="InsertarSituacionFinanciera" partnerLink="insertarSituacionFinanciera_db" outputVariable="RSPInsertarSituacionFinanicera" inputVariable="REQInsertarSituacionFinanicera">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/INTFC/insertarSituacionFinanciera/biz/insertarSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="InserccionSituacionFinancieraProxyVasa">
							<trf:insert varName="tempResponse">
								<trf:location>
									<expr:xpathText>./responses</expr:xpathText></trf:location>
								<trf:where>last-child</trf:where>
								<trf:expr>
									<expr:xqueryText><![CDATA[<response>
	<successIndicator>{ fn:string($RSPInsertarSituacionFinanicera.OutputParameters/ins:PV_SUCCESS_INDICADOR/text()) } </successIndicator>
	<messages>{ concat('PA01 ', fn:string($RSPInsertarSituacionFinanicera.OutputParameters/ins:PV_MENSAJE_ERROR/text()))} </messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:sequence></bpel:scope></bpel:sequence>
        							</bpel:elseif>
        							<bpel:else>
        								<bpel:sequence>
        									<bpel:empty/>
        								</bpel:sequence>
        							</bpel:else>
        						</bpel:if></bpel:sequence>
        				</bpel:scope>
        			</bpel:forEach></bpel:sequence>
        	</bpel:scope>
        </bpel:forEach>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.ResponseHeader">
        			<trf:expr>
        				<expr:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>
		{
			let $numberErrors := count($tempResponse/responses/response[fn:upper-case(successIndicator) != 'SUCCESS'])
			return
				if($numberErrors = 0) then(
					'SUCCESS'
				)else(
					'ERROR'
				)
    	}
	</successIndicator>
	<messages>{ fn:string-join($tempResponse/responses/response/messages, '. ') }</messages>
</aut:ResponseHeader>]]></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:reply partnerLink="sjConsultaSituacionFinancieraPAInterno" operation="ConsultaSituacionFinancieraPAInterno" variable="response"/>
    </bpel:sequence>
</bpel:process>