<bpel:process name="sjConsultaListasCliente" targetNamespace="http://www.example.com/flow/Middleware/v2/Resources/ConsultaListasCliente/sj/sjConsultaListasCliente" bea:name="sjConsultaRemesaPorNombre" xmlns:tns="http://www.example.com/flow/Middleware/v2/Resources/ConsultaListasCliente/sj/sjConsultaListasCliente" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:ns1="T24WebServicesImpl" xmlns:ns2="http://www.ficohsa.com.hn/middleware.services/sjConsultaRemesasPS" xmlns:ns3="http://www.ficohsa.com.hn/middleware.services/sjConsultaRemesaPorNombrePS" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareSOAApplication/consultaRemesasPorPrioridad/consultaRemesasPorPrioridad" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns5="http://www.ficohsa.com.hn/middleware.services/consultaRemesaPorNombreYMetodoPS/" xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/MiddlewareSOAApplication/ConsultaRemesadorasPorPrioridad/consultaRemesadorasPorPrioridad" xmlns:con="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaRemesadorasPorPrioridad" xmlns:ns0="http://www.bea.com/bpel/faults" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns7="http://www.ficohsa.com.hn/middleware.services/sjConsultaRemesaPorNombre" xmlns:ns8="http://www.ficohsa.com.hn/middleware.services/consultaRemesaPorNombreYMetodoTypes">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaListasCliente" partnerLinkType="tns:sjConsultaListasCliente" myRole="sjConsultaListasCliente">
	       </bpel:partnerLink>
	   
	   
	   <bpel:partnerLink name="ConsultaRemesaPorNombreYMetodo" partnerLinkType="tns:ConsultaRemesaPorNombreYMetodo_plnkType" partnerRole="ConsultaRemesaPorNombreYMetodo_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaRemesadorasPorPrioridad_db" partnerLinkType="tns:consultaRemesadorasPorPrioridad_db_plnkType" partnerRole="consultaRemesadorasPorPrioridad_db_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   

    
    <bpel:variables>
    	<bpel:variable name="request" messageType="ns3:sjConsultaRemesaPorNombreRequest">
    	</bpel:variable>
    	<bpel:variable name="response" messageType="ns3:sjConsultaRemesaPorNombreResponse">
    	</bpel:variable>
    	
    	
    	
    	<bpel:variable name="contadorGruposPrioridad" type="xsd:integer"/>
    	<bpel:variable name="REQConsultaRemesaPorNombreYMetodo" messageType="ns5:consultaRemesaPorNombreYMetodoRequest">
    	</bpel:variable>
    	<bpel:variable name="RSPConsultaRemesaPorNombreYMetodo" messageType="ns5:consultaRemesaPorNombreYMetodoResponse">
    	</bpel:variable>
    	<bpel:variable name="REQConsultaRemesadorasPorPrioridad" messageType="ns6:args_in_msg">
    	</bpel:variable>
    	<bpel:variable name="RSPConsultaRemesadorasPorPrioridad" messageType="ns6:args_out_msg">
    	</bpel:variable>
    	<bpel:variable name="validaRemesadoras" type="xsd:boolean"/>
    	
    	<bpel:variable name="totalRemesadoras" type="xsd:int"/>
    	<bpel:variable name="remesaEncontrada" type="xsd:boolean"/>
    	<bpel:variable name="Record" type="ns8:consultaRemesaPorNombreYMetodoResponseRecordType">
    	</bpel:variable>
    	<bpel:variable name="contadorRemesas" type="xsd:int"/>
    	<bpel:variable name="cantidadRemesas" type="xsd:int"/></bpel:variables>
    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaListasCliente" operation="consultaRemesaPorNombre" createInstance="yes" variable="request">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaRemesaPorNombre/wsdl/sjConsultaRemesaPorNombre" binding="ns3:sjConsultaRemesaPorNombrePSSOAP"/></rescon:receiveInfo>
        </bpel:receive>
        
        
        
        
        
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="REQConsultaRemesadorasPorPrioridad.InputParameters">
        			<trf:expr>
        				
        				<expr:xqueryTransform>
	<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaRemesaPorNombre/xq/consultaRemesadorasPorPrioridadIn"/>
	<expr:param name="string">
		<expr:path>""</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        <bpel:invoke operation="consultaRemesadorasPorPrioridad" partnerLink="consultaRemesadorasPorPrioridad_db" inputVariable="REQConsultaRemesadorasPorPrioridad" outputVariable="RSPConsultaRemesadorasPorPrioridad">
        	<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/MDW/consultaRemesadorasPorPrioridad/biz/consultaRemesadorasPorPrioridad_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="validaRemesadoras">
        			<trf:expr>
        				<expr:xqueryText>fn:string($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:CODIGO_RESPUESTA/text()) = "SUCCESS"</expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
		<trf:assign varName="response.outputParameters">
			<trf:expr>
				<expr:xqueryText>&lt;ns7:sjConsultaRemesaPorNombreResponse>
&lt;/ns7:sjConsultaRemesaPorNombreResponse></expr:xqueryText></trf:expr></trf:assign>
        </bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:if>
        	<bpel:condition>$validaRemesadoras</bpel:condition>
        	<bpel:sequence>
        		<bpel:empty/>
        	<bpel:assign>
		
	<bpel:extensionAssignOperation>
		<trf:assign varName="REQConsultaRemesaPorNombreYMetodo.RequestHeader">
			<trf:expr>
				<expr:xqueryText>$request.RequestHeader</expr:xqueryText></trf:expr></trf:assign>
	</bpel:extensionAssignOperation>
	<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:assign varName="contadorGruposPrioridad">
				<trf:expr>
					<expr:xqueryText>1</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        	<bpel:extensionAssignOperation>
		<bpel:documentation/>
		<trf:assign varName="remesaEncontrada">
			<trf:expr>
				<expr:xqueryText>fn:false()</expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        	
        	<bpel:extensionAssignOperation>
        		<bpel:documentation/>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;ns7:sjConsultaRemesaPorNombreResponse>
	&lt;ns7:consultaRemesaPorNombreResponseType>
	&lt;/ns7:consultaRemesaPorNombreResponseType>
&lt;/ns7:sjConsultaRemesaPorNombreResponse></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation></bpel:assign>
        	<bpel:repeatUntil>
        		<bpel:sequence>
        			
        			
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<bpel:documentation/>
        					<trf:assign varName="totalRemesadoras">
        						<trf:expr>
        							<expr:xqueryText>count($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:GRUPOS/con:GRUPO_PRIORIDAD[xs:int($contadorGruposPrioridad)]/con:REMESADORAS/con:REMESADORA)</expr:xqueryText></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			</bpel:assign>
        			
        			<bpel:forEach parallel="yes" counterName="contadorRemesadoras">
        				<bpel:startCounterValue>1</bpel:startCounterValue>
        				<bpel:finalCounterValue>$totalRemesadoras</bpel:finalCounterValue>
        				<bpel:scope>
        					
        					<bpel:sequence>
        						
        						<bpel:assign>
        							<bpel:extensionAssignOperation>
        								<bpel:documentation/>
        								<trf:assign varName="REQConsultaRemesaPorNombreYMetodo.parameters">
        									<trf:expr>
        										<expr:xqueryTransform>
        											<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaRemesaPorNombre/xq/consultaRemesaPorNombreYMetodoIn"/>
        											
        											
        											
        											
        											
        											
        											
        											
        											
        											
        											<expr:param name="outputParameters">
        												<expr:path>$RSPConsultaRemesadorasPorPrioridad.OutputParameters</expr:path></expr:param>
        											<expr:param name="nroGrupoPrioridad">
        												<expr:path>$contadorGruposPrioridad</expr:path></expr:param>
        											<expr:param name="nroRemesadora">
        												<expr:path>$contadorRemesadoras</expr:path></expr:param>
        											<expr:param name="sjConsultaRemesaPorNombreRequest">
        												<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        						<bpel:invoke operation="consultaRemesaPorNombreYMetodo" inputVariable="REQConsultaRemesaPorNombreYMetodo" partnerLink="ConsultaRemesaPorNombreYMetodo" outputVariable="RSPConsultaRemesaPorNombreYMetodo">
        							<rescon:invokeInfo><rescon:service ref="Middleware/v2/ProxyServices/ConsultaRemesaPorNombreYMetodo" xsi:type="con1:PipelineRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
        						<bpel:assign>
        							<bpel:extensionAssignOperation>
        								<bpel:documentation/>
        								<trf:assign varName="remesaEncontrada">
        									<trf:expr>
        										<expr:xqueryText>$RSPConsultaRemesaPorNombreYMetodo.ResponseHeader/successIndicator = "SUCCESS"</expr:xqueryText></trf:expr></trf:assign>
        							</bpel:extensionAssignOperation>
        						</bpel:assign>
        						<bpel:if>
        							<bpel:condition>$remesaEncontrada</bpel:condition>
        							<bpel:sequence>
        								<bpel:empty/>
        							
	<bpel:forEach parallel="no" counterName="contadorRemesas">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>count($RSPConsultaRemesaPorNombreYMetodo.result/ns8:consultaRemesaPorNombreYMetodoResponseType/ns8:consultaRemesaPorNombreYMetodoResponseRecordType)</bpel:finalCounterValue>
		<bpel:scope>
			<bpel:sequence>
				<bpel:assign>
					
				<bpel:extensionAssignOperation>
		<bpel:documentation/>
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./ns7:consultaRemesaPorNombreResponseType</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryTransform>
					<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaRemesaPorNombre/xq/consultaRemesaPorNombreYMetodoOut"/>
					
					
					
					
					<expr:param name="consultaRemesaPorNombreYMetodoResponse">
						<expr:path>$RSPConsultaRemesaPorNombreYMetodo.result</expr:path></expr:param>
					<expr:param name="contadorRemesas">
						<expr:path>$contadorRemesas</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert>
				</bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
		</bpel:scope>
        							</bpel:forEach>
	</bpel:sequence>
        							<bpel:else>
        								<bpel:sequence>
        									<bpel:empty/>
        								</bpel:sequence>
        							</bpel:else>
        						</bpel:if></bpel:sequence>
        				</bpel:scope>
        			</bpel:forEach>
        			
        			
        			
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<bpel:documentation/>
        					<trf:assign varName="contadorGruposPrioridad">
        						<trf:expr>
        							<expr:xqueryText>xs:integer($contadorGruposPrioridad) + 1</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
        				</bpel:assign>
        			</bpel:sequence>
        		<bpel:condition>$contadorGruposPrioridad > count($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:GRUPOS/con:GRUPO_PRIORIDAD) or 
count($response.outputParameters/ns7:consultaRemesaPorNombreResponseType/ns7:consultaRemesaPorNombreResponseRecordType) > 0</bpel:condition></bpel:repeatUntil>
        	
        	<bpel:if>
        		<bpel:condition>count($response.outputParameters/ns7:consultaRemesaPorNombreResponseType/ns7:consultaRemesaPorNombreResponseRecordType) > 0</bpel:condition>
        		<bpel:sequence>
        			<bpel:empty/>
        			
        			
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<bpel:documentation/>
        					<trf:assign varName="response.ResponseHeader">
        						<trf:expr>
        							<expr:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>SUCCESS</successIndicator>
      <messages>Remesa encontrada</messages>
</aut:ResponseHeader>]]></expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        		<bpel:else>
        			<bpel:sequence>
        				<bpel:empty/>
        				<bpel:assign>
        					<bpel:extensionAssignOperation>
        						<bpel:documentation/>
        						<trf:assign varName="response.ResponseHeader">
        							<trf:expr>
        								<expr:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>Remesa no encontrada</messages>
</aut:ResponseHeader>]]></expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
        					<bpel:extensionAssignOperation>
        						<bpel:documentation/>
        						<trf:assign varName="response.outputParameters">
        							<trf:expr>
        								<expr:xqueryText>&lt;ns7:sjConsultaRemesaPorNombreResponse>
&lt;/ns7:sjConsultaRemesaPorNombreResponse></expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        				</bpel:sequence></bpel:else></bpel:if></bpel:sequence>
        	<bpel:else>
        		<bpel:sequence>
        			<bpel:empty/>
        		<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:assign varName="response.ResponseHeader">
				<trf:expr>
					<expr:xqueryText><![CDATA[<aut:ResponseHeader>
    <successIndicator>
    { 
        if (fn:string($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:CODIGO_RESPUESTA/text())) then (
            fn:string($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:CODIGO_RESPUESTA/text())
        ) else 
        "ERROR CONSULTANDO LAS REMESADORAS"
    }
    </successIndicator>
    <messages>{ fn:string($RSPConsultaRemesadorasPorPrioridad.OutputParameters/con:MENSAJE_RESPUESTA/text()) }</messages>
</aut:ResponseHeader>]]></expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
        		</bpel:assign></bpel:sequence>
        	</bpel:else>
        </bpel:if>
        
        
        
        
        
        
        
        <bpel:reply partnerLink="sjConsultaListasCliente" operation="consultaRemesaPorNombre" variable="response"/>
    </bpel:sequence>
</bpel:process>