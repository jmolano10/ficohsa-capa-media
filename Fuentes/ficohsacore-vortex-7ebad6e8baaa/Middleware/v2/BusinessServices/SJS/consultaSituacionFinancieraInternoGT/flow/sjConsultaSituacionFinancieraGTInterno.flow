<bpel:process name="sjConsultaSituacionFinancieraGTInterno" targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/flow/sjConsultaSituacionFinancieraGTInterno" bea:name="sjConsultaSituacionFinancieraGTInterno" xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/flow/sjConsultaSituacionFinancieraGTInterno" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinancieraGTInternoPS" xmlns:ns1="http://xmlns.oracle.com/pcbpel/adapter/db/TESTWS/AplicaCargoCuenta/AplicaCargoCuenta" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/conDatoTarjetaGT/obtenerSitFinanciera/obtenerSitFinanciera" xmlns:ns2="http://www.ficohsa.com.hn/middleware.services/sjConsultaSituacionFinancieraInterno" xmlns:ns3="http://xmlns.oracle.com/pcbpel/adapter/db/insertarSituacionFinanciera/Project1/insertarSituacionFinanciera" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns4="http://xmlns.oracle.com/pcbpel/adapter/db/Application1/Project1/consultaSituacionFinanciera" xmlns:ins="http://xmlns.oracle.com/pcbpel/adapter/db/sp/insertarSituacionFinanciera" xmlns:ns5="http://xmlns.oracle.com/pcbpel/adapter/db/ConnectionTarjetas/conConsultaSituacionFinanciera/conConsultaSituacionFinanciera" xmlns:ns6="http://xmlns.oracle.com/pcbpel/adapter/db/Ejemplo/conDatoAutorizacionesHistorica/conDatoAutorizacionesHistorica">
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaSituacionFinancieraGTInterno" partnerLinkType="tns:sjConsultaSituacionFinancieraGTInterno" myRole="sjConsultaSituacionFinancieraGTInterno">
	       </bpel:partnerLink>
	   <bpel:partnerLink name="obtenerSitFinanciera_db" partnerLinkType="tns:obtenerSitFinanciera_db_plnkType" partnerRole="obtenerSitFinanciera_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="insertarSituacionFinanciera_db" partnerLinkType="tns:insertarSituacionFinanciera_db_plnkType" partnerRole="insertarSituacionFinanciera_db_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="conConsultaSituacionFinanciera_db" partnerLinkType="tns:conConsultaSituacionFinanciera_db_plnkType" partnerRole="conConsultaSituacionFinanciera_db_PartnerRole">
	   </bpel:partnerLink></bpel:partnerLinks>

	   <bpel:variables>
        <bpel:variable name="request" messageType="bind:sjConsultaSituacionFinancieraGTInternoRequest">
	       </bpel:variable>
	       <bpel:variable name="response" messageType="bind:sjConsultaSituacionFinancieraGTInternoResponse">
	       </bpel:variable>
    <bpel:variable name="tempResponse" type="xsd:anyType"/>
    <bpel:variable name="core" type="xsd:anyType"/></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaSituacionFinancieraGTInterno" operation="ConsultaSituacionFinancieraGTInterno" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/wsdl/sjConsultaSituacionFinancieraGTInterno" binding="bind:sjConsultaSituacionFinancieraGTInternoPSSOAP"/></rescon:receiveInfo>
        </bpel:receive>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;sjConsultaSituacionFinancieraInternoTypes/></expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="tempResponse">
        			<trf:expr>
        				<expr:xqueryText>&lt;ResponseHeader>
	&lt;responses/>
&lt;/ResponseHeader></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="core">
        			<trf:expr>
        				<expr:xqueryText><![CDATA[<CORES>
	<CORE>ABK</CORE>
	<CORE>MasterData</CORE>
</CORES>]]></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:forEach parallel="yes" counterName="counter">
        	<bpel:startCounterValue>number(1)</bpel:startCounterValue>
        	<bpel:finalCounterValue>count($request.inputParameters/GROUPS/GROUP)</bpel:finalCounterValue>
        	<bpel:scope>
        		
        		
        		<bpel:sequence>
        			
        			<bpel:forEach parallel="yes" counterName="counterCore">
        				<bpel:startCounterValue>number(1)</bpel:startCounterValue>
        				<bpel:finalCounterValue>count($core/CORE)</bpel:finalCounterValue>
        				<bpel:scope>
        					
        					<bpel:variables>
        						<bpel:variable name="currentCore" type="xsd:string">
        						</bpel:variable></bpel:variables>
        					<bpel:faultHandlers>
        						<bpel:catchAll>
        							<bpel:sequence>
        								<bpel:empty/>
        							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="tempResponse">
				<trf:location>
					<expr:xpathText>./responses</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText><![CDATA[<response>
	<successIndicator>ERROR</successIndicator>
	<messages>{ fn:concat('Error insertando en ', $currentCore, ' GT01') }</messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        						</bpel:catchAll></bpel:faultHandlers>
        					<bpel:sequence>
        						<bpel:assign>
        							<bpel:extensionAssignOperation>
        								<trf:assign varName="currentCore">
        									<trf:expr>
        										<expr:xqueryText>$core/CORE[xs:integer($counterCore)]</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
        						<bpel:if bea:branchLabel="ABK">
        							<bpel:condition>$currentCore = "ABK"</bpel:condition>
        							<bpel:sequence>
        								<bpel:empty/>
        							<bpel:scope>
		<bpel:variables>
			<bpel:variable name="REQObtenerSitFinancieraAbanksGT" messageType="ns0:args_in_msg"/>
			<bpel:variable name="RSPObtenerSitFinancieraAbanksGT" messageType="ns0:args_out_msg"/>
			<bpel:variable name="group" type="ns2:GROUP"/>
			<bpel:variable name="REQInsertarSituacionFinanciera" messageType="ns3:args_in_msg"/>
			<bpel:variable name="RSPInsertarSituacionFinanciera" messageType="ns3:args_out_msg"/></bpel:variables>
		<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
					<bpel:rethrow/>
					
					<bpel:exit/></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="group">
							<bpel:documentation/>
							<trf:assign varName="group">
								<trf:expr>
									<expr:xqueryText>$request.inputParameters/GROUPS/GROUP[xs:integer($counter)]</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQObtenerSitFinancieraAbanksGT">
							<trf:assign varName="REQObtenerSitFinancieraAbanksGT.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/xq/sjObtenerSitFinancieraAbanksGTIn"/>
										<expr:param name="group">
											<expr:path>$group</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="obtenerSitFinanciera" partnerLink="obtenerSitFinanciera_db" inputVariable="REQObtenerSitFinancieraAbanksGT" outputVariable="RSPObtenerSitFinancieraAbanksGT" bea:name="obtenerSituacionFinancieraAbanksGT">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/ABKGT/obtenerSitFinanciera/biz/obtenerSitFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke></bpel:sequence></bpel:scope>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQInsertarSituacionFinanicera">
							<trf:assign varName="REQInsertarSituacionFinanciera.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/xq/insertarSituacionFinancieraAbanksGTIn"/>
										
										
										<expr:param name="outputParameters">
											<expr:path>$RSPObtenerSitFinancieraAbanksGT.OutputParameters</expr:path></expr:param>
										<expr:param name="usuario">
											<expr:path>fn:string($request.RequestHeader/Authentication/UserName/text())</expr:path></expr:param>
										<expr:param name="referenciaLlave">
											<expr:path>fn:string($request.inputParameters/UUID/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="insertarSituacionFinanciera" partnerLink="insertarSituacionFinanciera_db" inputVariable="REQInsertarSituacionFinanciera" outputVariable="RSPInsertarSituacionFinanciera" bea:name="InsertarSituacionFinanciera">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/INTFC/insertarSituacionFinanciera/biz/insertarSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="InsercionSituacionFinancieraAbanksGT">
							<trf:insert varName="tempResponse">
								<trf:location>
									<expr:xpathText>./responses</expr:xpathText></trf:location>
								<trf:where>last-child</trf:where>
								<trf:expr>
									<expr:xqueryText><![CDATA[<response>
	<successIndicator>{ fn:string($RSPInsertarSituacionFinanciera.OutputParameters/ins:PV_SUCCESS_INDICADOR/text()) } </successIndicator>
	<messages>{ concat('GT01: ', fn:string($RSPInsertarSituacionFinanciera.OutputParameters/ins:PV_MENSAJE_ERROR/text())) }</messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:sequence></bpel:scope></bpel:sequence>
        							<bpel:elseif bea:name="MasterData">
        								<bpel:condition>$currentCore = "MasterData"</bpel:condition>
        								<bpel:sequence>
        									<bpel:empty/>
        								<bpel:scope>
		<bpel:variables>
			<bpel:variable name="REQConsultaSituacionFinancieraMasterData" messageType="ns5:args_in_msg"/>
			<bpel:variable name="RSPConsultaSituacionFinancieraMasterData" messageType="ns5:args_out_msg"/>
			<bpel:variable name="group" type="ns2:GROUP"/>
			<bpel:variable name="REQInsertarSituacionFinanciera" messageType="ns3:args_in_msg"/>
			<bpel:variable name="RSPInsertarSituacionFinanciera" messageType="ns3:args_out_msg"/></bpel:variables>
		<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
					
					<bpel:rethrow/>
					<bpel:exit/></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:scope>
				
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="group">
							<trf:assign varName="group">
								<trf:expr>
									<expr:xqueryText>$request.inputParameters/GROUPS/GROUP[xs:integer($counter)]</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQConsultaSituacionFinancieraMasterData">
							<trf:assign varName="REQConsultaSituacionFinancieraMasterData.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/xq/sjConsultaSituacionFinancieraMasterDataIn"/>
										<expr:param name="group">
											<expr:path>$group</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="conConsultaSituacionFinanciera" partnerLink="conConsultaSituacionFinanciera_db" bea:name="consultaSituacionFinancieraMasterData" inputVariable="REQConsultaSituacionFinancieraMasterData" outputVariable="RSPConsultaSituacionFinancieraMasterData">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/MasterData/conConsultaSituacionFinanciera/biz/conConsultaSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke></bpel:sequence></bpel:scope>
			<bpel:scope>
				<bpel:sequence>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="REQInsertarSituacionFinanicera">
							<trf:assign varName="REQInsertarSituacionFinanciera.InputParameters">
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaSituacionFinancieraInternoGT/xq/insertarSituacionFinancieraMasterDataIn"/>
										
										
										
										
										
										
										<expr:param name="usuario">
											<expr:path>fn:string($request.RequestHeader/Authentication/UserName/text())</expr:path></expr:param>
										<expr:param name="referenciaLlave">
											<expr:path>fn:string($request.inputParameters/UUID/text())</expr:path></expr:param>
										<expr:param name="outputParameters1">
											<expr:path>$RSPConsultaSituacionFinancieraMasterData.OutputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
					<bpel:invoke operation="insertarSituacionFinanciera" partnerLink="insertarSituacionFinanciera_db" inputVariable="REQInsertarSituacionFinanciera" outputVariable="RSPInsertarSituacionFinanciera" bea:name="insertarSituacionFinanciera">
						<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/INTFC/insertarSituacionFinanciera/biz/insertarSituacionFinanciera_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/></rescon:invokeInfo></bpel:invoke>
					<bpel:assign>
						<bpel:extensionAssignOperation bea:name="InsercionSituacionFinancieraVasa">
							<trf:insert varName="tempResponse">
								<trf:location>
									<expr:xpathText>./responses</expr:xpathText></trf:location>
								<trf:where>last-child</trf:where>
								<trf:expr>
									<expr:xqueryText><![CDATA[<response>
	<successIndicator>{ fn:string($RSPInsertarSituacionFinanciera.OutputParameters/ins:PV_SUCCESS_INDICADOR/text()) } </successIndicator>
	<messages>{ concat('GT01: ', fn:string($RSPInsertarSituacionFinanciera.OutputParameters/ins:PV_MENSAJE_ERROR/text())) }</messages>
</response>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:sequence></bpel:scope></bpel:sequence>
        							</bpel:elseif>
        							<bpel:else>
        								<bpel:sequence>
        									<bpel:empty/>
        								</bpel:sequence>
        							</bpel:else>
        						</bpel:if>
        						</bpel:sequence></bpel:scope></bpel:forEach></bpel:sequence>
        	</bpel:scope>
        </bpel:forEach>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="response.ResponseHeader">
        			<trf:expr>
        				<expr:xqueryText><![CDATA[<aut:ResponseHeader>
	<successIndicator>
		{
			let $numberErrors := count($tempResponse/responses/response[fn:upper-case(successIndicator) != 'SUCCESS'])
			return
				if($numberErrors = 0) then(
					'SUCCESS'
				)else(
					'ERROR'
				)
    	}
	</successIndicator>
	<messages>{ fn:string-join($tempResponse/responses/response/messages, '. ') }</messages>
</aut:ResponseHeader>]]></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        </bpel:assign>
        <bpel:reply partnerLink="sjConsultaSituacionFinancieraGTInterno" operation="ConsultaSituacionFinancieraGTInterno" variable="response"/>
    </bpel:sequence>
</bpel:process>