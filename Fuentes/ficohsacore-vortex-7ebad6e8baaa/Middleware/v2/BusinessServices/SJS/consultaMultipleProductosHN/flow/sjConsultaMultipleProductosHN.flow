<bpel:process name="sjConsultaMultipleProductosHN" targetNamespace="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/flow/sjConsultaMultipleProductosHN" bea:name="sjConsultaMultipleProductosHN" xmlns:tns="http://www.example.com/flow/Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/flow/sjConsultaMultipleProductosHN" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:rescon="http://www.bea.com/alsb/flow/resources/config" xmlns:bea="http://www.bea.com/bpel/ui/extensions" xmlns:ext="http://www.bea.com/bpel/extensions" xmlns:expr="http://www.bea.com/wli/sb/stages/config" xmlns:trf="http://www.bea.com/wli/sb/stages/transform/config" xmlns:bind="http://www.ficohsa.com.hn/middleware.services/sjConsultaMultipleProductosHN" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns1="T24WebServicesImpl" xmlns:ns0="http://xmlns.oracle.com/pcbpel/adapter/db/InterbancaSOAApplication/ConsultaFICOPEN/consultaFICOPEN" xmlns:ns2="http://xmlns.oracle.com/pcbpel/adapter/db/InterbancaSOAApplication/ConsultaGeneralPrestamo/consultaGeneralPrestamo" xmlns:ns3="http://tempuri.org/" xmlns:ns4="http://www.ficohsa.com.hn/middleware.services/sjConsultaSaldosMultipleProductos" xmlns:ns5="http://www.ficohsa.com.hn/middleware.services/consultaTasaCambioPS/" xmlns:ns6="http://www.ficohsa.com.hn/middleware.services/consultaSaldosTarjetaCreditoTypes" xmlns:ns7="http://www.ficohsa.com.hn/middleware.services/consultaSaldosTarjetaCreditoPS/" xmlns:aut="http://www.ficohsa.com.hn/middleware.services/autType" xmlns:ns8="http://xmlns.oracle.com/pcbpel/adapter/db/consultaLineasCreditoCliente/consultaLineasCreditoCliente/consultaLineasCreditoCliente" xmlns:ns9="http://www.ficohsa.com.hn/middleware.services/consultaMultiplesProductos/" xmlns:ns10="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ns11="http://xmlns.oracle.com/Vortex/Middleware/CloudCodeRestBS" xmlns:clo="https://www.ficohsa.com/honduras/pension/cloudCodeTypes"
              xmlns:ns12="http://www.bea.com/wli/sb/pipeline/config">
    <rescon:importInfo><rescon:wsdl-import ref="Middleware/v2/BusinessServices/ConsultaSaldosTarjetaCredito/wsdl/ConsultaSaldosTarjetaCreditoService_v2.svc.singleWsdl"/><rescon:schema-import ref="Middleware/v2/Resources/ConsultaSaldosTarjetaCredito/xsd/consultaSaldosTarjetaCreditoTypes"/></rescon:importInfo>
    <bpel:partnerLinks>
        <bpel:partnerLink name="sjConsultaMultipleProductosHN" partnerLinkType="tns:sjConsultaMultipleProductosHN" myRole="sjConsultaMultipleProductosHN">
	       </bpel:partnerLink>
	   
	   
	   
	   <bpel:partnerLink name="consultaGeneralPrestamoBS" partnerLinkType="tns:consultaGeneralPrestamoBS_plnkType" partnerRole="consultaGeneralPrestamoBS_PartnerRole">
	   </bpel:partnerLink>
	   
	   
	   
	   <bpel:partnerLink name="consultaCertificadoDespositoBS" partnerLinkType="tns:consultaCertificadoDespositoBS_plnkType" partnerRole="consultaCertificadoDespositoBS_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="sjConsultaSaldosMultipleProductos" partnerLinkType="tns:sjConsultaSaldosMultipleProductos_plnkType" partnerRole="sjConsultaSaldosMultipleProductos_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaTasaCambio" partnerLinkType="tns:ConsultaTasaCambio_plnkType" partnerRole="ConsultaTasaCambio_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="ConsultaSaldosTarjetaCredito" partnerLinkType="tns:ConsultaSaldosTarjetaCredito_plnkType" partnerRole="ConsultaSaldosTarjetaCredito_PartnerRole">
	   </bpel:partnerLink>
	   <bpel:partnerLink name="consultaLineasCreditoCliente_db" partnerLinkType="tns:consultaLineasCreditoCliente_db_plnkType" partnerRole="consultaLineasCreditoCliente_db_PartnerRole">
	   </bpel:partnerLink>
  <bpel:partnerLink name="CloudCodePP" partnerLinkType="tns:CloudCodePP" partnerRole="CloudCodePP"/>
 </bpel:partnerLinks>

	   <bpel:variables>
        
	       <bpel:variable name="response" messageType="bind:sjConsultaMultipleProductosHNResponse">
	       </bpel:variable>
    <bpel:variable name="productoxTipo" type="xsd:anyType"/>
    <bpel:variable name="totalTipos" type="xsd:int"/>
    <bpel:variable name="request" messageType="bind:sjConsultaMultipleProductosHNRequest">
    </bpel:variable></bpel:variables>

    <bpel:sequence>
        <bpel:receive partnerLink="sjConsultaMultipleProductosHN" operation="consultaProductos" variable="request" createInstance="yes">
	           <rescon:receiveInfo>
                
            <rescon:wsdl ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/wsdl/sjConsultaMultipleProductosHN" binding="bind:sjConsultaMultipleProductosHNPSSOAP"/></rescon:receiveInfo>
        </bpel:receive>
        
        <bpel:assign>
        	<bpel:extensionAssignOperation>
        		<bpel:documentation/>
        		<trf:assign varName="response.outputParameters">
        			<trf:expr>
        				<expr:xqueryText>&lt;outputParameters>
	&lt;bind:ASSETS/>
	&lt;bind:LIABILITIES/>
&lt;/outputParameters></expr:xqueryText></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        	<bpel:extensionAssignOperation>
        		<trf:assign varName="productoxTipo">
        			<trf:expr>
        				<expr:xqueryTransform>
        					<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/agruparTipos"/>
        					<expr:param name="sjConsultaMultipleProductosHN">
        						<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
        	</bpel:extensionAssignOperation>
        <bpel:extensionAssignOperation>
		<trf:assign varName="totalTipos">
			<trf:expr>
				<expr:xqueryText>count($productoxTipo/TYPE)</expr:xqueryText></trf:expr></trf:assign>
        </bpel:extensionAssignOperation></bpel:assign>
        <bpel:forEach parallel="yes" counterName="typePosition">
        	<bpel:startCounterValue>1</bpel:startCounterValue>
        	<bpel:finalCounterValue>$totalTipos</bpel:finalCounterValue>
        	<bpel:scope>
        		
        		<bpel:variables>
        			<bpel:variable name="type" type="xsd:string"/>
        			<bpel:variable name="REQConsultadecertifdeposito" messageType="ns1:Consultadecertifdeposito">
        			</bpel:variable>
        			<bpel:variable name="RSPConsultadecertifdeposito" messageType="ns1:ConsultadecertifdepositoResponse">
        			</bpel:variable>
        			<bpel:variable name="REQsjConsultaSaldosMultipleProductos" messageType="ns4:sjConsultaSaldosMultipleProductosRequest">
        			</bpel:variable>
        			<bpel:variable name="RSPsjConsultaSaldosMultipleProductos" messageType="ns4:sjConsultaSaldosMultipleProductosResponse">
        			</bpel:variable>
        			<bpel:variable name="totalProductos" type="xsd:int">
        			</bpel:variable>
        			<bpel:variable name="REQconsultaTasaCambio" messageType="ns5:consultaTasaCambioRequest">
        			</bpel:variable>
        			<bpel:variable name="RSPconsultaTasaCambio" messageType="ns5:consultaTasaCambioResponse">
        			</bpel:variable>
        			<bpel:variable name="successIndicatorT24" type="xsd:string">
        			</bpel:variable>
        			<bpel:variable name="depositosError" type="xsd:anyType">
        			</bpel:variable></bpel:variables>
        		<bpel:sequence>
        			<bpel:assign>
        				<bpel:extensionAssignOperation>
        					<bpel:documentation/>
        					<trf:assign varName="type">
        						<trf:expr>
        							<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/NAME_TYPE/text())</expr:xqueryText></trf:expr></trf:assign>
        				</bpel:extensionAssignOperation>
        			</bpel:assign>
        			<bpel:if>
        				<bpel:condition>$type="AHO"
or
$type="CHQ"</bpel:condition>
        				<bpel:sequence>
        					<bpel:empty/>
        					
        					
        					<bpel:scope>
        						<bpel:variables>
        							<bpel:variable name="Assets" type="xsd:anyType">
        							</bpel:variable></bpel:variables>
        						<bpel:sequence>
        							<bpel:scope>
        								<bpel:faultHandlers>
        									<bpel:catchAll>
        										<bpel:sequence>
        											<bpel:empty/>
        										<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText><![CDATA[for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return
<bind:ASSET>
	<bind:ID>{data($ID)}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:ASSET>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        									</bpel:catchAll></bpel:faultHandlers>
        								<bpel:sequence>
        									<bpel:assign>
        										<bpel:extensionAssignOperation>
        											<trf:assign varName="REQsjConsultaSaldosMultipleProductos.inputParameters">
        												<trf:expr>
        													<expr:xqueryTransform>
        														<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/sjConsultaSaldosMultipleProductosIn"/>
        														<expr:param name="TYPE">
        															<expr:path>$type</expr:path></expr:param>
        														<expr:param name="productosxTipo">
        															<expr:path>$productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS</expr:path></expr:param>
        														<expr:param name="sjConsultaMultipleProductosHN">
        															<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation>
        										</bpel:assign>
        									<bpel:invoke operation="consultaProductos" partnerLink="sjConsultaSaldosMultipleProductos" inputVariable="REQsjConsultaSaldosMultipleProductos" outputVariable="RSPsjConsultaSaldosMultipleProductos">
        										<rescon:invokeInfo><con:service ref="Middleware/v2/BusinessServices/SJS/consultaSaldosMultipleProductos/flow/sjConsultaSaldosMultipleProductos" xsi:type="con:FlowRef" xmlns:con="http://www.bea.com/alsb/flow/resources/config"/></rescon:invokeInfo></bpel:invoke>
        									<bpel:assign>
        										<bpel:extensionAssignOperation>
        											<bpel:documentation/>
        											<trf:insert varName="response.outputParameters">
        												<trf:location>
        													<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
        												<trf:where>first-child</trf:where>
        												<trf:expr>
        													<expr:xqueryText><![CDATA[
for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
let $asset := $RSPsjConsultaSaldosMultipleProductos.outputParameters/ns4:ASSETS/ns4:ASSET[ ns4:ID= data($ID) ][1]
return
if(upper-case(string($asset/ns4:SUCCESS_INDICATOR/text())) = "SUCCESS")then
<bind:ASSET>
	<bind:ID>{data($ID)}</bind:ID>
	<bind:PRODUCT_NAME>{string($asset/ns4:PRODUCT_NAME/text())}</bind:PRODUCT_NAME>
	<bind:CURRENCY>{string($asset/ns4:CURRENCY/text())}</bind:CURRENCY>
	{
		if(string($asset/ns4:RESERVE_BALANCE/text()) != "") then(
			<bind:RESERVE_BALANCE>{round-half-to-even(xs:decimal(data($asset/ns4:RESERVE_BALANCE)), 2)}</bind:RESERVE_BALANCE>
		) else (
			<bind:RESERVE_BALANCE>0.0</bind:RESERVE_BALANCE>
		),
		
		if(string($asset/ns4:LOCKED_BALANCE/text()) != "") then(
			<bind:LOCKED_BALANCE>{ round-half-to-even(xs:decimal(data($asset/ns4:LOCKED_BALANCE)), 2) }</bind:LOCKED_BALANCE>
		) else (
			<bind:LOCKED_BALANCE>0.0</bind:LOCKED_BALANCE>
		),
		
		if(string($asset/ns4:VISA_FLOATING_BALANCE/text()) != "") then(
			<bind:VISA_FLOATING_BALANCE>{ round-half-to-even(xs:decimal(data($asset/ns4:VISA_FLOATING_BALANCE)), 2) }</bind:VISA_FLOATING_BALANCE>
		) else (
			<bind:VISA_FLOATING_BALANCE>0.0</bind:VISA_FLOATING_BALANCE>
		),
		
		if(string($asset/ns4:CASH_ADVANCE_LIMIT/text()) != "") then(
			<bind:CASH_ADVANCE_LIMIT>{ round-half-to-even(xs:decimal(data($asset/ns4:CASH_ADVANCE_LIMIT)), 2) }</bind:CASH_ADVANCE_LIMIT>
		) else (
			<bind:CASH_ADVANCE_LIMIT>0.0</bind:CASH_ADVANCE_LIMIT>
		),
		
		if(string($asset/ns4:CASH_ADVANCE_AVAILABLE/text()) != "") then(
			<bind:CASH_ADVANCE_AVAILABLE>{ round-half-to-even(xs:decimal(data($asset/ns4:CASH_ADVANCE_AVAILABLE)), 2) }</bind:CASH_ADVANCE_AVAILABLE>
		) else (
			<bind:CASH_ADVANCE_AVAILABLE>0.0</bind:CASH_ADVANCE_AVAILABLE>
		),
		
		
		<bind:INTEREST_BALANCE>0.0</bind:INTEREST_BALANCE>,
		
		
		if(string($asset/ns4:TOTAL_BALANCE/text()) != "") then(
			<bind:TOTAL_BALANCE>{ round-half-to-even(xs:decimal(data($asset/ns4:TOTAL_BALANCE)), 2) }</bind:TOTAL_BALANCE>
		) else (
			<bind:TOTAL_BALANCE>0.0</bind:TOTAL_BALANCE>
		),
		
		if(string($asset/ns4:AVAILABLE_BALANCE/text()) != "") then(
			<bind:AVAILABLE_BALANCE>{ round-half-to-even(xs:decimal(data($asset/ns4:AVAILABLE_BALANCE)), 2) }</bind:AVAILABLE_BALANCE>
		) else (
			<bind:AVAILABLE_BALANCE>0.0</bind:AVAILABLE_BALANCE>
		)	
	}
	<bind:OPENING_DATE>{ fn:adjust-date-to-timezone(fn:current-date(), ()) }</bind:OPENING_DATE>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>SUCCESS</bind:SUCCESS_INDICATOR>
</bind:ASSET>
else
(
<bind:ASSET>
	<bind:ID>{data($ID)}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>{ upper-case(string($asset/ns4:SUCCESS_INDICATOR/text())) }</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>{ upper-case(string($asset/ns4:ERROR_MESSAGE/text())) }</bind:ERROR_MESSAGE>
</bind:ASSET>
)]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
        							</bpel:scope>
        							
        							
        							
        							</bpel:sequence>
        					</bpel:scope>
        					
        					
        					
        					
        					</bpel:sequence>
        				
        				
        				
        				<bpel:elseif>
        					<bpel:condition>$type="DEP"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					
	<bpel:scope>
		<bpel:faultHandlers>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText><![CDATA[for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return
<bind:ASSET>
	<bind:ID>{string($ID/text())}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:ASSET>]]></expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
				</bpel:assign></bpel:sequence>
			</bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign varName="REQConsultadecertifdeposito.parameters">
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultadecertifdepositoIn"/>
								<expr:param name="productosxTipo">
									<expr:path>$productoxTipo/TYPE[xs:int($typePosition)]</expr:path></expr:param>
								<expr:param name="sjConsultaMultipleProductosHN">
									<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
			<bpel:invoke operation="Consultadecertifdeposito" inputVariable="REQConsultadecertifdeposito" partnerLink="consultaCertificadoDespositoBS" outputVariable="RSPConsultadecertifdeposito">
				<rescon:invokeInfo><rescon:service ref="Middleware/Business_Resources/consultaCertificadoDeposito/Resources/consultaCertificadoDespositoBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/></rescon:invokeInfo></bpel:invoke>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign varName="successIndicatorT24">
						<trf:expr>
							<expr:xqueryText>upper-case(string($RSPConsultadecertifdeposito.parameters/Status/successIndicator/text()))</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation>
				<bpel:extensionAssignOperation>
					<bpel:documentation/>
					<trf:insert varName="response.outputParameters">
						<trf:location>
							<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
						<trf:where>last-child</trf:where>
						<trf:expr>
							<expr:xqueryText><![CDATA[if($successIndicatorT24 = "SUCCESS") then(
	for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
	let $cuenta := $RSPConsultadecertifdeposito.parameters/WSAZACCOUNTDEPType[1]/gWSAZACCOUNTDEPDetailType/mWSAZACCOUNTDEPDetailType[ ACCOUNTNO = data($ID) or ALTACCTID = data($ID) ]
	return
	if(count($cuenta) > 0)then
	<bind:ASSET>
		<bind:ID>{ data($ID )}</bind:ID>
		<bind:PRODUCT_NAME>{ string($cuenta/DEPOSITNAME/text()) }</bind:PRODUCT_NAME>
		<bind:CURRENCY>{ string($cuenta/CURRENCY/text()) }</bind:CURRENCY>
		<bind:RESERVE_BALANCE>0.0</bind:RESERVE_BALANCE>
        <bind:LOCKED_BALANCE>0.0</bind:LOCKED_BALANCE>
        <bind:VISA_FLOATING_BALANCE>0.0</bind:VISA_FLOATING_BALANCE>
		{
			if(string($cuenta/INTERESTEARNED/text()) != '')then(
				<bind:INTEREST_BALANCE>{ round-half-to-even(xs:decimal(data($cuenta/INTERESTEARNED)), 2) }</bind:INTEREST_BALANCE>
			)else(
				<bind:INTEREST_BALANCE>0.0</bind:INTEREST_BALANCE>
			),
			
			if(fn:string($cuenta/PRINCIPAL/text()) != '' or string($cuenta/INTERESTEARNED/text()) != '') then(
				<bind:TOTAL_BALANCE>
				{ 
					round-half-to-even(xs:decimal(data($cuenta/PRINCIPAL)), 2)
					+
					round-half-to-even(xs:decimal(data($cuenta/INTERESTEARNED)), 2) 
				}
				</bind:TOTAL_BALANCE>
			) else(
				<bind:TOTAL_BALANCE>0.0</bind:TOTAL_BALANCE>
			),
			
			if(fn:string($cuenta/PRINCIPAL/text()) != '') then(
				<bind:AVAILABLE_BALANCE>{ round-half-to-even(xs:decimal(data($cuenta/PRINCIPAL)), 2) }</bind:AVAILABLE_BALANCE>
			) else(
				<bind:AVAILABLE_BALANCE>0.0</bind:AVAILABLE_BALANCE>
			)
		}	
		<bind:OPENING_DATE>{ fn:adjust-date-to-timezone(fn:current-date(), ()) }</bind:OPENING_DATE>
		<bind:TYPE>{$type}</bind:TYPE>
		<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
		<bind:SUCCESS_INDICATOR>SUCCESS</bind:SUCCESS_INDICATOR>
	</bind:ASSET>
	else
	(
	<bind:ASSET>
		<bind:ID>{ data($ID) }</bind:ID>
		<bind:TYPE>{ $type }</bind:TYPE>
		<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
		<bind:SUCCESS_INDICATOR>NO RECORDS</bind:SUCCESS_INDICATOR>
		<bind:ERROR_MESSAGE>PRODUCTO NO ENCONTRADO</bind:ERROR_MESSAGE>
	</bind:ASSET>
	)
)else(
	for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
	return
	<bind:ASSET>
		<bind:ID>{ data($ID) }</bind:ID>
		<bind:TYPE>{ $type }</bind:TYPE>
		<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
		<bind:SUCCESS_INDICATOR>{ $successIndicatorT24 }</bind:SUCCESS_INDICATOR>
		<bind:ERROR_MESSAGE>{string-join($RSPConsultadecertifdeposito.parameters/Status/messages/text(),". ")}</bind:ERROR_MESSAGE>
	</bind:ASSET>
)]]></expr:xqueryText></trf:expr></trf:insert>
				</bpel:extensionAssignOperation></bpel:assign>
			</bpel:sequence>
	</bpel:scope>
	
	
	
	
	
	
	
	</bpel:sequence>
        				</bpel:elseif>
        				<bpel:elseif>
        					<bpel:condition>$type="FPC"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign>
		</bpel:extensionAssignOperation>
	</bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1	</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			<bpel:variables>
           <bpel:variable name="REQcuentasRelacionesPeriodos" messageType="ns11:cuentasRelacionesPeriodos_inputMessage"/>
           <bpel:variable name="RSPcuentasRelacionesPeriodos" messageType="ns11:cuentasRelacionesPeriodos_outputMessage"/>
           <bpel:variable name="currentDate" type="xsd:string"/>
           <bpel:variable name="codeErrorService" type="xsd:string"/>
           <bpel:variable name="statusService" type="xsd:string"/>
          </bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					
					<expr:xqueryText><![CDATA[<bind:ASSET>
	<bind:ID>{string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:ASSET>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
				</bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				<bpel:assign>
            <bpel:extensionAssignOperation>
             <trf:assign varName="currentDate">
              <trf:expr>
               <expr:xqueryText>fn-bea:date-to-string-with-format('dd-MM-yyyy', current-date())</expr:xqueryText>
              </trf:expr>
             </trf:assign>
            </bpel:extensionAssignOperation>
            <bpel:extensionAssignOperation>
             <trf:assign varName="REQcuentasRelacionesPeriodos.request">
              <trf:expr>
               <expr:xqueryTransform>
                <expr:resource ref="Middleware/v2/BusinessServices/FPC/CloudCode/Transformation/cuentasRelacionesPeriodosIn"/>
                <expr:param name="fechaInicialConsulta">
                 <expr:path>$currentDate</expr:path>
                </expr:param>
                <expr:param name="fechaFinalConsulta">
                 <expr:path>$currentDate</expr:path>
                </expr:param>
                <expr:param name="codigoCuenta">
                 <expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path>
                </expr:param>
               </expr:xqueryTransform>
              </trf:expr>
             </trf:assign>
            </bpel:extensionAssignOperation>
           </bpel:assign>
           <bpel:invoke partnerLink="CloudCodePP" operation="cuentasRelacionesPeriodos"
                        inputVariable="REQcuentasRelacionesPeriodos" outputVariable="RSPcuentasRelacionesPeriodos">
            <rescon:invokeInfo>
             <rescon:service ref="Middleware/v2/BusinessServices/FPC/CloudCode/PP/CloudCodePP"
                             xsi:type="ns12:PipelineRef"/>
            </rescon:invokeInfo>
           </bpel:invoke>
           <bpel:assign>
            <bpel:extensionAssignOperation>
             <trf:assign varName="codeErrorService">
              <trf:expr>
               <expr:xqueryText>fn:data($RSPcuentasRelacionesPeriodos.reply/clo:error)
</expr:xqueryText>
              </trf:expr>
             </trf:assign>
            </bpel:extensionAssignOperation>
            <bpel:extensionAssignOperation>
             <trf:assign varName="statusService">
              <trf:expr>
               <expr:xqueryText>if($codeErrorService = 'false') then (
  'Success'
) else ('Error')</expr:xqueryText>
              </trf:expr>
             </trf:assign>
            </bpel:extensionAssignOperation>
           </bpel:assign>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:insert varName="response.outputParameters">
							<trf:location>
								<expr:xpathText>./bind:ASSETS</expr:xpathText></trf:location>
							<trf:where>last-child</trf:where>
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaMultiplesProductosOut"/>
                <expr:param name="statusService">
                 <expr:path>$statusService</expr:path>
                </expr:param>
                <expr:param name="productType">
                 <expr:path>$type</expr:path>
                </expr:param>
                <expr:param name="region">
                 <expr:path>'HN01'</expr:path>
                </expr:param>
                <expr:param name="productId">
                 <expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path>
                </expr:param>
                <expr:param name="consultaMultiplesProductosResponse">
                 <expr:path>$RSPcuentasRelacionesPeriodos.reply</expr:path>
                </expr:param>
               </expr:xqueryTransform></trf:expr></trf:insert>
					</bpel:extensionAssignOperation>
				</bpel:assign></bpel:sequence>
		</bpel:scope>
        					</bpel:forEach></bpel:sequence>
        				</bpel:elseif>
        				<bpel:elseif>
        					<bpel:condition>$type="PTM"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					
	<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			<bpel:variables>
				<bpel:variable name="REQconsultaGeneralPrestamo" messageType="ns2:args_in_msg">
				</bpel:variable>
				<bpel:variable name="RSPconsultaGeneralPrestamo" messageType="ns2:args_out_msg">
				</bpel:variable></bpel:variables>
			<bpel:faultHandlers>
				<bpel:catchAll>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText><![CDATA[<bind:LIABILITY>
	<bind:ID>{string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:LIABILITY>]]></expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
					</bpel:assign></bpel:sequence>
				</bpel:catchAll></bpel:faultHandlers>
			<bpel:sequence>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:assign varName="REQconsultaGeneralPrestamo.InputParameters">
							<trf:expr>
								<expr:xqueryTransform>
									<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaGeneralPrestamoIn"/>
									<expr:param name="ID">
										<expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
					</bpel:extensionAssignOperation>
				</bpel:assign>
				<bpel:invoke operation="consultaGeneralPrestamo" partnerLink="consultaGeneralPrestamoBS" inputVariable="REQconsultaGeneralPrestamo" outputVariable="RSPconsultaGeneralPrestamo">
					<rescon:invokeInfo><rescon:service ref="Middleware/Business_Resources/consultaGeneralPrestamo/Resources/consultaGeneralPrestamoBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/></rescon:invokeInfo></bpel:invoke>
				<bpel:assign>
					<bpel:extensionAssignOperation>
						<trf:insert varName="response.outputParameters">
							<trf:location>
								<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
							<trf:where>last-child</trf:where>
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaGeneralPrestamoOut"/>
								
								
								
								
								
								
								
								
								
								
								
								
								
								
								<expr:param name="ID">
									<expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path></expr:param>
								<expr:param name="outputParameters">
									<expr:path>$RSPconsultaGeneralPrestamo.OutputParameters</expr:path></expr:param>
								<expr:param name="TYPE">
									<expr:path>$type</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert>
					</bpel:extensionAssignOperation>
				</bpel:assign></bpel:sequence>
		</bpel:scope>
        					</bpel:forEach></bpel:sequence>
        				</bpel:elseif>
        				
        				<bpel:elseif>
        					<bpel:condition>$type="TRC"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					
	<bpel:scope>
		<bpel:variables>
			<bpel:variable name="successIndicator" type="xsd:string"/></bpel:variables>
		<bpel:faultHandlers>
			<bpel:catch faultName="tns:tasaCambioFault">
				<bpel:sequence>
					<bpel:empty/>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<bpel:documentation/>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
				<trf:expr>
					<expr:xqueryText><![CDATA[for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return
<bind:LIABILITY>
	<bind:ID>{ data($ID)}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO LA TASA DE CAMBIO</bind:ERROR_MESSAGE>
</bind:LIABILITY>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence>
			</bpel:catch>
			<bpel:catchAll>
				<bpel:sequence>
					<bpel:empty/>
				<bpel:assign>
		
				<bpel:extensionAssignOperation>
		<bpel:documentation/>
		<trf:insert varName="response.outputParameters">
			<trf:location>
				<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
			<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText><![CDATA[for $ID in $productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID
return
<bind:LIABILITY>
	<bind:ID>{ data($ID)}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO LA TASA DE CAMBIO</bind:ERROR_MESSAGE>
</bind:LIABILITY>]]></expr:xqueryText></trf:expr></trf:insert>
				</bpel:extensionAssignOperation></bpel:assign>
				</bpel:sequence>
			</bpel:catchAll></bpel:faultHandlers>
		<bpel:sequence>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign varName="REQconsultaTasaCambio.RequestHeader">
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaTasaCambioHeaderIn"/>
								<expr:param name="sjConsultaMultipleProductosHN">
									<expr:path>$request.inputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation>
				<bpel:extensionAssignOperation>
					<trf:assign varName="REQconsultaTasaCambio.parameters">
						<trf:expr>
							<expr:xqueryTransform>
								<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaTasaCambioIn"/></expr:xqueryTransform></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
			<bpel:invoke operation="consultaTasaCambio" inputVariable="REQconsultaTasaCambio" partnerLink="ConsultaTasaCambio" outputVariable="RSPconsultaTasaCambio">
				<rescon:invokeInfo><rescon:service ref="Middleware/v2/ProxyServices/ConsultaTasaCambio" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/></rescon:invokeInfo></bpel:invoke>
			<bpel:assign>
				<bpel:extensionAssignOperation>
					<trf:assign varName="successIndicator">
						<trf:expr>
							<expr:xqueryText>upper-case(data($RSPconsultaTasaCambio.ResponseHeader/successIndicator))</expr:xqueryText></trf:expr></trf:assign>
				</bpel:extensionAssignOperation>
			</bpel:assign>
			<bpel:if>
				<bpel:condition>$successIndicator = 'SUCCESS'</bpel:condition>
				<bpel:sequence>
					<bpel:empty/>
				<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
				<bpel:forEach counterName="positionProduct" parallel="yes">
					<bpel:startCounterValue>1</bpel:startCounterValue>
					<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
					<bpel:scope>
						<bpel:variables>
							
							
							<bpel:variable name="ID" type="xsd:string">
							</bpel:variable>
							<bpel:variable name="REQConsultaSaldosTarjetaCredito" messageType="ns7:consultaSaldosTarjetaCreditoRequest">
							</bpel:variable>
							<bpel:variable name="RSPConsultaSaldosTarjetaCredito" messageType="ns7:consultaSaldosTarjetaCreditoResponse">
							</bpel:variable></bpel:variables>
						<bpel:faultHandlers>
							<bpel:catchAll>
								<bpel:sequence>
									<bpel:empty/>
									<bpel:assign>
										<bpel:extensionAssignOperation>
											<trf:insert varName="response.outputParameters">
												<trf:location>
													<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
												<trf:where>last-child</trf:where>
												<trf:expr>
													<expr:xqueryText><![CDATA[<bind:LIABILITY>
	<bind:ID>{string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:LIABILITY>]]></expr:xqueryText></trf:expr></trf:insert></bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:catchAll></bpel:faultHandlers>
						<bpel:sequence>
							<bpel:assign>
								<bpel:extensionAssignOperation>
									<trf:assign varName="ID">
										<trf:expr>
											<expr:xqueryText>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:xqueryText></trf:expr></trf:assign>
								</bpel:extensionAssignOperation>
								
								<bpel:extensionAssignOperation>
									<trf:assign varName="REQConsultaSaldosTarjetaCredito.RequestHeader">
										<trf:expr>
											<expr:xqueryText><![CDATA[<aut:RequestHeader>
    <Authentication>
        <UserName>{fn:string($request.inputParameters/bind:USERNAME/text())}</UserName>
        <Password>{fn:string($request.inputParameters/bind:PASSWORD/text())}</Password>
	</Authentication>
    <Region>
        <SourceBank>HN01</SourceBank>
        <DestinationBank>HN01</DestinationBank>
    </Region>
</aut:RequestHeader>]]></expr:xqueryText></trf:expr></trf:assign>
								</bpel:extensionAssignOperation>
								<bpel:extensionAssignOperation>
									<bpel:documentation/>
									<trf:assign varName="REQConsultaSaldosTarjetaCredito.parameters">
										<trf:expr>
											<expr:xqueryTransform>
												<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaSaldosTarjetaCreditoIn"/>
												
												<expr:param name="ID">
	<expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
								</bpel:extensionAssignOperation></bpel:assign>
							<bpel:invoke operation="consultaSaldosTarjetaCredito" partnerLink="ConsultaSaldosTarjetaCredito" inputVariable="REQConsultaSaldosTarjetaCredito" outputVariable="RSPConsultaSaldosTarjetaCredito">
								<rescon:invokeInfo><rescon:service ref="Middleware/v2/ProxyServices/ConsultaSaldosTarjetaCredito" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/></rescon:invokeInfo></bpel:invoke>
							
							<bpel:assign>
								
								<bpel:extensionAssignOperation>
									<trf:insert varName="response.outputParameters">
										<trf:location>
											<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
										<trf:where>last-child</trf:where>
									<trf:expr>
										<expr:xqueryTransform>
											<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/consultaSaldosTarjetaCreditoOut"/>
											
											
											
											
											
											
											
											
											
											<expr:param name="consultaSaldosTarjetaCreditoResponse">
												<expr:path>$RSPConsultaSaldosTarjetaCredito.result</expr:path></expr:param>
											<expr:param name="productID">
												<expr:path>$ID</expr:path></expr:param>
											<expr:param name="productType">
												<expr:path>$type</expr:path></expr:param>
											<expr:param name="responseHeader">
												<expr:path>$RSPConsultaSaldosTarjetaCredito.ResponseHeader</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert>
								</bpel:extensionAssignOperation></bpel:assign></bpel:sequence></bpel:scope></bpel:forEach></bpel:sequence>
				<bpel:else>
					<bpel:sequence>
						<bpel:empty/>
					<bpel:throw faultName="tns:tasaCambioFault"/></bpel:sequence>
				</bpel:else>
			</bpel:if>
			
			</bpel:sequence>
	</bpel:scope>
	
	
	
	
	</bpel:sequence>
        				</bpel:elseif>
        				<bpel:elseif>
        					<bpel:condition>$type = "LCR"</bpel:condition>
        					<bpel:sequence>
        						<bpel:empty/>
        					<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:assign varName="totalProductos">
				<trf:expr>
					<expr:xqueryText>count($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID)</expr:xqueryText></trf:expr></trf:assign></bpel:extensionAssignOperation></bpel:assign>
	<bpel:forEach parallel="yes" counterName="positionProduct">
		<bpel:startCounterValue>1</bpel:startCounterValue>
		<bpel:finalCounterValue>$totalProductos</bpel:finalCounterValue>
		<bpel:scope>
			<bpel:sequence>
				<bpel:scope>
					<bpel:variables>
						<bpel:variable name="REQConsultaLineasCreditoCliente" messageType="ns8:args_in_msg">
						</bpel:variable>
						<bpel:variable name="RSPConsultaLineasCreditoCliente" messageType="ns8:args_out_msg">
						</bpel:variable></bpel:variables>
					<bpel:faultHandlers>
						<bpel:catchAll>
							<bpel:sequence>
								<bpel:empty/>
							<bpel:assign>
		<bpel:extensionAssignOperation>
			<trf:insert varName="response.outputParameters">
				<trf:location>
					<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
				<trf:where>last-child</trf:where>
			<trf:expr>
				<expr:xqueryText><![CDATA[<bind:LIABILITY>
	<bind:ID>{string($productoxTipo/TYPE/PRODUCTS/ID/text())}</bind:ID>
	<bind:TYPE>{$type}</bind:TYPE>
	<bind:SOURCE_BANK>HN01</bind:SOURCE_BANK>
	<bind:SUCCESS_INDICATOR>ERROR</bind:SUCCESS_INDICATOR>
	<bind:ERROR_MESSAGE>ERROR CONSULTANDO EL PRODUCTO</bind:ERROR_MESSAGE>
</bind:LIABILITY>]]></expr:xqueryText></trf:expr></trf:insert>
		</bpel:extensionAssignOperation>
							</bpel:assign></bpel:sequence>
						</bpel:catchAll></bpel:faultHandlers>
					<bpel:sequence>
						<bpel:assign>
							<bpel:extensionAssignOperation>
								<trf:assign varName="REQConsultaLineasCreditoCliente.InputParameters">
									<trf:expr>
										<expr:xqueryTransform>
											<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/sjConsultaLineasCreditoClienteIn"/>
											<expr:param name="ID">
												<expr:path>string($productoxTipo/TYPE[xs:int($typePosition)]/PRODUCTS/ID[xs:int($positionProduct)]/text())</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:assign>
							</bpel:extensionAssignOperation>
						</bpel:assign>
						<bpel:invoke operation="consultaLineasCreditoCliente" partnerLink="consultaLineasCreditoCliente_db" inputVariable="REQConsultaLineasCreditoCliente" outputVariable="RSPConsultaLineasCreditoCliente">
							<rescon:invokeInfo><rescon:service ref="Middleware/v2/BusinessServices/ABK/consultaLineasCreditoCliente/biz/consultaLineasCreditoCliente_db" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/></rescon:invokeInfo></bpel:invoke>
						<bpel:assign>
							<bpel:extensionAssignOperation>
								<trf:insert varName="response.outputParameters">
									<trf:location>
										<expr:xpathText>./bind:LIABILITIES</expr:xpathText></trf:location>
									<trf:where>first-child</trf:where>
								<trf:expr>
									<expr:xqueryTransform>
										<expr:resource ref="Middleware/v2/BusinessServices/SJS/consultaMultipleProductosHN/xq/sjConsultaLineasCreditoClienteOut"/>
										<expr:param name="outputParameters">
											<expr:path>$RSPConsultaLineasCreditoCliente.OutputParameters</expr:path></expr:param></expr:xqueryTransform></trf:expr></trf:insert>
							</bpel:extensionAssignOperation>
						</bpel:assign></bpel:sequence>
				</bpel:scope></bpel:sequence></bpel:scope></bpel:forEach>
	</bpel:sequence>
        				</bpel:elseif>
        				<bpel:else>
        					<bpel:sequence>
        						<bpel:empty/></bpel:sequence></bpel:else></bpel:if></bpel:sequence>
        	</bpel:scope>
        </bpel:forEach>
        
        <bpel:reply partnerLink="sjConsultaMultipleProductosHN" operation="consultaProductos" variable="response"/>
    </bpel:sequence>
</bpel:process>