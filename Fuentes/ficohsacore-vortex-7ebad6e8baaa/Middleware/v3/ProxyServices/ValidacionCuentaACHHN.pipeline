<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/v3/Resources/ValidacionCuentaACH/wsdl/validacionCuentaAchPS"/>
            <con:binding>
                <con:name>validacionCuentaAchPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com.hn/middleware.services/validacionCuentaAchPS/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="false" aggregationInterval="10" level="pipeline"/>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con:router xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
        <con:pipeline type="request" name="HN01_ValidaCuentaACH_request">
            <con:stage name="IniciarVariables">
                <con:context>
                    <con1:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaAchType" prefix="val"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="totalFoundAccounts" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7fca</con2:id>
                        <con3:expr>
                            <con2:xqueryText>0</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountFound" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7fc9</con2:id>
                        <con3:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountCancelled" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7fc8</con2:id>
                        <con3:expr>
                            <con2:xqueryText>"false"</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="errorMessage" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7fc7</con2:id>
                        <con3:expr>
                            <con2:xqueryText>"false"</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con2:assign varName="accountNumberInput">
                        <con1:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7fb6</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn:string($body/val:validacionCuentaAch/ACCOUNT_NUMBER/text())</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="checkCancelledInput">
                        <con1:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7f83</con1:id>
                        <con2:expr>
                            <con1:xqueryText>data($body/val:validacionCuentaAch/CHECK_CANCELLED_YES_NO)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con3:assign varName="accountNameInput" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7f63</con2:id>
                        <con3:expr>
                            <con2:xqueryText>normalize-space(upper-case(fn:string($body/val:validacionCuentaAch/ACCOUNT_NAME/text())))</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="xmlForEach" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7f62</con2:id>
                        <con3:expr>
                            <con2:xqueryText><![CDATA[<body>
	<parent>
		<item>1</item>
		<item>2</item>
		<item>3</item>
	</parent>
</body>]]></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con:actions>
            </con:stage>
            <con:stage name="ConsultaPorcLevenshtein">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:wsCallout>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7eed</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                        <con3:request>
                            <con3:body>ReqConsPorcentajeLev</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RspConsPorcentajeLev</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="ReqConsPorcentajeLev">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7eef</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaPorcentajeLevensteinIn"/>
                                        <con2:param name="requestHeader1">
                                            <con2:path>$header/aut:RequestHeader</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="PorcentajeLevenstein">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7eee</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/ConsultaPorcentajeLevensteinOut"/>
                                        <con2:param name="outputParameters1">
                                            <con2:path>$RspConsPorcentajeLev</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con4:actions>
            </con:stage>
            <con:stage name="ConsultarDelayTime">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb2"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:wsCallout>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7e42</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>obtenerParametrizacion</con3:operation>
                        <con3:request>
                            <con3:body>ReqObtParam</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RspObtParam</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="ReqObtParam">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7e44</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                        <con2:param name="nombreParametros">
                                            <con2:path>"VALIDACIONCUENTA.DELAYTIME"</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="delayTime">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7e43</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($RspObtParam/osb2:CONFIGURACIONES/osb2:CONFIGURACIONES_ITEM[osb2:NAME="VALIDACIONCUENTA.DELAYTIME"]/osb2:VALUE/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con4:actions>
            </con:stage>
            <con:stage name="ValidarCitiT24">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCuentaEquivalente" prefix="con"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb2"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultasType" prefix="con1"/>
                    <con2:varNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
                    <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaMapeoCuentaT24Citi" prefix="con2"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:wsCallout>
                        <con2:comment>Se invoca el servicio de negocio (procedimiento almacenado) encargado de buscar si la cuenta corresponde a una cuenta del CITI y en caso exitoso, retornar el número de cuenta de T24 asociado a a uenta del CITI</con2:comment>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d71</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaMapeoCuentaT24Citi/biz/consultaMapeoCuentaT24Citi_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>consultaMapeoCuentaT24Citi</con3:operation>
                        <con3:request>
                            <con3:body>requestConsultaMapeoCuentaT24Citi</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>responseConsultaMapeoCuentaT24Citi</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="requestConsultaMapeoCuentaT24Citi">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d73</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaMapeoCuentaT24CitiIn"/>
                                        <con2:param name="accountNumber">
                                            <con2:path>$accountNumberInput</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="consultaMapeoCuentaT24CitiSuccessIndicator">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d72</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:CODIGO_ERROR/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d70</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:string($consultaMapeoCuentaT24CitiSuccessIndicator) = 'SUCCESS'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="accountNumberT24Citi">
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6f</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:NUMERO_CUENTA_T24/text())</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:assign varName="ConsultaSuccessIndicator">
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6e</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>""</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:foreach>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d66</con2:id>
                                    <con3:variable>xmlForEach</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./parent/item</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>item</con3:value-variable>
                                    <con3:index-variable>itemIndex</con3:index-variable>
                                    <con3:total-variable>itemCount</con3:total-variable>
                                    <con3:actions>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6d</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions/>
                                            </con3:case>
                                            <con3:default>
                                                <con3:ifThenElse>
                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6c</con2:id>
                                                    <con3:case>
                                                        <con3:condition>
                                                            <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                            <con3:javaCallout varName="">
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6b</con2:id>
                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                <con3:method>public static void sleep(int)</con3:method>
                                                                <con3:expr>
                                                                    <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:javaCallout>
                                                        </con3:actions>
                                                    </con3:case>
                                                    <con3:default/>
                                                </con3:ifThenElse>
                                                <con3:wsCallout>
                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d67</con2:id>
                                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/ConsultaDetalleValidacionCuenta/biz/detalleValidacionCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                    <con3:operation>DetalleValidacionCuentaACH</con3:operation>
                                                    <con3:request>
                                                        <con3:body>REQDetallesCuenta</con3:body>
                                                    </con3:request>
                                                    <con3:response>
                                                        <con3:body>RSPDetallesCuenta</con3:body>
                                                    </con3:response>
                                                    <con3:requestTransform>
                                                        <con3:assign varName="REQDetallesCuenta">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d6a</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryTransform>
                                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaDetallesCuentaAchHNIn"/>
                                                                    <con2:param name="accountNumber">
                                                                        <con2:path>$accountNumberT24Citi</con2:path>
                                                                    </con2:param>
                                                                    <con2:param name="requestHeader1">
                                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                                    </con2:param>
                                                                </con2:xqueryTransform>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:requestTransform>
                                                    <con3:responseTransform>
                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d69</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="zeroRecords">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d68</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTACHType/ZERORECORDS)</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:responseTransform>
                                                </con3:wsCallout>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d65</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d64</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:assign varName="accountNameResponse">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d63</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTACHType/gWSACCOUNTLISTACHDetailType/mWSACCOUNTLISTACHDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:javaCallout varName="levensteinDistance">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d62</con2:id>
                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                            <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                            <con3:expr>
                                                                <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                            </con3:expr>
                                                            <con3:expr>
                                                                <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:javaCallout>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d61</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="totalFoundAccounts">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d60</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:assign varName="accountFound">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5f</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="errorMessage">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5e</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="totalFoundAccounts">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5d</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="accountFound">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5c</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5b</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>""</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:foreach>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d53</con2:id>
                                                <con3:variable>xmlForEach</con3:variable>
                                                <con3:expression>
                                                    <con2:xpathText>./parent/item</con2:xpathText>
                                                </con3:expression>
                                                <con3:value-variable>item</con3:value-variable>
                                                <con3:index-variable>itemIndex</con3:index-variable>
                                                <con3:total-variable>itemCount</con3:total-variable>
                                                <con3:actions>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d5a</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions/>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d59</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:javaCallout varName="">
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d58</con2:id>
                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                            <con3:method>public static void sleep(int)</con3:method>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:javaCallout>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default/>
                                                            </con3:ifThenElse>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d54</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQCuentaCancelada</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPCuentaCancelada</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQCuentaCancelada">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d57</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaCuentaCanceladaHNIn"/>
                                                                                <con2:param name="requestHeader1">
                                                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="account">
                                                                                    <con2:path>$accountNumberT24Citi</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d56</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:assign varName="zeroRecords">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d55</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:foreach>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d52</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d51</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="accountNameResponse">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d50</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4f</con2:id>
                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                        </con3:expr>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:javaCallout>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4e</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="totalFoundAccounts">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4d</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountFound">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4c</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountCancelled">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4b</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>'true'</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="errorMessage">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d4a</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="totalFoundAccounts">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d49</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountFound">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d48</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountCancelled">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d47</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>'true'</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d46</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>"No se encontró información de la cuenta."</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:assign varName="errorMessage">
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d45</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:assign varName="errorCode">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d44</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>$consultaMapeoCuentaT24CitiSuccessIndicator</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="errorMessage">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7d43</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:DESCRIPCION_ERROR/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:default>
                    </con3:ifThenElse>
                </con4:actions>
            </con:stage>
            <con:stage name="RemoverGuionesYCerosIzquierda">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config"/>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7c9c</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerGuiones(java.lang.String)</con3:method>
                        <con3:expr>
                            <con2:xqueryText>$accountNumberInput</con2:xqueryText>
                        </con3:expr>
                    </con3:javaCallout>
                    <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7c9b</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerCerosIzquierda(java.lang.String)</con3:method>
                        <con3:expr>
                            <con2:xqueryText>$accountNumber</con2:xqueryText>
                        </con3:expr>
                    </con3:javaCallout>
                </con4:actions>
            </con:stage>
            <con:stage name="ValidarModulo10">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCuentaEquivalente" prefix="con"/>
                    <con2:userNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:ifThenElse>
                        <con2:comment>Condición para determinar si se continúa buscando la cuenta:

Si totalFoundAccounts = 0: no se ha encontrado cuenta. Pero si no se envío nombre para realizar levenshtein, entonces se debe buscar a ver si existe otra coincidencia</con2:comment>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bbc</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 0 or $accountNameInput = ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:comment>Condicion para determinar si longitud de cuenta cumple con formato Abanks (entre 7 y 13 caracteres). Las opciones son:
* VERDADERO: Se evalúa si cuenta cumple con el resto de caracterísitcas Abanks
* FALSO: Se descarta que cuenta tenga formato Abanks</con2:comment>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bbb</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:string-length($accountNumber) >= 6 and fn:string-length($accountNumber) &lt;= 14</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb9</con2:id>
                                                <con3:service ref="Middleware/v2/BusinessServices/EvaluaCuentaAbanks/flow/EvaluaCuentaAbanks" xsi:type="con5:FlowRef" xmlns:con5="http://www.bea.com/alsb/flow/resources/config"/>
                                                <con3:operation>EvaluaCuentaAbanks</con3:operation>
                                                <con3:request>
                                                    <con3:body wrapped="false">ReqEvalCuentaAbanks</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body wrapped="false">RspEvalCuentaAbanks</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="ReqEvalCuentaAbanks">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bba</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/EvaluarCuentaAbanksIn"/>
                                                                <con2:param name="accountNumber">
                                                                    <con2:path>$accountNumber</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform/>
                                            </con3:wsCallout>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:assign varName="RspEvalCuentaAbanks">
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb8</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;con:EvaluaCuentaAbanksTypeResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:default>
                                </con3:ifThenElse>
                                <con3:foreach>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b84</con2:id>
                                    <con3:variable>RspEvalCuentaAbanks</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>account</con3:value-variable>
                                    <con3:index-variable>index</con3:index-variable>
                                    <con3:total-variable>count</con3:total-variable>
                                    <con3:actions>
                                        <con3:assign varName="mod10Indicator">
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb7</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/mod10IndicatorIn"/>
                                                    <con2:param name="index">
                                                        <con2:path>$index</con2:path>
                                                    </con2:param>
                                                    <con2:param name="ResponseEvaluaCuentaAbanks">
                                                        <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb6</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb5</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>""</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:foreach>
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7baa</con2:id>
                                                        <con3:variable>xmlForEach</con3:variable>
                                                        <con3:expression>
                                                            <con2:xpathText>./parent/item</con2:xpathText>
                                                        </con3:expression>
                                                        <con3:value-variable>item</con3:value-variable>
                                                        <con3:index-variable>itemIndex</con3:index-variable>
                                                        <con3:total-variable>itemCount</con3:total-variable>
                                                        <con3:actions>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb4</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions/>
                                                                </con3:case>
                                                                <con3:default>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb3</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:javaCallout varName="">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb2</con2:id>
                                                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                    <con3:method>public static void sleep(int)</con3:method>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:javaCallout>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default/>
                                                                    </con3:ifThenElse>
                                                                    <con3:wsCallout>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bab</con2:id>
                                                                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/ConsultaDetalleValidacionCuenta/biz/detalleValidacionCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                        <con3:operation>DetalleValidacionCuentaACH</con3:operation>
                                                                        <con3:request>
                                                                            <con3:body>REQDetallesCuenta</con3:body>
                                                                        </con3:request>
                                                                        <con3:response>
                                                                            <con3:body>RSPDetallesCuentaAux</con3:body>
                                                                        </con3:response>
                                                                        <con3:requestTransform>
                                                                            <con3:assign varName="REQDetallesCuenta">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb1</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryTransform>
                                                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaCuentaForEachAchHNIn"/>
                                                                                        <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                            <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                                        </con2:param>
                                                                                        <con2:param name="index">
                                                                                            <con2:path>$index</con2:path>
                                                                                        </con2:param>
                                                                                        <con2:param name="requestHeader1">
                                                                                            <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                        </con2:param>
                                                                                    </con2:xqueryTransform>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:requestTransform>
                                                                        <con3:responseTransform>
                                                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bb0</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($RSPDetallesCuentaAux/Status/successIndicator)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7baf</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTACHType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="zeroRecords">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bae</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTACHType/ZERORECORDS)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="RSPDetallesCuenta">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bad</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>$RSPDetallesCuentaAux</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="zeroRecords">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7bac</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTACHType/ZERORECORDS)</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:responseTransform>
                                                                    </con3:wsCallout>
                                                                </con3:default>
                                                            </con3:ifThenElse>
                                                        </con3:actions>
                                                    </con3:foreach>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba9</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba8</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions>
                                                                            <con3:assign varName="accountNameResponse">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba7</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTACHType/gWSACCOUNTLISTACHDetailType/mWSACCOUNTLISTACHDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:javaCallout varName="levensteinDistance">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba6</con2:id>
                                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                </con3:expr>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:javaCallout>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba5</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="totalFoundAccounts">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba4</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:assign varName="accountFound">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba3</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="errorMessage">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba2</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:actions>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:assign varName="totalFoundAccounts">
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba1</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="accountFound">
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7ba0</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:assign varName="ConsultaSuccessIndicator">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9f</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>""</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:foreach>
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b94</con2:id>
                                                                    <con3:variable>xmlForEach</con3:variable>
                                                                    <con3:expression>
                                                                        <con2:xpathText>./parent/item</con2:xpathText>
                                                                    </con3:expression>
                                                                    <con3:value-variable>item</con3:value-variable>
                                                                    <con3:index-variable>itemIndex</con3:index-variable>
                                                                    <con3:total-variable>itemCount</con3:total-variable>
                                                                    <con3:actions>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9e</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions/>
                                                                            </con3:case>
                                                                            <con3:default>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9d</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:javaCallout varName="">
                                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9c</con2:id>
                                                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                                <con3:method>public static void sleep(int)</con3:method>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:javaCallout>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default/>
                                                                                </con3:ifThenElse>
                                                                                <con3:wsCallout>
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b95</con2:id>
                                                                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                    <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                                    <con3:request>
                                                                                        <con3:body>REQCuentaCancelada</con3:body>
                                                                                    </con3:request>
                                                                                    <con3:response>
                                                                                        <con3:body>RSPCuentaCanceladaAux</con3:body>
                                                                                    </con3:response>
                                                                                    <con3:requestTransform>
                                                                                        <con3:assign varName="REQCuentaCancelada">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9b</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryTransform>
                                                                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaCuentaCanceladaForEachHNIn"/>
                                                                                                    <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                                        <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                                                    </con2:param>
                                                                                                    <con2:param name="index">
                                                                                                        <con2:path>$index</con2:path>
                                                                                                    </con2:param>
                                                                                                    <con2:param name="requestHeader1">
                                                                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                                    </con2:param>
                                                                                                </con2:xqueryTransform>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:requestTransform>
                                                                                    <con3:responseTransform>
                                                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b9a</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPCuentaCanceladaAux/Status/successIndicator)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:ifThenElse>
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b99</con2:id>
                                                                                            <con3:case>
                                                                                                <con3:condition>
                                                                                                    <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                                </con3:condition>
                                                                                                <con3:actions>
                                                                                                    <con3:assign varName="zeroRecords">
                                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b98</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                </con3:actions>
                                                                                            </con3:case>
                                                                                            <con3:default>
                                                                                                <con3:assign varName="RSPCuentaCancelada">
                                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b97</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>$RSPCuentaCanceladaAux</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                                <con3:assign varName="zeroRecords">
                                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b96</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                            </con3:default>
                                                                                        </con3:ifThenElse>
                                                                                    </con3:responseTransform>
                                                                                </con3:wsCallout>
                                                                            </con3:default>
                                                                        </con3:ifThenElse>
                                                                    </con3:actions>
                                                                </con3:foreach>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b93</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b92</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="accountNameResponse">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b91</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:javaCallout varName="levensteinDistance">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b90</con2:id>
                                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                            <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:javaCallout>
                                                                                        <con3:ifThenElse>
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8f</con2:id>
                                                                                            <con3:case>
                                                                                                <con3:condition>
                                                                                                    <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                                </con3:condition>
                                                                                                <con3:actions>
                                                                                                    <con3:assign varName="totalFoundAccounts">
                                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8e</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                    <con3:assign varName="accountFound">
                                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8d</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                    <con3:assign varName="accountCancelled">
                                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8c</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                </con3:actions>
                                                                                            </con3:case>
                                                                                            <con3:default>
                                                                                                <con3:assign varName="errorMessage">
                                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8b</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                            </con3:default>
                                                                                        </con3:ifThenElse>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="totalFoundAccounts">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b8a</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="accountFound">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b89</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="accountCancelled">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b88</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:actions>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b87</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>"Cumple mod 10 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:assign varName="errorMessage">
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b86</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:case>
                                            <con3:default>
                                                <con3:assign varName="errorMessage">
                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7b85</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryText>"No cumplió mod 10 ni mod 11."</con2:xqueryText>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con4:actions>
            </con:stage>
            <con:stage name="ValidarModulo11">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:ifThenElse>
                        <con2:comment>Condición para determinar si se continúa buscando:

Si totalFoundAccounts = 0: no se ha encontrado cuenta Pero si no se envió nombre para realizar levenshtein, entonces se debe buscar a ver si existe otra coincidencia siempre y cuando no se haya encontrado ya en los otros 2 casos anteriores</con2:comment>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a48</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 0 or ($accountNameInput = '' and xs:integer($totalFoundAccounts) &lt; 2)</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:javaCallout varName="mod11Response">
                                    <con2:comment>Validación de Módulo 11 (Formato T24)</con2:comment>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a47</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static boolean DigitoVerificadorMod11(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumber</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:ifThenElse>
                                    <con2:comment>Condición para determinar si cuenta cumple Módulo 11 (Formato T24). Las opciones son:
* VERDADERO: La cuenta se consulta en T24 sin ninguna modificación adicional
* FALSO: La cuenta se consulta siguiendo paráemtros Abanks (0, 1 o 2 ceros adicionales a la izquierda)</con2:comment>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a46</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$mod11Response = 'true'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a45</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>""</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:foreach>
                                                <con2:comment>Ciclo que consulta cuenta hasta 3 veces en T24 ya que en ocasiones se pierde la comunicación entre Weblogic y T24</con2:comment>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3a</con2:id>
                                                <con3:variable>xmlForEach</con3:variable>
                                                <con3:expression>
                                                    <con2:xpathText>./parent/item</con2:xpathText>
                                                </con3:expression>
                                                <con3:value-variable>item</con3:value-variable>
                                                <con3:index-variable>itemIndex</con3:index-variable>
                                                <con3:total-variable>itemCount</con3:total-variable>
                                                <con3:actions>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a44</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions/>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a43</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:javaCallout varName="">
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a42</con2:id>
                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                            <con3:method>public static void sleep(int)</con3:method>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:javaCallout>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default/>
                                                            </con3:ifThenElse>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3b</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/ConsultaDetalleValidacionCuenta/biz/detalleValidacionCuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>DetalleValidacionCuentaACH</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQDetallesCuenta</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPDetallesCuentaAux</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQDetallesCuenta">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a41</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaDetallesCuentaAchHNIn"/>
                                                                                <con2:param name="accountNumber">
                                                                                    <con2:path>$accountNumber</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="requestHeader1">
                                                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a40</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPDetallesCuentaAux/Status/successIndicator)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3f</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTACHType/ZERORECORDS) != ''</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="zeroRecords">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3e</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTACHType/ZERORECORDS)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="RSPDetallesCuenta">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3d</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$RSPDetallesCuentaAux</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="zeroRecords">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a3c</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTACHType/ZERORECORDS)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:foreach>
                                            <con3:ifThenElse>
                                                <con2:comment>Condición para determinar si cuenta fue encontrado en paso anterior. Las opciones son:
* VERDADERO: La cuenta fue encontrada. Se procede con funcionalidad de validación de cuenta
* FALSO: La cuenta no fue encontrada. Se procede a validar si se debe buscar cuenta en módulo de cuentas canceladas.</con2:comment>
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a39</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:ifThenElse>
                                                            <con2:comment>Condición para determinar si el request incluye nombre de la cuenta para validación adicional. Las opciones son:
* VERDADERO: Request incluye nombre de cuenta. Se procede a comparar nombre de cuenta con nombre de request con algoritmo LEVENSHTEIN
* FALSO: Se devuelve cuenta que se encontró en paso anterior.</con2:comment>
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a38</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="accountNameResponse">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a37</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTACHType/gWSACCOUNTLISTACHDetailType/mWSACCOUNTLISTACHDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a36</con2:id>
                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                        </con3:expr>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:javaCallout>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a35</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="totalFoundAccounts">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a34</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountFound">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a33</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="errorMessage">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a32</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="totalFoundAccounts">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a31</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountFound">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a30</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTACHType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2f</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>""</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:foreach>
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a24</con2:id>
                                                            <con3:variable>xmlForEach</con3:variable>
                                                            <con3:expression>
                                                                <con2:xpathText>./parent/item</con2:xpathText>
                                                            </con3:expression>
                                                            <con3:value-variable>item</con3:value-variable>
                                                            <con3:index-variable>itemIndex</con3:index-variable>
                                                            <con3:total-variable>itemCount</con3:total-variable>
                                                            <con3:actions>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2e</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions/>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2d</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions>
                                                                                    <con3:javaCallout varName="">
                                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2c</con2:id>
                                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                        <con3:method>public static void sleep(int)</con3:method>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:javaCallout>
                                                                                </con3:actions>
                                                                            </con3:case>
                                                                            <con3:default/>
                                                                        </con3:ifThenElse>
                                                                        <con3:wsCallout>
                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a25</con2:id>
                                                                            <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                            <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                            <con3:request>
                                                                                <con3:body>REQCuentaCancelada</con3:body>
                                                                            </con3:request>
                                                                            <con3:response>
                                                                                <con3:body>RSPCuentaCanceladaAux</con3:body>
                                                                            </con3:response>
                                                                            <con3:requestTransform>
                                                                                <con3:assign varName="REQCuentaCancelada">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2b</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryTransform>
                                                                                            <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/consultaCuentaCanceladaHNIn"/>
                                                                                            <con2:param name="requestHeader1">
                                                                                                <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                            </con2:param>
                                                                                            <con2:param name="account">
                                                                                                <con2:path>$accountNumber</con2:path>
                                                                                            </con2:param>
                                                                                        </con2:xqueryTransform>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:requestTransform>
                                                                            <con3:responseTransform>
                                                                                <con3:assign varName="ConsultaSuccessIndicator">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a2a</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($RSPCuentaCanceladaAux/Status/successIndicator)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a29</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:assign varName="zeroRecords">
                                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a28</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default>
                                                                                        <con3:assign varName="RSPCuentaCancelada">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a27</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$RSPCuentaCanceladaAux</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:assign varName="zeroRecords">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a26</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:default>
                                                                                </con3:ifThenElse>
                                                                            </con3:responseTransform>
                                                                        </con3:wsCallout>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:foreach>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a23</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a22</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="accountNameResponse">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a21</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:javaCallout varName="levensteinDistance">
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a20</con2:id>
                                                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:javaCallout>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1f</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:assign varName="totalFoundAccounts">
                                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1e</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                            <con3:assign varName="accountFound">
                                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1d</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                            <con3:assign varName="accountCancelled">
                                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1c</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default>
                                                                                        <con3:assign varName="errorMessage">
                                                                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1b</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:default>
                                                                                </con3:ifThenElse>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="totalFoundAccounts">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a1a</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="accountFound">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a19</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="accountCancelled">
                                                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a18</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="errorMessage">
                                                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a17</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>"Cumple mod 11 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7a16</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con4:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="HN01_ValidaCuentaACH_response">
            <con:stage name="HN_proxyResponse">
                <con4:context xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaAchType" prefix="val1"/>
                </con4:context>
                <con4:actions xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/pipeline/config">
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-799b</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 1</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="header" contents-only="true">
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-799a</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>Success&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7999</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$accountCancelled = 'false'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace contents-only="true" varName="body">
                                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7998</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/ValidacionCuentaAchOut"/>
                                                        <con2:param name="accountFound">
                                                            <con2:path>$accountFound</con2:path>
                                                        </con2:param>
                                                        <con2:param name="RSPDetallesCuenta">
                                                            <con2:path>$RSPDetallesCuenta</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con3:expr>
                                            </con3:replace>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7997</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuentaACH/xq/ValidacionCuentaCanceladaOut"/>
                                                    <con2:param name="accountFound">
                                                        <con2:path>$accountFound</con2:path>
                                                    </con2:param>
                                                    <con2:param name="consultadecuentascanceladasResponse1">
                                                        <con2:path>$RSPCuentaCancelada</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace varName="header" contents-only="true">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7996</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	
		{
			if (xs:integer($totalFoundAccounts) > 1) then 
				(
					<successIndicator>ERROR</successIndicator>,
					<messages>Se ha encontrado más de una cuenta asociada</messages>
				)
			else
				(
					<successIndicator>NO RECORDS</successIndicator>,
					<messages>{ $errorMessage }</messages>
				)
		}	
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-1315910511938417762--5788f33f.195f3f3d0e1.-7995</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;val:validacionCuentaAchResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                </con4:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="HN01_ValidaCuentaACH">
                <con:request>HN01_ValidaCuentaACH_request</con:request>
                <con:response>HN01_ValidaCuentaACH_response</con:response>
            </con:pipeline-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>