<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Middleware/v3/Resources/ValidacionCuenta/wsdl/validacionCuentaPS"/>
            <con:binding>
                <con:name>validacionCuentaPSSOAP</con:name>
                <con:namespace>http://www.ficohsa.com.hn/middleware.services/validacionCuentaPS/</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:monitoring enabled="true" aggregationInterval="360" level="action"/>
            <oper:tracingEnabled>false</oper:tracingEnabled>
            <oper:reporting>true</oper:reporting>
            <oper:logging enabled="true" level="debug"/>
            <oper:sla-alerting enabled="true" level="normal"/>
            <oper:pipeline-alerting enabled="true" level="normal"/>
        </oper:operations>
    </con:coreEntry>
    <con1:router errorHandler="_onErrorHandler-8978621965144933415-63d099ef.1400bdf707f.-7f44" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con="http://www.bea.com/wli/sb/services/security/config" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
        <con1:pipeline type="error" name="_onErrorHandler-8978621965144933415-63d099ef.1400bdf707f.-7f44">
            <con1:stage name="ManejoError">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="errorCode">
                        <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7f36</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($fault/ctx:errorCode/text())</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="errorMessage">
                        <con2:id>_ActionId-4917021601587617309--564dd0d0.15062ae0ca0.-7f19</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($fault/ctx:reason/text())</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3966743769307152724-4a9ba1f0.158209eaad7.-7fe4</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:string($fault/ctx:errorCode/text()) = "BEA-382505"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="header" contents-only="true">
                                    <con2:id>_ActionId-3966743769307152724-4a9ba1f0.158209eaad7.-7fa6</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="Middleware/v2/Resources/Genericos/mapeoErrorValidate"/>
                                            <con2:param name="anyType1">
                                                <con2:path>$fault</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:wsCallout>
                                <con2:id>_ActionId-3966743769307152724-4a9ba1f0.158209eaad7.-7fde</con2:id>
                                <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con3:operation>mapeoErrores</con3:operation>
                                <con3:request>
                                    <con3:body>rqMapeoErrores</con3:body>
                                </con3:request>
                                <con3:response>
                                    <con3:body>rpMapeoErrores</con3:body>
                                </con3:response>
                                <con3:requestTransform>
                                    <con3:assign varName="rqMapeoErrores">
                                        <con2:id>_ActionId-3966743769307152724-4a9ba1f0.158209eaad7.-7fe0</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                                                <con2:param name="CODIGO_ERROR">
                                                    <con2:path>$errorCode</con2:path>
                                                </con2:param>
                                                <con2:param name="MENSAJE_ERROR">
                                                    <con2:path>fn:concat("FICBCO0153","$#$",$errorMessage)</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:assign>
                                </con3:requestTransform>
                                <con3:responseTransform>
                                    <con3:replace contents-only="true" varName="header">
                                        <con2:id>_ActionId-3966743769307152724-4a9ba1f0.158209eaad7.-7fdf</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                                                <con2:param name="mapeoErroresResponse1">
                                                    <con2:path>$rpMapeoErrores</con2:path>
                                                </con2:param>
                                                <con2:param name="successIndicator">
                                                    <con2:path>$errorCode</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:replace>
                                </con3:responseTransform>
                            </con3:wsCallout>
                        </con3:default>
                    </con3:ifThenElse>
                    <con3:replace contents-only="true" varName="body">
                        <con2:id>_ActionId-8978621965144933415-63d099ef.1400bdf707f.-7ed6</con2:id>
                        <con3:expr>
                            <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                        </con3:expr>
                    </con3:replace>
                    <con2:reply>
                        <con2:id>_ActionId-8978621965144933415-63d099ef.1400bdf707f.-7e9c</con2:id>
                    </con2:reply>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="Default_ValidarCuenta_request">
            <con1:stage name="FlujoEntrada">
                <con1:context/>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="Default_ValidarCuenta_response">
            <con1:stage name="FlujoSalida">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultaRecaudoTypes" prefix="con"/>
                </con1:context>
                <con1:actions>
                    <con2:Error xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7148230163448611608--447b7039.150cf8300fc.-7505</con4:id>
                        <con2:errCode>MW-0008</con2:errCode>
                        <con2:message>SERVICE NOT IMPLEMENTED YET FOR THIS COUNTRY/COMPANY</con2:message>
                    </con2:Error>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="HN01_ValidaCuenta_request">
            <con1:stage name="IniciarVariables">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="totalFoundAccounts">
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b5a</con2:id>
                        <con3:expr>
                            <con2:xqueryText>0</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountFound">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5dc6</con2:id>
                        <con3:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountCancelled">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5dbc</con2:id>
                        <con3:expr>
                            <con2:xqueryText>"false"</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="errorMessage">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db4</con2:id>
                        <con3:expr>
                            <con2:xqueryText>"false"</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountNumberInput">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db2</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:string($body/val:validacionCuenta/ACCOUNT_NUMBER/text())</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="checkCancelledInput">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db0</con2:id>
                        <con3:expr>
                            <con2:xqueryText>data($body/val:validacionCuenta/CHECK_CANCELLED_YES_NO)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="accountNameInput">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5dae</con2:id>
                        <con3:expr>
                            <con2:xqueryText>normalize-space(upper-case(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text())))</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="xmlForEach">
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5da8</con2:id>
                        <con3:expr>
                            <con2:xqueryText><![CDATA[<body>
	<parent>
		<item>1</item>
		<item>2</item>
		<item>3</item>
	</parent>
</body>]]></con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ConsultaPorcLevenshtein">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db6</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                        <con3:request>
                            <con3:body>ReqConsPorcentajeLev</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RspConsPorcentajeLev</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="ReqConsPorcentajeLev">
                                <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db8</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaPorcentajeLevensteinIn"/>
                                        <con2:param name="requestHeader1">
                                            <con2:path>$header/aut:RequestHeader</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="PorcentajeLevenstein">
                                <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5db7</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinOut"/>
                                        <con2:param name="outputParameters1">
                                            <con2:path>$RspConsPorcentajeLev</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ConsultarDelayTime">
                <con1:context>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb2"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5da0</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/general/Resources/ObtenerParametrizacion/ObtenerParametrizacion" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>obtenerParametrizacion</con3:operation>
                        <con3:request>
                            <con3:body>ReqObtParam</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>RspObtParam</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="ReqObtParam">
                                <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5da2</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/Business_Resources/general/Parametrizacion/obtenerParametrizacionIn"/>
                                        <con2:param name="nombreParametros">
                                            <con2:path>"VALIDACIONCUENTA.DELAYTIME"</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="delayTime">
                                <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5da1</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($RspObtParam/osb2:CONFIGURACIONES/osb2:CONFIGURACIONES_ITEM[osb2:NAME="VALIDACIONCUENTA.DELAYTIME"]/osb2:VALUE/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ValidarCitiT24">
                <con1:context>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCuentaEquivalente" prefix="con"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/ORA_BANK/OSB_GET_CONFIG/" prefix="osb2"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultasType" prefix="con1"/>
                    <con2:varNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:varNsDecl namespace="T24WebServicesImpl" prefix="t24"/>
                    <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaMapeoCuentaT24Citi" prefix="con2"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:comment>Se invoca el servicio de negocio (procedimiento almacenado) encargado de buscar si la cuenta corresponde a una cuenta del CITI y en caso exitoso, retornar el número de cuenta de T24 asociado a a uenta del CITI</con2:comment>
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7949</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaMapeoCuentaT24Citi/biz/consultaMapeoCuentaT24Citi_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>consultaMapeoCuentaT24Citi</con3:operation>
                        <con3:request>
                            <con3:body>requestConsultaMapeoCuentaT24Citi</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>responseConsultaMapeoCuentaT24Citi</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="requestConsultaMapeoCuentaT24Citi">
                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-794b</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/consultaMapeoCuentaT24CitiIn"/>
                                        <con2:param name="accountNumber">
                                            <con2:path>$accountNumberInput</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:assign varName="consultaMapeoCuentaT24CitiSuccessIndicator">
                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-794a</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:CODIGO_ERROR/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:responseTransform>
                    </con3:wsCallout>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-791e</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:string($consultaMapeoCuentaT24CitiSuccessIndicator) = 'SUCCESS'</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="accountNumberT24Citi">
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-791d</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:NUMERO_CUENTA_T24/text())</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:assign varName="ConsultaSuccessIndicator">
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-791c</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>""</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:foreach>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7914</con2:id>
                                    <con3:variable>xmlForEach</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./parent/item</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>item</con3:value-variable>
                                    <con3:index-variable>itemIndex</con3:index-variable>
                                    <con3:total-variable>itemCount</con3:total-variable>
                                    <con3:actions>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-791b</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions/>
                                            </con3:case>
                                            <con3:default>
                                                <con3:ifThenElse>
                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-791a</con2:id>
                                                    <con3:case>
                                                        <con3:condition>
                                                            <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                            <con3:javaCallout varName="">
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7919</con2:id>
                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                <con3:method>public static void sleep(int)</con3:method>
                                                                <con3:expr>
                                                                    <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:javaCallout>
                                                        </con3:actions>
                                                    </con3:case>
                                                    <con3:default/>
                                                </con3:ifThenElse>
                                                <con3:wsCallout>
                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7915</con2:id>
                                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                    <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                                    <con3:request>
                                                        <con3:body>REQDetallesCuenta</con3:body>
                                                    </con3:request>
                                                    <con3:response>
                                                        <con3:body>RSPDetallesCuenta</con3:body>
                                                    </con3:response>
                                                    <con3:requestTransform>
                                                        <con3:assign varName="REQDetallesCuenta">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7918</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryTransform>
                                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaDetallesCuentaHNIn"/>
                                                                    <con2:param name="accountNumber">
                                                                        <con2:path>$accountNumberT24Citi</con2:path>
                                                                    </con2:param>
                                                                    <con2:param name="requestHeader1">
                                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                                    </con2:param>
                                                                </con2:xqueryTransform>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:requestTransform>
                                                    <con3:responseTransform>
                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7917</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>data($RSPDetallesCuenta/Status/successIndicator)</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:assign varName="zeroRecords">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7916</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:responseTransform>
                                                </con3:wsCallout>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7913</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7912</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:assign varName="accountNameResponse">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7911</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:javaCallout varName="levensteinDistance">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7910</con2:id>
                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                            <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                            <con3:expr>
                                                                <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                            </con3:expr>
                                                            <con3:expr>
                                                                <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:javaCallout>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790f</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="totalFoundAccounts">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78c7</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:assign varName="accountFound">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790e</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="errorMessage">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790d</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="totalFoundAccounts">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78dd</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:assign varName="accountFound">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790c</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790b</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>""</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:foreach>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7903</con2:id>
                                                <con3:variable>xmlForEach</con3:variable>
                                                <con3:expression>
                                                    <con2:xpathText>./parent/item</con2:xpathText>
                                                </con3:expression>
                                                <con3:value-variable>item</con3:value-variable>
                                                <con3:index-variable>itemIndex</con3:index-variable>
                                                <con3:total-variable>itemCount</con3:total-variable>
                                                <con3:actions>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-790a</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions/>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7909</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:javaCallout varName="">
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7908</con2:id>
                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                            <con3:method>public static void sleep(int)</con3:method>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:javaCallout>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default/>
                                                            </con3:ifThenElse>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7904</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQCuentaCancelada</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPCuentaCancelada</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQCuentaCancelada">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7907</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaCuentaCanceladaHNIn"/>
                                                                                <con2:param name="account">
                                                                                    <con2:path>$accountNumberT24Citi</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="requestHeader1">
                                                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7906</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPCuentaCancelada/Status/successIndicator)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:assign varName="zeroRecords">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7905</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:foreach>
                                            <con3:ifThenElse>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7902</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7901</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="accountNameResponse">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7900</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78ff</con2:id>
                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                        </con3:expr>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:javaCallout>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78fe</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="totalFoundAccounts">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7720</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountFound">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78fd</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountCancelled">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78fc</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>'true'</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="errorMessage">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78fb</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="totalFoundAccounts">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-77ff</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountFound">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78fa</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountCancelled">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7803</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>'true'</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78f8</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>"No se encontró información de la cuenta."</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:assign varName="errorMessage">
                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78f7</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:assign varName="errorCode">
                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78f6</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>$consultaMapeoCuentaT24CitiSuccessIndicator</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con3:assign varName="errorMessage">
                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-78f5</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>fn:string($responseConsultaMapeoCuentaT24Citi/con2:DESCRIPCION_ERROR/text())</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="RemoverGuionesYCerosIzquierda">
                <con1:context/>
                <con1:actions>
                    <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7d08</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerGuiones(java.lang.String)</con3:method>
                        <con3:expr>
                            <con2:xqueryText>$accountNumberInput</con2:xqueryText>
                        </con3:expr>
                    </con3:javaCallout>
                    <con3:javaCallout varName="accountNumber">
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7d07</con2:id>
                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                        <con3:method>public static java.lang.String removerCerosIzquierda(java.lang.String)</con3:method>
                        <con3:expr>
                            <con2:xqueryText>$accountNumber</con2:xqueryText>
                        </con3:expr>
                    </con3:javaCallout>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ValidarModulo10">
                <con1:context>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaCuentaEquivalente" prefix="con"/>
                    <con2:userNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:comment>Condición para determinar si se continúa buscando la cuenta:

Si totalFoundAccounts = 0: no se ha encontrado cuenta. Pero si no se envío nombre para realizar levenshtein, entonces se debe buscar a ver si existe otra coincidencia</con2:comment>
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e4c</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 0 or $accountNameInput = ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:comment>Condicion para determinar si longitud de cuenta cumple con formato Abanks (entre 7 y 13 caracteres). Las opciones son:
* VERDADERO: Se evalúa si cuenta cumple con el resto de caracterísitcas Abanks
* FALSO: Se descarta que cuenta tenga formato Abanks</con2:comment>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e4b</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:string-length($accountNumber) >= 6 and fn:string-length($accountNumber) &lt;= 14</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:wsCallout>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e49</con2:id>
                                                <con3:service ref="Middleware/v2/BusinessServices/EvaluaCuentaAbanks/flow/EvaluaCuentaAbanks" xsi:type="con4:FlowRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:con4="http://www.bea.com/alsb/flow/resources/config"/>
                                                <con3:operation>EvaluaCuentaAbanks</con3:operation>
                                                <con3:request>
                                                    <con3:body>ReqEvalCuentaAbanks</con3:body>
                                                </con3:request>
                                                <con3:response>
                                                    <con3:body>RspEvalCuentaAbanks</con3:body>
                                                </con3:response>
                                                <con3:requestTransform>
                                                    <con3:assign varName="ReqEvalCuentaAbanks">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e4a</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryTransform>
                                                                <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/EvaluarCuentaAbanksIn"/>
                                                                <con2:param name="accountNumber">
                                                                    <con2:path>$accountNumber</con2:path>
                                                                </con2:param>
                                                            </con2:xqueryTransform>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:requestTransform>
                                                <con3:responseTransform/>
                                            </con3:wsCallout>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:assign varName="RspEvalCuentaAbanks">
                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e48</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;con:EvaluaCuentaAbanksTypeResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:default>
                                </con3:ifThenElse>
                                <con3:foreach>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e1d</con2:id>
                                    <con3:variable>RspEvalCuentaAbanks</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>account</con3:value-variable>
                                    <con3:index-variable>index</con3:index-variable>
                                    <con3:total-variable>count</con3:total-variable>
                                    <con3:actions>
                                        <con3:assign varName="mod10Indicator">
                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e47</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/mod10IndicatorIn"/>
                                                    <con2:param name="ResponseEvaluaCuentaAbanks">
                                                        <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                    </con2:param>
                                                    <con2:param name="index">
                                                        <con2:path>$index</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e46</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e45</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>""</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                    <con3:foreach>
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e3d</con2:id>
                                                        <con3:variable>xmlForEach</con3:variable>
                                                        <con3:expression>
                                                            <con2:xpathText>./parent/item</con2:xpathText>
                                                        </con3:expression>
                                                        <con3:value-variable>item</con3:value-variable>
                                                        <con3:index-variable>itemIndex</con3:index-variable>
                                                        <con3:total-variable>itemCount</con3:total-variable>
                                                        <con3:actions>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e44</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions/>
                                                                </con3:case>
                                                                <con3:default>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e43</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:javaCallout varName="">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e42</con2:id>
                                                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                    <con3:method>public static void sleep(int)</con3:method>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:javaCallout>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default/>
                                                                    </con3:ifThenElse>
                                                                    <con3:wsCallout>
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e3e</con2:id>
                                                                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                        <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                                                        <con3:request>
                                                                            <con3:body>REQDetallesCuenta</con3:body>
                                                                        </con3:request>
                                                                        <con3:response>
                                                                            <con3:body>RSPDetallesCuentaAux</con3:body>
                                                                        </con3:response>
                                                                        <con3:requestTransform>
                                                                            <con3:assign varName="REQDetallesCuenta">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e41</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryTransform>
                                                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaCuentaForEachHNIn"/>
                                                                                        <con2:param name="index">
                                                                                            <con2:path>$index</con2:path>
                                                                                        </con2:param>
                                                                                        <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                            <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                                        </con2:param>
                                                                                        <con2:param name="requestHeader1">
                                                                                            <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                        </con2:param>
                                                                                    </con2:xqueryTransform>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:requestTransform>
                                                                        <con3:responseTransform>
                                                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e40</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($RSPDetallesCuentaAux/Status/successIndicator)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7e57</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="zeroRecords">
                                                                                            <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7e56</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="RSPDetallesCuenta">
                                                                                        <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7e55</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>$RSPDetallesCuentaAux</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="zeroRecords">
                                                                                        <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7e54</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:responseTransform>
                                                                    </con3:wsCallout>
                                                                </con3:default>
                                                            </con3:ifThenElse>
                                                        </con3:actions>
                                                    </con3:foreach>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e3c</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e3b</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions>
                                                                            <con3:assign varName="accountNameResponse">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e3a</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:javaCallout varName="levensteinDistance">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e39</con2:id>
                                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                </con3:expr>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:javaCallout>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e38</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="totalFoundAccounts">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76e4</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:assign varName="accountFound">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e37</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="errorMessage">
                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e36</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:actions>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:assign varName="totalFoundAccounts">
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76e0</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="accountFound">
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e35</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions>
                                                                <con3:assign varName="ConsultaSuccessIndicator">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bd2</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>""</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:foreach>
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc2</con2:id>
                                                                    <con3:variable>xmlForEach</con3:variable>
                                                                    <con3:expression>
                                                                        <con2:xpathText>./parent/item</con2:xpathText>
                                                                    </con3:expression>
                                                                    <con3:value-variable>item</con3:value-variable>
                                                                    <con3:index-variable>itemIndex</con3:index-variable>
                                                                    <con3:total-variable>itemCount</con3:total-variable>
                                                                    <con3:actions>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc9</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions/>
                                                                            </con3:case>
                                                                            <con3:default>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc8</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:javaCallout varName="">
                                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc7</con2:id>
                                                                                                <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                                <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                                <con3:method>public static void sleep(int)</con3:method>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:javaCallout>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default/>
                                                                                </con3:ifThenElse>
                                                                                <con3:wsCallout>
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc3</con2:id>
                                                                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                    <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                                    <con3:request>
                                                                                        <con3:body>REQCuentaCancelada</con3:body>
                                                                                    </con3:request>
                                                                                    <con3:response>
                                                                                        <con3:body>RSPCuentaCanceladaAux</con3:body>
                                                                                    </con3:response>
                                                                                    <con3:requestTransform>
                                                                                        <con3:assign varName="REQCuentaCancelada">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc6</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryTransform>
                                                                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaCuentaCanceladaForEachHNIn"/>
                                                                                                    <con2:param name="index">
                                                                                                        <con2:path>$index</con2:path>
                                                                                                    </con2:param>
                                                                                                    <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                                        <con2:path>$RspEvalCuentaAbanks</con2:path>
                                                                                                    </con2:param>
                                                                                                    <con2:param name="requestHeader1">
                                                                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                                    </con2:param>
                                                                                                </con2:xqueryTransform>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:requestTransform>
                                                                                    <con3:responseTransform>
                                                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bc5</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPCuentaCanceladaAux/Status/successIndicator)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:ifThenElse>
                                                                                            <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7dfa</con2:id>
                                                                                            <con3:case>
                                                                                                <con3:condition>
                                                                                                    <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                                </con3:condition>
                                                                                                <con3:actions>
                                                                                                    <con3:assign varName="zeroRecords">
                                                                                                        <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7df5</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                </con3:actions>
                                                                                            </con3:case>
                                                                                            <con3:default>
                                                                                                <con3:assign varName="RSPCuentaCancelada">
                                                                                                    <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7df8</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>$RSPCuentaCanceladaAux</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                                <con3:assign varName="zeroRecords">
                                                                                                    <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7da1</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                            </con3:default>
                                                                                        </con3:ifThenElse>
                                                                                    </con3:responseTransform>
                                                                                </con3:wsCallout>
                                                                            </con3:default>
                                                                        </con3:ifThenElse>
                                                                    </con3:actions>
                                                                </con3:foreach>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb6</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions>
                                                                            <con3:ifThenElse>
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb5</con2:id>
                                                                                <con3:case>
                                                                                    <con3:condition>
                                                                                        <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                                    </con3:condition>
                                                                                    <con3:actions>
                                                                                        <con3:assign varName="accountNameResponse">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb4</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:javaCallout varName="levensteinDistance">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb3</con2:id>
                                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                            <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:javaCallout>
                                                                                        <con3:ifThenElse>
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb2</con2:id>
                                                                                            <con3:case>
                                                                                                <con3:condition>
                                                                                                    <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                                </con3:condition>
                                                                                                <con3:actions>
                                                                                                    <con3:assign varName="totalFoundAccounts">
                                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76d8</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                    <con3:assign varName="accountFound">
                                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb1</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                    <con3:assign varName="accountCancelled">
                                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bb0</con2:id>
                                                                                                        <con3:expr>
                                                                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                                                                        </con3:expr>
                                                                                                    </con3:assign>
                                                                                                </con3:actions>
                                                                                            </con3:case>
                                                                                            <con3:default>
                                                                                                <con3:assign varName="errorMessage">
                                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7baf</con2:id>
                                                                                                    <con3:expr>
                                                                                                        <con2:xqueryText>"no pasó validación Levenshtein para el nombre nombre "</con2:xqueryText>
                                                                                                    </con3:expr>
                                                                                                </con3:assign>
                                                                                            </con3:default>
                                                                                        </con3:ifThenElse>
                                                                                    </con3:actions>
                                                                                </con3:case>
                                                                                <con3:default>
                                                                                    <con3:assign varName="totalFoundAccounts">
                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76dc</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="accountFound">
                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bae</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                    <con3:assign varName="accountCancelled">
                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bad</con2:id>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>'true'</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:assign>
                                                                                </con3:default>
                                                                            </con3:ifThenElse>
                                                                        </con3:actions>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bac</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>"Cumple mod 10 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:assign varName="errorMessage">
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7bd4</con2:id>
                                                                <con3:expr>
                                                                    <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                                                </con3:expr>
                                                            </con3:assign>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:case>
                                            <con3:default>
                                                <con3:assign varName="errorMessage">
                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e1e</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryText>"No cumplió mod 10 ni mod 11."</con2:xqueryText>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ValidarModulo11">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:comment>Condición para determinar si se continúa buscando:

Si totalFoundAccounts = 0: no se ha encontrado cuenta Pero si no se envió nombre para realizar levenshtein, entonces se debe buscar a ver si existe otra coincidencia siempre y cuando no se haya encontrado ya en los otros 2 casos anteriores</con2:comment>
                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ecd</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 0 or ($accountNameInput = '' and xs:integer($totalFoundAccounts) &lt; 2)</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:javaCallout varName="mod11Response">
                                    <con2:comment>Validación de Módulo 11 (Formato T24)</con2:comment>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ecb</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static boolean DigitoVerificadorMod11(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumber</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:ifThenElse>
                                    <con2:comment>Condición para determinar si cuenta cumple Módulo 11 (Formato T24). Las opciones son:
* VERDADERO: La cuenta se consulta en T24 sin ninguna modificación adicional
* FALSO: La cuenta se consulta siguiendo paráemtros Abanks (0, 1 o 2 ceros adicionales a la izquierda)</con2:comment>
                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ea3</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$mod11Response = 'true'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:assign varName="ConsultaSuccessIndicator">
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7640</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>""</con2:xqueryText>
                                                </con3:expr>
                                            </con3:assign>
                                            <con3:foreach>
                                                <con2:comment>Ciclo que consulta cuenta hasta 3 veces en T24 ya que en ocasiones se pierde la comunicación entre Weblogic y T24</con2:comment>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e9b</con2:id>
                                                <con3:variable>xmlForEach</con3:variable>
                                                <con3:expression>
                                                    <con2:xpathText>./parent/item</con2:xpathText>
                                                </con3:expression>
                                                <con3:value-variable>item</con3:value-variable>
                                                <con3:index-variable>itemIndex</con3:index-variable>
                                                <con3:total-variable>itemCount</con3:total-variable>
                                                <con3:actions>
                                                    <con3:ifThenElse>
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ea2</con2:id>
                                                        <con3:case>
                                                            <con3:condition>
                                                                <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                            </con3:condition>
                                                            <con3:actions/>
                                                        </con3:case>
                                                        <con3:default>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ea1</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:javaCallout varName="">
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ea0</con2:id>
                                                                            <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                            <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                            <con3:method>public static void sleep(int)</con3:method>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:javaCallout>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default/>
                                                            </con3:ifThenElse>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e9c</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>Consultadedetallesdelacuenta</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQDetallesCuenta</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPDetallesCuentaAux</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQDetallesCuenta">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e9f</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaDetallesCuentaHNIn"/>
                                                                                <con2:param name="accountNumber">
                                                                                    <con2:path>$accountNumber</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="requestHeader1">
                                                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="ConsultaSuccessIndicator">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e9e</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPDetallesCuentaAux/Status/successIndicator)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7f24</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTType/ZERORECORDS) != ''</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="zeroRecords">
                                                                                    <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7f22</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($RSPDetallesCuentaAux/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="RSPDetallesCuenta">
                                                                                <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7eea</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>$RSPDetallesCuentaAux</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="zeroRecords">
                                                                                <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7eb1</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($RSPDetallesCuenta/WSACCOUNTLISTType/ZERORECORDS)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                        </con3:default>
                                                    </con3:ifThenElse>
                                                </con3:actions>
                                            </con3:foreach>
                                            <con3:ifThenElse>
                                                <con2:comment>Condición para determinar si cuenta fue encontrado en paso anterior. Las opciones son:
* VERDADERO: La cuenta fue encontrada. Se procede con funcionalidad de validación de cuenta
* FALSO: La cuenta no fue encontrada. Se procede a validar si se debe buscar cuenta en módulo de cuentas canceladas.</con2:comment>
                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e9a</con2:id>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:ifThenElse>
                                                            <con2:comment>Condición para determinar si el request incluye nombre de la cuenta para validación adicional. Las opciones son:
* VERDADERO: Request incluye nombre de cuenta. Se procede a comparar nombre de cuenta con nombre de request con algoritmo LEVENSHTEIN
* FALSO: Se devuelve cuenta que se encontró en paso anterior.</con2:comment>
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e99</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:assign varName="accountNameResponse">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e98</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPDetallesCuenta/WSACCOUNTLISTType/gWSACCOUNTLISTDetailType/mWSACCOUNTLISTDetailType/SHORTTITLE/text())))</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e97</con2:id>
                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                        </con3:expr>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:javaCallout>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e96</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="totalFoundAccounts">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-763e</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:assign varName="accountFound">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e95</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="errorMessage">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e94</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="totalFoundAccounts">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-732e</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                                <con3:assign varName="accountFound">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7e93</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>data($REQDetallesCuenta/WSACCOUNTLISTType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:case>
                                                    <con3:condition>
                                                        <con2:xqueryText>$checkCancelledInput = 'YES'</con2:xqueryText>
                                                    </con3:condition>
                                                    <con3:actions>
                                                        <con3:assign varName="ConsultaSuccessIndicator">
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7ba8</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>""</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                        <con3:foreach>
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b98</con2:id>
                                                            <con3:variable>xmlForEach</con3:variable>
                                                            <con3:expression>
                                                                <con2:xpathText>./parent/item</con2:xpathText>
                                                            </con3:expression>
                                                            <con3:value-variable>item</con3:value-variable>
                                                            <con3:index-variable>itemIndex</con3:index-variable>
                                                            <con3:total-variable>itemCount</con3:total-variable>
                                                            <con3:actions>
                                                                <con3:ifThenElse>
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b9f</con2:id>
                                                                    <con3:case>
                                                                        <con3:condition>
                                                                            <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS"</con2:xqueryText>
                                                                        </con3:condition>
                                                                        <con3:actions/>
                                                                    </con3:case>
                                                                    <con3:default>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b9e</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>$ConsultaSuccessIndicator != ""</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions>
                                                                                    <con3:javaCallout varName="">
                                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b9d</con2:id>
                                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                        <con3:method>public static void sleep(int)</con3:method>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>$delayTime</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:javaCallout>
                                                                                </con3:actions>
                                                                            </con3:case>
                                                                            <con3:default/>
                                                                        </con3:ifThenElse>
                                                                        <con3:wsCallout>
                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b99</con2:id>
                                                                            <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/Business_Resources/ConsultasCuenta/Resources/consultaCuentasBS" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                            <con3:operation>Consultadecuentascanceladas</con3:operation>
                                                                            <con3:request>
                                                                                <con3:body>REQCuentaCancelada</con3:body>
                                                                            </con3:request>
                                                                            <con3:response>
                                                                                <con3:body>RSPCuentaCanceladaAux</con3:body>
                                                                            </con3:response>
                                                                            <con3:requestTransform>
                                                                                <con3:assign varName="REQCuentaCancelada">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b9c</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryTransform>
                                                                                            <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaCuentaCanceladaHNIn"/>
                                                                                            <con2:param name="account">
                                                                                                <con2:path>$accountNumber</con2:path>
                                                                                            </con2:param>
                                                                                            <con2:param name="requestHeader1">
                                                                                                <con2:path>$header/aut:RequestHeader</con2:path>
                                                                                            </con2:param>
                                                                                        </con2:xqueryTransform>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                            </con3:requestTransform>
                                                                            <con3:responseTransform>
                                                                                <con3:assign varName="ConsultaSuccessIndicator">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b9b</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>data($RSPCuentaCanceladaAux/Status/successIndicator)</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7d47</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS) != ''</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:assign varName="zeroRecords">
                                                                                                <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7d46</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>data($RSPCuentaCanceladaAux/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default>
                                                                                        <con3:assign varName="RSPCuentaCancelada">
                                                                                            <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7d45</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>$RSPCuentaCanceladaAux</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                        <con3:assign varName="zeroRecords">
                                                                                            <con2:id>_ActionId-728652394897182949--6df27f5f.15e9538bf7d.-7d44</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>data($RSPCuentaCancelada/WSACCOUNTCLOSEDType/ZERORECORDS)</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:default>
                                                                                </con3:ifThenElse>
                                                                            </con3:responseTransform>
                                                                        </con3:wsCallout>
                                                                    </con3:default>
                                                                </con3:ifThenElse>
                                                            </con3:actions>
                                                        </con3:foreach>
                                                        <con3:ifThenElse>
                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b8c</con2:id>
                                                            <con3:case>
                                                                <con3:condition>
                                                                    <con2:xqueryText>fn:upper-case($ConsultaSuccessIndicator) = "SUCCESS" and fn:empty($zeroRecords)</con2:xqueryText>
                                                                </con3:condition>
                                                                <con3:actions>
                                                                    <con3:ifThenElse>
                                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b8b</con2:id>
                                                                        <con3:case>
                                                                            <con3:condition>
                                                                                <con2:xqueryText>fn:string-length($accountNameInput) > 0</con2:xqueryText>
                                                                            </con3:condition>
                                                                            <con3:actions>
                                                                                <con3:assign varName="accountNameResponse">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b8a</con2:id>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>normalize-space(upper-case(fn:string($RSPCuentaCancelada/WSACCOUNTCLOSEDType/gWSACCOUNTCLOSEDDetailType/mWSACCOUNTCLOSEDDetailType/ACCOUNTNAME/text())))</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:assign>
                                                                                <con3:javaCallout varName="levensteinDistance">
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b89</con2:id>
                                                                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$accountNameResponse</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                    <con3:expr>
                                                                                        <con2:xqueryText>$accountNameInput</con2:xqueryText>
                                                                                    </con3:expr>
                                                                                </con3:javaCallout>
                                                                                <con3:ifThenElse>
                                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b88</con2:id>
                                                                                    <con3:case>
                                                                                        <con3:condition>
                                                                                            <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                                                                        </con3:condition>
                                                                                        <con3:actions>
                                                                                            <con3:assign varName="totalFoundAccounts">
                                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76ce</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                            <con3:assign varName="accountFound">
                                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b87</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                            <con3:assign varName="accountCancelled">
                                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b86</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:actions>
                                                                                    </con3:case>
                                                                                    <con3:default>
                                                                                        <con3:assign varName="errorMessage">
                                                                                            <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b85</con2:id>
                                                                                            <con3:expr>
                                                                                                <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                            </con3:expr>
                                                                                        </con3:assign>
                                                                                    </con3:default>
                                                                                </con3:ifThenElse>
                                                                            </con3:actions>
                                                                        </con3:case>
                                                                        <con3:default>
                                                                            <con3:assign varName="totalFoundAccounts">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-76cc</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>xs:integer($totalFoundAccounts) + 1</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="accountFound">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b84</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>data($REQCuentaCancelada/WSACCOUNTCLOSEDType/enquiryInputCollection/criteriaValue)</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                            <con3:assign varName="accountCancelled">
                                                                                <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b83</con2:id>
                                                                                <con3:expr>
                                                                                    <con2:xqueryText>'true'</con2:xqueryText>
                                                                                </con3:expr>
                                                                            </con3:assign>
                                                                        </con3:default>
                                                                    </con3:ifThenElse>
                                                                </con3:actions>
                                                            </con3:case>
                                                            <con3:default>
                                                                <con3:assign varName="errorMessage">
                                                                    <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7b82</con2:id>
                                                                    <con3:expr>
                                                                        <con2:xqueryText>"Cumple mod 11 pero no se encontró información de la cuenta."</con2:xqueryText>
                                                                    </con3:expr>
                                                                </con3:assign>
                                                            </con3:default>
                                                        </con3:ifThenElse>
                                                    </con3:actions>
                                                </con3:case>
                                                <con3:default>
                                                    <con3:assign varName="errorMessage">
                                                        <con2:id>_ActionId-1419337740241664091-39d17939.15de13f8e9f.-7baa</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>"No se verificó si la cuenta está cancelada."</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:default>
                                            </con3:ifThenElse>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default/>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="HN01_ValidaCuenta_response">
            <con1:stage name="HN_proxyResponse">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-1702319232120729515--1fac2902.15738a4bb48.-76fe</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>xs:integer($totalFoundAccounts) = 1</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="header" contents-only="true">
                                    <con2:id>_ActionId-1702319232120729515--1fac2902.15738a4bb48.-76fc</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>Success&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5be7</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>$accountCancelled = 'false'</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace contents-only="true" varName="body">
                                                <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5bd2</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/ValidacionCuentaOut"/>
                                                        <con2:param name="accountFound">
                                                            <con2:path>$accountFound</con2:path>
                                                        </con2:param>
                                                        <con2:param name="RSPDetallesCuenta">
                                                            <con2:path>$RSPDetallesCuenta</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con3:expr>
                                            </con3:replace>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-1827806786218996013-36a86176.15dd1d59d28.-5be5</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/ValidacionCuentaCanceladaOut"/>
                                                    <con2:param name="accountFound">
                                                        <con2:path>$accountFound</con2:path>
                                                    </con2:param>
                                                    <con2:param name="consultadecuentascanceladasResponse1">
                                                        <con2:path>$RSPCuentaCancelada</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace varName="header" contents-only="true">
                                <con2:id>_ActionId-7995077846724813207-59dbfc07.157f6f13091.-7ee8</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
	
		{
			if (xs:integer($totalFoundAccounts) > 1) then 
				(
					<successIndicator>ERROR</successIndicator>,
					<messages>Se ha encontrado más de una cuenta asociada</messages>
				)
			else
				(
					<successIndicator>NO RECORDS</successIndicator>,
					<messages>{ $errorMessage }</messages>
				)
		}	
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-1702319232120729515--1fac2902.15738a4bb48.-76f7</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="GT01_ValidaCuenta_request">
            <con1:stage name="GT_proxyRequest">
                <con1:context>
                    <con2:userNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ConsultaDetallesCuenta" prefix="con"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="validationMessage">
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40bf</con2:id>
                        <con3:expr>
                            <con2:xqueryTransform>
                                <con2:resource ref="Middleware/Business_Resources/validacionCuenta/ValidacionCuenta/validacionCuentaValidate"/>
                                <con2:param name="validacionCuenta">
                                    <con2:path>$body/val:validacionCuenta</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40be</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="accountNumberInput">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40bd</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>fn:string($body/val:validacionCuenta/ACCOUNT_NUMBER/text())</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:javaCallout varName="accountNumber">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40bc</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static java.lang.String removerGuiones(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumberInput</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:javaCallout varName="accountNumber">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40bb</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static java.lang.String removerCerosIzquierda(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumber</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b9</con2:id>
                                    <con3:service ref="Middleware/v2/BusinessServices/EvaluaCuentaAbanks/flow/EvaluaCuentaAbanks" xsi:type="con4:FlowRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:con4="http://www.bea.com/alsb/flow/resources/config"/>
                                    <con3:operation>EvaluaCuentaAbanks</con3:operation>
                                    <con3:request>
                                        <con3:body>REQEvaluaCuentaAbanks</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPEvaluaCuentaAbanks</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQEvaluaCuentaAbanks">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40ba</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/EvaluarCuentaAbanksIn"/>
                                                    <con2:param name="accountNumber">
                                                        <con2:path>$accountNumber</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform/>
                                </con3:wsCallout>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b6</con2:id>
                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                                    <con3:request>
                                        <con3:body>REQConsecutivoPorcentajeLevenstein</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPConsecutivoPorcentajeLevenstein</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQConsecutivoPorcentajeLevenstein">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b8</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaPorcentajeLevensteinIn"/>
                                                    <con2:param name="requestHeader1">
                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:assign varName="porcentajeLevenstein">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b7</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinOut"/>
                                                    <con2:param name="outputParameters1">
                                                        <con2:path>$RSPConsecutivoPorcentajeLevenstein</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                                <con3:assign varName="successIndicatorForEach">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b5</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>""</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:foreach>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a4</con2:id>
                                    <con3:variable>RSPEvaluaCuentaAbanks</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>account</con3:value-variable>
                                    <con3:index-variable>index</con3:index-variable>
                                    <con3:total-variable>count</con3:total-variable>
                                    <con3:actions>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b4</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions/>
                                            </con3:case>
                                            <con3:default>
                                                <con3:assign varName="mod10Indicator">
                                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b3</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryTransform>
                                                            <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/mod10IndicatorIn"/>
                                                            <con2:param name="index">
                                                                <con2:path>$index</con2:path>
                                                            </con2:param>
                                                            <con2:param name="ResponseEvaluaCuentaAbanks">
                                                                <con2:path>$RSPEvaluaCuentaAbanks</con2:path>
                                                            </con2:param>
                                                        </con2:xqueryTransform>
                                                    </con3:expr>
                                                </con3:assign>
                                                <con3:ifThenElse>
                                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b2</con2:id>
                                                    <con3:case>
                                                        <con3:condition>
                                                            <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40af</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ABKGT/consultaDetallesCuenta/biz/consultaDetallesCuenta_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>ConsultaDetallesCuenta</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQConsultaDetallesCuenta</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPConsultaDetallesCuenta</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQConsultaDetallesCuenta">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b1</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaDetalleCuentaGTIN"/>
                                                                                <con2:param name="index">
                                                                                    <con2:path>$index</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                    <con2:path>$RSPEvaluaCuentaAbanks</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="errorCode">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40b0</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPConsultaDetallesCuenta/con:ERROR_CODE)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40ae</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryConditionExpr>
                                                                            <con2:compExpr operator="=">
                                                                                <con2:leftPath>$errorCode</con2:leftPath>
                                                                                <con2:rightPath>"SUCCESS"</con2:rightPath>
                                                                            </con2:compExpr>
                                                                        </con2:xqueryConditionExpr>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40ad</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>""</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="successIndicatorForEach">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40ac</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$errorCode</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40ab</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>fn:string-length(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text())) > 0</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions>
                                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40aa</con2:id>
                                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPConsultaDetallesCuenta/con:ACCOUNT_NAME/text())))</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text())))</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:javaCallout>
                                                                                    <con3:ifThenElse>
                                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a9</con2:id>
                                                                                        <con3:case>
                                                                                            <con3:condition>
                                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($porcentajeLevenstein)</con2:xqueryText>
                                                                                            </con3:condition>
                                                                                            <con3:actions/>
                                                                                        </con3:case>
                                                                                        <con3:default>
                                                                                            <con3:assign varName="errorMessage">
                                                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a8</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:default>
                                                                                    </con3:ifThenElse>
                                                                                </con3:actions>
                                                                            </con3:case>
                                                                            <con3:default/>
                                                                        </con3:ifThenElse>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryConditionExpr>
                                                                            <con2:compExpr operator="=">
                                                                                <con2:leftPath>$errorCode</con2:leftPath>
                                                                                <con2:rightPath>"NO RECORDS"</con2:rightPath>
                                                                            </con2:compExpr>
                                                                        </con2:xqueryConditionExpr>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a7</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>"Cumple mod10 pero no existe"</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default>
                                                                    <con3:assign varName="errorMessage">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a6</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>fn:string($RSPConsultaDetallesCuenta/con:ERROR_MESSAGE/text())</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:default>
                                                            </con3:ifThenElse>
                                                        </con3:actions>
                                                    </con3:case>
                                                    <con3:default>
                                                        <con3:assign varName="errorMessage">
                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-40a5</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>"No cumplió mod 10."</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:default>
                                                </con3:ifThenElse>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="GT01_ValidaCuenta_response">
            <con1:stage name="GT_proxyResponse">
                <con1:context>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:userNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="PRUEBA01">
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3c98</con2:id>
                        <con3:expr>
                            <con2:xqueryText>'01'</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3c6f</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3c43</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:string($errorMessage) = ""</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace varName="header" contents-only="true">
                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3bab</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>SUCCESS&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                                                </con3:expr>
                                            </con3:replace>
                                            <con3:replace contents-only="true" varName="body">
                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3ba9</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/validacionCuentaGTBodyOut"/>
                                                        <con2:param name="outputParameters">
                                                            <con2:path>$RSPConsultaDetallesCuenta</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con3:expr>
                                            </con3:replace>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:replace varName="header" contents-only="true">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3b56</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{$errorMessage}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                        <con3:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3b6f</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace varName="header" contents-only="true">
                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3b8b</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{fn:string($validationMessage)}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3ba1</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="ValidacionesGenerales_request">
            <con1:stage name="ValidacionXSD">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                </con1:context>
                <con1:actions>
                    <con3:validate>
                        <con2:id>_ActionId-7995077846724813207-59dbfc07.157f6f13091.-7f42</con2:id>
                        <con3:schema ref="Middleware/v3/Resources/ValidacionCuenta/xsd/validacionCuentaType"/>
                        <con3:schemaElement xmlns:val="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType">val:validacionCuenta</con3:schemaElement>
                        <con3:varName>body</con3:varName>
                        <con3:location>
                            <con2:xpathText>./val:validacionCuenta</con2:xpathText>
                        </con3:location>
                    </con3:validate>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ValidacionServicioRegional">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/ValidaServicioRegional" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val1"/>
                </con1:context>
                <con1:actions>
                    <con3:wsCallout>
                        <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f31</con2:id>
                        <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ValidaServicioRegional/biz/ValidaServicioRegional_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>ValidaServicioRegional</con3:operation>
                        <con3:request>
                            <con3:body>reqValidaServicioRegional</con3:body>
                        </con3:request>
                        <con3:response>
                            <con3:body>respValidaServicioRegional</con3:body>
                        </con3:response>
                        <con3:requestTransform>
                            <con3:assign varName="reqValidaServicioRegional">
                                <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f38</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="Middleware/v2/Resources/Generales/xq/validaServicioRegionalIn"/>
                                        <con2:param name="requestHeader1">
                                            <con2:path>$header/aut:RequestHeader</con2:path>
                                        </con2:param>
                                        <con2:param name="serviceId">
                                            <con2:path>"FICBCO0153"</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:assign>
                        </con3:requestTransform>
                        <con3:responseTransform>
                            <con3:ifThenElse>
                                <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f37</con2:id>
                                <con3:case>
                                    <con3:condition>
                                        <con2:xqueryText>fn:string($respValidaServicioRegional/val:PV_CODIGO_ERROR/text()) != 'SUCCESS'</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                        <con3:replace contents-only="true" varName="header">
                                            <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f36</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{fn:string($respValidaServicioRegional/val:PV_MENSAJE_ERROR/text())}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                        <con3:replace contents-only="true" varName="body">
                                            <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f35</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;val1:validacionCuentaResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                        <con2:reply>
                                            <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f34</con2:id>
                                        </con2:reply>
                                    </con3:actions>
                                </con3:case>
                                <con3:default>
                                    <con3:replace contents-only="true" varName="header">
                                        <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f33</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/v2/Resources/Generales/xq/aplicarValoresPorDefectoRegion"/>
                                                <con2:param name="requestHeader">
                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:replace>
                                    <con3:assign varName="areSameSourceAndDestination">
                                        <con2:id>_ActionId-4777262987165033336--99c1467.151cfe5628c.-6f32</con2:id>
                                        <con3:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Middleware/v2/Resources/Generales/xq/validarCrucePaisEmpresa"/>
                                                <con2:param name="requestHeader">
                                                    <con2:path>$header/aut:RequestHeader</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con3:expr>
                                    </con3:assign>
                                </con3:default>
                            </con3:ifThenElse>
                        </con3:responseTransform>
                    </con3:wsCallout>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="ValidacionesGenerales_response">
            <con1:stage name="MapeoError">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-5148</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>fn:upper-case(fn:string($header/aut:ResponseHeader/successIndicator/text())) != "SUCCESS"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-5145</con2:id>
                                    <con3:service xsi:type="ref:ProxyRef" ref="Middleware/v2/ProxyServices/MapeoErrores" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>mapeoErrores</con3:operation>
                                    <con3:request>
                                        <con3:body>REQMapeoErrores</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPMapeoErrores</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQMapeoErrores">
                                            <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-5147</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageIn"/>
                                                    <con2:param name="MENSAJE_ERROR">
                                                        <con2:path>fn:concat("FICBCO0153","$#$",fn:string-join($header/aut:ResponseHeader/messages, '||'))</con2:path>
                                                    </con2:param>
                                                    <con2:param name="CODIGO_ERROR">
                                                        <con2:path>fn:upper-case(fn:string($header/aut:ResponseHeader/successIndicator/text()))</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:replace varName="header" contents-only="true">
                                            <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-5146</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/MapeoErrores/xq/mapeoErroresUsageOut"/>
                                                    <con2:param name="mapeoErroresResponse1">
                                                        <con2:path>$RSPMapeoErrores</con2:path>
                                                    </con2:param>
                                                    <con2:param name="successIndicator">
                                                        <con2:path>fn:string($header/aut:ResponseHeader/successIndicator/text())</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="PA01_ValidaCuenta_request">
            <con1:stage name="PA_proxyRequest">
                <con1:context>
                    <con2:userNsDecl namespace="EvaluaCuentaAbanks" prefix="eval"/>
                    <con2:userNsDecl namespace="http://xmlns.oracle.com/pcbpel/adapter/db/sp/consultaDetallesCuenta" prefix="con"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="validationMessage">
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a7b</con2:id>
                        <con3:expr>
                            <con2:xqueryTransform>
                                <con2:resource ref="Middleware/Business_Resources/validacionCuenta/ValidacionCuenta/validacionCuentaValidate"/>
                                <con2:param name="validacionCuenta">
                                    <con2:path>$body/val:validacionCuenta</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a7a</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="accountNumberInput">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a79</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>fn:string($body/val:validacionCuenta/ACCOUNT_NUMBER/text())</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:javaCallout varName="accountNumber">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a78</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static java.lang.String removerGuiones(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumberInput</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:javaCallout varName="accountNumber">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a77</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static java.lang.String removerCerosIzquierda(java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>$accountNumber</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a75</con2:id>
                                    <con3:service ref="Middleware/v2/BusinessServices/EvaluaCuentaAbanks/flow/EvaluaCuentaAbanks" xsi:type="con4:FlowRef" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:con4="http://www.bea.com/alsb/flow/resources/config"/>
                                    <con3:operation>EvaluaCuentaAbanks</con3:operation>
                                    <con3:request>
                                        <con3:body>REQEvaluaCuentaAbanks</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPEvaluaCuentaAbanks</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQEvaluaCuentaAbanks">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a76</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/EvaluarCuentaAbanksIn"/>
                                                    <con2:param name="accountNumber">
                                                        <con2:path>$accountNumber</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform/>
                                </con3:wsCallout>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a72</con2:id>
                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                                    <con3:request>
                                        <con3:body>REQConsecutivoPorcentajeLevenstein</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPConsecutivoPorcentajeLevenstein</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQConsecutivoPorcentajeLevenstein">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a74</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaPorcentajeLevensteinIn"/>
                                                    <con2:param name="requestHeader1">
                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:assign varName="porcentajeLevenstein">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a73</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinOut"/>
                                                    <con2:param name="outputParameters1">
                                                        <con2:path>$RSPConsecutivoPorcentajeLevenstein</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                                <con3:assign varName="successIndicatorForEach">
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a71</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>""</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:foreach>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a60</con2:id>
                                    <con3:variable>RSPEvaluaCuentaAbanks</con3:variable>
                                    <con3:expression>
                                        <con2:xpathText>./eval:EvaluaCuentaAbanksTypeResponse/eval:ACCOUNT_ID</con2:xpathText>
                                    </con3:expression>
                                    <con3:value-variable>account</con3:value-variable>
                                    <con3:index-variable>index</con3:index-variable>
                                    <con3:total-variable>count</con3:total-variable>
                                    <con3:actions>
                                        <con3:ifThenElse>
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a70</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>fn:upper-case($successIndicatorForEach) = "SUCCESS"</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions/>
                                            </con3:case>
                                            <con3:default>
                                                <con3:assign varName="mod10Indicator">
                                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6f</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryTransform>
                                                            <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/mod10IndicatorIn"/>
                                                            <con2:param name="index">
                                                                <con2:path>$index</con2:path>
                                                            </con2:param>
                                                            <con2:param name="ResponseEvaluaCuentaAbanks">
                                                                <con2:path>$RSPEvaluaCuentaAbanks</con2:path>
                                                            </con2:param>
                                                        </con2:xqueryTransform>
                                                    </con3:expr>
                                                </con3:assign>
                                                <con3:ifThenElse>
                                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6e</con2:id>
                                                    <con3:case>
                                                        <con3:condition>
                                                            <con2:xqueryText>$mod10Indicator = 'true'</con2:xqueryText>
                                                        </con3:condition>
                                                        <con3:actions>
                                                            <con3:wsCallout>
                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6b</con2:id>
                                                                <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/ABKPA/consultaDetallesCuenta/biz/consultaDetallesCuenta_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                <con3:operation>consultaDetallesCuenta</con3:operation>
                                                                <con3:request>
                                                                    <con3:body>REQConsultaDetallesCuenta</con3:body>
                                                                </con3:request>
                                                                <con3:response>
                                                                    <con3:body>RSPConsultaDetallesCuenta</con3:body>
                                                                </con3:response>
                                                                <con3:requestTransform>
                                                                    <con3:assign varName="REQConsultaDetallesCuenta">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6d</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryTransform>
                                                                                <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaDetalleCuentaPAIn"/>
                                                                                <con2:param name="evaluaCuentaAbanksTypeResponse1">
                                                                                    <con2:path>$RSPEvaluaCuentaAbanks</con2:path>
                                                                                </con2:param>
                                                                                <con2:param name="index">
                                                                                    <con2:path>$index</con2:path>
                                                                                </con2:param>
                                                                            </con2:xqueryTransform>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:requestTransform>
                                                                <con3:responseTransform>
                                                                    <con3:assign varName="errorCode">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6c</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>data($RSPConsultaDetallesCuenta/con:ERROR_CODE)</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:responseTransform>
                                                            </con3:wsCallout>
                                                            <con3:ifThenElse>
                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a6a</con2:id>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryConditionExpr>
                                                                            <con2:compExpr operator="=">
                                                                                <con2:leftPath>$errorCode</con2:leftPath>
                                                                                <con2:rightPath>"SUCCESS"</con2:rightPath>
                                                                            </con2:compExpr>
                                                                        </con2:xqueryConditionExpr>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a69</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>""</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:assign varName="successIndicatorForEach">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a68</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>$errorCode</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                        <con3:ifThenElse>
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a67</con2:id>
                                                                            <con3:case>
                                                                                <con3:condition>
                                                                                    <con2:xqueryText>fn:string-length(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text())) > 0</con2:xqueryText>
                                                                                </con3:condition>
                                                                                <con3:actions>
                                                                                    <con3:javaCallout varName="levensteinDistance">
                                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a66</con2:id>
                                                                                        <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                                                                        <con3:className>ficohsa.utilities.Utilities</con3:className>
                                                                                        <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($RSPConsultaDetallesCuenta/con:ACCOUNT_NAME/text())))</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                        <con3:expr>
                                                                                            <con2:xqueryText>normalize-space(upper-case(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text())))</con2:xqueryText>
                                                                                        </con3:expr>
                                                                                    </con3:javaCallout>
                                                                                    <con3:ifThenElse>
                                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a65</con2:id>
                                                                                        <con3:case>
                                                                                            <con3:condition>
                                                                                                <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($porcentajeLevenstein)</con2:xqueryText>
                                                                                            </con3:condition>
                                                                                            <con3:actions/>
                                                                                        </con3:case>
                                                                                        <con3:default>
                                                                                            <con3:assign varName="errorMessage">
                                                                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a64</con2:id>
                                                                                                <con3:expr>
                                                                                                    <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                                                                                </con3:expr>
                                                                                            </con3:assign>
                                                                                        </con3:default>
                                                                                    </con3:ifThenElse>
                                                                                </con3:actions>
                                                                            </con3:case>
                                                                            <con3:default/>
                                                                        </con3:ifThenElse>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:case>
                                                                    <con3:condition>
                                                                        <con2:xqueryConditionExpr>
                                                                            <con2:compExpr operator="=">
                                                                                <con2:leftPath>$errorCode</con2:leftPath>
                                                                                <con2:rightPath>"NO RECORDS"</con2:rightPath>
                                                                            </con2:compExpr>
                                                                        </con2:xqueryConditionExpr>
                                                                    </con3:condition>
                                                                    <con3:actions>
                                                                        <con3:assign varName="errorMessage">
                                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a63</con2:id>
                                                                            <con3:expr>
                                                                                <con2:xqueryText>"Cumple mod10 pero no existe"</con2:xqueryText>
                                                                            </con3:expr>
                                                                        </con3:assign>
                                                                    </con3:actions>
                                                                </con3:case>
                                                                <con3:default>
                                                                    <con3:assign varName="errorMessage">
                                                                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a62</con2:id>
                                                                        <con3:expr>
                                                                            <con2:xqueryText>fn:string($RSPConsultaDetallesCuenta/con:ERROR_MESSAGE/text())</con2:xqueryText>
                                                                        </con3:expr>
                                                                    </con3:assign>
                                                                </con3:default>
                                                            </con3:ifThenElse>
                                                        </con3:actions>
                                                    </con3:case>
                                                    <con3:default>
                                                        <con3:assign varName="errorMessage">
                                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3a61</con2:id>
                                                            <con3:expr>
                                                                <con2:xqueryText>"No cumplió mod 10."</con2:xqueryText>
                                                            </con3:expr>
                                                        </con3:assign>
                                                    </con3:default>
                                                </con3:ifThenElse>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:actions>
                                </con3:foreach>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="PA01_ValidaCuenta_response">
            <con1:stage name="PA_proxyResponse">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-385e</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = ""</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-37c3</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>fn:string($errorMessage) = ""</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions>
                                            <con3:replace contents-only="true" varName="header">
                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3650</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>SUCCESS&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                                                </con3:expr>
                                            </con3:replace>
                                            <con3:replace contents-only="true" varName="body">
                                                <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-3631</con2:id>
                                                <con3:expr>
                                                    <con2:xqueryTransform>
                                                        <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/validacionCuentaPABodyOut"/>
                                                        <con2:param name="outputParameters">
                                                            <con2:path>$RSPConsultaDetallesCuenta</con2:path>
                                                        </con2:param>
                                                    </con2:xqueryTransform>
                                                </con3:expr>
                                            </con3:replace>
                                        </con3:actions>
                                    </con3:case>
                                    <con3:default>
                                        <con3:replace varName="header" contents-only="true">
                                            <con2:id>_ActionId-7995077846724813207-59dbfc07.157f6f13091.-7ee6</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{$errorMessage}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                        <con3:replace contents-only="true" varName="body">
                                            <con2:id>_ActionId-3719545350917257038--129ccfcd.15710de9924.-364e</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                            </con3:expr>
                                        </con3:replace>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace varName="header" contents-only="true">
                                <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-522c</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{fn:string($validationMessage)}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-5165187676452498133--660a4447.157dcfdc56d.-51f3</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="request" name="NI01_ValidaCuenta_request">
            <con1:stage name="FlujoEntrada">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/consultasType" prefix="con"/>
                    <con2:varNsDecl namespace="http://service.srvaplcobiscuenta.ecobis.cobiscorp" prefix="ser"/>
                    <con2:varNsDecl namespace="http://dto.srvaplcobisentidades.ecobis.cobiscorp" prefix="dto"/>
                </con1:context>
                <con1:actions>
                    <con3:assign varName="validationMessage">
                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed5</con2:id>
                        <con3:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="cuenta">
                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed4</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn-bea:trim(fn:string($body/val:validacionCuenta/ACCOUNT_NUMBER/text()))</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed3</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$cuenta != ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ece</con2:id>
                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/CTS/cuenta/biz/cuenta" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>OpConsultaDetalleCuenta</con3:operation>
                                    <con3:request>
                                        <con3:body>REQConsultaDetalleCuenta</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RSPConsultaDetalleCuenta</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="REQConsultaDetalleCuenta">
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed2</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaDetallesCuentaNIIn"/>
                                                    <con2:param name="validacionCuenta">
                                                        <con2:path>$body/val:validacionCuenta</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                        <con3:validate>
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7e61</con2:id>
                                            <con3:schema ref="Middleware/v2/BusinessServices/CTS/cuenta/xsd/services"/>
                                            <con3:schemaElement xmlns:ser1="http://service.srvaplcobiscuenta.ecobis.cobiscorp">ser1:opConsultaDetalleCuentaSolicitud</con3:schemaElement>
                                            <con3:varName>REQConsultaDetalleCuenta</con3:varName>
                                            <con3:location>
                                                <con2:xpathText>.</con2:xpathText>
                                            </con3:location>
                                        </con3:validate>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:ifThenElse>
                                            <con2:comment>Si al consultar el detalle de la cuenta es 0 quiere decir que si existe solo queda valdiar el nombre con levenstain para estar seguro que la cuenta si corresponde</con2:comment>
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed1</con2:id>
                                            <con3:case>
                                                <con3:condition>
                                                    <con2:xqueryText>fn:string($RSPConsultaDetalleCuenta/dto:contextoRespuesta/dto:codTipoRespuesta/text()) = "0"</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:assign varName="nombreCuenta">
                                                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ed0</con2:id>
                                                        <con3:expr>
                                                            <con2:xqueryText>fn-bea:trim(fn:string($RSPConsultaDetalleCuenta/dto:cuenta/dto:valCuentaHabiente/text()))</con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:assign>
                                                </con3:actions>
                                            </con3:case>
                                            <con3:default>
                                                <con3:assign varName="validationMessage">
                                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ecf</con2:id>
                                                    <con3:expr>
                                                        <con2:xqueryText>fn:string($RSPConsultaDetalleCuenta/dto:contextoRespuesta/dto:valDescripcionRespuesta/text())</con2:xqueryText>
                                                    </con3:expr>
                                                </con3:assign>
                                            </con3:default>
                                        </con3:ifThenElse>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:assign varName="validationMessage">
                                <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ecd</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>'El número de cuenta ingresado es inválido'</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
            <con1:stage name="ValidaNombreCuentaLevenshtein">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ecc</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = '' and fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text()) != ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec9</con2:id>
                                    <con3:service xsi:type="ref:BusinessServiceRef" ref="Middleware/v2/BusinessServices/consultaPorcentajeLevenstein/biz/CONS_PORC_LEVENSTEIN_db" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>CONS_PORC_LEVENSTEIN</con3:operation>
                                    <con3:request>
                                        <con3:body>ReqConsPorcentajeLev</con3:body>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body>RspConsPorcentajeLev</con3:body>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="ReqConsPorcentajeLev">
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ecb</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/consultaPorcentajeLevensteinIn"/>
                                                    <con2:param name="requestHeader1">
                                                        <con2:path>$header/aut:RequestHeader</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:requestTransform>
                                    <con3:responseTransform>
                                        <con3:assign varName="PorcentajeLevenstein">
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7eca</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="Middleware/v2/Resources/ValidacionCuenta/xq/ConsultaPorcentajeLevensteinOut"/>
                                                    <con2:param name="outputParameters1">
                                                        <con2:path>$RspConsPorcentajeLev</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:responseTransform>
                                </con3:wsCallout>
                                <con3:assign varName="nombreRequest">
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec8</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>fn-bea:trim(fn:string($body/val:validacionCuenta/ACCOUNT_NAME/text()))</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con3:javaCallout varName="levensteinDistance">
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec7</con2:id>
                                    <con3:archive ref="Middleware/v2/Resources/Utilities/Java/Utilities"/>
                                    <con3:className>ficohsa.utilities.Utilities</con3:className>
                                    <con3:method>public static int computeLevenshteinDistance(java.lang.String, java.lang.String)</con3:method>
                                    <con3:expr>
                                        <con2:xqueryText>normalize-space(upper-case($nombreCuenta))</con2:xqueryText>
                                    </con3:expr>
                                    <con3:expr>
                                        <con2:xqueryText>normalize-space(upper-case($nombreRequest))</con2:xqueryText>
                                    </con3:expr>
                                </con3:javaCallout>
                                <con3:ifThenElse>
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec6</con2:id>
                                    <con3:case>
                                        <con3:condition>
                                            <con2:xqueryText>xs:integer($levensteinDistance) > xs:integer($PorcentajeLevenstein)</con2:xqueryText>
                                        </con3:condition>
                                        <con3:actions/>
                                    </con3:case>
                                    <con3:default>
                                        <con3:assign varName="validationMessage">
                                            <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec5</con2:id>
                                            <con3:expr>
                                                <con2:xqueryText>"no pasó validación Levenshtein para el nombre "</con2:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                    </con3:default>
                                </con3:ifThenElse>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:pipeline type="response" name="NI01_ValidaCuenta_response">
            <con1:stage name="FlujoSalida">
                <con1:context>
                    <con2:varNsDecl namespace="http://service.srvaplcobiscuenta.ecobis.cobiscorp" prefix="ser"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/validacionCuentaType" prefix="val"/>
                    <con2:varNsDecl namespace="http://dto.srvaplcobisentidades.ecobis.cobiscorp" prefix="dto"/>
                </con1:context>
                <con1:actions>
                    <con3:ifThenElse>
                        <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec4</con2:id>
                        <con3:case>
                            <con3:condition>
                                <con2:xqueryText>$validationMessage = ''</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="header" contents-only="true">
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec3</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>&lt;aut:ResponseHeader>
      &lt;successIndicator>Success&lt;/successIndicator>
      &lt;messages/>
&lt;/aut:ResponseHeader></con2:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:replace contents-only="true" varName="body">
                                    <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec2</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="Middleware/v3/Resources/ValidacionCuenta/xq/validacionCuentaNIOut"/>
                                            <con2:param name="opConsultaDetalleCuentaRespuesta">
                                                <con2:path>$RSPConsultaDetalleCuenta</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con3:replace contents-only="true" varName="header">
                                <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec1</con2:id>
                                <con3:expr>
                                    <con2:xqueryText><![CDATA[<aut:ResponseHeader>
      <successIndicator>ERROR</successIndicator>
      <messages>{fn:string($validationMessage)}</messages>
</aut:ResponseHeader>]]></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-7585691874613790884-45d04716.15edddb8e86.-7ec0</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>&lt;val:validacionCuentaResponse/></con2:xqueryText>
                                </con3:expr>
                            </con3:replace>
                        </con3:default>
                    </con3:ifThenElse>
                </con1:actions>
            </con1:stage>
        </con1:pipeline>
        <con1:flow>
            <con1:pipeline-node name="ValidacionesGenerales">
                <con1:request>ValidacionesGenerales_request</con1:request>
                <con1:response>ValidacionesGenerales_response</con1:response>
            </con1:pipeline-node>
            <con1:branch-node type="condition" name="RegionalizacionPaisEmpresa">
                <con1:context>
                    <con2:varNsDecl namespace="http://www.ficohsa.com.hn/middleware.services/autType" prefix="aut"/>
                </con1:context>
                <con1:branch-table variable="header">
                    <con1:xpath>
                        <con2:xpathText>./aut:RequestHeader/Region/SourceBank</con2:xpathText>
                    </con1:xpath>
                    <con1:branch name="HN01">
                        <con1:operator>equals</con1:operator>
                        <con1:value>'HN01'</con1:value>
                        <con1:flow>
                            <con1:pipeline-node name="HN01_ValidaCuenta">
                                <con1:request>HN01_ValidaCuenta_request</con1:request>
                                <con1:response>HN01_ValidaCuenta_response</con1:response>
                            </con1:pipeline-node>
                        </con1:flow>
                    </con1:branch>
                    <con1:branch name="GT01">
                        <con1:operator>equals</con1:operator>
                        <con1:value>'GT01'</con1:value>
                        <con1:flow>
                            <con1:pipeline-node name="GT01_ValidaCuenta">
                                <con1:request>GT01_ValidaCuenta_request</con1:request>
                                <con1:response>GT01_ValidaCuenta_response</con1:response>
                            </con1:pipeline-node>
                        </con1:flow>
                    </con1:branch>
                    <con1:branch name="PA01">
                        <con1:operator>equals</con1:operator>
                        <con1:value>'PA01'</con1:value>
                        <con1:flow>
                            <con1:pipeline-node name="PA01_ValidaCuenta">
                                <con1:request>PA01_ValidaCuenta_request</con1:request>
                                <con1:response>PA01_ValidaCuenta_response</con1:response>
                            </con1:pipeline-node>
                        </con1:flow>
                    </con1:branch>
                    <con1:branch name="NI01">
                        <con1:operator>equals</con1:operator>
                        <con1:value>'NI01'</con1:value>
                        <con1:flow>
                            <con1:pipeline-node name="NI01_ValidaCuenta">
                                <con1:request>NI01_ValidaCuenta_request</con1:request>
                                <con1:response>NI01_ValidaCuenta_response</con1:response>
                            </con1:pipeline-node>
                        </con1:flow>
                    </con1:branch>
                    <con1:default-branch>
                        <con1:flow>
                            <con1:pipeline-node name="Default_ValidarCuenta">
                                <con1:request>Default_ValidarCuenta_request</con1:request>
                                <con1:response>Default_ValidarCuenta_response</con1:response>
                            </con1:pipeline-node>
                        </con1:flow>
                    </con1:default-branch>
                </con1:branch-table>
            </con1:branch-node>
        </con1:flow>
    </con1:router>
</con:pipelineEntry>