<?xml version="1.0" encoding="UTF-8"?>
<con:templateEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
    <con:coreEntry>
        <con:binding type="SOAP" xsi:type="con:AnyWsdlSoapBindingType"/>
    </con:coreEntry>
    <con:router errorHandler="error-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff4">
        <con:pipeline type="request" name="request-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff8">
            <con:stage id="_StageId-N53e8038b.N33d56e41.0.188bfef5a4d.N7fec" name="Definitions">
                <con:context/>
                <con:actions>
                    <con1:assign varName="service">
                        <con2:id>_ActionId-N53e8038b.N33d56e41.0.188bfef5a4d.N7fe9</con2:id>
                        <con1:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="version">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7fb0</con2:id>
                        <con1:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="key">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f7f</con2:id>
                        <con1:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="value">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f7c</con2:id>
                        <con1:expr>
                            <con2:xqueryText>''</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="language">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f59</con2:id>
                        <con1:expr>
                            <con2:xqueryText>if(($body//GeneralInfo/Language) and (data($body//GeneralInfo/Language) != '')) then
data($body//GeneralInfo/Language)
else(
'es'
)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="uuid">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7fc8</con2:id>
                        <con1:expr>
                            <con2:xqueryText>if(($body//GeneralInfo/GlobalId) and (data($body//GeneralInfo/GlobalId) != '')) then
data($body//GeneralInfo/GlobalId)
else(
fn-bea:uuid()
)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="sourceBank">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f9d</con2:id>
                        <con1:expr>
                            <con2:xqueryText>data($body//GeneralInfo/SourceBank)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="destinationBank">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f8e</con2:id>
                        <con1:expr>
                            <con2:xqueryText>if(($body//GeneralInfo/DestinationBank) and (data($body//GeneralInfo/DestinationBank)!= '')) then
data($body//GeneralInfo/DestinationBank)
else(
$sourceBank
)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="user">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f8a</con2:id>
                        <con1:expr>
                            <con2:xqueryText>data($inbound/ctx:security/ctx:transportClient/ctx:username)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="targetSystem">
                        <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f86</con2:id>
                        <con1:expr>
                            <con2:xqueryText>'OSB'</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="method">
                        <con2:id>_ActionId-N53e8f55a.795ddf0e.0.188d936efc1.N7fef</con2:id>
                        <con1:expr>
                            <con2:xqueryText>if(fn:matches($inbound/ctx:transport/ctx:uri/text(), '/rest/'))then(
'REST'
)else(
'SOAP'
)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-N53e80115.N3e1c0fc9.0.188fd483d85.N7f05</con2:id>
                        <con1:location>
                            <con2:xpathText>.//GeneralInfo</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<SourceBank>{$sourceBank}</SourceBank>,
<DestinationBank>{$destinationBank}</DestinationBank>,
<GlobalId>{$uuid}</GlobalId>,
<ApplicationId>{$user}</ApplicationId>,
<ApplicationUser>{data($body//GeneralInfo/ApplicationUser)}</ApplicationUser>,
<BranchId>{data($body//GeneralInfo/BranchId)}</BranchId>,
<TransactionDate>{data($body//GeneralInfo/TransactionDate)}</TransactionDate>,
<Language>{$language}</Language>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:assign varName="OriginalBody">
                        <con2:id>_ActionId-N53e8038b.N33d56e41.0.188bfef5a4d.N7fe6</con2:id>
                        <con1:expr>
                            <con2:xqueryText>$body</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff6" name="StageLoggingInput">
                <con:context/>
                <con:actions>
                    <con4:route>
                        <con2:id>_ActionId-N53e8007b.N5582fe2b.0.188b51b3f1c.N7f86</con2:id>
                        <con4:service ref="SBRG_MassivePayment_Commons/BS/LoggingRegionalRestBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>SaveLogInFileSystem</con4:operation>
                        <con4:outboundTransform>
                            <con1:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-N53e80335.6e99aeb8.0.188d440d299.N7f82</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SBRG_MassivePayment_Commons/Transformations/ServiceToLog"/>
                                        <con2:param name="destinationBank">
                                            <con2:path>$destinationBank</con2:path>
                                        </con2:param>
                                        <con2:param name="method">
                                            <con2:path>$method</con2:path>
                                        </con2:param>
                                        <con2:param name="errorFlowName">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="channel">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="messageError">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="body">
                                            <con2:path>$body</con2:path>
                                        </con2:param>
                                        <con2:param name="version">
                                            <con2:path>$version</con2:path>
                                        </con2:param>
                                        <con2:param name="targetSystem">
                                            <con2:path>$targetSystem</con2:path>
                                        </con2:param>
                                        <con2:param name="GlobalId">
                                            <con2:path>$uuid</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceBank">
                                            <con2:path>$sourceBank</con2:path>
                                        </con2:param>
                                        <con2:param name="endpoint">
                                            <con2:path>data($inbound/ctx:transport/ctx:uri/text())</con2:path>
                                        </con2:param>
                                        <con2:param name="messageType">
                                            <con2:path>'REQUEST'</con2:path>
                                        </con2:param>
                                        <con2:param name="service">
                                            <con2:path>$service</con2:path>
                                        </con2:param>
                                        <con2:param name="codeError">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="state">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="operation">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="value">
                                            <con2:path>$value</con2:path>
                                        </con2:param>
                                        <con2:param name="user">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="parameters">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="key">
                                            <con2:path>$key</con2:path>
                                        </con2:param>
                                        <con2:param name="errorDetails">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                        </con4:outboundTransform>
                    </con4:route>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_N53e800db.N66e2518f.0.188bbf2a1b3.N7feb" name="Validate"/>
            <con:stage id="_StageId-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff2" name="StageRegionalizacion">
                <con:context/>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fef</con2:id>
                        <con1:service ref="SBRG_MassivePayment_Commons/BS/GetCountryURLByNameRegionalRestBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>GetCountryURLByName</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">requestRegional</con1:body>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">responseRegional</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:replace varName="requestRegional">
                                <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fd4</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SBRG_MassivePayment_Commons/Transformations/ServiceToRegionalizacion"/>
                                        <con2:param name="destinationBank">
                                            <con2:path>$destinationBank</con2:path>
                                        </con2:param>
                                        <con2:param name="service">
                                            <con2:path>$service</con2:path>
                                        </con2:param>
                                        <con2:param name="user">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="operation">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="version">
                                            <con2:path>$version</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceBank">
                                            <con2:path>$sourceBank</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N3f57febe.11119f7e.0.188a1c972db.N7ef0</con2:id>
                        <con1:case id="_BranchId-N3f57febe.11119f7e.0.188a1c972db.N7eef">
                            <con1:condition>
                                <con2:xqueryText>data($responseRegional) = "N/A"</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:Error>
                                    <con2:id>_ActionId-N3f57febe.11119f7e.0.188a1c972db.N7eec</con2:id>
                                    <con1:errCode>MW-0008</con1:errCode>
                                    <con1:message>SERVICE NOT IMPLEMENTED YET FOR THIS COUNTRY/COMPANY</con1:message>
                                </con1:Error>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_N53e802d6.N21e827a5.0.1887ec75b1e.N7feb" name="StageContry"/>
        </con:pipeline>
        <con:pipeline type="response" name="response-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff7">
            <con:stage id="_StageId-N53e8f55a.795ddf0e.0.188d936efc1.N7fea" name="Definitions">
                <con:context/>
                <con:actions>
                    <con1:assign varName="state">
                        <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fd0</con2:id>
                        <con1:expr>
                            <con2:xqueryText>data($body//StatusInfo/Status/text())</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="codeError">
                        <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fcc</con2:id>
                        <con1:expr>
                            <con2:xqueryText>data($body//ErrorInfo/Code/text())</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="messageError">
                        <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fc9</con2:id>
                        <con1:expr>
                            <con2:xqueryText>data($body//ErrorInfo/Description/text())</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57f591.58a7fbcd.0.18a23de9578.N7f55" name="StageLoggingOutput">
                <con:context/>
                <con:actions>
                    <con4:route>
                        <con2:id>_ActionId-N3f57f591.58a7fbcd.0.18a23de9578.N7f1e</con2:id>
                        <con4:service ref="SBRG_MassivePayment_Commons/BS/LoggingRegionalRestBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>SaveLogInFileSystem</con4:operation>
                        <con4:outboundTransform>
                            <con1:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-N3f57f591.58a7fbcd.0.18a23de9578.N7eb8</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SBRG_MassivePayment_Commons/Transformations/ServiceToLog"/>
                                        <con2:param name="destinationBank">
                                            <con2:path>$destinationBank</con2:path>
                                        </con2:param>
                                        <con2:param name="method">
                                            <con2:path>$method</con2:path>
                                        </con2:param>
                                        <con2:param name="errorFlowName">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="channel">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="messageError">
                                            <con2:path>$messageError</con2:path>
                                        </con2:param>
                                        <con2:param name="body">
                                            <con2:path>$body</con2:path>
                                        </con2:param>
                                        <con2:param name="version">
                                            <con2:path>$version</con2:path>
                                        </con2:param>
                                        <con2:param name="targetSystem">
                                            <con2:path>$targetSystem</con2:path>
                                        </con2:param>
                                        <con2:param name="GlobalId">
                                            <con2:path>$uuid</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceBank">
                                            <con2:path>$sourceBank</con2:path>
                                        </con2:param>
                                        <con2:param name="endpoint">
                                            <con2:path>$inbound/ctx:transport/ctx:uri/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="messageType">
                                            <con2:path>'RESPONSE'</con2:path>
                                        </con2:param>
                                        <con2:param name="service">
                                            <con2:path>$service</con2:path>
                                        </con2:param>
                                        <con2:param name="codeError">
                                            <con2:path>$codeError</con2:path>
                                        </con2:param>
                                        <con2:param name="state">
                                            <con2:path>$state</con2:path>
                                        </con2:param>
                                        <con2:param name="operation">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="value">
                                            <con2:path>$value</con2:path>
                                        </con2:param>
                                        <con2:param name="user">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="parameters">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="key">
                                            <con2:path>$key</con2:path>
                                        </con2:param>
                                        <con2:param name="errorDetails">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                        </con4:outboundTransform>
                    </con4:route>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53e8019e.57791fee.0.188f9b27985.N7fc8" name="Stage1">
                <con:context/>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fc1</con2:id>
                        <con1:case id="_BranchId-N53e8019e.57791fee.0.188f9b27985.N7fc0">
                            <con1:condition>
                                <con2:xqueryText>(($method='REST')and (fn:upper-case($state)!='SUCCESS'))</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:insert varName="inbound">
                                    <con2:id>_ActionId-N53e8019e.57791fee.0.188f9b27985.N7fbc</con2:id>
                                    <con1:location>
                                        <con2:xpathText>./ctx:transport/ctx:response</con2:xpathText>
                                    </con1:location>
                                    <con1:where>last-child</con1:where>
                                    <con1:expr>
                                        <con2:xqueryText>&lt;http:http-response-code>{$codeError}&lt;/http:http-response-code></con2:xqueryText>
                                    </con1:expr>
                                </con1:insert>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff4">
            <con:stage id="_StageId-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff3" name="StageIT">
                <con:context/>
                <con:actions>
                    <con3:report>
                        <con2:id>_ActionId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fe7</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$body</con2:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>code</con3:key>
                            <con3:varName>fault</con3:varName>
                            <con3:value>
                                <con2:xpathText>./ctx:errorCode</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                        <con3:labels>
                            <con3:key>reason</con3:key>
                            <con3:varName>fault</con3:varName>
                            <con3:value>
                                <con2:xpathText>./ctx:reason</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                        <con3:labels>
                            <con3:key>uuid</con3:key>
                            <con3:varName>body</con3:varName>
                            <con3:value>
                                <con2:xpathText>.//GeneralInfo/GlobalId</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con3:report>
                        <con2:id>_ActionId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fe4</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$fault</con2:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>code</con3:key>
                            <con3:varName>fault</con3:varName>
                            <con3:value>
                                <con2:xpathText>./ctx:errorCode</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                        <con3:labels>
                            <con3:key>reason</con3:key>
                            <con3:varName>fault</con3:varName>
                            <con3:value>
                                <con2:xpathText>./ctx:reason</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                        <con3:labels>
                            <con3:key>uuid</con3:key>
                            <con3:varName>body</con3:varName>
                            <con3:value>
                                <con2:xpathText>.//GeneralInfo/GlobalId</con2:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fea" name="StageMappingErrors">
                <con:context/>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-N53e8038b.N33d56e41.0.188bfef5a4d.N7ff4</con2:id>
                        <con1:service ref="SBRG_MassivePayment_Commons/BS/GetCustomErrorByStackTraceRegionalRestBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>process</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">requestError</con1:body>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">responseError</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:replace varName="requestError" contents-only="false">
                                <con2:id>_ActionId-N53e8f55a.795ddf0e.0.188d936efc1.N7fdb</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SBRG_MassivePayment_Commons/Transformations/ServicesToError"/>
                                        <con2:param name="systemApplication">
                                            <con2:path>'OSB'</con2:path>
                                        </con2:param>
                                        <con2:param name="service">
                                            <con2:path>$service</con2:path>
                                        </con2:param>
                                        <con2:param name="errorMessage">
                                            <con2:path>$fault/ctx:reason/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="errorCode">
                                            <con2:path>$fault/ctx:errorCode/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="language">
                                            <con2:path>$language</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_N53e802d6.N21e827a5.0.1887ec75b1e.N7fe0"/>
            <con:stage id="_StageId-N53e8038b.N33d56e41.0.188bfef5a4d.N7f23" name="StageLoggingOutputError">
                <con:context/>
                <con:actions>
                    <con4:route>
                        <con2:id>_ActionId-N53e8038b.N33d56e41.0.188bfef5a4d.N7f1f</con2:id>
                        <con4:service ref="SBRG_MassivePayment_Commons/BS/LoggingRegionalRestBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:operation>SaveLogInFileSystem</con4:operation>
                        <con4:outboundTransform>
                            <con1:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-N53e8f55a.795ddf0e.0.188d936efc1.N7fd7</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="SBRG_MassivePayment_Commons/Transformations/ServiceToLog"/>
                                        <con2:param name="destinationBank">
                                            <con2:path>$destinationBank</con2:path>
                                        </con2:param>
                                        <con2:param name="method">
                                            <con2:path>$method</con2:path>
                                        </con2:param>
                                        <con2:param name="errorFlowName">
                                            <con2:path>$fault/ctx:location/ctx:stage/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="channel">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="messageError">
                                            <con2:path>$fault/ctx:reason/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="body">
                                            <con2:path>$body</con2:path>
                                        </con2:param>
                                        <con2:param name="version">
                                            <con2:path>$version</con2:path>
                                        </con2:param>
                                        <con2:param name="targetSystem">
                                            <con2:path>'OSB'</con2:path>
                                        </con2:param>
                                        <con2:param name="GlobalId">
                                            <con2:path>$uuid</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceBank">
                                            <con2:path>$sourceBank</con2:path>
                                        </con2:param>
                                        <con2:param name="endpoint">
                                            <con2:path>data($inbound/ctx:transport/ctx:uri/text())</con2:path>
                                        </con2:param>
                                        <con2:param name="messageType">
                                            <con2:path>'RESPONSE'</con2:path>
                                        </con2:param>
                                        <con2:param name="service">
                                            <con2:path>$service</con2:path>
                                        </con2:param>
                                        <con2:param name="codeError">
                                            <con2:path>$fault/ctx:errorCode/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="state">
                                            <con2:path>'Error'</con2:path>
                                        </con2:param>
                                        <con2:param name="operation">
                                            <con2:path>$operation</con2:path>
                                        </con2:param>
                                        <con2:param name="value">
                                            <con2:path>$value</con2:path>
                                        </con2:param>
                                        <con2:param name="user">
                                            <con2:path>$user</con2:path>
                                        </con2:param>
                                        <con2:param name="parameters">
                                            <con2:path>''</con2:path>
                                        </con2:param>
                                        <con2:param name="key">
                                            <con2:path>$key</con2:path>
                                        </con2:param>
                                        <con2:param name="errorDetails">
                                            <con2:path>fn-bea:serialize($fault)</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:replace>
                        </con4:outboundTransform>
                    </con4:route>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53e8f55a.795ddf0e.0.188d936efc1.N7fd5" name="errorCodeHandling">
                <con:context>
                    <con2:userNsDecl prefix="cosnt" namespace="https://www.ficohsa.com/regional/constants"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N53e8f55a.795ddf0e.0.188d936efc1.N7fce</con2:id>
                        <con1:case id="_BranchId-N53e8f55a.795ddf0e.0.188d936efc1.N7fcd">
                            <con1:condition>
                                <con2:xqueryText>$method='REST'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:insert varName="inbound">
                                    <con2:id>_ActionId-N53e8f55a.795ddf0e.0.188d936efc1.N7fca</con2:id>
                                    <con1:location>
                                        <con2:xpathText>./ctx:transport/ctx:response</con2:xpathText>
                                    </con1:location>
                                    <con1:where>last-child</con1:where>
                                    <con1:expr>
                                        <con2:xqueryText>&lt;http:http-response-code>{data($responseError/cosnt:code)}&lt;/http:http-response-code></con2:xqueryText>
                                    </con1:expr>
                                </con1:insert>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fdf" name="StageReply">
                <con:context/>
                <con:actions>
                    <con2:reply>
                        <con2:id>_ActionId-N53e802d6.N21e827a5.0.1887ec75b1e.N7fdc</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="Pipeline Pair Node1">
                <con:request>request-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff8</con:request>
                <con:response>response-N53e802d6.N21e827a5.0.1887ec75b1e.N7ff7</con:response>
            </con:pipeline-node>
        </con:flow>
        <con:shared-variables>
            <con:variable>responseRegional</con:variable>
            <con:variable>requestService</con:variable>
            <con:variable>responseService</con:variable>
            <con:variable>requestError</con:variable>
            <con:variable>responseError</con:variable>
            <con:variable>destinationService</con:variable>
            <con:variable>requestRegional</con:variable>
            <con:variable>requestBitacora</con:variable>
            <con:variable>responseBitacora</con:variable>
            <con:variable>originalBody</con:variable>
            <con:variable>service</con:variable>
            <con:variable>uuid</con:variable>
            <con:variable>user</con:variable>
            <con:variable>destinationBank</con:variable>
            <con:variable>sourceBank</con:variable>
            <con:variable>version</con:variable>
            <con:variable>key</con:variable>
            <con:variable>value</con:variable>
            <con:variable>method</con:variable>
            <con:variable>state</con:variable>
            <con:variable>codeError</con:variable>
            <con:variable>messageError</con:variable>
            <con:variable>language</con:variable>
            <con:variable>targetSystem</con:variable>
        </con:shared-variables>
    </con:router>
</con:templateEntry>